\documentclass[uplatex,dvipdfmx]{jsreport}
\title{セミパラメトリック推測と経験過程}
\author{司馬博文}
\date{\today}
\pagestyle{headings} \setcounter{secnumdepth}{4}
\input{/home/hirofumi/StatisticalNature/preamble_no_fonts.tex}
%\input{/Users/hirofumi.shiba48/StatisticalNature/preamble_no_fonts.tex}
\usepackage[math]{anttor}
\renewcommand{\C}{\mathcal{C}}
\renewcommand{\Z}{\mathcal{Z}}
%\usepackage[deluxe]{otf}
\begin{document}
\tableofcontents

\chapter{枠組み}

\begin{quotation}
    統計モデル自体を形式的に定義したい．
    が，それを解析する手段は，幾何学的方法と解析学的方法の２つが存在し，互いに密接に，双対的に深く映りあっている．
    母数の空間は，統計モデルを多様体にする基礎空間となると同時に，それ自体位相線型空間である．
    あるいはこの考え方は，従来の数学という営み全体を，データの観点から捉え直す契機になることさえあるかもしれない．
\end{quotation}

\begin{notation}
    \begin{enumerate}
        \item $Y$をresponse variableとする．ベクトルである．
        \item $X$をcovariatesのなすベクトルとする．
        \item $Z_i$は$i$番目のunitに対応する確率ベクトルとする．$Z_1,\cdots,Z_n$は互いに独立同分布に従うとする．
        \item $Z$はある一回の観察に対応する確率ベクトルとする．
        \item 確率変数のrealizationには小文字$x,y$を用いる．
        \item $h\in H$の直交分解$u_0+u_1\in U+U^\perp$を，$u_0=\Pi(h|U)$と表す．
    \end{enumerate}
\end{notation}

\section{統計モデル}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    統計モデルという語の枠組みは明瞭になっているが，その選択に関しては，識別可能性程度しか概念が成熟していない．
    統計モデルの推論における有用さを，拡張可能性や自然性を圏論的に捉える試みがある．
\end{tcolorbox}

\subsection{統計モデルの枠組み}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    この枠組みに落とし込むまでに，ドメイン知識とmentalismが必要になる．\footnote{こういうところで，データ生成過程に対するドメイン知識が必要になる．統計学者のデイヴィッド・コックス卿は、「対象となる問題から統計モデルへの変換をどのように行うかが、分析の最も重要な部分であることが多い」と述べている。}
    全てのモデルは間違っている．
    しかしその中でも，モデルは無限次元である方が表現力・応用可能性・頑健性がある．
    が，数理的な扱いは困難になる．
    そこで，セミパラという希望の光が差し込む．
\end{tcolorbox}

\begin{definition}[sample space, parameter, experiment]\mbox{}
    \begin{enumerate}
        \item 可測空間$X$を\textbf{標本空間}という．
        \item （位相／可測）線型空間$\Theta$の元を\textbf{母数}という．
        \item 可測な族$(P_\theta)_{\theta\in\Theta}:\Theta\to\Delta(X)$を\textbf{統計モデル}という．\footnote{$\Delta(X)\subset P(X)$は単体である．$P(X)\subset M(X):=(C(X))^*$は$w^*$-コンパクトな凸集合であることに注意．}
        \item 組$(X,(P_\theta))$を\textbf{統計的実験}という．
    \end{enumerate}
\end{definition}

\begin{definition}[identifiable, parametric, nonparametric, semiparametric]\mbox{}
    \begin{enumerate}
        \item 族$(P_\theta)_{\theta\in\Theta}:\Theta\to\Delta(X)$が単射であることを，\textbf{識別可能}という．
        \item モデル$\F:\Theta\to\Meas(\X,[0,1])$の添字集合$\Theta$について，$\exists_{k\in\N}\;\Theta\subset\R^k$を満たす（有限次元）パラメトリックモデルと，そうでないノンパラメトリックモデルに別れる．
        \item 母数が$\theta=(\beta,\eta)\in\Theta_1\times\Theta_2=\Theta$という形に分解でき，$\Theta_1$が有限次元で$\Theta_2$が無限次元\footnote{関数や測度など}であるモデルを，\textbf{セミパラメトリックモデル}という．
        パラメトリックモデルとノンパラメトリックモデルは，セミパラメトリックモデルの退化と捉えたい．\footnote{むしろいくつかの特徴量で特徴付けられるような統計モデルの方が特殊なのである．}
    \end{enumerate}
\end{definition}

\begin{remarks}
    ほとんどの場合，実用的には「平均治療効果」など，特定の有限個の母数にのみ興味がある．
    人間のリソースは有限であるからだ．
    しかし，モデルとしては無限である方が祈りが高い．実際，自然な関数空間は押し並べて無限次元である．
    そこで現れる形式がセミパラメトリックモデルである．
\end{remarks}

\subsection{統計モデルを創るまで}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    What Is A Statistical Model?から作った節．
\end{tcolorbox}

\begin{definition}[statistical unit, covariate / independent variable, response]
    統計的実験$(X,(P_\theta))$や観察実験は，次の３要素からなる．
    \begin{enumerate}
        \item 統計的単位全体の集合$U$．
        \item 独立変数全体の集合$\Om$．\footnote{共変量ともいう．説明変数，予測因子，独立変数ともいう．「より狭義の意味では、covariateは従属変数と最も関心のある独立変数との関係に影響を与える二次的な変数である」\footnote{https://en.wikipedia.org/wiki/Dependent\_and\_independent\_variables\#Statistics\_synonyms}}
        \item 従属変数全体の集合$V$．\footnote{応答変数(response variable)ともいう．is a concept, idea, or quantity that someone wants to measure.}
    \end{enumerate}
    独立変数や施策(treatment)の配分$\chi:U\to\Om$を実験計画といい，その全体$D:=\Om^U$を計画空間という．
    あり得る結果の付値全体$X:=V^U$を標本空間という．
    確率分布は計画に依存することに注意．
\end{definition}

\subsection{統計という営み}

\begin{definition}[statistic]\mbox{}
    \begin{enumerate}
        \item 標本空間$X$上の写像（特に$X$上の確率測度の構造に依存しない写像）を\textbf{統計量}という．
    \end{enumerate}
\end{definition}

\section{分布という考え方}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    可測空間とは，汎関数が備わり得る空間である．
    確率密度関数などが考えられるが，一般の空間に拡張する際には，確率密度なる多様体的な幾何学的な概念にとって代わられる．
    統計モデルを幾何学的にみるか，解析的にみるかの双対性が成り立つはずである．

    この視点からすると，測度＝分布とは，極めて幾何学的な設定でもある．
    「積分されるべきもの」という観点からは共通である．
    幾何と解析の双対性の基本がここに観て取れる．
\end{tcolorbox}

超関数がdistributionというのと同様，分布とは／測度とは関数の一般化であり，汎関数に他ならない．

\begin{definition}[volume, density, distributional density, generalized smooth function]\mbox{}
    \begin{enumerate}
        \item 可微分多様体上の，至る所消えない最高次元の微分形式(top-dimentional form)を\textbf{体積形式}という．
        \item 可微分多様体上の\textbf{密度（形式）}とは，密度バンドルの切断をいう．作用素の視点からは，密度とは，座標変換に関してJacobianの絶対値倍の変換を受ける関数の族である．向き付け可能な多様体について，密度は$n$-形式＝体積形式$\dvol$と標準的に同一視できる．密度は体積形式の一般化である．
        \item 隆起関数の空間$C_c^\infty(X)$上の線型汎函数を\textbf{密度分布}という．これは多様体上の密度の概念の一般化と捉えられる．
        \item 密度分布は可微分写像の極限と考えられ，この観点に立った際には\textbf{超関数}という．
    \end{enumerate}
\end{definition}

\begin{example}\mbox{}
    \begin{enumerate}
        \item 確率密度とは密度の一種であり，積分の結果確率測度を生むものをいう．
        \item 確率密度関数は，空間を可測空間に限定する．
    \end{enumerate}
\end{example}

\section{回帰分析}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    推定論の基本として，目的変数と説明変数の間の関数関係にfittingするという指針の分析を，開基分析という．
\end{tcolorbox}

\begin{history}
    歴史上初めに行われた回帰分析は，LegendreとGaussによる最小二乗法である．
    回帰という用語はFrancis Galton 1822-11（従兄にDarwinを持つ）による\footnote{Cedric VillaniのTED Talk "It keeps on occuring again and again for many theories and many experiments as a great example of the universality which is so dear to us mathematicians."
    このガウス分布についてのFrancis Galton 1822-11の言葉が象徴的すぎる．
    “It would have been deified by the Greeks if they had known it. It is the supreme law of unreason.”
    Galton’s Boardなんてあるのか．}．
    GaltonはDarwinに感化され，自身は統計学を武器に生物学へ切り込んだ．Galton Boardを用いて中心極限定理を実感しながら，「平均への回帰」や「凡庸性の原理」を議論した．
    平均への回帰は相関係数が低い際に起こる普遍的現象であった．
\end{history}

\section{生存分析}

\chapter{パラメトリック有効性}

\section{正則なモデルの定義と十分条件}

\begin{notation}
    $(\X,\B)$上のモデル$\P\subset P(\X,\B)$を考える．
\end{notation}

\begin{definition}
    $\P=(P_\theta)_{\theta\in\Theta}$が次を満たすとき，\textbf{パラメトリックモデル}であるという：
    \begin{enumerate}
        \item $\exists_{k\in\R}\;\Theta\subset\R^k$．
        \item (識別可能性) $\Theta\to\P$は全単射．
    \end{enumerate}
    さらに次の条件を課す．
    \begin{enumerate}\setcounter{enumi}{2}
        \item $\Theta\osub\R^k$．
        \item 各$P_\theta$は$\sigma$-有限な参照測度$\nu$に対して絶対連続．
    \end{enumerate}
    このとき，
    \[p_\theta:=\dd{P_\theta}{\nu},\quad l_\theta:=\log p_\theta,\quad s_\theta:=\sqrt{p_\theta}\]
    とおく．
    $P_\theta$を$p_\theta,s_\theta$と同一視することで，Banach空間$L_1(\X,\B,\nu)$またはHilbert空間$L_2(\X,\B,\nu)$の部分集合とパラメトリックモデル$\P$とを同一視出来る．
    いずれの場合も$\P$に同値な位相を定める．
    Hellingerの距離$d_H(P_{\theta_1},P_{\theta_2}):=\norm{s_{\theta_1}-s_{\theta_2}}_{\nu,2}$によって距離化出来る．
    
    この上さらに次の3条件を満たすとき，パラメトリックモデルは\textbf{正則}であるとする．
    \begin{enumerate}\setcounter{enumi}{4}
        \item パラメータ付け$\Theta\to\P\mono L_2(\nu);\theta\mapsto s_\theta$は$L_2(\nu)$-微分可能：$\exists_{\dot{s}_\theta\in L^2(\nu;\R^k)}\;\norm{s_{\theta+h}-s_\theta-h^\top\dot{s}_\theta}_{\nu,2}=o(\norm{h})\;(h\to\infty)$．
        以降，微分を$\dot{s}_\theta$で表す．
        \item Fisher行列は可逆：$\int\dot{s}_\theta\dot{s}_\theta^\top d\nu\in\GL_k(\R)$．
        \item 合成$\Theta\to\P\to\R;\theta\mapsto s_\theta\mapsto \dot{s}_{\theta_i}\;(i\in[k])$は$L_2(\nu)$-連続：$\forall_{\theta\in\Theta}\;E_\nu[\norm{\dot{s}_{\theta+h}-\dot{s}_\theta}^2]\to0\;(h\to0)$．
    \end{enumerate}
    なおこのとき，$\P$は$k$-次元多様体をなしている．
\end{definition}

\begin{definition}
    $I_\theta:=4E_\nu[\dot{s}_\theta\dot{s}_\theta^\top]\in\GL_k(\R)$をFisher情報行列という．
\end{definition}

\begin{lemma}[正則性の十分条件]
    任意の$\theta\in\Theta\osub\R^k$が(4)までを満たす上に，次が成り立つとき，$(P_\theta)_{\theta\in\Theta}$は正則である：
    \begin{enumerate}
        \item $\nu\dae x$に対して$p_\theta$は微分可能で連続な勾配$\dot{p}_\theta$を持つ．
        \item $\dot{l}_\theta(x):=2\frac{\dot{p}_\theta(x)}{p_\theta(x)}1_{p_\theta>0}(x)$について，$\norm{\dot{l}_\theta}\in L_2(P_\theta)$．
        \item $I_\theta$は可逆で$\theta$に関して連続．
    \end{enumerate}
\end{lemma}

\begin{lemma}[lemma for Cramer-Rao]
    次の2条件は同値であり，パラメトリックモデルが正則ならば成り立つ：
    \begin{enumerate}
        \item $P_\theta\dot{l}_\theta=0$．
        \item $\forall_{i\in[k]}\;\brac{\dot{s}_{\theta_i},s_\theta}=0$．
    \end{enumerate}
\end{lemma}

\section{正則推定量}

\subsection{正則推定量}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    正則推定量は，Fisher情報行列の逆を分散とする正規分布に従う$X$と，ある分布$M_\theta$に従う$Y$という独立な2つの確率変数の和に漸近同等である．
    この分解により，$M_\theta=0$のときに漸近分散が最小になることが従う．
\end{tcolorbox}

\begin{definition}[locally normal]
    汎関数$\nu:\Theta\to\R^m$の推定量$(T_n)$が$\theta\in\Theta$において\textbf{(局所)正則}であるとは，$\sqrt{n}\norm{\theta_n-\theta}=O(1)$を満たす任意のパラメータ列$(\theta_n)$に対して，
    弱収束$\sqrt{n}(T_n-\nu(\theta_n))\xrightarrow{P_{\theta_n}}L_\theta$が成り立つことをいう．
\end{definition}
\begin{remarks}
    任意の方向ベクトル$h\in\R^k$に対して，
    \[\sqrt{n}\paren{T_n-\psi\paren{\theta+\frac{h}{\sqrt{n}}}}\xrightarrow{\theta+\frac{h}{\sqrt{n}}}L_{\theta,h}\]
    なる弱収束極限が存在するとする．
    正則性とは，$L_{\theta,h}$が十分近傍では$\theta$にも依らないことをいう．
    あるいは，$\dot{\psi}_\theta h$と漸近同等な推定量列のことをいう．
    A more informative name for "regular" is asymptotically equivalent-in-law.\cite{Asymptotic Statistics}
\end{remarks}
\begin{example}[Stein shrinkage estimator]
    Steinの縮小推定量は正則でない．
\end{example}

\begin{theorem}[Hajek-LeCamの畳み込み定理]
    $\P$の正則点$\theta\in\Theta$において，$\nu(\theta)$の推定量列$(T_n)$は正則で，極限分布$L_\theta$を持つとする．
    $\nu:\Theta\to\R^m$が$\theta\in\Theta$において微分可能ならば，ある確率分布$M_\theta$が存在して
    \[L_\theta=N(0,\dot{\nu}(\theta)I_\theta^{-1}\dot{\nu}(\theta)^\top)*M_\theta\]
    が成り立つ．
\end{theorem}

\begin{definition}[asymptotically efficient]
    推定量列$(T_n)$が正則で，その漸近共分散行列$\Sigma_\theta$が$\dot{\nu}(\theta)I_\theta^{-1}\dot{\nu}(\theta)^\top$と表せるならば，$(T_n)$は\textbf{漸近有効}であるという．
\end{definition}

\subsection{漸近有効推定量}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    漸近有効推定量は影響関数のことばによって特徴付けられる．
    そして影響関数とは，微分というよりも，漸近的な線型関係をいう．
\end{tcolorbox}

\begin{notation}
    $\abs{f}^2=f^\top(X) f(X)$が可積分な空間$L_2(P)$の，平均$0$のものがなす部分空間
    $L^0_2(P):=\Brace{f\in L^2(P)\mid Pf=0}$を考える．
    絶対値の二乗が2次形式として特別な意味を持つのである．
\end{notation}

\begin{definition}[asymptotically linear, influence function]
    一般のモデル$\P$と汎関数$\psi:\P\to\R^m$について，次が成り立つならば，\textbf{漸近線型}であるという：
    \[\forall_{P\in\P}\;\exists_{\check{\psi}_P\in\L_2^0(\X,P;\R^m)}\;T_n=\psi(P)+\bP_n\check{\psi}_P+o_P(n^{-1/2}).\]
    このときの漸近的な線型主要部$\check{\psi}_P$を$T_n$の\textbf{影響関数}という．
\end{definition}
\begin{remarks}
    漸近線型であるときは，正規近似$\sqrt{n}(T_n-\psi(P))\to N(0,P[\check{\psi}_P\check{\psi}_P^\top])$が成功する．
    また，推定誤差$T_n-\psi(P)$に対する観測$X_i-x$の影響は，1次近似として$n^{-1}\check{\psi}_P(x)$で与えられる．
\end{remarks}

\begin{theorem}[パラメトリックモデルにおける漸近有効性の特徴付け]
    パラメトリックモデル$\P=(P_\theta)_{\theta\in\Theta}$の正則点$\theta\in\Theta$において，$\nu(\theta)$は$\theta$で微分可能であるとする．
    次の2条件は同値：
    \begin{enumerate}
        \item $\nu(\theta)$の推定量列$(T_n)$が
        \[T_n=\nu(\theta)+\bP_n\wt{l}_{\theta|\nu,\P}+o_P(n^{-1/2}),\quad\wt{l}_{\theta|\nu,\P}(x):=\dot{\nu}(\theta)I_\theta^{-1}\dot{l}_\theta(x)\]
        と展開される．
        \item $(T_n)$は$\theta\in\Theta$において$\nu(\theta)$の漸近有効推定量列であり，その漸近分散は$I^{-1}_{\theta|\nu,\P}:=\dot{\nu}(\theta)I^{-1}_\theta\dot{\nu}(\theta)^\top$である．
    \end{enumerate}
\end{theorem}

\begin{definition}[efficient influence function, information bound, efficient information]\mbox{}
    \begin{enumerate}
        \item $\wt{l}_{\theta|\nu,\P}(x):=\dot{\nu}(\theta)I_\theta^{-1}\dot{l}_\theta(x)$を$\P$の$\nu$における\textbf{有効影響関数}という．
        \item $I^{-1}_{\theta|\nu,\P}:=\dot{\nu}(\theta)I^{-1}_\theta\dot{\nu}(\theta)^\top$とその逆行列を，それぞれ\textbf{情報量限界}と\textbf{有効情報量}という．
    \end{enumerate}
\end{definition}

\section{分離度}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    正則なパラメトリックモデルは多様体をなす．
    そこでまず，多様体上の分離度の一般論を調べる．
    分離度とは，2点の分離性を検出する関数であって，Taylor展開の2次項がRiemann距離を定めるものである．
\end{tcolorbox}

\begin{definition}[divergence]
    $(M^p,(\xi_x))$を可微分多様体とする．関数$D:M\times M\to\R_+$が\textbf{分離度}であるとは，
    \begin{enumerate}
        \item 非退化性：$D[P,Q]=0\Leftrightarrow P=Q$．
        \item 点$\xi$と同じ座標系で表せる近傍の点$\xi+d\xi$について，$D[\xi,\xi+d\xi]=\frac{1}{2}g_x(dx,dx)+O(\abs{dx}^3)=\frac{1}{2}\sum_{i,j\in[p]}g_{ij}(\xi)d\xi_i\otimes d\xi_j+O(\abs{d\xi}^3)\;(\abs{d\xi}\to0)$が定める行列$G(\xi)=(g_{ij}(\xi))$は正定値対称である．\footnote{$dx\in T^*(\P)$と見るのである！}
        \item 点$P\in M$の$r$-近傍$N(P,r):=\Brace{Q\in M\mid D[P,Q]<r}$は$r$について単調に増大する．
    \end{enumerate}
    $D^*(p,q):=D(q,p)$を双対分離度という．
\end{definition}
\begin{remarks}
    対称性も三角不等式も成り立たず，距離の概念とは違い，むしろ距離の二乗のような，分散のような概念である（次元解析の考え方）．
    (1)より$D$が半正定値であることがわかるが，これは，$D$は定数部分と線型部分を持たないことを意味する．定数部分は$D[P,P]=0$に矛盾し，線型部分は非負性に矛盾する．
    これは，$D$の二次部分が半正定値な二次形式であることを意味する．
    こうして，特に(2)で正定値性が成り立てば，自然にRiemann計量を定める．
    このとき非対称性は受け継がれ，これが双対性という方向を持った新たな構造を授ける．
\end{remarks}
\begin{remark}
    情報理論では，非対称性を強調して$D(p||q)$などと表す．
    また条件付き確率$P(A|B)$の記法に似ているが，これと同様に分離度
    も相対測度として見做す態度がある．
    この見方をするときKL分離度を相対エントロピーと呼ぶ．
\end{remark}

\begin{definition}[Kullback-Leibler information / divergence / relative entropy]
    $P,Q\in\P$について，
    \[I[Q,P]:=\int_\X q(x)\log\frac{q(x)}{p(x)}\nu(dx)\]
    によって定まる関数$I:\P\times\P\to\R_+$を\textbf{Kullback-Leibler情報量}という．
\end{definition}

\begin{example}[正規分布族のKL分離度]
    $M_n(\R)$の中の半正定値行列のなす部分多様体$\GL_n(\R)_+$は$n(n+1)/2$次元である．
    この多様体に
    \[D[P,Q]=\Tr(PQ^{-1})-\log\abs{PQ^{-1}}-n\]
    なるダイバージェンスが定まる．これは，$P,Q$を分散共分散行列とする平均$0$の正規分布の間のKLダイバージェンスになっている．
\end{example}

\section{Riemann計量}

\subsection{計量の定義}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
    title=]
    $T(a,b):=T(M)^{\otimes a}\otimes T^*(M)^{\otimes b}$の元を$(a,b)$-テンソルバンドルという（順に共変・反変）．ベクトル場は$(1,0)$-テンソル束の切断である．
\end{tcolorbox}

\begin{definition}[metric]\label{def-metric}
    滑らかなベクトル束$\pi:E\to M$を考える．
    \begin{enumerate}
        \item 全てのファイバー$E_x$に内積$(-,-)_x$が与えられており，内積空間である．
        \item 任意の滑らかな切断面$\sigma_1,\sigma_2\in\Gamma(E)$に対して，合成写像$(\sigma_1(-),\sigma_2(-))_{(-)}:M\to K$は滑らかである．
    \end{enumerate}
    $E$が$\R$上のベクトル束ならばRiemann計量，$\C$上のベクトル束ならばHermite計量という．
\end{definition}
\begin{remarks}
    $(\sigma_1(-),\sigma_2(-))_x\in\Gamma(E)\otimes_{C(X)}\Gamma(E)$は確かに共変2-テンソルである．
    任意の２つのベクトル場$\sigma_1,\sigma_2\in\Gamma(E)$に対して，$x\in M$をまずベクトル束$E_x$上の２つのベクトル$\sigma_1(x),\sigma_2(x)$に対応させ，そこで内積を取る対応．
\end{remarks}

\begin{theorem}
    任意のベクトル束には計量が存在する．
\end{theorem}

\subsection{双対バンドル}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
    title=]
    滑らかなベクトル束には計量が入り，各ファイバー$V_x$には内積が存在する．
    $V_x$の基底$\{e_1,\cdots,e_p\}$に対して$g_{\mu\nu}:=(e_\mu|e_\nu)$とおくと，対称性と基底であることより$(g_{\mu\nu})$は対称で正$\det(g_{\mu\nu})>0$な行列となる．
    この行列の単位行列からの乖離は正規直交系からの乖離を意味する．当然この表示を用いると
    \[(a|x)=\sum_{\mu,\nu=1}^pg_{\mu\nu}a^\mu x^\nu\]
    が成り立ち，内積が定める同型$V_x\sim V_x^*$は
    \[a=\sum^p_{\mu=1}a^\mu e_\mu\mapsto\sum^p_{\nu=1}\paren{\sum^p_{\mu=1}g_{\mu\nu}a^\mu}e^\nu=\varphi_a=(a|-)\]
    と表せる．
    双対基底を用いると，無理やりFourier係数を抽出出来る．
    
    ここで大域に目を戻すと，計量はバンドル全体に同型対応$E\simeq E^*$を導く．
\end{tcolorbox}

\begin{definition}\mbox{}
    \begin{enumerate}
        \item 内積空間$V$について，同型$V\to V^*:a\mapsto(a,-)$が定まる．これを\textbf{内積が定める標準的な同型対応}という．
        \item 各ファイバー$E_x\simeq E_x^*$にも標準同型が存在し，ここからベクトルバンドルとしての同型対応$E\simeq E^*$が引き起こされる．これを\textbf{計量が定める標準的な同型対応}という．
    \end{enumerate}
\end{definition}

\begin{discussion}
    バンドルとしての対応$E\simeq E^*$を局所的に調べる．

    $U\osub M$を座標近傍とし，$E$のこの上での自明性$E|_U\simeq U\times\R^p$を局所基底$(e_1,\cdots,e_p):U\to E$が与えるとする．
    このとき，$E_x\;(x\in U)$の基底$\{e_1(x),\cdots,e_p(x)\}$の双対基底$\{e^1(x),\cdots,e^p(x)\}$は，$E^*$の$U$上での自明性$E^*|_U\simeq U\times\R^p$を与える．

    ここから，$E,E^*$が同型であることを，対応を具体的構成することで示す．
    $E$の計量$(-|-)_-$に対して，$g_{\mu\nu}(x):=(e_\mu(x),e_\nu(x))_x\in\K$と定める．
    $(g_{\mu\nu}(x))\in\GL_p(\K)$だから，逆行列を持つが，これを$(g^{\mu\nu}(x))$で表すこととする．
    次の2つの写像は互いに逆になっている：
    \[\xymatrix@R-2pc{
        \Gamma(E|_U)\ar[r]&\Gamma(E^*|_U)\\
        \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
        \al(x)=\sum^p_{\mu=1}\al^\mu(x)e_\mu(x)\ar@{|->}[r]&\sum^p_{\mu=1}\paren{\sum^p_{\nu=1}g_{\mu\nu}(x)\al^\nu(x)}e^\mu(x)=\beta(x)
    }\]
    \[\xymatrix@R-2pc{
        \Gamma(E^*|_U)\ar[r]&\Gamma(E|_U)\\
        \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
        \beta(x)=\sum^p_{\mu=1}\beta_\mu(x)e^\mu(x)\ar@{|->}[r]&\sum^p_{\mu=1}\paren{\sum^p_{\nu=1}g^{\mu\nu}(x)\beta_\nu(x)}e_{\mu(x)}
    }\]
    さらに，$E^*$に計量が押し出され，それは局所的には$g^{\mu\nu}(x)=(e^\mu(x),e^\nu(x))_x$と表せる．
\end{discussion}
\begin{remarks}
    よって，Fisher情報行列とその逆とは双対的な関係にある．
\end{remarks}

\subsection{Riemann計量}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    Riemann計量とは，接束という特別具体的なベクトル束に与えられた計量をいう．
    こう見ると，これは$(0,2)$-テンソル場$g\in\Gamma(T^*(M)\otimes T^*(M))$である．
    局所的には正定値な対称行列であり，$(0,2)$-テンソル場としての変換則を満たす大域的な存在がRiemann計量である．
\end{tcolorbox}

\begin{remarks}
    接バンドル$T(M)$に計量が与えられたとき，$M$にRiemann計量が与えられたという．
    計量の定義\ref{def-metric}を局所的な「各点ごとに見ると内積」とは違って大域的に定義すると，滑らかな$(0,2)$-テンソル場$g\in\Gamma(T^*(M)\otimes T^*(M))$であって，(Hermite)対称かつ正定値なものをいう．
    すなわち，$g_x:T_x(M)\times T_x(M)\to\R$を満たす双線型写像で，$g_x(X,Y)=g_x(Y,X)$かつ$g_x(X,X)>0\;(X\ne 0)$として扱える．
    $g:M\to T^*(M)\otimes T^*(M)$は，各$(U,(x^1,\cdots,x^n))$上での$C^\infty$関数$g_{ij}:=\paren{\pp{}{x^i},\pp{}{x^j}}$の貼り合わせである．
    これに対して内積は$\brac{X,Y}_x:=g_x(X,Y)$で復元できる．
\end{remarks}

以上のことを逆から議論すると次のようになる．

\begin{notation}
    各接空間$T_x$の内積について，
    \[g_{\mu\nu}^\al(x):=\paren{\pp{}{x_\al^\mu},\pp{}{x^\nu_\al}}_x\]
    とおくと，$g_{\mu\nu}^\al:U_\al\to\R$は滑らかな関数であり，各点で$\det(g^\al_{\mu\nu})>0$を満たす．
    （ベクトル場の成分の２次元版）．
    さらに，内積は，$\xi,\eta$を数ベクトル$(\xi^\mu),(\eta^\nu)$とEuclid空間での内積$\brac{-,-}$を用いて
    \[(\xi,\eta)=\brac{(\xi^\mu),G(\eta^\nu)}\]
    と表せる．

    $x\in U_\al\cap U_\beta$のとき，$(g_{\mu\nu}^\al(x))$と$(g_{\mu\nu}^\beta(x))$との間の変換則は，
    \[g_{\mu\nu}^\beta(x)=\sum^n_{i,j=1}\pp{x_\al^i}{x_\beta^\mu}\pp{x_\al^j}{x^\nu_\beta}g_{ij}^\al(x)\]
    すなわち$(g^\beta_{\mu\nu})=\paren{\pp{x^i_\al}{x^\mu_\beta}}^\top(g_{ij}^\al)\paren{\pp{x^j_\al}{x_\beta^\nu}}$
    で与えられる．
    ベクトル場の変換則は$(\xi_\beta^\mu)=\paren{\pp{x_\beta}{x_\al}}(\xi_\al^\nu)$で与えられることに注意．たしかに2階の反変テンソルである．

    逆に，各局所座標$U_\al$上で定義された正値行列$(g_{\mu\nu}^\al(x))$で，$U_\al\cap U_\beta$上で上述の$(2,0)$-テンソルの貼り合わせの条件を満たすものを与えることで，計量が定まる．
    これを
    \[ds^2=\sum g_{\mu\nu}^\al(x)dx^\mu_\al dx_\al^\nu\]
    と表す．
\end{notation}
\begin{remarks}
    こうして，貼り合わせの考え方からみると，Riemann計量とは局所的には各$U_\al$上の正定値対称行列$(g_{\mu\nu}^\al(x))$で，
    $(2,0)$-テンソルとしての貼り合わせの変換則を満たすもの，と捉えられる（そのようなものを定めるとRiemann計量が一意に定まる）．
    テンソルと言ってもビビらなくて良い，大域的に存在するための整合性を満たすというだけの消息である．
\end{remarks}

\section{接続}

\subsection{微分作用素の定義と例}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
    title=]
    微分作用素とは，ベクトル束の切断の間の線型写像であって，
    $\sigma\in\Gamma(E)$がある開集合$U$上で恒等的に$0$ならば，微分しても$0$であるという性質を抽出して，「台を縮小させる切断間の線型作用素」と定義する．
\end{tcolorbox}

\begin{definition}[differential operator]
    $E,F$を$M$上のベクトル束とする．
    線型写像$\Phi:\Gamma(E)\to\Gamma(F)$が，任意の$\sigma\in\Gamma(E)$に対して$\supp\Phi(\sigma)\subset\supp\sigma$を満たすとき，これを\textbf{微分作用素}という．
\end{definition}

\begin{lemma}\mbox{}
    \begin{enumerate}
        \item 微分作用素の全体は線型空間をなす．これを$D(E,F)\subset\Hom_\R(E,F)$で表す．
        \item $C(M)$-加群の構造も持つ．
    \end{enumerate}
\end{lemma}

\begin{example}\mbox{}
    \begin{enumerate}
        \item 多重指数$\al\in\N^n$について，$D^\al$は微分作用素である．これらの線型結合も微分作用素である．
        \item 局所有限な開被覆$(V_i)_{i\in\N}$について，これに属する1の分解$(\varphi_i)$を用いて，$D^\al$の線型結合で表される微分作用素の局所有限和
        $\Phi:=\sum^\infty_{i=1}\varphi_i\Phi_i$も微分作用素である．この形の微分作用素は一般に階数を持つとは限らない．
        Peetreの定理より，$D(\ep^1,\ep^1)$の元はすべてこの形で表される．
    \end{enumerate}
\end{example}

\subsection{Peetreの定理}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    $\Phi$の局所座標への制限$\Phi|_U:C_c(U,\R^p)\to C_c(U,\R^p)$を行列表示したこととなる．
\end{tcolorbox}

\begin{theorem}[微分作用素の局所表示]
    $\Phi\in D(E,F)$を微分作用素とする．
    $M$の座標近傍$\{U,(x^1,\cdots,x^n)\}$について，$\o{U}$はコンパクト，$E|_U,F|_U$は自明束となっているとする．
    $\sigma\in\Gamma(E)$は$\supp\sigma\subset U$を満たし，$\sigma(x)=(\sigma^1(x),\cdots,\sigma^p(x))\;(x\in U)$と表せるとし，$\Phi(\sigma)(x)=(\tau^1(x),\cdots,\tau^q(x))\;(x\in U)$と表す．
    このとき，次の関係が成り立つ：
    \[\begin{pmatrix}\tau^1(x)\\\vdots\\\tau^q(x)\end{pmatrix}=(\Phi^i_j(x))\begin{pmatrix}\sigma^1(x)\\\vdots\\\sigma^p(x)\end{pmatrix}.\]
    ただし，
    \[\Phi^i_j(x)=\sum_{\abs{\al}\le k}{a^i_j}_\al(x)D^\al\quad(\al\in\N^n,{a^i_j}_\al\in C^\infty(U)).\]
\end{theorem}

\begin{definition}
    $\sigma\in C(U,\R^p)$に対して，$\al$が点$x_0\in U$で$D^\al\sigma(x_0)=0\;(\abs{\al}\le k)$を満たすとき，$\sigma$は\textbf{$x_0$で$k$-平旦}であるという．
\end{definition}

\subsection{微分作用素の階数}

\begin{definition}
    微分作用素$\Phi$が局所的に常に
    \[\Phi^i_j(x)=\sum_{\abs{\al}\le k}{a^i_j}_\al(x)D^\al\quad(\al\in\N^n,{a^i_j}_\al\in C^\infty(U))\]
    と表せるとき，これを\textbf{$k$-階}という．
    $k$-階微分作用素のなす部分空間を$D_k(E,F)$で表す．
\end{definition}

\begin{corollary}
    $\Phi\in D(E,F)$について，
    \begin{enumerate}
        \item $k$-階である．
        \item $\forall_{x\in M}\;j^k(\sigma)(x)=0\Rightarrow\Phi(\sigma)(x)=0$．すなわち，局所座標を用いて表せば，$D^\al\sigma(x)=0\;(\abs{\al}\le k)$．
    \end{enumerate}
\end{corollary}

\begin{theorem}\mbox{}
    \begin{enumerate}
        \item $D_0(E,F)\subset D_1(E,F)\subset\cdots$が成り立つ．
        \item $\cup_{k\in\N}D_k(E,F)=D(E,F)$が成り立つことと，$M$がコンパクトであることとは同値．
    \end{enumerate}
\end{theorem}

\section{局外母数と情報量の幾何}

\begin{notation}
    正則なパラメトリックモデル$\P=(P_\theta)_{\theta\in\Theta= N\times H}$について，
    \begin{enumerate}
        \item $\dl:=\dl_{\theta_0}=\left.\dd{}{\theta}\log p_\theta(x)\right|_{\theta=\theta_0}=\frac{\dotp_{\theta_0}(x)}{p_{\theta_0}(x)}1_{\Brace{p_\theta\ne0}}(x)$をスコア関数とする．
        \item $I:=I_{\theta_0}=P_{\theta_0}[\dl\dl^\top]=E_{\theta_0}[\abs{\dl}^2]$はスコアの2次のモーメントであるが，これをFisher情報行列という．
        \item $\wl:=\wl_{\theta_0}=I_{\theta_0}^{-1}\dl_{\theta_0}$を有効影響関数とする．
    \end{enumerate}
\end{notation}

\section{局所漸近正規性}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
パラメータのスケーリングの違いを除いて，局所漸近正規なモデルはあるガウスモデルに収束する．
\end{tcolorbox}

\begin{discussion}
    ある点$\theta_0\in\R^k$に注目して，その周りの
    局所パラメータを$h:=\sqrt{n}(\theta-\theta_0)$とすると，元の統計的実験$(\X^n,\A^n,(P_\theta^n)_{\theta\in\R^k})$は，
    $(\X^n,\A^n,(P^n_{\theta_0+h/\sqrt{n}})_{h\in\R^k})$と変換される．
    するとこの統計的実験は，元の統計的実験$\theta\mapsto P_\theta$が滑らかであるとき，
    $(\X^n,\A^n,(N(h,I_{\theta_0}^{-1}))_{h\in\R^k})$に漸近する！
\end{discussion}

\subsection{尤度の拡張}

\begin{discussion}
    $P_\theta\ll\mu$とし，$p_\theta:=\dd{P_\theta}{\mu}$と表す．
    ここでは$\theta,h\in\R$のような記法をするが，$k$次元としても$\dot{l}(x)$が$k$ベクトルになり，掛け算が内積または二次形式になるのみである．
    $l_\theta(x):=\log p_\theta(x)\in C^2(\X)$と仮定すると(この仮定は強すぎるが)，Taylorの定理より，
    \[\log P_{\theta+h}(x)=l_\theta(x)+\dot{l}_\theta(h)+\frac{1}{2}\ddot{l}_\theta(x)h^2+o_x(h^2).\quad h\in\R^k,h\to0\]
    \[\log\frac{p_{\theta+h}}{p_\theta}(x)=h\dot{l}_\theta(x)+\frac{1}{2}h^2\ddot{l}_\theta(x)+o_x(h^2).\quad h\in\R^k,h\to0\]
    ここで尤度比が現れる．特に$x$に観測値$X_1,\cdots,X_n$を代入し，$h$を$\frac{h}{\sqrt{n}}$として$n\to\infty$の極限を考えると，
    \[\log\prod_{i=1}^n\frac{p_{\theta+h/\sqrt{n}}}{p_\theta}(X_i)=\frac{h}{\sqrt{n}}\sum^n_{i=1}\dot{l}_\theta(X_i)+\frac{1}{2}\frac{h^2}{n}\sum^n_{i=1}\ddot{l}_\theta(X_i)+\sum_{i=1}^no_x\paren{\frac{h^2}{n}}\quad(n\to\infty)\]
    ここで，$E_\theta[\dot{l}_\theta]=0,-E_\theta[\ddot{l}_\theta]=E_\theta[\dot{l}^2_\theta]=I_\theta$だから，
    \begin{enumerate}
        \item $\Delta_{n,\theta}:=\frac{1}{\sqrt{n}}\sum^n_{i=1}\dot{l}_\theta(X_i)\in\R$とおくと$\Delta_{n,\theta}\xrightarrow{d}N(0,I_\theta)$（中心極限定理）．
        \item 大数の法則より$\frac{1}{n}\sum^n_{i=1}\ddot{l}_\theta(X_i)\xrightarrow{d}-I_\theta$．
        \item 3項目はおそらく確率収束（仮定をうまく設定すれば良い）．
    \end{enumerate}
    よって，
    \[\log\prod_{i=1}^n\frac{p_{\theta+h/\sqrt{n}}}{p_\theta}(X_i)=h\Delta_{n,\theta}-\frac{1}{2}I_\theta h^2+o_{p_\theta}(1)\]
    が成り立つ．
    実は，必要な過程は，$L^2$-微分の言葉で簡潔に書ける．
\end{discussion}

\begin{theorem}[局所漸近正規性の十分条件]\label{thm-sufficient-condition-for-parametric-LAN}
    モデル$(p_\theta)_{\theta\in\Theta\osub\R^k}$は，
    密度関数の平方根$\theta\mapsto\sqrt{p_\theta}$が$L^2$-微分可能であるとする：
    \[\exists_{\dot{l}\in\L^2(\X)}\quad\int\paren{\sqrt{p_{\theta+h}}-\sqrt{p_\theta}-\frac{1}{2}h^\top \dot{l}_\theta\sqrt{p_\theta}}^2d\mu=o(\norm{h}^2)\quad(h\to0).\]
    なお，通常の意味で微分可能であった場合は，
    \[\frac{1}{2}\dot{l}_\theta\sqrt{p_\theta}=\pp{\sqrt{p_\theta}(x)}{\theta}\quad\Leftrightarrow\quad \dot{l}_\theta=\pp{}{\theta}\log p_\theta(x)\]
    が必要であることに注意．このとき，
    \begin{enumerate}
        \item $E_\theta[\dot{l}]=0\in\R^k$かつ$I_\theta:=E_\theta[\dot{l}_\theta\dot{l}_\theta^\top]\in M_k(\R)$が定まる．
        \item 任意の収束列$\{h_n\}\subset\Theta,h_n\to h$について，$\Delta_{n,\theta}:=\frac{1}{\sqrt{n}}\sum^n_{i=1}\dot{l}_\theta(X_i)\in\R^k$とすると，
        \[\log\prod_{i=1}^n\frac{p_{\theta+h_n/\sqrt{n}}}{p_\theta}(X_i)=h^\top\Delta_{n,\theta}-h^\top\frac{1}{2}I_\theta h+o_{p_\theta}(1)\]
    \end{enumerate}
\end{theorem}

\begin{definition}[LAN: local asymptotic normal]
    モデル$(P_{n,\theta}|\theta\in\Theta)_{n\in\N}$が$\theta_0\in\Theta$において\textbf{局所漸近正規}であるとは，
    \begin{enumerate}
        \item 行列$r_n,I_{\theta_0}\in M_k(\R)$，
        \item $P_{\theta_0}$の下で$N(0,I_{\theta_0})$に分布収束する確率変数$\Delta_{n,\theta}:\Om\to\R^k$，
    \end{enumerate}
    が存在して，任意の収束列$\{h_n\}\subset\R^k,h_n\to h$について，
    \[\log\frac{dP_{n,\theta+r_n^{-1}h_n}}{dP_{n,\theta}}=h^\top\Delta_{n,\theta}-\frac{1}{2}h^\top I_\theta h+o_{P_{n,\theta}}(1)\]
    と展開できることをいう．
\end{definition}
\begin{example}
    $L^2$-微分可能なモデル$(P_\theta)_{\theta\in\Theta}$が定める実験列$(P^n_\theta)$は，$r_n=\sqrt{n}I$を行列として局所漸近正規である．
\end{example}

\subsection{正規実験への収束}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    上の「局所漸近正規性」の意味を，統計的実験列の収束概念以前の状態で考えたい．

\end{tcolorbox}

\begin{discussion}
    統計的実験が収束するとき，元の実験で弱収束する統計量は，極限実験での弱収束先に法則同等である．
\end{discussion}

\begin{definition}
    ランダム化された統計量$T=T(X,U)$とは，$U\sim U([0,1])$にも依存する統計量をいう．
\end{definition}

\begin{theorem}[局所漸近正規性の十分条件]
    モデル$(p_\theta)_{\theta\in\Theta\osub\R^k}$は，
    密度関数の平方根$\theta\mapsto\sqrt{p_\theta}$が$L^2$-微分可能であり，Fisher情報行列$I_\theta:=E_\theta[\dot{l}_\theta\dot{l}_\theta^\top]\in\GL_k(\R)$が可逆であるとする．
    実験$(P_{\theta+h/\sqrt{n}})_{h\in\R^k}$における統計量$T_n:\X^n\to\R^k$が，
    任意の$P_{\theta+h/\sqrt{n}}\;(h\in\R^k)$について弱収束するとき，
    実験$(N(h,I^{-1}_{\theta}))_{h\in\R^k}$上のランダム化された統計量$T:=T(X,U):\X\times[0,1]\to\R^k$が存在して，任意の$h$について同じ収束先へ分布収束する．
\end{theorem}

\chapter{セミパラメトリック有効性}

\begin{quotation}
    一部の特徴はパラメータ付けすることが可能なほど知見があり，一方で残りは生の関数のまんま残しておくモデルをセミパラメトリックモデルという．
    また別の見方として，$\P\subset P(\X)$を完全に未知として，既知の汎関数$\psi:\P\to\R^p$の値の推定を考える問題はセミパラメトリックモデルである．

    このようなモデルは複雑な構造ゆえ，（解析的な解決は無理で）アルゴリズム的な実装のみが可能な，非線形な推定過程を必要とする．
    そこで，\textbf{最も重要な手続きは漸近理論}となり(大標本理論の延長)，実際のサンプルサイズに対するパフォーマンスは，シミュレーションと数値実験によって検証されることとなる．
    しかし多くのパラメータ$\theta$は，古典的モデルと同様の収束レートと漸近正規性をもって推定可能である．

    観察研究などで，欠測データへの配慮を行わないこと（"complete case analysis"と呼ばれて，解析ソフトはデフォルトでこの挙動を行うものも多い）は深刻なバイアスをもたらしかねない．
    欠測データと言っても，"censored data"を含む．これは生存解析でよく直面する．\cite{Tsiatis}

    一致で漸近正規な統計量をsemiparametric estimatorという．
    これの存在や探し方は，影響関数の幾何学から重大な示唆がある．
    まず効率性理論(efficiency theory)を議論し，これはパラメトリックな場合をほぼ完璧に一般化する．
    が，推測理論において未解決問題が多い．

    \begin{enumerate}
        \item 最尤推定法は，共変量$x$と結果変数$y$の間のパラメトリックなモデルを立て，その中では「最適」かもしれない．
        \item 傾向スコア・マッチングでは，傾向スコア$e(x)=\pr(z=1|x)$の推定が大事になる．すなわち，共変量$x$と割当$z$の間の回帰関係をパラメトリックに解析するが，その後の結果変数と共変量の間には回帰モデルを仮定する必要がない．
        \item 割当変数$z$は大抵一次元で，モデルの誤設定の可能性は低いので，ロバストであると言える．\footnote{Drake 1993}が，もっと祈りを高く，二重にロバストであることを考えたい．
    \end{enumerate}
\end{quotation}

\section{例}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    ほとんどの場合，無限次元空間は関数空間であり，有限次元空間は何かしらの特徴量である．
\end{tcolorbox}

\subsection{Restricted Moment Models}

$\mu\in C(\Theta_1\times\Theta_2),\beta\in\Theta_2\subset\R^q$に関して，
$E(Y|X)=\mu(X,\beta)$
という回帰関係を仮定する．
これ以上の仮定を置かない場合，これはセミパラメトリックモデルで，Chamberlain and Neweyによって計量経済学から研究され，Liang and Zegerにより広められた．

\subsection{Proportional Hazards Model}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    We assume the treatment effect can be modeled multiplicatively (parametrically) on some completely unknown scale.
    Such models have arisen in a wide variety of contexts in recent years, particularly in economics, epidemiology, and astronomy.\cite{Bickel}
\end{tcolorbox}

Coxにより72年に導入された生存解析におけるモデル．

\begin{align*}
    \lambda(t|X)&=\lim_{h\to0}\paren{\frac{P(t\le T<t+h|T\ge t,X)}{h}}\\
    &=\lambda(t)\exp(\beta^TX).
\end{align*}

\subsection{Nonparametric Model}

セミパラメトリックモデルの解析に於ても，$\beta(\theta)$なる汎関数を推定する際などは，$\theta$の分割は特に数理的な示唆を与えない．

\section{関数デルタ法}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    確率変数の分布収束について，$r_n(T_n-\theta)$の極限分布から$r_n(\varphi(T_n)-\varphi(\theta))$の極限分布を得る手法をデルタ法というのであった．
    $T_n$が確率過程である場合についての理論の拡張を関数デルタ法という．
    $\varphi$はEuclid空間間の可微分写像ではなく，Hilbert空間間の(Hadamard)可微分作用素となる．
\end{tcolorbox}

\begin{example}[space of mean-zero and bounded second moments random functions]
    標本空間$(X,A,P)$上の$q$次元確率関数$h:X\to\R^q$であって，$E[h(Z)]=0,E[h^T(Z)h(Z)]<\infty$を満たすもの全体はHilbert空間$H_\mb$をなす．
    なお，確率関数とは，可測関数$h\circ Z$を表す．
    内積$(h_1|h_2):=E[h_1^Th_2]$を共分散内積と呼ぶ．
\end{example}

\subsection{経験過程の場合：von Mises解析}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    $P$を真の分布，$\bP_n$を経験分布とする．
    多くの統計量は，一定の汎関数$\varphi:\P\to\R$について，
    $\varphi(\bP_n)$という形の汎関数とみなせる．
\end{tcolorbox}

\begin{theorem}[復習：Taylorの定理]
    Frechet多様体上の汎関数$\varphi:\P\to\R$は，ある$H\in\P$が定める実関数$\varphi(P+tH):(-\ep,\ep)\to\R$が$C^m$-級であるとする．
    このとき，
    \[\varphi(P+tH)-\varphi(P)=t\varphi'_P(H)+\cdots+\frac{t^m}{m!}\varphi^{(m)}_P(H)+o(t^m)\]
    が成り立つ．ただし，$\varphi'_P:T_P(\P)\to T_{\varphi(P)}(\R)$は線型写像．
\end{theorem}
\begin{remarks}[von Mises展開]
    このTaylor展開に$t=n^{-1/2},H=\bG_n=\sqrt{n}(\bP_n-P)$ととると，
    \[\varphi(\bP_n)-\varphi(P)=\frac{1}{\sqrt{n}}\varphi'_P(\bG_n)+\cdots+\frac{1}{m!}\frac{1}{n^{m/2}}\varphi^{(m)}_P(\bG_n)+\cdots\]
    となる．ただし，剰余項は$1/n^{m/2}$と$\varphi^{(m+1)}_P(\bG_n+\delta)$の形をしているため，必ずしも$n\to0$のとき$0$に収束するとは限らない．
    しかし，$1/n^{m/2}$は十分高次の微小量だし，$\bG_n$は有界であるので，この展開が成り立つとする仮定は合理的である．
\end{remarks}

\begin{discussion}[1次のvon Mises展開からわかること]
    仮に$\varphi$は$P$を中心として$\bP_n$方向にvon Mises展開が可能で，2次以上の項が無視できるとき，
    \[\varphi(\bP_n)-\varphi(P)\approx\frac{1}{\sqrt{n}}\varphi'_P(\bG_n)=\frac{1}{n}\sum^n_{i=1}\varphi'_P(\delta_{X_i}-P)\]
    と表せる．右辺は$X_i$の，可測関数$\varphi'_P(\delta--P)$との合成であるから，独立な実確率変数の平均である．
    よって，各項が$L^2(\Om)$に入るならば，
    中心極限定理より，$\sqrt{n}(\varphi(\bP_n)-\varphi(P))$の分布は正規である．

    今，可測性の過程を置いた対応$\X\ni x\mapsto\varphi'_P(\delta_x-P)\in\R$を\textbf{影響関数}といい，$\IF(x;\varphi,P)$と表す．
    今まで$\varphi'_P$は線型作用素$T_P(\P)\to T_{\varphi(P)}(\R)$と見ていたが，数学的にはこの段階では，$x\in\X$の定める道毎の微分
    \[\IF(x;\varphi,P):=\varphi'_P(\delta_x-P)=\left.\dd{}{t}\varphi((1-t)P+t\delta_x)\right|_{t=0}\]
    とすれば良い．
    これは，新たな観測$x\in\X$が追加された経験測度$\bP_{n+1}$は
    \[\varphi(\bP_{n+1})-\varphi(P)\approx\frac{1}{n}\sum^n_{i=1}\varphi'_P(\delta_{X_i}-P)+\IF(x;\varphi,P)\]
    となるから，漸近分散がその分だけ撹乱されることとなり，$\IF$が$\X$上有界でない場合特に漸近的に問題となる．
\end{discussion}
\begin{discussion}[影響関数の具体的表示ができるとき]
    線型作用素$\varphi'_P:\P\to\R$は，各$\wt{\varphi}_P$を用いて積分作用素$H\mapsto\int_\X\wt{\varphi}_PdH$と等しくなるかも知れない．
    さらに$\int\wt{\varphi}_PdP=0$もみたす
    とき，$\wt{\varphi}_P$も\textbf{影響関数}という．
    実際，
    \[\varphi'_P(\delta_x-P)=\int\wt{\varphi}_P(d\delta_x-dP)=\int\wt{\varphi}_Pd\delta_x-\int\wt{\varphi}_PdP=\wt{\varphi}_P(x).\]
\end{discussion}
\begin{remark}[記法の基礎づけについて]
    $\int\wt{\varphi}_P(d\delta_x-dP)$という積分形式に演算が定まっているかのような表記や$\int\wt{\varphi}_Pd\delta_x$という未定義積分は，
    超関数の場合と同様，$\int-d-$をFrechet多様体$\P$上の双線型形式(ペアリング)と思えば良い．
\end{remark}

\begin{example}[$M$-推定量の影響関数]
    推定関数$\psi:\X\times\Theta\to\R^p\;(\Theta\osub\R^p)$に対して，汎関数$T:P(\X)\to\Theta$は推定方程式$\forall_{P\in\P}\;\int_\X\psi(x,T(P))P(dx)=0$を満足すると仮定する．
    すると経験分布$\bP_n$について，$\wt{\theta_n}:=T(\bP_n)$は推定関数$\psi$に関する$M$-推定量である．
    $T$が前述条件を満たす$M$推定量を与える汎関数であり，$\forall_{(x,\theta)\in\X\times\Theta}\;\abs{\partial_\theta\psi}$は可積分であるとする．
    \[\IF(x;T,P)=\Gamma(P)^{-1}\psi(x,T(P)),\qquad\Gamma(P):=-\int_\X\partial_\theta\psi(y,T(P))P(dy)\]
    特に，$p=1$のとき，推定関数$\psi(x,T(P))\in\R^p$の定数倍である．
\end{example}
\begin{proof}
    推定方程式より
    \[0=\int_\X\psi(x,T(P+\ep\delta_x))(P+\ep\delta_x)(dx)=\int_\X\psi(x,T(P+\ep\delta_x))P(dx)+\ep\psi(x,T(P+\ep\delta_x))\]
    が成り立つ．この両辺を$\ep$で微分して$\ep=0$を考えると，関数$\forall_{(x,\theta)\in\X\times\Theta}\;\abs{\partial_\theta\psi}$は可積分であるとすると，微分と積分とは交換可能であるから，
    \[0=\paren{\int_\X\partial_\theta\psi(x,T(P))P(dx)}\cdot\left.\dd{}{\ep}T(P+\ep\delta_x)\right|_{\ep=0}+\psi(x,T(P)).\]
\end{proof}

\subsection{Hadamard微分可能性}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    「$D$全域でGateaux微分可能」という概念を拡張し，任意の点列について極限$\frac{\varphi(\theta+th_t)-\varphi(\theta)}{t}$が導関数の値にノルム収束することを必要とする．
    これはEuclid空間$\R^n$で全微分可能性を定義したときと並行な議論であるが，なんとノルム空間にとってはこれでもまだFrechet微分可能性より弱い！
\end{tcolorbox}

\begin{notation}
    ノルム空間$D$に値を取る
    統計量の列$(T_n:\Om^n\to D)$を考える．
    これは経験測度$\bP_n:\Om^n\to D(\o{\R})$の一般化となる．
    ある可測関数$T:\Om\to D$と$\theta\in D,r_n\to\infty$について$r_n(T_n-\theta)\xrightarrow{d}T$が成り立つとする．
    このときの，可微分作用素$\varphi:D\to E$の値$\varphi(T)$の極限分布$r_n(\varphi(T_n)-\varphi(\theta))$を考えたい．
\end{notation}

\begin{definition}[Gateaux differentiable, Hamadard differentiable, Hadamard differentiable tangentally with a subset]
    ノルム空間$D,E$の間の作用素$\varphi:D\to E$について，
    \begin{enumerate}
        \item $\theta\in D$にて\textbf{Gateaux微分可能}とは，写像$\varphi'_\theta:D\to E;h\mapsto\varphi'_\theta(h)\;\st\varphi(\theta+th)-\varphi(\theta)=t\varphi'_\theta(h)+o(t)$が存在することをいう．
        このとき，$\varphi'_\theta$は線型とは限らない．ある近傍$\theta\in U$について，連続なGateaux微分$U\times D\to E$が存在するならば，$\varphi'_\theta$は連続かつ線型である．
        \item $\theta\in D$にて\textbf{Hadamard微分可能}とは，連続な線型作用素$\varphi'_\theta:D\to E$が存在して，任意の$h\in D$と$h$へ収束する道$(h_t)$について，
        \[\Norm{\frac{\varphi(\theta+th_t)-\varphi(\theta)}{t}-\varphi'_\theta(h)}_E\xrightarrow{t\to0}0.\]
        \item 連続な線型作用素$\varphi'_\theta$が$D_0\subsetneq D$上でしか存在しない場合，$\varphi$は\textbf{$D_0$に接してのみHadamard微分可能}であるという．
        \item 
    \end{enumerate}$\theta\in D$にて\textbf{Frechet微分可能}とは，連続な線型作用素$\varphi'_\theta:D\to E$が存在して，$\norm{\varphi(\theta+h)-\varphi(\theta)-\varphi'_\theta(h)}=o(\norm{h})\;(\norm{h}\to0)$．
\end{definition}

\begin{lemma}[Hadamard微分可能性の特徴づけ]
    $D$上Gateaux微分可能な作用素$\varphi:D\to E$について，
    \begin{enumerate}
        \item Hadamard微分可能である．
        \item 任意の$\theta\in D$と任意のコンパクト集合$C\subset D$について，$\frac{\varphi(\theta+th)-\varphi(\theta)}{t}$は任意の$h\in C$について一様収束する．
    \end{enumerate}
\end{lemma}
\begin{remarks}
    確率変数の法則収束はProkhorovの定理を通じてコンパクト集合と深い関係があることも，Hadamard微分との関連の深さに寄与している．
\end{remarks}

\begin{lemma}[微分の強さの関係]\mbox{}
    \begin{enumerate}
        \item 作用素$\varphi:D\to E$が$\theta\in D$の近傍でGateaux微分可能で，Gateaux導関数が$\theta$にて連続ならば，$\theta$にてFrechet微分可能である．
        \item 作用素$\varphi:D\to E$がHadamard微分可能ならばGateaux微分可能で，2つの導関数は一致する．
        \item 作用素$\varphi:D\to E$が$D$上局所Lipschit連続ならば，任意の点においてGateaux微分可能性はHadamard微分可能性を含意する．
    \end{enumerate}
\end{lemma}

\begin{proposition}[Hadamard微分の連鎖律]
    
\end{proposition}

\subsection{関数デルタ法}

\begin{theorem}
    $\varphi:D(\varphi)\to E$は$\theta\in D(\varphi)$において$D_0$に接してHadamard微分可能であるとし，統計量の列$(T_n:\Om^n\to D(\varphi))$は$r_n\to\infty$と$T:\Om^\infty\to D_0$について$\sqrt{n}(T_n-\theta)\xrightarrow{d}T$を満たすとする．
    このとき，
    \begin{enumerate}
        \item $r_n(\varphi(T_n)-\varphi(\theta))\xrightarrow{d}\varphi'_\theta(T)$．
        \item $\varphi_\theta'$が$D$全域で定義されていて連続であるとき，さらに$r_n((\varphi(T_n)-\varphi(\theta)))=\varphi'_\theta(r_n(T_n-\theta))+o_P(1)$．
    \end{enumerate}
\end{theorem}

\section{接空間と情報量}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    Fisher情報量の概念を拡張するには，部分パラメトリックモデルを考える必要がある．
    この発想の根底には$\P$をFrechet多様体と見做す態度がある（多様体自体が$\R^n$の貼り合わせなので）．
    さらに，構成ができてしまうため，部分パラメトリックモデルは局所漸近正規な1次元なもののみを考えれば良いことになり，パラメトリックモデルでの議論が完全に生きる．
\end{tcolorbox}

\begin{notation}
    $\P$に属する未知の分布$P\in\P$に従う観測量を$X_1,\cdots$，その標本空間を$\X$とする．
\end{notation}

\subsection{スコア関数と接集合}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    LeCunによる概念．
    全てを$\L^2_*(\X,P)$の中で考える(なぜならこれはモデルに一切の制限をつけなかった場合の極大な接空間をなす)．
    非常に語用が混乱しているので注意する必要がある．
    \begin{enumerate}
        \item 部分パラメトリックモデル$\ep\mapsto P_\ep$の定める$1/2$乗測度$\ep\mapsto P^{1/2}_\ep$が$\ep=0$で$L^2$-微分可能であることを$\P$が$P_0$にて道毎に微分可能であるといい，
        \item このような部分パラメトリックモデル$\ep\mapsto P_\ep$が定めるスコア関数全体の集合を接集合$\dot{\P}_{P_0}$という．
    \end{enumerate}
\end{tcolorbox}

\begin{notation}
    確率測度$\P$について中心化されている$(\X,\B)$上の2乗可積分関数全体の空間を
    \[\L^2_*(\X,P):=\Brace{g\in\L^2(\X,P)\mid E_P[g]=0}.\]
    とする．
\end{notation}

\begin{discussion}[パラメトリックな場合]
    パラメトリックモデルが定める密度の平方根関数$\theta\mapsto\sqrt{p_\theta}$が$\theta$において$L^2$-可微分
    \[\exists_{\dot{l}\in\L^2(\X)}\quad\int\paren{\sqrt{p_{\theta+h}}-\sqrt{p_\theta}-\frac{1}{2}h^\top \dot{l}_\theta\sqrt{p_\theta}}^2d\mu=o(\norm{h}^2)\quad(h\to0).\]
    ならば，$\theta$において局所漸近正規，すなわち，次の展開が成り立つのであった(定理\ref{thm-sufficient-condition-for-parametric-LAN})．
    任意の収束列$\{h_n\}\subset\Theta,h_n\to h$について，$\Delta_{n,\theta}:=\frac{1}{\sqrt{n}}\sum^n_{i=1}\dot{l}_\theta(X_i)\in\R^k$とすると，
    \[\log\prod_{i=1}^n\frac{p_{\theta+h_n/\sqrt{n}}}{p_\theta}(X_i)=h^\top\Delta_{n,\theta}-h^\top\frac{1}{2}I_\theta h+o_{p_\theta}(1)\]
    ここで，$\dot{l}_\theta$をスコア関数といい，この$L^2$-ノルム$I_\theta:=P_\theta\dot{l}_\theta\dot{l}_\theta^\top$をFisher情報行列というのであった．
\end{discussion}

\begin{definition}[$P$-path]
    $\bP\in\P$に対して，\textbf{1次元部分パラメトリックモデル}改ため\textbf{$\bP$-道}とは，$(P_t)_{t\in\R_+}:[0,\ep)\to\P;P_0=\bP$をいう．
\end{definition}

\begin{definition}[$L^2$-differentiability of path, score function]
    \textbf{$g$をスコア関数として$L^2$-微分可能}な$P$-道とは，$P$-道$(P_t)_{t\in[0,\ep)}$であって，
    \begin{enumerate}
        \item ある可測関数$g\in\L(\X,P)$に対して
        \[\int\paren{\frac{dP^{1/2}_t-dP^{1/2}}{t}-\frac{1}{2}gdP^{1/2}}^2\xrightarrow{t\to0}0.\]
        を満たすことをいう．このとき，$dP^{1/2}$は測度が定める線型作用素の二乗根作用素とする．\footnote{どうやら任意の$dP^{1/2}$は$L^2(P)$の単位円内に入る？}
        すると，$g$は中心化された$P$-2乗可積分関数$g\in\L^2_*(\X,P)$となることが必要．\cite{vanderVaart Semiparametric Theory}
        \item 参照測度の族$(\mu_t)$に対して$\dd{P}{\mu_t}=p_{tt}$とし，
        \[\int\paren{\frac{p_{tt}^2-p_t^2}{t}-\frac{1}{2}gp_t^{1/2}}^2d\mu_t\xrightarrow{t\to0}0.\]
        と理解しても良い．
    \end{enumerate}
    このときの$g$を\textbf{スコア関数}や\textbf{道毎の微分}という．
\end{definition}
\begin{remarks}[セミパラメトリックモデルの幾何学的描像]
    $P\in\P$は$L^2(\X,P)$に対して正な線型汎函数を定めるから，$dP\in L^2(\X,P)$だと思える．ここで$dP^{1/2}$は単位円に入る．
    すると$\P\subset L^2(\X,P)$と思っても良い．
    すると，$\dot{\P}_P$を$1/2gdP^{1/2}$全体の集合$\P^{1/2}$と同一視すると，その接空間を集めたものと思える．
\end{remarks}

\begin{definition}[tangent cone / space]
    $P$を通る全ての$L^2$-可微分な$P$-道$(P_t)_{t\in\R_+}$に関するスコア関数$g$全体の集合を，$P$における\textbf{接集合}といい，$\dot{\P}_P$\cite{vanderVaart Semiparametric Theory}または$T_P(\P)$\cite{Pfanzagl}で表す．
    ほとんどの場合，これは閉部分空間となる．
    少なくとも，必ず正錐にはなる．
\end{definition}

\begin{lemma}
    任意のスコア関数は$2$乗可積分で，$E_P[g]=0$を満たす\cite{vanderVaart Semiparametric Theory}．
    特に，$\dot{\P}_P\subset\L^2_*(\X,P)$が成り立つ．
\end{lemma}
\begin{remarks}
    もしモデルがノンパラメトリックであったら，接集合は$\dot{\P}_P=\L^2_*(\X,P)$を満たす．
\end{remarks}

\begin{example}[スコア関数の構成方法]
    もし$P$-道$\ep\mapsto dP_\ep$がより強く微分可能ならば，その導関数は$L^2$-導関数と一致して，
    \[g(x)=\left.\pp{}{\ep}\log dP_\ep(x)\right|_{\ep=0}\]
    と表せるのであった．よって，構成する際はこれを目安とする．
    ここでも対数尤度からは逃れられない，極めて基本的な対象である．
\end{example}

\begin{lemma}[$L^2$-微分可能な$P$-道の局所漸近正規性]
    $P$-道$t\mapsto P_t$はスコア$g\in\L(\X)$について$L^2$-微分可能とする．このとき，
    \begin{enumerate}
        \item $g\in L_*^2(\X,P)$である：$Pg=0,Pg^2<\infty$．
        \item 次の展開が成り立つ：
        \[\log\prod^n_{i=1}\frac{dP_{n^{-1/2}}}{dP}(X_i)=\frac{1}{\sqrt{n}}\sum_{i=1}^ng(X_i)-\frac{1}{2}Pg^2+o_P(1).\]
    \end{enumerate}
\end{lemma}
\begin{proof}
    定理\ref{thm-sufficient-condition-for-parametric-LAN}による．
\end{proof}

\subsection{汎関数の可微分性}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    多様体上の関数の場合と全く同様に，多様体上の関数$f$が可微分であるとは，その接空間上の汎関数$df$を定めることをいう．
\end{tcolorbox}

\begin{definition}[differentiable relative to a tangent set, efficient influence function]\mbox{}
    \begin{enumerate}
        \item 汎関数$\psi:\P\to\R^k$が$P\in\P$においての\textbf{接空間$\dot{\P}_P$に関して可微分}であるとは，
        \[\exists_{\dot{\psi}_P\in L^2(P)^*}\;\forall_{g\in\dot{\P}_P}\;\frac{\psi(P_t)-\psi(P)}{t}\xrightarrow{t\to0}\dot{\psi}_P(g)\]
        を満たすことをいう．このとき，合成関数$\R\to\R;t\mapsto P_t\mapsto \psi(P_t)$が通常の意味で微分可能であることも必要で，その微分が道$t\mapsto P_t$の定めるスコア関数$g$上の関数$\dot{\psi}_P$として表現できることを要求する強い条件である．
        \item このときの有界線型汎函数$\dot{\psi}_P:L^2(P)\to\R$は，$\dot{\P}_P$の生成する閉部分空間上では一意に定まる．
        これが定めるRiesz表現元$\wt{\varphi}_P\in\dot{\P}_P\subset L^2(P)$を
        \textbf{有効影響関数}という：$\dot{\psi}_Pg=(\wt{\psi}_P|g)=\int\wt{\psi}gdP$．
        \item 
        一方で有効影響関数は
        $L^2(P)$全域には一意に拡張できるとは限らないので，
        $\dot{\P}_P$上への射影として有効影響関数を定めるような函数$\dot{\psi}_P\in L^2(P)$を\textbf{影響関数}という．
        これは確かにパラメトリックな場合の影響関数$\IF(x;T,P):\X\to\R^k$を一般化している．ここでパラメトリックな場合の影響関数を影響曲線というレトロニムを使う．
    \end{enumerate}
\end{definition}
\begin{remarks}
    すなわち，有効影響関数$\dot{\psi}_P\in L^2(P)^*$は特に$\dot{\P}_P$上の有界線型汎函数であり，
    余接空間の元である．また，$\P^{1/2}\subset B(L^2(P))$上の有界線型汎函数と思っても良い．
\end{remarks}

\subsection{有効性理論}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    パラメトリックの場合の最小な漸近分散$\dot{\psi}_\theta I^{-1}_\theta\dot{\psi}_\theta^\top$を同じ役割を，有効影響関数の$L^2$-ノルム$\norm{\wt{\psi}_P}_{L^2(P)}$が果たす．
    正規化されたスコア関数$I^{-1}_\theta\dot{l}_\theta$と影響関数$\wt{\psi}_P$は同じ役割を果たす．
    そして，殆ど至る所畳み込み定理はLebesgue測度を利用したパラメトリックな場合特有の議論であったのを除いて，畳み込み定理とLAMがそのまま一般化される．
    $\psi(P)$の漸近最適な推定量として，一般的には$\psi(\bP_n)$が取れることとなる．
\end{tcolorbox}

\begin{discussion}
    $P$-道$t\mapsto P_t$上で汎関数$\psi$を推定する際の情報量限界は，スコア関数を$g$とするとFisher情報量は$Pg^2$であるから，
    Cramer-Raoの下界
    \[\frac{(d\psi(P_t)/dt)^2}{Pg^2}=\frac{(\wt{\psi}_P|g)^2}{(g|g)}\]
    を得る．
    これを全ての$P$-道，すなわち，全てのスコア関数$g\in\dot{\P}_P$についての上界を取れば良い．
    実はこれは有効影響関数$\wt{\psi}_P:\X\to\R$の定める有界線型汎函数$\dot{\psi}_P:\dot{\P}_P\to\R$
\end{discussion}

\begin{proposition}
    汎関数$\psi:\P\to\R$は$P\in\P$において，$\dot{\P}_P$に関して微分可能であるとする：$\dot{\psi}_P:\dot{\P}_P\to\R$．
    このとき，
    \[\sup_{g\in\dot{\P}_P}\frac{(\wt{\psi}_P|g)^2}{(g|g)}=P\wt{\psi}_P^2=\norm{\wt{\psi}_P}_{L^2(P)}.\]
\end{proposition}

\begin{notation}
    $P_{t,g}$で，$g\in\dot{\P}_P$に対応する$L^2$-可微分な$P$-道とする．
\end{notation}

\begin{definition}
    統計量$T_n$が\textbf{正則}であるとは，ある極限分布$L\in P(\R^n)$が存在して，任意の$g\in\dot{\P}_P$に対して
    \[\sqrt{n}(T_n-\psi(P_{1/\sqrt{n},g}))\xrightarrow[P_{1/\sqrt{n},g}]{d}L\]
\end{definition}

\begin{theorem}[畳み込み定理]
    
\end{theorem}

\begin{theorem}[LAM]
    
\end{theorem}

\begin{lemma}[正規な統計量が最適であるための必要十分条件]
    $\psi:\P\to\R^k$は$P$において接正錐$\dot{\P}_P$に関して，有効影響関数$\wt{\psi}_P$を持って微分可能であるとする．
    このとき，統計量列$T_n$について，次の2条件は同値．
    \begin{enumerate}
        \item $T_n$は正則で，漸近分布$N(0,P\wt{\psi}\wt{\psi}^\top)$を持つ．
        \item 展開$\sqrt{n}(T_n-\psi(P))=\frac{1}{\sqrt{n}}\sum_{i=1}^n\wt{\psi}_P(X_i)+o_P(1)$が成り立つ．
    \end{enumerate}
\end{lemma}
\begin{remarks}
    有効影響関数は，確かに新たな観測$X_i$が，漸近分布にどのような影響を与えるかの指標になっているとみれる．
\end{remarks}

\begin{example}[経験測度]
    $f\in L^2(\X,P)$を固定して，$\psi(P)=Pf=\ev_f(P)$の推定を考える．
    極大にとった接集合は$L^2_*(\X,P)$となるが，これだと大きすぎるので，有界なもの$L^\infty_*(\X,P)$を考えよう．
    任意の$g\in L^\infty_*(\X,P)$に対して，$P$-道$dP_t:=(1+tg)dP$を考えると，$\psi(P_t)=Pf+tPfg$となるから，
    微分$\dot{\psi}_P$は$g\mapsto Pfg$で定まる．
    よって，影響関数は$f$で，その$L^2_*(\X,P)$への射影$f-Pf$で有効影響関数$\wt{\psi}_P=f-Pf$が得られる．
    よって，$\psi(P)$の推定の漸近最適な分散は$P\wt{\psi}_P^2=P(f-Pf)^2$．
    経験測度$\bP_n$はこれを達成するから，漸近最適な$\psi(P)$の推定量である．
\end{example}

\section{有効スコア関数}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    モデルが$\{P_{\theta,\eta}\}_{\theta\in\Theta,\eta\in H},\;(\Theta\osub\R^k)$と表され，その上の
    汎関数が$\psi(P_{\theta,\eta})=\theta$となる場合について，有効性理論を特殊化する．
    このとき，スコア関数はパラメトリックモデルのものとノンパラメトリックモデルのものの線形和になる．
    そして有効影響関数の形は，すごく分かりやすくパラメトリックの場合の一般化となっている．
\end{tcolorbox}

\begin{discussion}[局外母数の接空間]
    $t\mapsto\eta_t$を$H$上の$\eta$-道とする．このとき，$P_{\theta,\eta}$-道として
    $t\mapsto P_{\theta+at,\eta_t}$を取ると，($L^2$-微分可能ならば)そのスコア関数は，$\eta$を固定して得るパラメトリックモデル$(P_{\theta,\eta})_{\theta\in\Theta}$のスコア関数を$\dot{l}_{\theta,\eta}$として，
    \[\pp{}{t}\log dP_{\theta+ta,\eta_t}|_{t=0}=a^\top\dot{l}_{\theta,\eta}+g\]
    と表せる．このときの$g$は，$\theta$を固定して得るノンパラメトリックモデル$(P_{\theta,\eta})_{\eta\in H}$の道のスコア関数と見做すことができ，
    その全体からなる集合を${}_\eta\dot{\P}_{P_{\theta,\eta}}$で表し，\textbf{局外母数$\eta$の接空間}という．
\end{discussion}

\begin{discussion}
    パラメータ$t\mapsto\psi(P_{\theta+at,\eta_t})=\theta+at$は微分可能で，微分係数は$a$である．
    汎関数$\psi$が$\dot{\P}_{P_{\theta,\eta}}$について微分可能であるとき，有効影響関数$\wt{\psi}_{\theta,\eta}:\dot{\P}_{P_{\theta,\eta}}\to\R$が存在して
    \[a=\pp{}{t}\psi(P_{\theta+at,\eta_t})|_{t=0}=(\wt{\psi}_{\theta,\eta}|a^\top\dot{l}_{\theta,\eta}+g)\]
    が成り立つ．特に$a=0$ととったとき，$\wt{\psi}_{\theta,\eta}\perp{}_\eta\dot{\P}_{P_{\theta,\eta}}$が必要だとわかる．
\end{discussion}

\begin{definition}[efficient score function, efficient information matrix]\mbox{}
    \begin{enumerate}
        \item $\wt{l}_{\theta,\eta}:=\dot{l}_{\theta,\eta}-\pr_{\dot{\P}_{P_{\theta,\eta}}}(\dot{l}_{\theta,\eta})$を\textbf{有効スコア関数}という．
        \item $\wt{I}_{\theta,\eta}:=P_{\theta,\eta}\wt{l}_{\theta,\eta}\wt{l}_{\theta,\eta}^\top$を\textbf{有効情報行列}という．
    \end{enumerate}
\end{definition}

\begin{lemma}[汎関数が直交射影である場合の影響関数]\mbox{}
    \begin{enumerate}[({A}1)]
        \item 任意の$a\in\R^k$と$g\in{}_\eta\dot{P}_{P_{\theta,\eta}}$に関して，$H$の道$t\mapsto \eta_t$が存在して，これが定める$P_{\theta,\eta}$-道はスコア関数を$a^\top\dot{l}_{\theta,\eta}+g$として$L^2$-微分可能であるとする．
        \item 有効情報行列$\wt{I}_{\theta,\eta}$は可逆であるとする．
    \end{enumerate}
    このとき，直交射影の定める汎関数$\psi(P_{\theta,\eta})=\theta$は$P_{\theta,\eta}$において$\dot{\P}_{\theta,\eta}=\brac{\dot{l}_{\theta,\eta}}\oplus{}_\eta\dot{\P}_{\theta,\eta}$に関して微分可能で，有効影響関数$\wt{\psi}_{\theta,\eta}=\wt{I}_{\theta,\eta}^{-1}\wt{l}_{\theta,\eta}$を持つ．
\end{lemma}
\begin{remarks}
    漸近最適な統計量列の特徴づけは，
    $\sqrt{n}(T_n-\psi(\theta))=\frac{1}{\sqrt{n}}\sum^n_{i=1}\wt{I}^{-1}_{\theta,\eta}\wt{l}_{\theta,\eta}(X_i)+o_P(1)$
    が与える．パラメトリックな場合の漸近線型性
    \[\sqrt{n}(T_n-\psi(\theta))=\frac{1}{\sqrt{n}}\sum^n_{i=1}\dot{\psi}_\theta I_\theta^{-1}\dot{l}_\theta^\top(X_i)+o_P(1)\]
    と酷似している．$\dot{\psi}_\theta\dot{l}_\theta^\top$が$\wt{l}_{\theta,\eta}$に当たるのは，射影作用がパラメトリックな場合では$\dot{\psi}_\theta$を乗じることに等価になるのか．
\end{remarks}

\section{スコア作用素と情報量作用素}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    特殊化された理論は分解$\Theta\oplus H$を利用した．
    一般の汎関数$\psi$についてこの分解を見つけることは困難であり，
    そのような場合は，より抽象的な枠組みから，「写像の微分」に当たる，
    「局外母数の接空間を定めるスコア作用素」の考え方を用いる．
\end{tcolorbox}

\subsection{スコア作用素}

\begin{notation}
    モデル$\P=\{P_\eta\}_{\eta\in H}$について，
    $\eta$自体も確率測度で，$\eta\in H$も確率測度のFrechet多様体とみなせる状況を考える．
    \begin{enumerate}
        \item モデル$H$上に，$\dot{H}_\eta$について可微分な汎関数$\chi:H\to\R^k$を考え，影響関数を$\wt{\chi}_\eta$とする．
        \item モデル$\P$上の汎関数$\psi:\P\to H\to\R^k;P_\eta\mapsto\eta\mapsto\chi(\eta)$の推定を考える．
    \end{enumerate}
\end{notation}

\begin{definition}[score operator]
    モデル$\P$を写像と見た対応$H\to\P;\eta\mapsto P_\eta$が$\dot{H}_\eta$に関して可微分であるとき，微分$A_\eta:\dot{H}_\eta\to\dot{\P}_{P_\eta}\subset L_2(P_\eta);b\mapsto g$を\textbf{スコア作用素}という．
    この対応は，任意の$H$上の$\eta$-道$t\mapsto\eta_t$に対して，$\P$上の$P_\eta$-道$t\mapsto P_{\eta_t}$が対応し，これがスコア関数の対応$b\mapsto g$を導く．
    このとき，$\Im(A_\eta)=A_\eta(\dot{H}_\eta)\subset\dot{\P}_{P_\eta}$．
\end{definition}
\begin{example}
    $\eta$が観測不可能量$Y$の分布，$P_\eta$が対応する観測可能量$X=m(Y)$の分布であるとき，スコア作用素$A_\eta:L^2\to L^2$は条件付き期待値に他ならない．
\end{example}

\subsection{情報量作用素}

\begin{lemma}[adjoint score operatorによる可微分性の特徴付け]
    モデル$H$上に，$\dot{H}_\eta$について可微分な汎関数$\chi:H\to\R^k$を考え，影響関数を$\wt{\chi}_\eta$とする．
    \[\xymatrix{
        \P\ar[dr]^-{\psi}&H\ar[l]_-\P\ar[d]^-\chi\\&\R^k
    }\]
    \begin{enumerate}
        \item $\psi$が$\dot{\P}_{P_\eta}=A_\eta(\dot{H}_\eta)$に関して微分可能であることは，有効影響関数$\wt{\psi}_{P_\eta}\in\dot{\P}_{P_\eta}$が存在して，
        \[\forall_{b\in\dot{H}_\eta}\quad\brac{\wt{\psi}_{P_\eta},A_\eta b}=\left.\pp{}{t}\psi(P_{\eta_t})\right|_{t=0}=\left.\pp{}{t}\chi(\eta_t)\right|_{t=0}=\brac{\wt{\chi}_\eta,b}_\eta\]
        が成り立つことと同値．
        \item $A^*_\eta:L_2(P_\eta)\to \dot{H}_\eta$を用いれば，$\forall_{h\in L_2(P_\eta)}\;\forall_{b\in\dot{H}_\eta}\;\brac{h,A_\eta b}_{P_\eta}=\brac{A^*_\eta h,b}_\eta$が成り立つ．すなわち，$A^*_\eta(\wt{\psi}_{P_\eta})=\wt{\chi}_\eta$．
    \end{enumerate}
\end{lemma}
\begin{remarks}
    $\P^{-1}:\P\to H;P_\eta\mapsto\eta$とすると，$\psi=\chi\circ \P^{-1}$となる．
    $\chi$が可微分のとき，$\psi$が可微分であるための必要十分条件は，$\P^{-1}$の微分，すなわち$A_\eta^*$の言葉で与えられる．
    (線型)方程式$A^*_\eta\wt{\psi}_{P_\eta}=\wt{\chi}_\eta$が解けるときだから，$\wt{\chi}_\eta\in\Im(A^*_\eta)$のとき．

    スコア作用素は，接空間の間の対応（すなわちスコア関数同士の対応）を与えた．
    スコア作用素の随伴は，逆向きに，余接空間の間の対応を与える．Hilbert空間は自己共役であることを考えると，これは有効影響関数の間に対応を与えていることになる．
\end{remarks}

\begin{definition}[information operator]
    特に$\wt{\chi}_\eta\in\Im(A^*_\eta A_\eta)$が成り立つとき，$\wt{\psi}_{P_\eta}=A_\eta(A^*_\eta A_\eta)^-\wt{\chi}_\eta$が成り立つ．このとき，$A^*_\eta A_\eta$を\textbf{情報量作用素}という．
\end{definition}

\subsection{結果の一般化}

\begin{theorem}
    写像$\psi:\P\to\R^k$は$P_\eta$において$A_\eta(H_\eta)$に関して微分可能であることは，$\wt{\chi}_eta\in\Im(A^*_\eta:L_2(P_\eta)\to H_\eta)$に同値．
    このとき，有効影響関数$\wt{\psi}_{P_n}$は$A^*_n\wt{\psi}_{P_\eta}=\wt{\chi}_\eta$を満たす．
    さらに，$\wt{\chi}_\eta\in\Im(A^*_\eta A_\eta)$も満たすとき，$\wt{\psi}_{P_\eta}=A_\eta(A^*_\eta A_\eta)^-\wt{\chi}_\eta$も成り立つ．
\end{theorem}

\begin{corollary}
    汎関数$\chi:H\to\R^k;\eta\mapsto\chi(\eta)$は$\dot{H}_\eta$に関して可微分であるが，影響関数が$\wt{\chi}_\eta\notin\Im(A^*_\eta)$を満たすならば，$P_\eta$にて正則な$\chi$の推定量は存在しない．
\end{corollary}

\section{有効性とデルタ法}

\section{有効スコア方程式}

\section{一般化推定方程式}

\chapter{因果推論法}

\section{傾向スコア・マッチング}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    Rosenbaum and Rubin 1983．
    強く無視できる割当条件を満たすときの，平均処置効果の不偏推定量の標準的構成法である．
    また，多次元な共変量を１つのスカラー変数に集約することができれば，その１変数の上で層別化などを行うことができるため，従来のマッチングや層別での問題が回避される．
    なおこれは，まず傾向スコアを推定する必要が生じるため，二段階推定法となる．
    が，「推定した傾向スコアを用いても，推定の偏りは真の傾向スコアを用いた場合と同様である」ということが明らかになっている(Drake, 1993)．
    \footnote{If treatment assignment is strongly ignorable given $x$, then the difference between treatment and control means at each value, and consequently pair matching, subclassification and covariance adjustment on a balancing score can produce unbiased estimates of the avarage treatment effect.}
\end{tcolorbox}

\subsection{強く無視できる割当条件}

傾向スコア$e(x)$を事前に定めている実験が無作為割当実験である．
一方で，割当がランダムでない場合は，まず傾向スコア$e(x)$の推定が問題になる．\footnote{logitモデルなどのパラメトリックモデルが使われることが多い．}

\begin{definition}
    割当が無作為に近いことを，\textbf{強く無視できる}という．
    無作為割当では，結果変数は，$x$の下では割当と独立である：$(r_1,r_0)\indep z|x$．
    また，$\pr(z_i|x)\in(0,1)$である．
    割当が無作為ではないながらも，次の条件が保証されることをいう：
    \[(r_1,r_0)\indep z|v,\quad 0<\pr(z=1|v)<1\]
\end{definition}

\begin{lemma}
    割当が強く無視できるとき，Rubin 1978の意味でも無視できる（すなわち，「無視できる欠測」である）．
    が，逆は成り立たない．
\end{lemma}

\subsection{定義と特徴付け}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    バランシングスコアは，共変量の値域の空間に定める同値類の細かさの順序について有界束をなし，最大元が$b(x)=x$で，最小元が$b(x)=e(x)$である．
\end{tcolorbox}

\begin{definition}[balancing score, propensity score]
    共変量$x$の関数を考える．
    \begin{enumerate}
        \item \textbf{バランシングスコア}$b(x)$とは，これによって共変量$x$を条件付けると，割付$z$と独立になるような関数を言う：$z\indep x|b(x)$．\footnote{David's (1979) notation}すなわち，$b(x)$を与えたときの$x$の条件付き分布が，$z=0,1$に依らず同一になるような，共変量の対応付けを言う．
        \item $e(x):=\pr(z=1|x)$によって定まる共変量の関数を，\textbf{傾向スコア}という．これは，共変量$x$を仮定したときに，処置を受ける傾向を表している．RCTでは$e=1/2$という定数関数となる．
        傾向スコアは，バランシングスコア$b(x)$の中で，最も粗い同値関係を定めるものとして特徴付けられる．
    \end{enumerate}
\end{definition}
\begin{remarks}
    バランシングスコアは共変量の関数と定義されているが，これは共変量の値域に同値類を作るための装置に他ならない．
    傾向スコアとは，そのようにして関数概念を運用するという巧妙な形式科学である．
\end{remarks}

\begin{example}
    $b(x)=x$はバランシングスコアである．この$b(x)$で条件づけたとき，$x$の分布はデルタ分布になる．
    特に，バランシングスコアは存在する．
\end{example}

\begin{lemma}[バランシングスコアと傾向スコアの特徴付け]
    $b$を共変量の関数とする．次の２条件は同値．
    \begin{enumerate}
        \item $b$はバランシングスコアである．
        \item $b(x)$は$e(x)$より細かい同値類を定める：関数$f$が存在して，$e(x)=f(z(x))$と表せる．
    \end{enumerate}
\end{lemma}

\begin{corollary}[Cochran and Rubin (1973)]
    特に，割当と共変量とは，傾向スコアが与えられたとき，条件付き独立である：
    $x\indep z|e(x)$．
\end{corollary}

\subsection{平均処置効果の推定}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    割当が強く無視できるとき，
    $b(x)$が取る各値において，平均処置効果は，それぞれの群の平均の差によって不偏推定可能である．
\end{tcolorbox}

\begin{theorem}
    割当が$x$について強く無視できるとする．
    このとき，割当は任意のバランシングスコア$b(x)$についても強く無視できる：
    \[\Square{\forall_{x}\;(r_1,r_0)\indep z|x\land\pr(z=1|x)\in(0,1)}\Longrightarrow\Square{\forall_{b}\;\forall_{x}\;(r_1,r_0)\indep z|b(x)\land\pr(z=1|b(x))\in (0,1)}.\]
\end{theorem}

\begin{theorem}
    割当が$x$について強く無視でき，$b(x)$をバランシングスコアとする．
    このとき，
    \[E[r_1|b(x),z=1]-E[r_0|b(x),z=0]=E[r_1-r_0|b(x)].\]
\end{theorem}

\begin{corollary}[pair matching on balancing scores]
    割当は強く無視できるとする．また，母集団から，$b(x)$の値と，それに対応する単位であって，それぞれの群の中から$z_i=1$を満たす単位$i$と$z_j=0$を満たす単位$j$が抽出されたとする．
    このとき，$E[r_1-r_0|b(x)]=E[y_i-y_j]$が成り立つ．
\end{corollary}

\begin{corollary}[subclassification(層別解析)]
    
\end{corollary}

\begin{corollary}[covariance adjustment(共分散分析)]
    
\end{corollary}
\begin{remark}
    共分散分析は分散分析(ANOVA)と回帰分析を組み合わせた，一般化線形モデルである．
\end{remark}

\subsection{傾向スコアの推定}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    傾向スコアの経験測度から構成される推定量から，$x$上のsample balanceを構成できる．
\end{tcolorbox}

\begin{definition}
    $P_N$を標本から得た確率測度とする．
    $\wh{e}(a):=P_N(z=1|x=a)$によって，傾向スコア$e(x)$を推定することを考える．
\end{definition}

\begin{theorem}
    $\wh{e}(a)\in(0,1)$ならば，$P_N(z=0,x=a|\wh{e}(x)=\wh{e}(a))\Rightarrow P_N(z=0|\wh{e}(x)=\wh{e}(x))P_N(x=a|\wh{e}(z)=\wh{e}(a))$．
\end{theorem}

\subsection{IPW推定法}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    Rubin 1985による，層別標本抽出におけるHorovitz and Thompson 1952の拡張．
\end{tcolorbox}

\begin{definition}[IPW: inverse probability weighting]
    $y_0,y_1$の周辺平均の推定を考える．

    $y$の値の，なんらかの確率測度についての期待値ではなく，傾向スコアの逆数が定める積分を考える：
    \[\wh{E}(y_1):=\frac{\sum\frac{z_i}{e_i}y_i}{\sum\frac{z_i}{e_i}},\quad\wh{E}(y_0):=\frac{\sum\frac{1-z_i}{1-e_i}y_i}{\sum\frac{1-z_i}{1-e_i}}\]
    強く無視できる割当条件が成立するとき，真の傾向スコアがわかっているなら不偏推定量となり，傾向スコアを推定値で代用しても一致推定量となる．
\end{definition}
\begin{remark}
    IPW推定量は，母数ベクトル$(E(y_1),E(y_0))$，推定関数$\paren{\frac{z}{e}(y-E[y_1]),\frac{1-z}{1-e}(y-E[y_0])}$についての$m$-推定量でもある．
\end{remark}

\subsection{kernelマッチング}

\section{傾向スコア解析の拡張}

\subsection{一般化推定方程式におけるIPW推定量}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    Liang and Zeger 1986
\end{tcolorbox}

\subsection{一般化傾向スコア}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    Imbens 2000は，割当変数が2値でない場合にも傾向スコアが利用できるように拡張した．
\end{tcolorbox}

\section{一般的な周辺パラメトリックモデルの推定}

\chapter{影響関数を用いた頑健な汎関数推定}

\begin{quotation}
    まだ名前が定まっていないが，Semiparametric Doubly Robust Targeted Double Machine Learningと呼ばれている．
    ベイズ的な発想かも知れないが，不確実性の中で唯一頼りになるのは頑健性・反脆弱性である．
    極めて数学者らしくない発想ではあるが．

    おそらく，こういう話である．
    ノンパラメトリックなパラメータとは汎関数になる(これをtargeted parameterともいう)．
    汎関数の推定は，モデル$\bP\in\P$の密度自体の推定より簡単で，
    さらに汎関数に，影響関数の手法が使える良い構造を仮定すると，fast $\sqrt{n}$-収束が実現できる．
\end{quotation}

\begin{notation}\mbox{}
    \begin{enumerate}
        \item $A=a$とした場合の(反実仮想的)観測値を$Y^a$で表す．
        \item $Z\in\R^m$は観測量とする．
    \end{enumerate}
\end{notation}

\section{汎関数の例}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    本質的に，共変量上で平均を取った回帰関数の形を取る．
    回帰関数とは何の仮定も置かない場合はただの条件付き期待値であるから，条件付き期待値の平均，という形が標準的である．
    このような設定に対する意味論は，因果推論とより一般に欠損データである．
\end{tcolorbox}

\subsection{セミパラメトリック回帰について}

\begin{example}[回帰分析とは，条件付き期待値なる汎関数の推定問題である]
    $Z=(X,Y)\in\R^2$が観測されたとする．回帰関数$\psi(x;P)=E[Y|X=x]$は汎関数$\R\times\P\to\R$となる．

    そもそも，任意の観測量$Z=(X,Y)$に対して，$Y_i=E[Y_i|X_i]+\ep_i,E[\ep_i|X_i]=0$が成り立つ．
    これは$X_i$に依存する成分が，条件付き期待値によって可予測に表されていることによる．
    したがって，二乗誤差について，$E[Y_i|X_i]$は$X_i$から$Y_i$を推定する最適推定量である．
    $E[Y_i|X_i]$の形を指定するのが回帰モデルである．
\end{example}

\subsection{処置効果}

\begin{example}[平均処置効果]
    $Z=(X,A,Y)$とする．
    \begin{description}
        \item[positivity] 処置割当がなされる：$0<P[A=a]<1$．
        \item[consistency] 
        \item[no unmeasured confounding] 
    \end{description}
    母集団がすべて$A=a$の処置を受けたときの結果の期待値
    \[\psi(P):=E[Y^a]=E[E[Y|X,A=a]]=E[\mu_a(X)]\]
    は汎関数となる．これは，回帰関数の，$X$(の周辺分布)に関する平均値，という形をしている．
    回帰関数を$\mu_a(X):=E[Y|X,A=a]$とすることも多い．

    これに対して，平均処置効果は$E[Y^1-Y^0]$と定まる．
\end{example}

\begin{example}[平均欠損結果]
    $Z=(X,A,AY)$とする．$A=0$のとき$AY$とは欠損とする．
    \begin{description}
        \item[positivity] 
        \item[missing at random] 
    \end{description}
    母集団の平均結果は，回帰関数の$X$に関する平均
    \[\psi(P):=E[Y]=E[E[Y|X,A=1]]\]
    となる．これは，数学的には平均処置結果の特別な場合となる．
\end{example}

\begin{example}[平均で重みづけた処置効果]
    $Z=(X,A,Y)$とする．平均処置効果と同様の仮定の下で，
    \[\psi(P)=E[w(X)E[Y^1-Y^0|X]]=\frac{E[\Cov[A,Y|X]]}{E[\Var[A|X]]}\qquad w(X):=\frac{\Var[A|X]}{E[\Var[A|X]]}\]
\end{example}

\begin{example}[確率的介入効果]
    $Z=(X,A,Y)$とする．
    平均処置効果と同様の仮定の下で，
    $A\sim dG(a|x)$なる確率分布で割り当てられているとき，
    平均処置結果は
    \[\psi(P)=E[E[Y|X,A^*]]=\iint E[Y|X=x,A=a]dG(a|x)dP(x).\]
\end{example}

\begin{example}[操作変数効果 / 局所平均処置効果]
    $Z=(X,R,A,Y)$とする．
    \begin{description}
        \item[positivity] 
        \item[consistency] 
        \item[IV-unconfoundedness] 
        \item[exclusion] 
        \item[instrumentation] 
        \item[monotonicity] 
    \end{description}
    コンプライアー$A^{r=1}>A^{r=0}$の平均処置効果は
    \[\psi(P)=E[Y^{a=1}-Y^{a=0}|A^{r=1}>A^{r=0}]=\frac{E[E[Y|X,R=1]]-E[Y|X,R=0]}{E[E[A|X,R=1]]-E[A|X,R=0]}\]

    monotonicityの仮定をeffect homogeneityに置き換えることで，同じ汎関数は，処置された集団に対する効果となる．
\end{example}

\begin{example}[時間変化する処置効果]
    
\end{example}

\subsection{その他}

\begin{example}[密度の期待値]
    $Z$が真の密度$p$を持つとする．
    密度の期待値は汎関数になる：
    \[\psi(P):=E[p(Z)]=\int p(z)^2dz.\]
\end{example}

\begin{example}[エントロピー]
    $Z$が真の密度$p$を持つとする．
    エントロピーは汎関数になる：
    \[\psi(P)=-\int p(z)\log p(z)dz=-E[\log p(Z)]\]
\end{example}

\begin{example}[$f$-分離度]
    $Z=(A,Y)$は，割当$A\in 2$と条件付き密度$p(y|a)$を持つとする．
    このとき，$p(y|a=1),p(y|a=0)$の分離度は汎関数となる：
    \[\psi(P)=\int f\paren{\frac{p(y|a=1)}{p(y|a=0)}}p(y|a=0)dy\]
\end{example}

\section{ノンパラメトリック効率限界}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    target parameter $\psi$とモデル$\P$を設定して後，下界を得ることで，効率性についてのベンチマークを考える．
    ちょうど，滑らかなパラメトリックモデルに対するCramer-Raoの不等式のような，情報理論的議論である．
    \textbf{このとき，どのような効率限界が，どのようなモデルに対して成り立つかは，一つ課題である}．
\end{tcolorbox}

\begin{notation}
    モデル$\P$を，標本空間$(\R^n,\B(\R^n))$上のすべての確率測度とする．
\end{notation}

\subsection{パラメトリックモデルの扱い}

\subsubsection{Cramer-Raoの不等式}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    滑らかなパラメトリックモデル$\P=(P_\theta)_{\theta\in\R}$について，
\end{tcolorbox}

\begin{theorem}[Cramer-Raoの不等式]
    滑らかなパラメトリックモデル$\P=(P_\theta)_{\theta\in\R}$と滑らかな汎関数$\psi:\P\to\R$について，任意の不偏推定量$\wh{\psi}$は次を満たす：
    \[\forall_{\theta\in\Theta}\quad\Var_\theta[\wh{\psi}]\ge\frac{\psi'(\theta)^2}{\Var_\theta[s_\theta(Z)]}\qquad s_\theta(z)=\pp{}{\theta}\log p_\theta(z).\]
\end{theorem}

\subsubsection{minimax危険関数の下界}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    より広いクラスについては，次のように，危険関数に言及することによるベンチマークの与え方がある．
\end{tcolorbox}

\begin{definition}[Holder class]
    $T\subset\R$を区間，$\beta,L>0$とする．
    $T$上の$\Sigma(\beta,L)$-Holderクラスとは，$l:=\floor{\beta}$に対して，
    \[\Sigma(\beta,L):=\Brace{f\in C^{l}(T)\mid f^{(l)}\text{は}\beta-l\text{次Holder連続}}\]
\end{definition}

\begin{theorem}[Theorem 2.8 \cite{Tsybakov}]
    $\P$が$\Sigma(\beta,L)$-Holderクラスであるとき，推定量$\wh{\psi}$のミニマックス危険関数の下界は
    \[\inf_{\wh{\psi}}\sup_{P\in\P}E_P\Square{(\wh{\psi}-\psi(P))^2}\ge Cn^{-\frac{1}{1+d/2s}}\]
    で与えられる．
\end{theorem}

\subsubsection{滑らかなパラメトリックモデルの危険関数下界}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    Cramer-Raoのように，滑らかなパラメトリックモデルに対しては，より繊細な下界を危険関数に対して取れる．
\end{tcolorbox}

\begin{theorem}[Theorem 8.11 \cite{Asymptotic Statistics}]
    パラメトリックモデル$P_\theta$は$\theta$について$L_2$-微分可能で，非特異なFisher情報行列$I_\theta=\Var_\theta[s_\theta(Z)]$を持つとする．
    $\psi(\theta)$は$\theta$上微分可能で微分係数$\psi'(\theta)$を持つとき，任意の推定量$\wh{\psi}$は次を満たす：
    \[\inf_{\delta>0}\liminf_{n\to\infty}\sup_{\norm{\theta'-\theta}<\delta}nE_{\theta'}\Square{(\wh{\psi}-\psi(\theta'))^2}\ge\psi'(\theta)\Var_\theta[s_\theta(Z)]^{-1}\psi(\theta)^\top.\]
\end{theorem}

\subsection{部分パラメトリックモデル}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    Stein\footnote{C. Stein. Efficient nonparametric testing and estimation. Proceedings of the Third Berkeley
    Symposium on Mathematical Statistics and Probability, 1:187–195, 1956.}による．
    とは言っても，1次元のものしか考えない場合は，真の分布$\bP$を$\ep=0$にて通る道に他ならない．
\end{tcolorbox}

\begin{definition}[parametric submodel]
    モデル$\P$内の\textbf{部分パラメトリックモデル}とは，滑らかな写像$(P_\ep)_{\ep\in\R}:\R\to\P$であって$P_0=\bP$を満たすものをいう．
\end{definition}

\begin{example}[効率限界を与える1次元部分モデル]
    任意の中心化された確率変数$h:\Z\to\R$に対して，$\exists_{M\in\R}\;\norm{h}_\infty\le M\land\exists_{\ep<1/M}\;p_\ep(z)\ge0$が成り立つとき，
    \[p_\ep(z):=dP(z)(1+\ep h(z))\]
    とおくと，これは1次元の部分パラメトリックモデルであり，次の形の影響関数を持つ：
    \[\pp{}{\ep}\log p_\ep(z)|_{\ep=0}=\pp{}{\ep}\log(1+\ep h(z))|_{\ep=0}=h(z).\]
    したがって，この部分モデルの効率限界は，任意の$\ep\in\R$について，
    \[\frac{\psi'(P_\ep)^2}{\Var_{P_\ep}[s_\ep(Z)]}=\frac{\pp{}{\ep}\psi(P_\ep)|_{\ep=0}}{E_{P_\ep}[h(Z)^2]}\]
    で与えられる．
\end{example}

\subsection{道毎の微分可能性}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    まずは分母の$\pp{}{\ep}\psi(P_\ep)$について考えるために，Frechet多様体上の関数$\psi:\P\to\R$が微分可能なクラスについて，その振る舞いを考える．
    基本的に$\P$を無限次元Frechet多様体と見て，path smoothnessと呼んでいるのであろう．
\end{tcolorbox}

\begin{definition}[smooth / differentiable / asymptotic linear, pathwise differentiable]\mbox{}
    \begin{enumerate}
        \item 関数$\psi:\P\to\R$が\textbf{von Mises展開可能}であるとは，任意の$\o{P}\in\P$に対して，対応する$\varphi(z;\o{P})\in\L^2(\cZ),R_2(P,\o{P})\in\R$が存在して
        \[\psi(\o{P})-\psi(P)=\int\varphi(z;\o{P})d(\o{P}-P)(z)+R_2(P,\o{P}),\qquad E_P[\varphi(z;P)]=0,\Var_P[\varphi(z;P)]<\infty.\]
        と表せることをいう．
        \item 関数$\psi:\P\to\R$が\textbf{道毎に微分可能}または\textbf{$\dot{\P}_P$に関して可微分}であるとは，任意の道$\R\to\P,P_0=\bP$について，
        \[\pp{}{\ep}\psi(P_\ep)|_{\ep=0}=\int\varphi(z;\bP)s_\ep(z)d\bP(z)\]
        を満たすことをいう．
    \end{enumerate}
    このとき，関数$\varphi$を\textbf{パラメータ$\psi$の影響曲線}と呼ぶ．
\end{definition}
\begin{remark}[influence curve]
    この式をvon Mises展開といい，このときの関数$\varphi$を影響関数，道毎の微分，勾配，Neyman直交スコアなどと呼ぶ．
    なお，母数についての影響関数とは別の概念であるから，この場合は\textbf{影響曲線}と呼び分けることとする．

    ChernozhukovがNeyman直交性と呼んでいるのは，この道毎の微分可能性に同値．
\end{remark}

\begin{example}[道毎に微分可能な汎関数]\mbox{}
    \begin{enumerate}
        \item 
    \end{enumerate}
\end{example}

\begin{lemma}
    可微分ならば，道毎に微分可能である．
\end{lemma}

\begin{tbox}{red}{}
    $\P$は$\cZ=\X\times\Y$上の確率測度の空間で，従って各$P$は$L^1(\cZ)$上の汎関数であり，
    この汎関数$P:L^1(\cZ)\to\R$の"微分"$dP:T_P(L^1(\cZ))=:\dot{\P}_P\to\R$が接空間上の有界線型汎函数として定まる．
    接空間は$L^2(P)$の部分空間としてHilbert空間の構造も持つから，
    この微分$dP$は積分核を持つ：$\exists_{\varphi\in\L^2(P)}\;dP(g)=(g|\varphi)_P=\int g\varphi dP$．
    この積分核$\varphi(z;P)$を影響関数という．
    だから幾何学的なのか．そして各接空間の内積構造も少しずつ違う，Riemann多様体のようになっている．
    $T_P(L^1(\cZ))$は，各移動可能な方向$\o{P}\in\O(P)$によって張られる無限次元空間である．
    これに直接言及は難しいので，現在のセミパラメトリック理論では接集合という概念が登場する．
\end{tbox}

\subsection{下界}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    汎関数$\psi:\P\to\R$に対して，$\bP$での微分の表現元$\varphi$のノルムの二乗が効率限界である．
\end{tcolorbox}

\begin{discussion}
    部分モデルの族
    \[p_\ep(z):=dP(z)(1+\ep h(z))\qquad \exists_{M\in\R}\;\norm{h}_\infty\le M\land\exists_{\ep<1/M}\;p_\ep(z)\ge0\]
    のスコアは$h(z)$自身だから，下界はCauchy-Schwartzの不等式によって
    \[\sup_{P_\ep}\frac{\psi'(P)^2}{\Var[s_\ep(Z)]}=\sup_{h}\frac{\bE[\varphi{Z;\bP}h(Z)]^2}{E[h(Z)^2]}\le\bE[\varphi(Z;\bP)^2]=\Var[\varphi(Z)].\]
    そしてこの最右辺は達成可能であるから，この，$\varphi\in\dot{\P}_P$のノルムの二乗が効率限界であることがわかった．
\end{discussion}
\begin{remark}
    このときの下界を達成するサブモデルを，least favorableまたはhardestという\cite{Asymptotic Statistics}．
\end{remark}

\begin{corollary}[Corollary 2.6 \cite{vanderVaart Semiparametric Theory}]
    
\end{corollary}

\section{有効影響関数の導出}

\section{影響関数に基づく推定量}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    実際に効率限界を達成する推定量を，影響関数を用いて構成する．
\end{tcolorbox}

\begin{notation}
    モデル$\P$に滑らかさ，または，疎性の仮定をおく．
\end{notation}

\subsection{plug-in推定量の修正}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    パラメトリックモデルにおけるNewton法に対応する．
    これは一段階で$Z$-推定量と同等にまで改善されるNewton0Rhapson反復法の類似である．
\end{tcolorbox}

\begin{notation}
    汎関数$\psi:\P\to\R$はvon Mises展開可能とする：
    \[\exists_{\varphi\in L^2_*(\Z,P)}\;\forall_{\o{P}\in\P}\quad\psi(\o{P})-\psi(P)=\int\varphi(z;\o{P})d(\o{P}-P)(z)+R_2(\o{P},P).\]
\end{notation}

\begin{discussion}
    このとき，plug-in推定量$\wt{\psi}_{pi}:=\psi(\wt{\bP})$は，一致性はあるが，1次のバイアス
    \[\psi(\wh{\bP})-\psi(\bP)=-\int\varphi(z;\wh{\bP})d\bP(z)+R_2(\wh{\bP},\bP)\]
    を持つ．
    そこで，バイアスに関する2回目の一致推定$\bP_n\varphi(Z;\wt{\bP})$を用いて，打ち消すことを考える．
    これを\textbf{ワンステップ推定量}という．
\end{discussion}

\begin{example}
    処置群$A=1$に対するノンパラメトリック回帰関数$\mu(X):=E[Y|X,A=1]$の推定量$\wh{\mu}(x)$に対して，$\bP_n\wt{\mu(X)}=:\wt{\psi}_{pi}$とすると，これは平均処置効果$\psi=E[E[Y|X,A=1]]$のplug-in推定量となる．
    $\mu$の推定に用いた標本と$\bP_n$を定めた標本は別にあり互いに独立であるとすると，plug-in推定量の1次のバイアスが
    \[E[\wt{\psi}_{pi}-\psi]=\int E[\wt{\mu}(x)-\mu(x)]dP(x)\]
    となる．
    これは，第一段階の，ノンパラメトリック回帰関数の推定量$\wh{\mu}$のバイアスの平均となり，大きなノンパラメトリックモデルの標準的なtuningでは$n^{-1/2}$よりさらに遅くなる．

    これは，傾向スコア$\pi(x):=P[A=1|X=x]$に対する推定量$\wh{\pi}$を用いて，$\bP_n\paren{\frac{A(Y-\wh{\mu}(X))}{\wh{\pi}(X)}}$と一致推定出来る．
\end{example}

\subsection{ワンステップ推定量の性質}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    $\wh{\psi}=\psi(\wh{\bP})+\bP_n\varphi(Z;\wh{\bP})$の漸近分散を調べる．
\end{tcolorbox}

\begin{discussion}[ワンステップ推定量の偏差の標準分解]
    \begin{align*}
        \wh{\psi}-\psi&=\psi(\wh{\bP})+\bP_n\varphi(Z;\wh{\bP})-\psi(\bP)\\
        &=(\bP_n-\bP)\varphi(Z;\wh{\bP})+R_2(\wh{\bP},\bP)\\
        &=\underbrace{(\bP_n-\bP)\varphi(Z;\bP)}_{=:S^*}+\underbrace{(\bP_n-\bP)(\varphi(Z;\wh{\bP})-\varphi(Z;\bP))}_{=:T_1}+\underbrace{R_2(\wh{\bP},\bP)}_{=:T_2}
    \end{align*}
    \begin{enumerate}
        \item $\varphi(Z;\bP)$は$n$に依らないから，これは大数の法則より$O_\bP(1/\sqrt{n})$である．
        \item $\sqrt{n}(\bP_n-\bP)=:\bG_n$は経験過程で，$\bP$-Donskerクラスについてはタイトな確率過程であるBrown橋$\bG$に弱収束する．クラス$(\varphi(Z;\wh{\bP})-\varphi(Z;\bP))_{n\in\N}$はたしかにDonskerになりそうである．特に分散は縮んでいく．したがって，遅くとも$O_\bP(1/\sqrt{n})$である．
        \item $T_2$が，一般のplug-in推定量で支配的になり，大きな偏差を生んでしまうが，適切なノンパラメトリックな仮定(疎性や滑らかさ)をおくことによって，高次の微小項になることが示せる．
    \end{enumerate}
    $T_1,T_2$が$o_\bP(1/\sqrt{n})$ならば$S^*$が支配的になり，漸近正規性と最適性，$\sqrt{n}$-一致性がすぐに従う．
\end{discussion}

\subsubsection{$T_1$}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    $\varphi(Z;\wh{\bP})$が$\varphi(Z;\bP)$に$L^2(\bP)$-収束するならば，
    Donsker性を満たすか，標本分割法を使えば，$0$に$\sqrt{n}$-収束する．すなわち，$o_\bP(1/\sqrt{n})$．
    いずれの手法も"overfitting"を避けるための手続きとみなせる．
\end{tcolorbox}

\begin{discussion}
    この$L^2(\bP)$-収束の必要十分条件が確定出来ない．
\end{discussion}

\subsubsection{$T_2$}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    この項が$o_\bP(1)$になり得るという現象が，通常のplug-in推定量とワンステップ推定量の差の全てである．
    これは現状，ケースバイケースの解析しか出来ていない．
    が，von Mises展開をより高次にすることによって，何かしら一般的な議論が導けるに違いないだろう．
\end{tcolorbox}

\subsection{推定方程式}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    ワンステップ推定量に代わる理論として，$Z$-推定量の対応物を考えたい．
\end{tcolorbox}

\begin{discussion}
    推定方程式$\bP_n\varphi(z;\wh{\bP},\psi)=0$の$\psi$についての解を推定量とすることを考える．

    影響曲線$\varphi$が線型ならば：$\varphi(z;\bP)=\phi(z;\bP)-\psi(\bP)$，この手法はワンステップ推定量に等価である．
\end{discussion}

\subsection{TMLE}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    van der Laanらによるtargeted maximum likelihood estimationは，漸近的にワンステップ推定量に似た挙動をし，有限標本に対して良い挙動をする．
\end{tcolorbox}

\section{適応的実験}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    CS用語であり，基本的には無記憶性・忘却的の対義語であり，Markov性と関係が深い．

    また特定の使い方では，頑健性に関連が深い．機械学習・統計的学習はData-adaptive model buildingと表現でき，モデルのmisspecificationのリスクを減らす方策の1つである．
\end{tcolorbox}

\begin{history}[adaptive / sequential allocation]
    過去の観測に応じて次にサンプルを取得する対象を選択する問題は\textbf{適応的割当}または\textbf{逐次割当}と呼ばれ，古くから多くの研究がなされている．
    バンディット問題はその典型である．
    統計学・確率論の観点から再評価したのがRobins 1952である．
    特に，治験において，治療に失敗する患者を最小化しながらデータを取るための方法論が議論された．
\end{history}

\begin{discussion}[この研究がコーナーストーンである理由]
    影響関数に基づいてワンステップ構成される漸近最適な一致推定量は，"targeted learning"や"debiased machine learning"と呼ばれる．
    その理由は，モデルに一切の仮定をおいていないノンパラメトリック法なので，
    むしろデータ生成過程のモデルに適応的推定方策(変数選択(variable selection procedures)や機械学習アルゴリズム)の採用を可能にする．
    これは，「モデル選択とvalidation」「情報量規準」から，「科学的に正しい統計汎関数の選び方」へ科学の中心を移すことになる．
    形式科学・自然科学として，数学中心に物理学を情報学全般に回転させることが出来る．\cite{Hines}
\end{discussion}

\subsection{バンディット問題}

\begin{history}
    \begin{enumerate}
        \item 1980s-90sには強化学習(Markov決定過程の中で最適行動を学習する行動者)がこの問題を解いた．
    \end{enumerate}
\end{history}

\section{二重にロバストな推定}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    Robins et al. 1994は，推定方程式に$z=0$群の共変量データを用いた項を付加することでデータ利用効率を向上し，推定量の分散を減少させる\textbf{augmented inverse probability weighted estimator}を開発した．
    これは実は局所有効なセミパラメトリック推定量になる．
    現在では「共変量で結果変数を説明する回帰関数の形で表された項を付加することで局所有効なセミパラメトリック推定量を構成する」手続きは一般化されている．
\end{tcolorbox}

\chapter{影響関数の幾何}

\begin{quotation}
    セミパラメトリックモデルでは，最尤推定が必ずしも良くない(Neyman-Scott問題 1948)．
    これを解決に導いたのが情報幾何であった．
\end{quotation}

\begin{notation}
    $Z$の密度は，ある測度$\nu_Z$に関して$(p_Z(z;\theta))_{\theta\in\Omega}$に属すると仮定する．
    母数は$\theta=(\beta^T,\eta^T)^T\in\R^q\times\R^r=\R^p$とする．
    真値は$\theta_0=(\beta_0^T,\eta^T_0)$で表す．
\end{notation}

\section{影響関数}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    ロバスト解析の文脈から影響の語が取られた(Hampel 74)．
    良い統計量の例として漸近線型統計量が考えられる．
    漸近線形統計量は影響関数によって特徴付けられる．
    $M$-推定量は漸近線型推定量の例である．
\end{tcolorbox}

\begin{definition}[asymptotic linear estimator, influence function]\mbox{}
    \begin{enumerate}
        \item 推定量$\wt{\beta_n}$が次を満たすとき，\textbf{漸近線型}であるという：
        \[\exists_{\varphi\in H_\mb}\quad\sqrt{n}(\wh{\beta_n}-\beta_0)=\frac{1}{\sqrt{n}}\sum^n_{i=1}\varphi(Z_i)+o_p(1)\]
        \item このときの$q$-次元ベクトル値関数$\varphi$を，推定量$\wt{\beta_n}$の\textbf{影響関数}という．影響関数は実は一意に定まる．
        \item $\Avar(\wt{\beta_n}):=E[\varphi(Z,\theta)\varphi(Z,\theta)^T]$を\textbf{漸近分散共分散行列}という．
    \end{enumerate}
\end{definition}
\begin{remark}
    影響関数$\varphi(Z)$は実は真の分布$p(z,\theta_0)$の関数である．$\varphi(Z,\theta)$とも書く．
    よって，$E[\varphi(Z)]$は$E_{\theta_0}[\varphi(Z,\theta_0)]$の略記である．
\end{remark}

\begin{theorem}
    任意の漸近線型統計量について影響関数が存在し，ほとんど確実にただ一つに定まる．
\end{theorem}

\chapter{経験過程論}

\begin{quotation}
    大数の法則や中心極限定理などの，推定量の大標本漸近理論をBanach空間値の確率変数=確率過程にまで拡張する試みを，経験過程論という．
    ここで退化していた「一様」の概念が出現し，Banach空間のノルムと関連する．

    そもそも確率変数・分布の収束とは，本質的に2-射的な概念で，圏論的な意味での極限にすごく近いものがあるな．
    圏論に「図式の極限」という例があるので，関数空間上の点列の収束の概念はそこまで怖くない．

    測度の収束には，全変動ノルムによる収束と，各点（各集合）収束とがまず思い付くが，
    これらよりも広い概念である弱収束が同様な論法で定義できる．

    \cite{渡辺澄夫}によると，代数幾何$\Leftrightarrow$特異点論$\Leftrightarrow$超関数論$\Leftrightarrow$経験過程$\Leftrightarrow$学習理論
    の途があるらしい．「この架け橋によって，実世界の中にある学習システムの挙動を，対応する数学の概念を用いることにより予言することができる．」
\end{quotation}

\section{まとめ}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=経験過程論]
    経験過程論とはなにか．標本$X_1,\cdots,X_n$を分布と見ることは，線型汎関数とみるということである．
    すると，中心極限定理は線型汎関数に関して一般化される．
    測度の空間には作用素ノルムの変種，特に全変動ノルムの一般化と見れるノルムを入れる．
    この$\F$が定めるノルムが完備になるか，特に$\bP_n$について収束するかを考える．
    こちらのほうが幾何学的で，中心極限定理が直感的に捉えやすいのではないか？
\end{tcolorbox}

\begin{definition}[stochastic process, empirical process, sample function / realization / sample path]\mbox{}
    \begin{enumerate}
        \item 確率空間$(\X,\A,P)$と任意の可測空間$T$に関して，可測写像の族$T\to\Meas(\X,\R)$を確率過程という．
        \item 経験測度$\bP_n:=n^{-1}\sum_{i=1}^n\delta_{X_i}$と任意の可測関数族$\F\subset\Meas(\X,\R)$について，確率過程$(\bP_nf)_{f\in\F}:\F\to\Meas(\X^n,\R)$が定まる．これを\textbf{一般化された経験過程}という．
        \item 経験過程$\F\to\Meas(\X^n,\R)$が定める確率要素$\X^n\to\Map(\F,\R)$の値$(X_t(x))_{t\in T}$を\textbf{見本関数}，\textbf{実現}または\textbf{標本道}という．これは時系列値の確率変数と見れるため，この道を理解することが目的の一つとなる．\footnote{$w_1\in\X$を銘柄として，$X(w_1)$は時系列を返す，など．}
    \end{enumerate}
\end{definition}
\begin{remarks}
    $\X=\R$であるとき，経験分布関数$\bF_n:\R\to[0,1]$は，定義関数のクラス$\F:=\Brace{1_{x\le t}\mid t\in\R}$が定める経験過程$(\bP_nf)_{f\in\F}$と同一視できる．
    添字集合$T$の同型類は，必要に応じて自由に取るが，主な手法は$T\subset\Meas(\X,\R)$の場合について与えられる．
    経験測度が$\Meas(\X,\R)$上に線型汎関数を定めるためであろう．
\end{remarks}

\begin{enumerate}
    \item 経験過程には弱収束の概念が定義できる．経験過程$(\X^n\to\Map(\F,\R))_{n\in\N}$はBanach空間$l^\infty(\R)$-値確率変数の列であり，始域こそ違うが，終域上に定まる測度に関する収束である弱収束は問題なく定義できる．
    さらに$X_n:\Om_n\to\X$始域が違うことは，外積分の定義に含まれて効いてくるが，$\Om_n:=\coprod_{n\in\N}\X^n$に埋め込んで定義することとする．\footnote{この技術的な議論が完全性(perfect map)の議論である．}
    なお，経験過程の値域は，双対空間$\bP_{(X_1,\cdots,X_n)}:\F\to\R\in\X^{**}$の元であることに注意．これが距離空間というのは部分的な見方である．
    \item Glivenko-Cantelli 1933の古典的な結果$\sup_{t\in\R}\abs{\bF_n(t)-F(t)}\xrightarrow[n\to\infty]{\as}0$
    は，任意の経験分布関数$\bF_n:\X^n\to\Meas(\R,[0,1])$は一様に真の分布関数$F$に概収束することを保証する．
    これを，経験過程＝Banach空間値確率変数の列に関する「一様大数の法則」の特殊な場合だと見て，一般に，$\sup_{f\in\F}\abs{\bP_nf-Pf}=:\norm{\bP_n-P}_\F\xrightarrow{\as^*}0$を満たす確率過程$(\bP_nf)_{f\in\F}$を，$P$-Glivenko-Cantelliであるという．
    前述の結果は，$\F=\{1_{(-\infty,t]}\in\Meas(\X,\R)\mid t\in\R\}$に関する特別な場合に相対化される．
    \item これを中心化して，$\G_n:=\sqrt{n}(\bP_n-P)$という符号付測度の$w^*$-収束を考える．
    これは標本$X_1,\cdots,X_n$と真の分布との誤差に関する主張であり，
    古典的な中心極限定理は$\X=[0,1]$について，$\G_n(t):=\sqrt{n}(\bF_n(t)-F(t))$が平均$0$で分散$F(t)(1-F(t))$を持つGauss確率変数$G(t):[0,1]\to[0,1]$に各点$t\in[0,1]$で分布収束するという主張に相当する．
    Donsker 1952の古典的な結果は，Dudleyによる整理と併せて，Brown橋$\G_n$に対して
    $\norm{\G_n-\G}_\infty$が$0$に確率収束すること，すなわち，$\G_n$が$\G$に$l^\infty(\F)$上の一様ノルムについて弱収束することを示した．
    \footnote{Donskerのオリジナルな結果は，標本道がSkorokhod空間$D(-\infty,\infty)$上で分布収束することを保証する．}
    \item すなわち，標本$X_1,\cdots,X_n$は測度を定め，真の分布との差を考えることは符号付き測度を定めるが，これを線型汎関数と見て，これが（ノルム収束するだけでなく）$w^*$-収束することを示すことが，誤差論の中心的な議論となる．
\end{enumerate}

\begin{discussion}[Brownian bridgeについて]
    極限過程$G$はGaussian過程（任意の有限部分集合$T_k\subset T$に関して多変量正規分布を周辺分布にもつ）であり，標準Brownian bridge $\bB$を用いて$\G=\bB(F(t))$と表せる．よって$\G$自体もBrownian bridgeと呼ぶ．
    なお，標準Brownian bridgeは標準ブラウン運動$\bW$を用いて，$\bB(t)=\bW(t)-t\bW(1)\;(t\in[0,1])$と表せる．
    標準ブラウン運動は$[0,\infty)$上のGaussian過程の代表であり，$\bW(0)=0$で共分散が$s\land t$で特徴付けられる．
\end{discussion}

\begin{discussion}[中心極限定理の翻訳]
    経験過程$\G_n\frac{1}{\sqrt{n}}(\bP_n-P)$の$l^\infty(\F)$上での分布収束は，独立同分布に従うBanach空間値確率要素$\delta_{X_1}-P,\cdots,\delta_{X_n}-P$のBanach空間$l^\infty(\F)$上での中心極限定理とみなせる．
    逆に，次が成り立つ．
    \begin{proposition}
        任意の独立同分布に従うBanach空間値確率変数に関する中心極限定理は，経験過程に関する結果によって等価に表現できる．
    \end{proposition}
    したがって，確率論に対する関数解析の視点からの壮大な方針転換と言える．\footnote{一部の中心極限定理は経験過程に翻訳するにあたって不自然な結果をうむので，あまり執着し過ぎるべきではない，とのこと．特に$l^\infty(\F)$という形のBanach空間について考える．これは$\R^n$を含む．$\F$の選び方によって様々なBanach空間を走るが，これが$\F$の条件のみによって表せる．}
\end{discussion}


\section{一般化された弱収束の理論}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    統計量は一般に一様ノルムについて可測ではないので，必ずしも可測ではない写像列の「弱収束」＝「終域上に定める測度の弱収束」の概念を定めたい．
    そのためには，一般の写像について，それが終域上に引き起こす測度を考えたいから，外確率・外積分の概念を導入する．
    \textbf{そもそも確率変数の収束の定義の仕方は，可測性に関連がない}．このことを明らかにした．
    これは，Billingsleyが68に集大成したように，50sの確率変数の収束の議論を，経験過程論との相互作用の中でHoffmann-JorgensenとDudleyによって整備された．

    このアプローチは非常に自然で，経験過程論の中心的な道具となる（なお，確率過程は自然にBanach空間値の確率変数と見れるから，一般の距離空間を値に取る確率要素について議論する）．
    一般の写像の弱収束は伊藤清の確率積分と同様かもしれないが，この弱収束の理論の外積分による拡張は極めて自然で，まさに正道という感じがする．
    実際，cadlag過程に対するSkorohod位相などの不思議な位相ではなく，一様ノルムの位相についての収束が外測度上の収束に対応する．
\end{tcolorbox}

\subsection{問題意識：非可測な確率過程の存在}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    自体はユニタリ表現などのときのように，
    一様ノルムが定める$\sigma$-代数に関して非可測な確率過程が自然に出現する．
    ノルム位相が強すぎるのである．
    位相を弱める方針もありえるかもしれないが，ここでは従来の弱収束の定義を拡張したい．
\end{tcolorbox}

\begin{definition}[pseudometric]\mbox{}
    \begin{enumerate}
        \item $d(x,y)=0\Rightarrow x=y$が必ずしも成り立たない距離関数$d:D\times D\to\R_{\ge 0}$を，\textbf{擬距離}という．
        ノルム空間は距離空間を定めるように，半ノルム空間($\norm{u}=0\Rightarrow u=0$が成り立たないノルム空間)は擬距離空間を定める．
        \item 擬距離が生成する位相とは，開球$B_r(x):=\Brace{y\in X\mid d(x,y)< r}$を開基として生成する位相をいう．擬距離が距離であるための必要十分条件は，生成する位相がKolmogorov($T_0$)であることに同値．この位相が生成するBorel $\sigma$-集合体を$\D$と表すこととする．
    \end{enumerate}
\end{definition}
\begin{remark}
    擬距離と半ノルムは関数空間では極めて自然な概念である．例えば実数値関数空間$f,g\in\F(X)$について，$d(f,g):=\abs{f(x_0)-g(x_0)}\;(x_0\in X)$と定めると，これは擬距離である．
    すると，位相が識別可能であるかどうか($T_0$)が焦点になり，これにKolmogorovの名前がついている．
\end{remark}

\begin{notation}[関数空間の記法]\mbox{}
    \begin{enumerate}
        \item 実数値有界関数の全体を$l^\infty(D)$と表す．一般に$l^\infty(J)$は直和$\oplus_{j\in J}\R=\Brace{(j,x_j)\in J\times\R\;\middle|\; \sup_{j\in J}x_j<\infty}$に一様ノルムを入れたもので，$J=\N$の場合が数列空間であるが，その一般化と捉えるのである．
        \item その上の一様ノルムを$\norm{f}_\infty$または$\norm{f}_D$などと表す．
        \item 実数値有界連続関数の空間を$C_b(X)$と表す．
    \end{enumerate}
\end{notation}

\begin{definition}[random element (Fréchet 48)]
    確率空間$(\Om,\A,P)$から距離空間$(D,d)$への$\A/\D$-可測関数$X:\Om\to D$を\textbf{確率要素}という．
    $D=\R$の場合を\textbf{確率変数}という．
\end{definition}

\begin{definition}[weak convergence of measure]
    測度を測度空間$(D,\D)$上の有界連続関数の空間$C_b(D)$上に定まる線型汎関数とみなす．このときの$\sigma(C_b(D)^*,C_b(D))$位相に関する収束，すなわち弱$*$-収束を，測度の弱収束という．
    詳しくは，次の通り：
    \begin{enumerate}
        \item Borel可測空間$(D,\D)$上のBorel確率測度の列$(L_n)$が$L$に弱収束する$L_n\rightsquigarrow L$とは，次が成り立つことをいう：$\forall_{f\in C_b(D)}\;\lim_{n\to\infty}\int_DfdL_b=\int_DfdL$．
        \item $L_n,L$を分布として引き起こす確率要素$X_n:\Om_n\to D,X:\Om\to D$を用いると，この条件は次のように特徴付けられる：$\forall_{f\in C_b(D)}\;\lim_{n\to\infty}E[f(X_n)]=E[f(X)]$．この条件を，$X_n$が$X$あるいは$L$に\textbf{弱収束}するといい，$X_n\wconv X$や$X_n\wconv L$と表す．
    \end{enumerate}
\end{definition}
\begin{remark}
    (2)で確率過程$(X_n)$の弱収束の概念が登場しているが，重要な確率過程でBorel可測でないものが存在する．
\end{remark}

\begin{example}[Borel可測でない確率過程：$D$-値過程]\label{exp-non-measurable-process}
    $B([0,1])$は一様ノルムに関してBanach空間であり，一様距離を定める．これの部分空間$D([0,1])\subset B([0,1])$としてSkorokhod空間を考えると，
    これはSkorokhod距離とは異なる．
    この位相が定めるBorel $\sigma$-加法族を$\D$とし，$\B$を$[0,1]$のBorel $\sigma$-加法族，$\lambda$を$[0,1]$のLebesgue測度とする．
    一様分布に独立に従う確率変数$\xi_i:([0,1],\B,\lambda)^n\to([0,1],\B,\lambda)\;(i\in[n])$を射影として定める．
    このとき，
    \begin{itemize}
        \item 経験分布過程$F_n(t)=\frac{1}{n}\sum_{i=1}^n\chi_{[0,t]}(\xi_i)$
        \item 一様経験過程$X_n(t)=\sqrt{n}(F_n(t)-t)$
    \end{itemize}
    は$D$空間への写像$[0,1]^n\to D([0,1])$を定めるが，いずれも$\D/\B^n$-可測ではない．
    特に，$\sigma$-加法族を$\D$が大きすぎるので，$\B^n$では要素数が足りない．
    ユニタリ表現における$B(H)$に入れる位相で，ノルム位相では強すぎるという状況に似ている．
    $n=1$の場合で実際に見てみると，確率変数$\xi(\om)=\om\in[0,1]$に対して，
    経験分布関数はただの特性関数$\chi_{\om}$となるから，関数$z:[0,1]\to D([0,1])$を$z_x(t):=\chi_{[x,1]}(t)-t$と定めるとこれは$z_x\in D([0,1])$で，一様経験過程は$X_1(t)=z_{\xi(\om)}(t)=z_\om(t)$と表せる．
    $X_1^{-1}(A)\notin\B$を満たす$A\in D([0,1])$を構成する．$[0,1]$の非Borel集合$H\notin B$を一つとり，$A:=\cup_{x\in H}B_{1/2}(z_x)$と定めれば良い．これは$D([0,1])$の開集合であるから$A\in\D$であるが，$D([0,1])$の距離は一様距離としたから，$x_1\ne x_2$ならば，$d(z_{x_1},z_{x_2})=\sup_{t\in[0,1]}\abs{\chi_{x_1,1}(t)-\chi_{x_2,1}(t)}=1$となるので，$\forall_{x\in[0,1]}\;B_{1/2}(z_x)\cap A=\{z_x\}$であり，$X_1^{-1}(A)=\Brace{x\in[0,1]\mid z_x\in A}=H\notin B$である．
\end{example}

\begin{definition}[RCLL / càdlàg, càglàd, Skorokhod space]
    関数$f:[a,b]\to\R$について，
    \begin{enumerate}
        \item $[a,b)$上右連続$\lim_{x\searrow x_0}f(x)=f(x_0)$で，$(a,b]$上左極限を持つ$\lim_{x\nearrow x_0}f(x)\in\R$とき，\textbf{右連続左極限関数}またはcàdlàg (continue à droite, limites à gauche)関数またはRCLL (Right Continuous with Left Limits)という．
        \item $(a,b]$上左連続で，$[a,b)$上右極限を持つとき，$f$を\textbf{左連続右極限関数}という．
        \item càdlàg関数$f:E\to M$全体からなる集合を$D(E;M)$または$D(E)$と表し，\textbf{スコロホッド空間}という．$E$が閉区間であるとき，$D(E)\subset B(E)$である．
    \end{enumerate}
    これらはWeiner過程のように連続ではなく，ジャンプをもつ過程を捉える基本言語となる．
\end{definition}
\begin{example}\mbox{}
    \begin{enumerate}
        \item 任意の累積分布関数はcàdlàgである．考えている区間$(-\infty,a]$が右閉であるからである．
        \item 基本的には，右から左へ遡及してみて行ったときに，左端が閉じていれば良い．
    \end{enumerate}
\end{example}

\begin{lemma}[càdlàg関数は有界]\label{lemma-cadlag-bounded}
    集合$T\subset[a,b]$上の関数$f$の連続度$w_f:P([a,b])\to\R$を$w_f(T):=\sup_{u,v\in T}\abs{f(u)-f(v)}$で定める．
    \begin{enumerate}
        \item 任意の$\ep>0$に対して，$[a,b]$の分割$a=t_0<t_1<\cdots<t_N=b$であって，$\forall_{i\in m}\;w_f([t_{i-1},t_i))<\ep$を満たすものが存在する．
    \end{enumerate}
    $D([a,b])\subset B([a,b])$．すなわち，区間$[a,b]$上のcàdlàg関数$f$は有界である．
\end{lemma}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item \[\delta^*:=\sup\Brace{\delta\in(0,b-a]\mid [0,\delta)の分割0=t_0<t_1<\cdots<t_N\le\delta であって，条件を満たすものが存在する}\]
        と定めると，$\delta^*=b-a$を示せば良い．
        $f$の右連続性から，$0$に十分小さい点では$\forall_{\ep>0}\;\sup_{u,v\in[0,\delta)}\abs{f(u)-f(v)}<\ep$を満たすから，$\delta^*>0$．
        $0<\delta^*<b-a$と仮定して矛盾を示せば良い．
        このとき，左極限が存在するから，$[0,\delta^*]$の分割で条件を満たすものが存在する．また，$\delta^*$における右極限が存在するから，$r>0$を十分小さくすることで$w_f([\delta^*,\delta^*+r))<\ep$かつ$[\delta^*,\delta^*+r)\subset[a,b]$を満たすようにできる．
        したがって，$\delta^*$の最大性に矛盾．
        \item 
        $\ep=1$などとして適用すれば良い．
    \end{enumerate}
\end{proof}
\begin{remarks}
    ジャンプを無限個持つことがあり得ることも含めて議論が成り立っている！
    例え無限個ジャンプを持っても，そのジャンプの幅の合計が無限に飛ぶことはない．よって，連続度のように，$y$軸で切る見方がうまくいく．
    これは見事だ．
\end{remarks}

\subsection{外積分}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    Kosorok\cite{Kosorok}の6.2そのまんまである．
    外測度とほとんど同様の議論を関数空間上で再展開しただけである．
    可測な写像$U:\Om\to\o{\R}$を用いて，その$E:\Meas(\Om,\oR)\to\oR$による像の下限と定めるのだが，使うときは列をとって議論する．
\end{tcolorbox}

\subsubsection{定義と特徴付け}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    非可測な対象を扱うためには，Caratheodoryの頃からouterな対象を使うと決まっている．
    こうして，$E:\Meas(\Om,\oR)\to\oR$の延長
    $E^*:\Map(\Om,\oR)\to\oR$が定まり，実は$\Im E=\Im E^*$が成り立つ．

    いや，寧ろ積分とは，外積分の制限であるというCarathéodoryの理論も拡張できないか？
    その見方で，$E^*$が基本的に非負・単調・$\sigma$-劣加法的であると特徴付け\ref{lemma-characterization-of-outer-integral}
    の結論を見た方がスッキリするようだ．
    ${-}^*:\Map(\Om,\oR)\to\Meas(\Om,\oR)$も同様の単調写像と思える．
\end{tcolorbox}

\begin{definition}[outer integral / expectation, outer probability]
    $(\Om,\A,P)$を確率空間とする．
    \begin{enumerate}
        \item 写像$T\in\Map(\Om,\o{\R})$に対して，$T$の$P$による\textbf{外積分}とは，\[E^*T:=\inf\Brace{EU\in\o{\R}\mid U\ge T,U\in\Meas(\Om,\o{\R}),EU\in\o{\R}が積分確定}\]をいう．\footnote{統計量$T$は可測とは限らない＝確率変数とは限らないので，期待値とは呼ばずに積分と読んだ方が良いだろう．}
        \item 部分集合$B\in P(\Om)$に対して，\textbf{外確率}とは，$P^*(B):=\inf\Brace{P(A)\in[0,1]\mid A\in\A,B\subset A}$をいう．すなわち，$P^*(B)=E^*[1_{B}]$であり，外積分の特殊な場合と考えられる．
    \end{enumerate}
    $T$の上限とは$-T$の下限であるから，
    双対概念「内積分」「内確率」は次のように定めれば良い：$E_*[T]:=-E^*[-T]$，$P_*(B):=1-P^*(\Om\setminus B)$．
\end{definition}

\begin{lemma}[外積分の特徴付け：minimal measurable majorant, maximal measurable minorant]\label{lemma-characterization-of-outer-integral}
    任意の写像$T\in\Map(\Om,\o{\R})$に対して，可測関数$T^*\in\Meas(\Om,\o{\R})$が存在して，次の２条件と(3)を満たす：
    \begin{enumerate}
        \item $T^*\ge T$，
        \item $\forall_{U\in\Meas(U,\o{\R})}\;U\ge T\as\Rightarrow U\ge T^*\as$（本質的に極小）．
        \item $ET^*$が存在するならば$E^*T=ET^*$である．
    \end{enumerate}
    この$T^*$を\textbf{極小可測優関数}という．
\end{lemma}
\begin{proof}\mbox{}
    \begin{description}
        \item[$T^*$の構成] $f\in B(\R)$を狭義単調増加な有界連続関数とし，$\oR$への連続拡張$\o{f}:\oR\to\oR$を考える．
        
        合成写像$f\circ T:\Om\to\oR$についての外積分$E^*[f(T)]$について，定義から，積分確定な$\Meas(\Om,\oR)$の列$(U_n)$が存在して，$f\circ T\le U_n\le f(\infty)$かつ$E[U_n]\searrow E^*[f(T)]$を満たすものが存在する．ここで，$V_n:=f^*U_n:\Om\to\oR$を考えると，条件$E[U_n]\searrow E^*[f(T)]$は$E[f(V_n)]\searrow E^*[f(T)]$と表せる．
        このとき，$T^*:=\lim_{n\to\infty}\inf_{1\le k\le n}V_k$と定めれば良い．
        \[\xymatrix{
            \Om\ar@{.>}[d]^-{V_n}\ar@/_1pc/[d]_-T\ar[dr]^-{U_n}\\
            \oR\ar[r]_-{\o{f}}&\oR
        }\]
        \item[検証]
        このとき，$T\le\inf_{1\le k\le n}V_k\le V_n$で，第二項と第三項は可測関数だから，
        \[E^*[f(T)]\le E[f(\inf_{1\le k\le n}V_k)]\le E[f(V_n)]\]
        が成り立つ．$n\to\infty$の場合を考えると，$E^*[f(T)]=E[f(T^*)]$．
        \begin{enumerate}
            \item 構成から，$f\circ T\le U\Lrarrow f\circ T\le f\circ V_n$より，$T\le V_n$であるから，$T\le T^*=\lim_{n\to\infty}\inf_{1\le k\le n}V_k$である．
            \item 可測写像$V\in\Meas(\Om,\oR)$が$T\le V\as$を満たすとする．このとき，(1)から$f\circ T\le f\circ(T^*\land V)\as$でもあるから，$T^*\land V$が可測であることに注意して，
            \[E[f(T^*)]=E^*[f(T)]\le E[f(T^*\land V)]\]
            より，$f(T^*)=f(T^*\land V)\as\Lrarrow T^*\le V\as$．
            \item $T^*$が積分確定のとき，(1)より$E^*[T]\le E[T^*]$であるから，逆向きの不等号を示せば良い．
            任意の$V\in\Meas(\Om,\oR)$について，(2)より$T\le V\Rightarrow T^*\le V\Rightarrow E[T^*]\le E[V]$であるから，$V$に関しての下限を考えると，$E[T^*]\le E^*[T]$．
        \end{enumerate}
    \end{description}
\end{proof}
\begin{remarks}\mbox{}
    \begin{enumerate}
        \item なんだこの構成は．
        \item 結局外積分は，Lebesgue積分のときの議論と同様，$\Im E=\Im E^*$．そのときのファイバーは極小可測優関数$T^*$で$E^*T=ET^*$と与えられる．
        これはLebesgue可測性の位相的特徴づけよりも結論が強い．
        外測度の場合はこちらが先に定義され，測度はその制限とされた．
        なるほど，外積分も絶対公理化できるな．そしてLebesgue積分とはその制限なのかもしれない！！
        \item (2)の主張を，${}^*$の単調性$U\ge T\Rightarrow U^*=U\ge T^*$と読むと理解しやすい．
    \end{enumerate}
\end{remarks}

\begin{lemma}[外確率の特徴付け]
    任意の集合$B\subset\Om$に対して，可測集合$B^*\in\A$が存在して，次の２条件と(3)を満たす：
    \begin{enumerate}
        \item $B^*\supset B$，
        \item $\forall_{A\in\A}\;B\subset A\Rightarrow B^*\subset A$．
        \item $1_{B^*}=(1_B)^*\;\as$及び$P(B^*)=E(1_B)^*=P^*(B)$が成り立つ．
    \end{enumerate}
\end{lemma}
\begin{proof}\mbox{}
    \begin{description}
        \item[構成] $B$に対して，$1_B$の極小可測優関数$(1_B)^*$を用いて$B^*:=\Brace{\om\in\Om\mid (1_B)^*(\om)\ge 1}$と定めれば良い．$B^*\in\A$かつ$(1_B)^*=1_{B^*}$である．
        \item[検証]
        \begin{enumerate}
            \item 外積分の特徴付け\ref{lemma-characterization-of-outer-integral}(1)より，$1_{B^*}=(1_B)^*\ge 1_B$より，$B\subset B^*$．
            \item $B\subset A$を満たす任意の可測集合$A\in\A$について，$1_B\le 1_A$より，$(1_B)^*=1_{B^*}\le 1_A=(1_A)^*$．よって，$B^*\subset A$．
            \item $P^*(B)=E^*[1_B]$を示せば，外積分の特徴付け\ref{lemma-characterization-of-outer-integral}(3)より，$E^*[1_B]=E[(1_B)^*]=E[1_{B^*}]=P(B^*)$が従う．
            $E^*[1_B]\le P^*(B)$は，任意の可測集合$A\in\A$について，$B\subset A\Leftrightarrow 1_B\le 1_A\Rightarrow E^*[1_B]\le E[1_A]=P(A)$．$A$についての下限を考えて，$E^*[1_B]\le P^*(B)$がわかる．
            逆の$E^*[1_B]\ge P^*(B)$も，任意の積分確定な可測関数$U\ge 1_B$について，$B\subset\{U\ge 1\}$より，$P^*(B)\le P(U\ge 1)\le E[U]$．$U$に関しての下限を考えて，$P^*(B)\le E^*[1_B]$を得る．
        \end{enumerate}
    \end{description}
\end{proof}
\begin{remarks}
    特性関数と可測性の交錯があまりにも見事だ．
\end{remarks}

\subsubsection{外積分の性質}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    外積分・外確率の計算は結局，写像$T$や集合$A$について，極小可測優関数$T^*$と極小可測集合$A^*$を考えれば良いのであった．
    そこで，この２つについての計算規則をまとめる．
    それにしても，今まで見たことのない計算規則．
    いや，こういう対称性破れは，Borelクラスの位相的正則性のときから見慣れているものと同根かもしれない．
\end{tcolorbox}

\begin{lemma}
    任意の写像$S,T\in\Map(\Om,\o{\R})$に対して，次の関係式が意味を持つならば，確率$1$で成り立つ．
    \begin{enumerate}
        \item $S_*+T^*\le(S+T)^*\le S^*+T^*$：等号成立は$S$が可測であるとき．
        \item $S_*+T_*\le(S+T)_*\le S_*+T^*$：等号成立は$T$が可測であるとき．
        \item $(S-T)^*\ge S^*-T^*$．
        \item $\abs{S^*-T^*}\le\abs{S-T}^*$．
        \item $\forall_{c\in\R}\;(1_{\Brace{T>c}})^*=1_{\Brace{T^*>c}}$．
        \item $\forall_{c\in\R}\;(1_{\Brace{T\ge c}})^*=1_{\Brace{T_*\ge c}}$．
        \item $(S\lor T)^*=S^*\lor T^*$．
        \item $(S\land T)^*\le S^*\land T^*$：等号成立は$S$が可測であるとき．
    \end{enumerate}
\end{lemma}

\begin{lemma}\label{lemma-character-of-minimal-measurable-set}
    任意の集合$A,B\subset\Om$に対して，
    \begin{enumerate}
        \item $(A\cup B)^*=A^*\cup B^*$，$(A\cap B)_*=A_*\cap B_*$．
        \item $(A\cap B)^*\subset A^*\cap B^*$，$(A\cup B)_*\supset A_*\cup B_*$．$A,B$のいずれか一方が可測である場合は逆も成立．
        \item $A\cap B=\emptyset\Rightarrow P_*(A)+P_*(B)\le P_*(A\cup B)\le P^*(A\cup B)\le P^*(A)+P^*(B)$．特に，最右辺の結論には前提$A\cap B=\emptyset$が必要ないことに注意．
        \item $P_*(A\cap B)\ge P_*(A)+P_*(B)-1$．
    \end{enumerate}
\end{lemma}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item 1
        \item 2
        \item 3
        \item (3)で$A=\o{A},B=\o{B}$を考えると，
        \begin{align*}
            &P^*(\o{A}\cup\o{B})\le P^*(\o{A})+P^*(\o{B})\\
            \Leftrightarrow\quad&1-P_*(A\cap B)\le 1-P_*(A)+1-P_*(B)\\
            \Leftrightarrow\quad&P_*(A\cap B)\ge P_*(A)+P_*(B)-1
        \end{align*}
        より，$A\cup B=\Om\Rightarrow P_*(A\cap B)\ge P_*(A)+P_*(B)-1$がわかる．
        $A\cup B=\Om$ではない場合も，部分空間$A\cup B\subset\Om$で考えれば良い．
    \end{enumerate}
\end{proof}

\begin{lemma}
    $T:\Om\to\R$を写像，$\phi:\R\to\R$は広義単調で$\o{\R}$への延長をもつとする．次の関係式が意味をもつならば，それは確率$1$で成り立つ．
    \begin{enumerate}
        \item $\phi$が広義単調増加ならば，
        \begin{enumerate}[(a)]
            \item $\phi(T^*)\ge(\phi(T))^*$：$\phi$が$[-\infty,\infty)$上左連続のとき等号成立．
            \item $\phi(T_*)\le(\phi(T))_*$：$\phi$が$(-\infty,\infty]$上右連続のとき等号成立．
        \end{enumerate}
        \item $\phi$が広義単調減少ならば，
        \begin{enumerate}[(a)]
            \item $\phi(T^*)\le(\phi(T))_*$：$\phi$が$[-\infty,\infty)$上左連続のとき等号成立．
            \item $\phi(T_*)\ge(\phi(T))^*$：$\phi$が$(-\infty,\infty]$上右連続のとき等号成立．
        \end{enumerate}
    \end{enumerate}
\end{lemma}

\subsubsection{Chebyshevの不等式}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    Jensenの不等式など，種々の不等式が引き継がれる．
\end{tcolorbox}

\begin{lemma}[外積分におけるChebyshevの不等式]
    任意の写像$T:\Om\to\R$と$(0,\infty)$上正値な単調増加関数$\phi:[0,\infty)\to[0,\infty)$について，次が成り立つ：
    \[\forall_{u>0}\;P^*(\abs{T}\ge u)\le\frac{E^*\phi(\abs{T})}{\phi(u)}.\]
\end{lemma}
\begin{proof}
    任意の$u>0$について，
    \begin{align*}
        \phi(u)P^*(\abs{T}\ge u)&=\phi(u)E^*[1_{\Brace{\abs{T}\ge u}}]\\
        &=E^*[\phi(u)1_{\Brace{\abs{T}\ge u}}]&\because\phi(u)>0\\
        &\le E^*[\phi(\abs{T})].
    \end{align*}
\end{proof}

\subsubsection{完全性とFubiniの定理}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    Fubiniの定理が，
    一般化されたLebesgueの優収束定理と同じような消息になる．
    もうだめだ，もはやこれが本来的だと感じる．
\end{tcolorbox}

\begin{definition}[perfect]
    可測関数$\phi$と写像$T$に関して，$T^*\circ\phi$は$T\circ\phi\le T^*\circ\phi$を満たす可測関数だから，外積分の特徴付け\ref{lemma-characterization-of-outer-integral}(2)より，
    $(T\circ\phi)^*\le T^*\circ\phi$であるが，逆も成り立つかはわからない．
    \[\xymatrix{
        (\wt{\Om},\wt{\A},\wt{P})\ar[r]^-\phi\ar[dr]_-{T\circ\phi}&(\Om,A,\phi_*\wt{P}=P)\ar[d]^-T\ar@/_1pc/[d]_-{T^*}\\
        &\R
    }\]
    そこで，$\forall_{T\in B(\Om)}\;(T\circ\phi)^*=T^*\circ\phi$を満たす可測関数$\phi:\wt{\Om}\to\Om$を\textbf{完全}という．
    したがって，任意の$T:\Om\to\R$に対して，
    $\wt{E}^*(T\circ\phi)=\wt{E}(T^*\circ\phi)=E[T^*]=\int T^*dP$と計算できる．特に，任意の$B\subset\Om$について$T=\chi_B$とすれば，$\wt{P}^*(\phi\in B)=P^*(B)$である．
\end{definition}

\begin{lemma}\label{lemma-projection-is-perfect}
    直積確率空間からの射影は完全である．
\end{lemma}

\begin{definition}[累次外積分]
    $T:(\Om_1\times\Om_2,\A_1\times\A_2,P_1\times P_2)\to\R$を写像とする．
    \begin{enumerate}
        \item $(E_2^*[T])(\om_1):=\inf\Brace{E_2[U]\in\o{\R}\mid\forall_{\om_2\in\Om_2}\;U(\om_2)\ge T(\om_1,\om_2),U\in\Meas(\Om_2,\o{\R}),E_2Uが存在}$とする．「$\om_1\in\Om_1$について止めて一変数と見たときの外積分」と定める．
        \item $E_1^*(E_2^*T)$を，関数$E_2^*T:\Om_1\to\o{\R}$の外積分とする．
    \end{enumerate}
\end{definition}

\begin{theorem}[Fubini]\label{thm-Fubini}
    $T:(\Om_1\times\Om_2,\A_1\times\A_2,P_1\times P_2)\to\R$を写像とする．このとき，
    \[E_*T\le E_{1*}E_{2*}T\le E_1^*E_2^*T\le E^*T.\]
\end{theorem}
\begin{proof}\mbox{}
    \begin{description}
        \item[方針] $E^*[T]<\infty$の場合に$E_1^*[E_2^*[T]]\le E^*[T]$を示せば良い．
        このとき，$T\le U$かつ$E^*[T]\le E[U]<\infty$を満たす可測関数$U\in\Meas(\Om_1\times\Om_2,\oR)$が取れる．
        すると，$T^*\le U$であるから，$E[(T^*)^+]\le E[U^+]<\infty$である．
        \item[証明] 
        いま$T\le T^*$だから，$\forall_{\om_1\in\Om_1}\;T(\om_1,-)\le T^*(\om_1,-)$より，
        \begin{align*}
            E^*_2[T]&\le E_2[T^*]\quad P_1\textrm{-}\as\\
            &=E_2[(T^*)^+]-E_2[(T^*)^-]
        \end{align*}
        であるが，$E[(T^*)^+]<\infty$であったから，右辺は積分確定．よって，これについての外積分を考えて，
        \begin{align*}
            E_1^*[E_2^*[T]]&\le E_1[E_2[(T^*)^+]-E_2[(T^*)^-]]\\
            &=E[(T^*)^+]-E[(T^*)^-]&\because\text{Fubiniの定理}\\
            &=E[T^*]=E^*[T].
        \end{align*}
    \end{description}
\end{proof}

\subsection{緊密性と可分性}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=可分・緊密な確率変数]
    可分確率変数＝Radon確率変数というクラスを定義する．
    これは「確率変数の像が可分」ということを確率論的に緩めて，「確率１で可分な空間に含まれる」ことと定義する．
    $\sigma$-コンパクト性と$\sigma$-有限性の混合のように，「確率１に至るコンパクト集合の増大列が取れる」ことを緊密という．
    コンパクト集合の増大列が取れなくても全有界集合の増大列が取れる場合，プレタイトという．
\end{tcolorbox}

\begin{definition}[tight, separable, pretight]
    距離空間上のBorel確率空間$(D,\B(D),L)$上のBorel可測写像$X:\Om\to D$について，
    \begin{enumerate}
        \item Borel可測写像$X:\Om\to D$が\textbf{緊密}であるとは，内部正則であることをいう：$\forall_{\ep>0}\;\exists_{K\compsub D}\;L^X(K)\ge 1-\ep$．\footnote{ある種の$\sigma$-compect性や$\sigma$-有限性の拡張に思える．}
        \item 可算な稠密部分集合が存在する位相空間$X$，すなわち$X$の任意の空でない開集合が交わりを持つような$X$の点列が存在するような空間を\textbf{可分}という．
        \item Borel可測写像$X:\Om\to D$が\textbf{可分}であるとは，可分な可測集合$A\in\B(D)$が存在して$L^X(A)=1$を満たすことをいう．
        \item 測度$L$が\textbf{プレタイト}であるとは，任意の$\ep>0$に対して，全有界な可測集合$B\in\B(D)$であって，$L^X(B)\ge 1-\ep$を満たすものが存在することをいう．
    \end{enumerate}
\end{definition}

\begin{lemma}\label{lemma-separable-and-tight}
    距離空間上のBorel確率空間$(D,\B(D),L)$について，(1)$\Leftrightarrow$(2)$\Rightarrow$(3)であり，
    $D$が完備であるとき(3)も同値である．
    \begin{enumerate}
        \item $L$は緊密である．
        \item $\sigma$-コンパクト集合$\wt{K}\in\B(D)$が存在して，$L(\wt{K})=1$を満たす．
        \item $L$は可分である．
    \end{enumerate}
\end{lemma}
\begin{proof}\mbox{}
    \begin{description}
        \item[(1)$\Rightarrow$(2)] 
        任意の$n\in\N$について，$L(K_n)\ge 1-1/n$を満たす$K_n\compsub D$が取れる．これについて$\wt{K}:=\cupn K_n$と置くとこれは$\sigma$-コンパクトで，$\forall_{n\in\N}\;\wt{K}\supset K_n$より$\forall_{n\in\N}\;L(\wt{K})\ge 1-1/n$だから$L(\wt{K})=1$．
        \item[(2)$\Rightarrow$(1)]
        $\sigma$-コンパクトな集合$\wt{K}\subset D$が存在して，$L(\wt{K})=1$を満たす．仮に$\wt{K}=\cupn K_n$とし，コンパクト集合の列$M_i:=\cup_{n=1}^iK_n$を考えると，これは$\wt{K}$に収束する．よって，$\forall_{\ep>0}\;\exists_{N>0}\;\forall_{n\ge N}\;L(M_n)\ge 1-\ep$．よって，$K:=\cup_{n=1}^NK_n$と定めれば良い．コンパクト集合の有限合併はコンパクトである．
        \item[(2)$\Rightarrow$(3)]
        距離空間において$\sigma$-コンパクトな集合は可分であることから従う．

        距離空間のコンパクト性は全有界かつ任意の被覆にルベーグ数が存在することで特徴付けられるが，距離空間が全有界ならば可分である．
        \item[(3)$\Rightarrow$(2)]
        ？
    \end{description}
\end{proof}

\begin{lemma}
    Borel確率変数$L:\Om\to D$が可分であるならば，プレタイトである．
\end{lemma}

\begin{example}[標準的な確率空間の場合]
    $D=\R^n$のとき，$\R^n$の全ての部分集合は$\sigma$-コンパクトだから，全てのBorel確率測度は緊密である．
\end{example}

\subsection{弱収束の定義と特徴付け}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    任意の（可測とは限らない）写像列の，Borel確率変数への弱収束を議論する
    （したがって弱収束とは純測度論的な概念ではない）．
    これには，$B(D)$を，そしてRiesz空間の関数を媒介に用いる．
\end{tcolorbox}

\begin{definition}[weak convergence of mappings]
    確率空間$(\Om_n,\A_n,P_n)$からの$D$-値写像の列を$(X_n)$とする．
    \begin{enumerate}
        \item $(X_n)$が$(D,\D)$上のBorel確率測度$L:\D\to[0,1]$に\textbf{弱収束}するとは，次が成り立つことをいう：$\forall_{f\in C_b(D)}\;E^*[f(X_n)]\xrightarrow{n\to\infty}E[f]$．
        \item $(X_n)$がBorel可測写像$X:\Om\to D$に\textbf{弱収束}するとは，次が成り立つことをいう：$\forall_{f\in C_b(D)}\;E^*[f(X_n)]\xrightarrow{n\to\infty}E[f(X)]$．
    \end{enumerate}
    ただし，各$E^*[f(X_n)]$は$P_n$の定める外積分で，$E[f(X)]$は$L$の定める期待値である．
\end{definition}

\begin{definition}[Riesz space / vector lattice]\mbox{}
    \begin{enumerate}
        \item $\F\subset l^\infty(D)$が実線型空間かつ$\land,\lor$について束をなすとき，\textbf{Riesz空間}または\textbf{線型束}という．
        \item $\F$が$D$の各点を分離するとは，$\forall_{x,y\in D}\;x\ne y\Rightarrow[\exists_{f\in\F}\;f(x)\ne f(y)]$．
    \end{enumerate}
\end{definition}

\begin{definition}[Lipschitz norm, Lipschitz (continuous) map]\mbox{}
    \begin{enumerate}
        \item Lipschitzノルムを$\norm{f}_\lip:=\inf\Brace{L\in\o{R}\mid\forall_{x,y\in D}\;\abs{f(x)-f(y)}\le Ld(x,y)}=\sup_{x\ne y\in D}\frac{\abs{f(x)-f(y)}}{d(x,y)}$と定める．
        \item Lipschitzノルムが有限となる関数を\textbf{Lipschitz（連続）関数}という．
        \item 上限が１以下またはshortな\footnote{非拡大な写像をshortという．縮小写像はshort mapである．}Lipschitz連続関数の空間の部分空間$\BL_1(D):=\Brace{f\in C_b(D)\mid \norm{f}_\infty\lor\norm{f}_\lip\le1}\subset\BL(D)$に名前をつける．
    \end{enumerate}
\end{definition}

\begin{lemma}[Lipschitz連続性]\mbox{}
    \begin{enumerate}
        \item $\norm{f}_\lip$はノルムになる．
        \item Lipschitz連続関数$f:\R\to\R$は絶対連続であり，したがって殆ど至る所微分可能である．
        \item 絶対連続関数は一様連続である．
        \item 微分可能なLipschitz連続関数$f:\R\to\R$について，$\norm{f}_\lip=\norm{f'}_\infty$である．
    \end{enumerate}
\end{lemma}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item \begin{enumerate}[(a)]
            \item $\norm{f}_\lip=0$とすると，$\forall_{x,y\in D}\;\abs{f(x)-f(y)}=0$であるから，$f=0$．
            \item 任意に$a\in\R$を取ると，任意の$x,y\in D$について，$\abs{af(x)-af(y)}=\abs{a}\abs{f(x)-f(y)}\le\norm{af}_\lip d(x,y)$より，$\norm{f}_\lip=\frac{\norm{af}_\lip}{\abs{a}}$．
            \item 任意の$x,y\in D$について，$\abs{(f+g)(x)-(f+g)(y)}\le\abs{f(x)-f(y)}+\abs{g(x)-g(y)}\le(\norm{f}_\lip+\norm{g}_\lip)d(x,y)$より，$\norm{f+g}_\lip\le\norm{f}_\lip+\norm{g}_\lip$．
        \end{enumerate}
    \end{enumerate}
\end{proof}

\begin{lemma}[弱収束の概念の安定性]\label{lemma-well-definedness-of-weak-convergence}
    距離空間$D$上のBorel確率測度$L_1,L_2$について，次の
    (1)と(2)は同値である．$L_1,L_2$が可分ならば(3)も同値で，緊密ならば(4)も同値である．
    \begin{enumerate}
        \item $L_1=L_2$．
        \item $\forall_{f\in C_b(D)}\;\int_DfdL_1=\int_DfdL_2$．
        \item $\forall_{f\in\BL_1(D)}\;\int_DfdL_1=\int_DfdL_2$．
        \item $\F\subset C_b(D)$が定数関数を含み，$D$の各点を分離するベクトル束ならば，$\forall_{f\in\F}\;\int_DfdL_1=\int_DfdL_2$．
    \end{enumerate}
\end{lemma}
\begin{proof}\mbox{}
    \begin{description}
        \item[(1)$\Rightarrow$(2)] 自明．
        \item[(2)$\Rightarrow$(1)] 
        Borelクラスの上で$L_1=L_2$を示せば良いから，任意の$G\osub D$について$L_1(G)=L_2(G)$を導けば良い．
        任意の$G\osub D$に対して$f_m(x):=\paren{m\cdot d(x,D\setminus G)}\land 1$と定めると，$f_m$は非負値で$\o{G}$を台とする，有界なLipschitz関数であり($\norm{f}_\lip\le m$より)，$0\le f_m\nearrow 1_G\;(m\to\infty)$を満たす．
        よって，$\forall_{m\in\N}\;\int_Df_mdL_1=\int_Df_mdL_2$と単調収束定理より，$G(L_1)=G(L_2)$．
    \end{description}
\end{proof}
\begin{remarks}
    $f_m(x):=\paren{m\cdot d(x,D\setminus G)}\land 1$という非負値で$\o{G}$を台とする有界なLipschitz関数は，
    微分可能性こそないものの，随分普遍的に使えそうなテクニックである．(4)はStone-Weierstrassの定理による．
\end{remarks}

\begin{theorem}[portmanteau (仏:旅行鞄)：弱収束の特徴付け]\label{thm-portmanteau}
    確率空間$(\Om_n,\A_n,P_n)$上の任意の写像列$(X_n:\Om_n\to D)$と$D$上のBorel確率測度$L$について，次の７条件は同値．
    また，$L$が可分でBorel可測写像$X$が$L$を分布に持つとき，(8)も同値．
    \begin{enumerate}
        \item $X_n$は$L$に弱収束する．
        \item 任意の開集合$G\subset D$に対して，$\liminf_{n\to\infty} P_*(X_n\in G)\ge L(G)$．
        \item 任意の閉集合$F\subset D$に対して，$\limsup_{n\to\infty} P^*(X_n\in F)\le L(F)$．
        \item 下に有界な全ての下半連続関数$f$に対して，$\liminf_{n\to\infty} E_*f(X_n)\ge\int_DfdL$．
        \item 上に有界な全ての上半連続関数$f$に対して，$\limsup_{n\to\infty}  E^*f(X_n)\le\int_DfdL$．
        \item $L(\partial B)=0$を満たす任意のBorel集合$B$に対して，$\lim_{n\to\infty} P^*(X_n\in B)=\lim_{n\to\infty} P_*(X_n\in B)=L(B)$．
        \item 全ての有界で非負のLipschitz連続関数$f$に対して，$\liminf_{n\to\infty} E_*f(X_n)\ge\int_DfdL$．
        \item $\sup_{f\in\BL_1(D)}\abs{E^*f(X_n)-Ef(X)}\to 0$．
    \end{enumerate}
    また，$D=\R^k$のとき，(9)と同値で，$(X_n)$がBorel可測であるならば，(10)とも同値．
    \begin{enumerate}\setcounter{enumi}{8}
        \item $L$の累積分布関数$F$の任意の連続点において，$\lim_{n\to\infty} P^*(X_n\le x)=\lim_{n\to\infty} P_*(X_n\le x)=\lim_{n\to\infty}F_n(x)=F(x)$．
        \item $\forall_{t\in\R^k}\;\lim Ee^{it^TX_n}=\int e^{it^Tx}dL(x)$．
    \end{enumerate}
\end{theorem}
\begin{proof}\mbox{}
    \begin{description}
        \item[(1)$\Rightarrow$(7)] 
        $E^*[f(X_n)]\to\int_DfdL$のとき，$E_*[f(X_n)]\to\int_DfdL$でもあるから，$\lim_{n\to\infty}\inf_{n\le k}E_*[f(X_k)]=\int_DfdL$．
        \item[(2)$\Leftrightarrow$(3)]
        補集合を考えることにより，
        \[\liminf P_*(X_n\in D\setminus F)\ge L(D\setminus F)\Lrarrow\liminf(1-P^*(X_n\in F))\ge 1-L(F)\]
        とわかる．
        \item[(4)$\Leftrightarrow$(5)]
        $f$を$-f$と入れ替えることによりわかる．
        \item[(7)$\Rightarrow$(2)]
        任意の$G\osub D$を取る．$0\le f_m\nearrow 1_G\;(m\to\infty)$を満たす有界なLipschitz関数列が取れる．
        (7)より，$1_G\ge f_m$について，$\forall_{m\in\N}\;\liminf P_*(X_n\in G)\ge\liminf E_*[f(X_n)]\ge\int f_mdL$が成り立つ．ここで$m\to\infty$を考えると，単調収束定理より，(2)を得る．

        $P_*[X_n\in G]=P_*(X_n^{-1}(G))=E_*[1_G(X_n)]$の読み替えが肝要であった．
        \item[(5)$\Rightarrow$(1)]
        (4)$\Leftrightarrow$(5)より，任意の上に有界な上半連続関数$f$について，
        \[E[f]\ge\limsup E^*[f(X_n)]\ge\liminf E_*[f(X_n)]\ge E[f]\]
        \item[(2)$\Rightarrow$(4)]
        $f$を非負の下半連続関数とすると，これは下に有界で，$G_i:=\Brace{x\in D\;\middle|\;f(x)>\frac{i}{m}}$は任意の$i\in\N$について開集合であり，$D=\cup_{i\in\N}G_i$である．
        $f_m(x):=\sum^{m^2}_{i=1}\frac{1}{m}1_{G_i}(x)$と定めるとこれは単関数で，
        \[f_m(x)=\begin{cases}
        \frac{i}{m},&x\in G_i\cap(D\setminus G_{i+1})=\Brace{x\in D\;\middle|\;\frac{i}{m}<f(x)\le\frac{i+1}{m}\le m},\\
        m,&x\in G_{m^2}=\Brace{x\in D\mid f(x)>m}.
        \end{cases}\]
        なので，$0\le f_m\le f\land m\le f$であり，$\forall_{x\in D\setminus G_{m^2}}\;\abs{f_m(x)-f(x)}\le\Abs{\frac{i}{m}-\frac{i+1}{m}}=\frac{1}{m}$．
        よって，$(f_m)$は$f$に収束する単関数列である．
        このとき，
        \begin{align*}
            \liminf_{n\to\infty}E_*[f(X_n)]&\ge\liminf_{n\to\infty}E_*[f_m(X_n)]=\liminf_{n\to\infty}E_*\Square{\sum^{m^2}_{i=1}\frac{1}{m}1_{G_i}(X_n)}\\
            &\ge\sum^{m^2}_{i=1}\frac{1}{m}\Square{\liminf_{n\to\infty}P_*(X_n\in G_i)}&\liminf の性質というかなんというか\\
            &\ge\sum^{m^2}_{i=1}\frac{1}{m}L(G_i)=\int f_mdL&\text{(2)の仮定}
        \end{align*}
        と評価できる．ただし，最後の等式は単関数$f_m$に関するLebesgue積分の定義による．
        $m\to\infty$を考えると，
        非負関数の列$(f_m)$の極限$f$の可積分性は不明だが，$(f_m)$が$f$に収束する限り
        Fatouの補題により，
        \[\int_DfdL\le\liminf_{m\to\infty}\int_Df_mdL\le\limsup_{m\to\infty}\int_Df_mdL\le\int_DfdL\]
        であるから，$\liminf_{m\to\infty}\int_Df_mdL=\limsup_{m\to\infty}=\int_DfdL$が従い，(4)の主張を得る．\footnote{$f$の可積分性がわからないので，Lebesgueの優収束定理が使えない．}
        一般の値を取る下に有界な$f$についても同様．
        \item[(2)$\Rightarrow$(6)]
        (2),(3)より，任意のBorel集合について，
        \[L(B^\circ)\le\liminf_{n\to\infty}P_*(X_n\in B^\circ)\le\limsup_{n\to\infty}P^*(X_n\in\o{B})\le L(\o{B})\]
        が成り立つ．$L(\partial B)=0$のとき，等号成立．
        \item[(6)$\Rightarrow$(3)]
        任意の閉集合$F\subset D$をとる．
        $F^\ep:=\Brace{x\in D\mid d(x,F)<\ep}\;(\ep>0)$と定めると，$\ep_1\ne\ep_2\Rightarrow\partial F^{\ep_1}\cap\partial F^{\ep_2}=\emptyset$だから，$E:=\Brace{\ep\in\R_{>0}\mid L(\partial F^\ep)>0}$は可算集合．
        実際，これが非可算だとすれば，$F:=\Im L(\partial F^\ep)\subset(0,1]\;(\ep\in E)$を有限に分割した区間$(i/n,(i+1)/n]$のいずれかに無限個の点を持つ（さもなくば$E$が非可算無限であることに矛盾）．
        その部分の和を取ると，$\infty$に発散するため，$L(D)=1$に矛盾．
        よって，$L(\partial F^{\ep_m})=0$を満たす$\R_{>0}$の単調減少列$(\ep_m)_{m\in\R}$が取れる．
        このとき，(6)より，
        \[\limsup_{n\to\infty}P^*(X_n\in F)\le\limsup_{n\to\infty}P^*(X_n\in\o{F^{\ep_m}})=L(\o{F^{\ep_m}})\]
        が成り立つ．ここで，$m\to\infty$を考えると，$\cap_{m\in\N}\o{F^{\ep_m}}=F$より，(3)が従う．
        \item[(6)$\Rightarrow$(9)] 特別な場合．

    \end{description}
\end{proof}
\begin{remarks}
    全てFatouの補題ちっくな特徴づけ．
    \begin{description}
        \item[(2),(3)] 
        やはりBorelクラスを議論しているので，位相の言葉で特徴付けると良い．
        \item[(4),(5)] 下に有界な下半連続関数について$\int_DfdL\le\liminf E_*[f(X_n)]$，上に有界な上半連続関数について$\limsup E^*[f(X_n)]\le\int_DfdL$．確かにFatouの補題の弱化に見える．
        半連続関数に注目するのは，その場合に$D=\cup_{i\in\N}G_i$という標準的な開集合の合併による表現が使え，その上に定義された単関数$f_m$は．$D\setminus G_{m^2}$上で$f-f_m$は$1/m$で一様に抑えられ，$m\to\infty$に対して$G_{m^2}\to D$となる．
        \item[(6)]
        これも(2),(3)の特徴付け．
        \item[(7)] これは弱収束の定義の「$f\in\B(D)$」を「$f\in\BL(D)$」に強めている．
        開集合$G$の特性関数$1_G$（ちなみに下半連続）に下から収束する非負値で$\o{G}$を台とする有界なLipschitz関数の列$(f_m)$
        を用いた，(2)へ帰着させる補題\ref{lemma-well-definedness-of-weak-convergence}の証明抽出．
        \item[(8)]

        \item[(9)] Prokhorovの定理による．

        \item[(10)] 特性関数は分布を特徴付ける．Glibenkoの定理という確率論の話．
    \end{description}
\end{remarks}

\begin{lemma}
    部分距離空間$D_0\subset D$について，$X,X_n:\X\to D$を写像とする．
    この時，$(X_n)$が$D_0$への写像として$X$に弱収束することと，$D$への写像として弱収束することとは同値．
\end{lemma}
\begin{proof}
    $D_0$は位相空間として$D$の部分空間であるから，$D_0$の開集合と$D$の部分空間としての開集合は一致するため，
    portmanteau定理\ref{thm-portmanteau}(2)からわかる．
\end{proof}

\begin{example}
    $\R$上のDirac測度$\ep_{1/n}$は，$\ep_0$に弱収束するが，各点収束はしない．
    例えば$A:=(0,1]\in\B_1$上では，$\forall_{n\in\N}\;\ep_{1/n}(A)=1$である．
\end{example}

\subsection{弱収束の例：経験過程はBrownian bridgeに収束する}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    Glivenko-Cantelliの定理は関数$F$の推定量としての一致性(consistency)を示している．
    ではどこに収束するか？
    経験分布関数$F_n$の収束先は$F$-Brownian bridgeと呼ばれ，
    このときの収束は「一般の関数の可測関数への弱収束」として定義できる．
    「経験分布関数の理論では，この収束と連続写像定理を組み合わせることで，種々の統計量の漸近分布が調べられている．」\cite{吉田}

    当然であるが，経験分布関数$\bF_n$は真の分布$F$の自然な推定量であるから，適合度検定で使われる．
\end{tcolorbox}

\begin{example}[empirical distribution function, empirical process, Brownian bridge / pinned Brownian motion]\mbox{}
    \begin{enumerate}
        \item 可測空間$(\o{\R},\B(\o{\R}))$上のBorel確率測度$P$に従う独立な$\o{\R}$-値確率変数を$X_1,\cdots,X_n$とする．
        この観測値が定める\textbf{経験分布関数}$\bF_n:\o{\R}\to[0,1]$とは，$\bP_n(Y):=\#\Abs{\Brace{X_i\in(\{X_1,\cdots,X_n\})\mid X_i\in Y}}\;(Y\in\B(\o{\R}))$と定めた経験測度
        $\bP_n:\B(\o{\R})\to[0,1]$の，定義関数の族$\F:=\Brace{\chi_{(-\infty,t]}\in\Meas(\o{\R},\o{\R})\mid t\in\o{\R}}\simeq_\Set\o{\R}$\footnote{これはBorelクラスを生成する「基底」である．実はこれがDonskerクラスである，という理論が展開される．もしかしてこれは「$\sigma$-代数の基底」の理論なのか？また，Set上の消息に引き戻す理論が経験過程論ってことかもしれない．}への制限として定まる：$\bF_n(t):=\int_{\o{\R}}1_{(-\infty,t]}d\bP_n=\bP_n((-\infty,t])=\frac{1}{n}\#\Abs{\Brace{i\in[n]\mid X_i\le t}}$．
        \item \textbf{中心化・正規化された経験測度}$\G_n:=\sqrt{n}(\bP_n-P):\B(\o{\R})\to\R$についても同様のことを考える．
        \begin{enumerate}[(a)]
            \item これは$A\in\B(\o{\R})$を固定したときの値$\G_n(A)\in\R$の$n\to\infty$のときの弱収束極限は，中心極限定理により正規分布$N(0,P(A)(1-P(A)))$に従う．
            実際，二項分布$B(n,P(A))$に独立に従う確率変数$Y_1,\cdots,Y_n$について$E[Y_1+\cdots+Y_n]=nP(A),\bP_n(A)=\frac{Y_1+\cdots+Y_n}{n}$であるから，
            \[\G_n(A)=\sqrt{n}(\bP_n(A)-P(A))=\sqrt{n}\paren{\frac{Y_1+\cdots+Y_n}{n}-P(A)}=\frac{1}{\sqrt{n}}\sum_{i=1}^n(Y_i-P(A)).\]
            このとき定まる族$(\G_n(A)):\A\times\N\to\R$を，\textbf{可測集合の族$\A\subset\B(\o{\R})$上の経験過程}という．
            \item 一方で，この測度$\G_n:\B(\o{\R})\to[0,1]$を，これが積分によって定める線型汎函数$\G_n:\Meas(\o{\R},\R)\supset\F\to\oR$と見る．
            すると，$f\in\F$を固定したとき，$\G_nf=\sqrt{n}(\bP_n-P)f\in\R$の$n\to\infty$のときの弱収束極限は，正規分布$N(0,E(f-Ef)^2)$に従う．
            このとき定まる族$(\G_nf):\F\times\N\to\R$を，\textbf{可測関数の族$\F$上の経験過程}という．
            \item 今回の例では$\F$はDonskerクラスであり，$F$を（真の）確率測度$P$の分布関数$F(t):=P((-\infty,t])$とすると，
            $\G_n:\F\simeq_\Set[-\infty,\infty]\to[0,1];t\mapsto\sqrt{n}(\bF_n-F)(t)$の極限過程$\G_F:[-\infty,\infty]\to\R$が存在して，$F$-\textbf{Brown橋／固定端Brown運動}と呼ばれる．
            \item ２つの見方は双対的なもので，大した違いはない．基本的に(b)を採用する．
        \end{enumerate}
        \item 
        こうして，\textbf{経験過程}$\N\to D(\o{\R});n\mapsto\G_n(t)$が定まった．\textbf{このときの値が関数空間$D(\o{\R})$の大きすぎる$\sigma$-加法族に関して可測とは限らないことに注意}\ref{exp-non-measurable-process}．
        これについて，Brownian bridgeへの収束$\G_n\to\G_F$を弱収束として定義できたことになる．
        あとは，そのための$\F$の十分条件を考えたい．
    \end{enumerate}
\end{example}

\begin{example}[適合度検定における応用]\label{exp-Kolmogorov-Smirnov-Cramér-von-Mises}
    $\bF_n$と$F$の差を評価する測度には
    \begin{description}
        \item[Kolmogorov-Smirnov統計量] $\sqrt{n}\norm{\bF_n-F}_\infty=\norm{\G_n}_\infty$
        \item[Cramér-von Mises統計量] $n\int(\bF_n-F)^2dF=\int\G_n^2dF$
    \end{description}
    などがある．$\norm{\cdot}_\infty:D([-\infty,\infty])\to[0,\infty]$は連続であり，
    いずれも経験過程$\G_n$の連続関数になっているから，$\G_n$の極限からこれらの統計量の極限分布が，連続写像定理\ref{thm-continuous-map-theorem}からわかる．
\end{example}

\begin{proposition}
    $\lambda:\B([0,1])\to[0,1]$を一様分布とする．
    $F$-Brownian bridge $\G_F$について，$\G_F=\G_\lambda\circ F$である．
\end{proposition}

\subsection{連続写像定理}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    連続写像は，確率変数の弱収束も，一般の写像のBorel可測関数への弱収束も保つ．
    （したがって特に，一般の確率変数の弱収束，確率収束，概収束も保つ）．
    どうしてこんなものが作れたのか．
    図式の変換を定める射は「殆ど至る所連続な写像」が適格，ということだろうか．
\end{tcolorbox}

\begin{theorem}[continuous map theorem (Henry Mann, Abraham Wald 43)]\label{thm-continuous-map-theorem}
    $D,E$を距離空間とし，
    $g:D\to E$を部分集合$D_0\subset D$上で連続で，\underline{不連続点$D_g$が零な}写像とする．
    この時，写像$(X_n:\Om_n\to D)$がBorel可測関数$X:\Om\to D$に弱収束し，$\Im X\subset D_0$ならば，$(g(X_n))$も$g(X)$に弱収束する．
    \[\xymatrix{
        D\ar[r]^-g&E\\
        \Om\ar[u]^-{X_n}\ar@{.>}[ur]_-{g\circ X_n}
    }\]
\end{theorem}
\begin{proof}\mbox{}
    \begin{description}
        \item[方針] 任意の閉集合$F\subset E$について，$\limsup_{n\to\infty}P^*(g(X_n)\in F)\le P(g(X)\in F)$を示せば良い(Portmanteau定理\ref{thm-portmanteau}(3))．
        いま，$g^{-1}(F)\subset\o{g^{-1}(F)}$で，$\o{g^{-1}(F)}$は閉集合だから，Portmanteau定理\ref{thm-portmanteau}(3)より，
        \[\limsup_{n\to\infty}P^*(g(X_n)\in F)\le\limsup_{n\to\infty}P^*(X_n\in\o{g^{-1}(F)})\le P(X\in\o{g^{-1}(F)}).\]
        実は，$P(X\in\o{g^{-1}(F)})=P(g(X)\in F)$である．
        まず，$\o{g^{-1}(F)}\subset g^{-1}(F)\cup D_g$であるが，これと$L(D_g)=0$を併せると従う．
        任意の$g^{-1}(F)$の列$\{x_n\}$の収束先$x\in D$が，$g$の連続点である場合は$x\in g^{-1}(F)$で，連続点でない場合は$x\in D_g$である．
    \end{description}
\end{proof}
\begin{remark}
    証明を簡単にするため，「不連続点$D_g$が零集合である」という仮定を含めたが，
    この部分がなくとも，$D_g$がBorel集合である（したがって可測である）ことと，測度が$0$であることが導ける．
\end{remark}

\subsection{相対コンパクト性の特徴付け：Prokhorovの定理}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    確率変数$X:\Om\to D$がタイトとは，$D$のコンパクト集合の列$(K_n)$であって，full setに収束するものが存在することをいう．
    一様にタイトとは，$D$のコンパクト集合の列$(K_n)$であって，全ての写像$X_n$について$P(X_n^{-1}(K))\ge 1-\ep$となるような列が取れることをいう．
    一様にタイトなBorel可測関数列は，タイトなBorel可測関数に弱収束する部分列を持つ．
    しかしタイト性もBorel可測性も，多くの応用においては期待できないが，一般の写像列についても，漸近的にさえタイト性と可測性が成り立てば十分であることがわかる．

    「タイトなBorel可測関数」を「広義一様収束」と読み替え，
    「漸近的にタイトかつ漸近的可測」は「正規族である」ことと読み替えれば，
    完全にAscoli-Arzelàの定理と議論がパラレルである．
    可測性と複素微分可能性が対応して，広義一様収束がタイト性に対応する．
    いずれもコンパクト集合をうまく使った収束性の弱化が行われている．

    Prokhorovの定理は，「収束する部分列が存在する」ことを特徴付けるが，これは，距離空間においてコンパクト性と点列コンパクト性は同値だから，相対コンパクト性として特徴付けられる．
    いわば，複素解析におけるMontelの定理のような結果である．
\end{tcolorbox}

\begin{definition}[asymptotically measurable, asymptotically tight, uniformly tight]
    写像列$(X_n:\Om_n\to D)$について，
    \begin{enumerate}
        \item $\forall_{f\in B(D)}\;\lim_{n\to\infty}\paren{E^*[f(X_n)]-E_*[f(X_n)]}=0$が成り立つ時，$X_n$は\textbf{漸近的可測}であるという．
        \item $\forall_{\ep>0}\;\exists_{K\compsub D}\;\forall_{\delta>0}\;\liminf_{n\to\infty}P_*(X_n\in K^\delta)\ge 1-\ep$が成り立つ時，$(X_n)$は\textbf{漸近的緊密}という．
        
        ただし，$K^\delta:=\Brace{x\in D\mid d(x,K)<\delta}$とした．
    \end{enumerate}
    Borel可測関数の列$(X_n:\Om_n\to D)$について，$(X_n)$が\textbf{一様に緊密}とは，$\forall_{\ep>0}\;\exists_{K\compsub D}\;\forall_{n\ge 1}\;P(X_n\in K)\ge 1-\ep$が成り立つことをいう．
\end{definition}

\begin{example}[一様にタイトなBorel可測関数列]
    $(X_n:D\to\R)$を確率変数列とする．
    \begin{enumerate}
        \item $L^{X_n}:=N(n,1)$ならば，$X_n$は一様にタイトではない．
        \item $L^{X_n}:=N(\mu_n,1)\;(-\infty<a\le\mu_n\le b<\infty)$ならば，$X_n$は一様にタイトである．
    \end{enumerate}
\end{example}

\begin{lemma}
    Borel可測関数の列$(X_n:\Om_n\to D)$について，
    \begin{enumerate}
        \item (a)$\Rightarrow$(b)が成り立つ．$D$がPolishである時，(b)$\Rightarrow$(a)も成り立つ．
        \begin{enumerate}[(a)]
            \item $(X_n)$は一様にタイトである．
            \item $(X_n)$は漸近的にタイトである．
        \end{enumerate}
        \item $(X_n)$が一様にタイトである時，弱収束する部分列が存在する．
    \end{enumerate}
\end{lemma}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item (a)$\Rightarrow$(b)は$K\subset K^\delta$より，$P(X_n\in K)\le P_*(X_n\in K^\delta)$であるから明らか．
    \end{enumerate}
\end{proof}

\begin{proposition}[純方向は簡単]\label{prop-inverse-of-Prokhorov}
    $(X_n:\Om_n\to D)$を写像列とする．
    \begin{enumerate}
        \item $(X_n)$が$X$に弱収束するならば，$(X_n)$は漸近的可測である．
        \item $(X_n)$が$X$に弱収束するとき，$(X_n)$が漸近的にタイトであることと$X$がタイトであることとは同値．
    \end{enumerate}
\end{proposition}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item 任意の$f\in B(D)$について，$X_n$が$X$に弱収束するならば，定義より$E^*[f(X_n)]\to E[f(X)]$である．このとき$E_*[f(X_n)]=-E^*[-f(X_n)]\to-E[-f(X)]=E[f(X)]$であるから，$E^*[f(X_n)]-E_*[f(X_n)]\to E[f(X)]-E[f(X)]=0$．
        \item 
        \begin{description}
            \item[$\Rightarrow$] 
            $(X_n)$を漸近的タイトとすると，任意の$\ep>0$に対して，コンパクト集合$K\subset D$が存在して，$\forall_{\delta>0}\;\liminf_{n\to\infty}P_*(X_n\in K^\delta)\ge 1-\ep$．portmanteau定理\ref{thm-portmanteau}(3)より，
            \[P(X\in\o{K^\delta})\ge\limsup_{n\to\infty}P^*(X_n\in\o{K^\delta})\ge\liminf_{n\to\infty}P_*(X_n\in\o{K^\delta})\ge 1-\ep.\]
            $\delta\searrow 0$を考えて，$P(X\in K)\ge 1-\ep$を得る．
            \item[$\Leftarrow$]
            $X$をタイトとすると，任意の$\ep>0$に対して，コンパクト集合$K\subset D$が存在して，$P(X\in K)\ge 1-\ep$．
            開集合$K^\delta\osub D$に対して，portmanteau定理\ref{thm-portmanteau}(2)より，
            \[\forall_{\delta>0}\;\liminf_{n\to\infty}P_*(X_n\in K^\delta)\ge P(X\in K^\delta)\ge 1-\ep.\]
        \end{description}
    \end{enumerate}
\end{proof}

\begin{corollary}
    写像の列$(X_n:\Om_n\to D)$が可分な$X:\Om\to D$に弱収束するならば，$X_n$を完備拡大$\wt{D}$への写像列と見た時，漸近的にタイトである．
\end{corollary}

\begin{theorem}[Prokhorov]\label{thm-Prokhorov}
    $(X_n:\Om_n\to D)$を写像列とする．(1)$\Rightarrow$(2)である．
    \begin{enumerate}
        \item $(X_n)$は漸近的にタイトかつ漸近的に可測である．
        \item $(X_n)$の部分列で，タイトなBorel確率測度$L$に弱収束するものが存在する．
    \end{enumerate}
\end{theorem}

\begin{proposition}[連続写像は漸近的性質を保つ]\label{prop-continous-functions-preserve-asymptotical-properties}
    $(X_n:\Om\to D)$を写像の列，$g:D\to E$を連続写像とする．
    \begin{enumerate}
        \item $(X_n)$が漸近的タイトならば，$(g(X_n))$も漸近的タイトである．
        \item $(X_n)$が漸近的可測ならば，$(g(X_n))$も漸近的可測である．
    \end{enumerate}
\end{proposition}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item $(X_n)$は漸近的にタイトだから，$\forall_{\ep>0}\;\exists_{K\compsub D}\;\forall_{\eta>0}\;\liminf_{n\to\infty} P_*(X_n\in K^\eta)\le 1-\ep$．
        ここで，$g$が連続であることより，任意の$\delta>0$について，$K^{\eta(\delta)}\subset g^{-1}(g(K)^\delta)$を満たす$\eta(\delta)>0$が取れるから，
        \[\liminfn P_*(g(X_n)\in g(K)^\delta)\ge\liminfn P_*(X_n\in K^{\eta(\delta)})\ge 1-\ep\]
        が従う．こうして，条件を満たすコンパクト集合の族$(g(K))_{\delta>0}$が見つかった．
        \item 任意の$f\in B(E)$に対して，$f\circ g\in B(D)$より，$(X_n)$の漸近的可測性から
        \[E^*[f(g(X_n))]-E_*[f(g(X_n))]\xrightarrow{n\to\infty}0.\]
        これは$g(X_n)$の漸近的可測性を表している．
    \end{enumerate}
\end{proof}

\begin{lemma}[漸近的可測性の十分条件]\label{lemma-characterization-of-asymptotical-measurability}
    $\F\subset B(D)$を$D$の各点を分離する代数とする．
    写像列$(X_n)$が次の条件(\#)を満たすならば，漸近的可測である．
    \begin{quote}
        (\#) $(X_n)$は漸近的タイトで，$\forall_{f\in\F}\;E^*[f(X_n)]-E_*[f(X_n)]\to 0$．
    \end{quote}
\end{lemma}
\begin{remarks}
    これはStone-Weierstrassの近似定理による．まさに複素関数での議論に同じである．
\end{remarks}

\begin{tbox}{red}{Prokhorovの定理まとめ}
    「相対コンパクト」と言った時など，収束先がタイトなBorel確率測度であることを暗黙の了解とする．
    すると，Prokhorovの定理は「弱収束するならば漸近的にタイトかつ漸近的に可測」の逆の成立を主張していると思える．
    さらに一歩踏み込んで，
    写像の族$\F\subset\Map(\Om,D)$が相対コンパクトであることの十分条件は，
    漸近的にタイトであることと，ある$B(D)$の部分代数について「漸近的可測」であれば良い．
\end{tbox}

\subsection{収束性の遺伝：Slutskyの定理}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=Prokhorovの定理で迂回できる]
    ２つの確率変数が弱収束し，片方が定数になるならば，それらの積写像も弱収束し，また連続写像定理を組み合わせると，弱収束する確率変数から標準的な構成を行なったものは基本的に全て弱収束することがわかる．
    これをSlutskyの定理といい，これは一般の写像の弱収束についても成り立つ．

    \textbf{片方が定数にならない場合は同様な結果は弱収束では成り立たないが，確率収束では成り立つ}．
    なお，定数に弱収束するならば，定数に確率収束する（補題\ref{lemma-確率収束と弱収束}）．
\end{tcolorbox}

\begin{lemma}[直積距離空間]\label{lemma-product-metric-space}
    $(D,d),(E,e)$を距離空間とする．
    \begin{enumerate}
        \item $\rho((x_1,y_1),(x_2,y_2))=d(x_1,x_2)\lor e(y_1,y_2),\sqrt{d(x_1,x_2)^2+e(y_1,y_2)^2},d(x_1,x_2)+e(y_1,y_2)$はいずれも距離関数で，$D\times E$に直積位相を誘導する．
        \item $D\times E$を直積距離空間とする．一般に$\B(D)\times\B(E)\subset\B(D\times E)$であり，$D,E$がいずれも可分であるならば逆も成り立つ．
        \item $(X,Y):\Om\to D\times E$はBorel $\sigma$-加法族の積について常に可測である．したがって，$D,E$が可分でない場合は，可測関数の積写像$(X,Y):\Om\to D\times E$は直積距離位相のBorel $\sigma$-加法族$\B(D\times E)$については必ずしも可測とは限らない．
        \item コンパクト集合$K_1\subset D,K_2\subset E$と距離関数$\rho$について，$\forall_{\delta>0}\;(K_1\times K_2)^\delta=K_1^\delta\times K_2^\delta$である．
    \end{enumerate}
\end{lemma}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item a
        \item a
        \item a
        \item 
        \[\rho((x,y),K_1\times K_2)=d(x,K_1)\lor e(y,K_2)<\delta\Lrarrow d(x,K_1)<\delta\land e(y,K_2)<\delta\]
        であるから．
    \end{enumerate}
\end{proof}

\begin{lemma}[結合写像の漸近的タイト性]\label{lemma-asymptotical-character-of-product-sequence}
    $(X_n:\Om_n\to D),(Y_n:\Om_n\to E)$を写像列とする．
    \begin{enumerate}
        \item $(X_n),(Y_n)$が共に漸近的タイトであることと，積写像$(X_n,Y_n)$が漸近的タイトであることは同値．
        \item $(X_n),(Y_n)$が漸近的にタイトであるとき，共に漸近的可測であることと，積写像$(X_n,Y_n)$が漸近的可測であることは同値．
    \end{enumerate}
\end{lemma}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item 直積距離空間の性質\ref{lemma-product-metric-space}(4)より$(K_1\times K_2)^\delta=K_1^\delta\times K_2^\delta$であるから，\ref{lemma-character-of-minimal-measurable-set}(4)より，
        \[P_*((X_n,Y_n)\in(K_1\times K_2)^\delta)=P_*((X_n,Y_n)\in K_1^\delta\times K_2^\delta)=P_*(X_n^{-1}(K_1^\delta)\cap Y_b^{-1}(K_2^\delta))\le P_*(X_n\in K_1^\delta)+P_*(Y_n\in K_2^\delta)-1.\]
        また，$K^\delta\subset\pr_1(K)^\delta\times\pr_2(K)^\delta$より，
        \[P_*((X_n,Y_n)\in K^\delta)\le P_*(X^{-1}_n(\pr_1(K)^\delta)\cap Y^{-1}_n(\pr_2(K)^\delta))\le P_*(X_n\in\pr_1(K)^\delta)\land P_*(Y_n\in\pr_2(K)^\delta).\]
        $(X_n),(Y_n)$が共に漸近的タイトである時，一式目よりコンパクト集合の族$(K_1\times K_2)_{\delta>0}$が見つかる．
        $(X_n,Y_n)$が共に漸近的タイトである時，二式目よりコンパクト集合の族$(\pr_1(K))_{\delta>0},(\pr_2(K))_{\delta>0}$がそれぞれ見つかる．
        \item 
        \begin{description}
            \item[$\Leftarrow$] 
            任意の$f\in B(D)$について，$f\circ\pr_i\in B(D\times E)\;(i=1,2)$より，
            \[E^*[f(\pr_i(X_n,Y_n))]-E_*[f(\pr_i(X_n,Y_n))]\xrightarrow{n\to\infty}0\]
            だから，$(X_n),(Y_n)$の漸近的可測性を得る．
            \item[$\Rightarrow$] ？
        \end{description}
    \end{enumerate}
\end{proof}

\begin{theorem}[Slutsky]
    可分なBorel可測写像$X:\Om\to D$と，任意の$c\in E$について，写像列$(X_n:\Om\to D),(Y_n:\Om\to E)$が$X_n\Rightarrow X,Y_n\Rightarrow c$を満たすとする．
    \begin{enumerate}
        \item $(X_n,Y_n)\Rightarrow(X,c)$である．
        \item $D=E$を線型空間とする．$X_n+Y_n\Rightarrow X+c$である．
        \item $Y_n$が定数ならば，$Y_nX_n\Rightarrow cX$である．また$c\ne 0$ならば$X_n/Y_n\Rightarrow X/c$である．
    \end{enumerate}
\end{theorem}
\begin{proof}\mbox{}
    \begin{description}
        \item[(1)] $X$の終域$D$を完備化$\o{D}$に埋め込むことにより，可分な$X$は緊密でもあるとして一般性を失わない\ref{lemma-separable-and-tight}．
        $X,c$はいずれもタイトだから，これに弱収束する$(X_n),(Y_n)$はいずれも漸近的にタイトかつ漸近的に可測で(Prokhorovの逆\ref{prop-inverse-of-Prokhorov})，
        したがって$(X_n,Y_n)$も漸近的にタイトかつ漸近的に可測\ref{lemma-asymptotical-character-of-product-sequence}．
        よって，Prokhorovの定理\ref{thm-Prokhorov}（を繰り返し適用することに）より，族$\{X_n,Y_n\}$は「相対コンパクト」
        （任意の$\{X_n,Y_n\}$の列はタイトな確率要素に収束する部分列を持つ）．
        しかし，収束する部分列は要素ごとに見ると，結局収束先は$(X,c)$であることが必要．
        特に(1)が成り立つ．
        \item[(2),(3)]
        線型空間の演算$+,\cdot,/$などの連続写像について，連続写像定理\ref{thm-continuous-map-theorem}より．
    \end{description}
\end{proof}

\begin{corollary}
    Donskerクラスは，Glivenko-Cantelli in probabilityである．
\end{corollary}
\begin{remarks}
    実際は，almost surelyに成り立つ．
\end{remarks}

\subsection{確率収束と概収束}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    弱収束と同様に，確率収束と概収束も非可測な場合に拡張できる．
    また，表現という概念を用いれば，弱収束するネットは，表現の違いを除いて（確率空間は違うかもしれないが法則としては一致する確率変数が存在して）概収束する．
\end{tcolorbox}

\begin{definition}[convergence in outer probability, convergence outer almost surely]
    $(X_n:\Om\to D),X:\Om\to D$を写像とする．
    \begin{enumerate}
        \item $(X_n)$が$X$に\textbf{外確率収束}する($X_n\xrightarrow{P^*}X$)とは，次が成り立つことをいう：
        \[\forall_{\ep>0}\quad\limn P(d(X_n,X)^*>\ep)=\limn P^*(d(X_n,X)>\ep)=0.\]
        \item $(X_n)$が$X$に\textbf{外概収束}する($X_n\xrightarrow{\as^*}X$)とは，次が成り立つことをいう：
        \[P\paren{\limn d(X_n,X)^*=0}=1.\]
    \end{enumerate}
\end{definition}

\begin{lemma}
    $X:\Om\to D$をBorel可測関数，$(X_n)$を写像の列とする．
    \begin{enumerate}
        \item $(X_n)$が外概収束するならば，外確率収束する．
        \item $(X_n)$が確率収束することは，$\{X_n\}$が相対コンパクト（$\{X_n\}$の任意の部分列は$X$に概収束する部分列を持つ）ことに同値．
    \end{enumerate}
\end{lemma}

\begin{lemma}\label{lemma-確率収束と弱収束}
    $X:\Om\to D$をBorel可測関数，$(X_n),(Y_n)$を写像の列とする．
    \begin{enumerate}
        \item $(X_n)$が$X$に弱収束し，かつ$d(X_n,Y_n)\xrightarrow{P^*}0$ならば，$(Y_n)$も$X$に弱収束する．
        \item $(X_n)$が$X$に外確率収束するならば，$X$に弱収束する．
        \item $(X_n)$が定数$c$に外確率収束することと，$c$に弱収束することは同値．
    \end{enumerate}
\end{lemma}

\begin{theorem}[連続写像定理の拡張]
    $D$の部分集合の列$(D_n)_{n\in\N}$と写像$g_n:D_n\to E$の列は，$\forall_{n\in\N_+}\;\forall_{x\in D_0}\;x_n\in D_n\land x_n\to x\Rightarrow g_n(x_n)\to g(x)$を満たすとする．
    このとき，写像の列$(X_n:\Om\to D_n)$と可分なBorel可測関数$X:\Om\to D_0$について，次が成り立つ：
    \begin{enumerate}
        \item $(X_n)$が$X$に弱収束するならば，$g_n(X_n)$も$g(X)$に弱収束する．
        \item $(X_n)$が$X$に外確率収束するならば，$g_n(X_n)$も$g(X)$に外確率収束する．
        \item $(X_n)$が$X$に外概収束するならば，$g_n(X_n)$も$g(X)$に外概収束する．
    \end{enumerate}
\end{theorem}
\begin{remarks}
    準備が必要．
\end{remarks}

\section{有界関数の空間値確率要素}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    $l^\infty(T)$-値確率変数がタイトなGauss過程に弱収束するための，f.f.d.が弱収束することに加えて必要な条件を割り出す．
    これは第一義的には「漸近的タイト性」によって明瞭に捉えられるが，これをさらに計算可能な概念に翻訳し，収束先がタイトなGauss過程である場合についてさらに特殊化する．
\end{tcolorbox}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
    title=動機付け]
    $D=\wt{B}(T)\;(T\in\Set)$とした各論（確率過程論）を展開する．
    確率過程$X:T\to\Meas(\Om,\R)$は，見本過程を実現値とする「確率変数」$X:\Om\to\Map(T,\R)$とも見れる．
    始域の追加（２変数関数化）という意味でも，終域の関数空間化という意味でも，実確率変数の拡張でもある．
    この値域$\Im X$に種々の制限をつけて考えることになるのだが，特に$\Im X\subset\wt{B}(T)$は，一様ノルムの構造が入るので，重要な仮定である．

    $T=2$の場合が結合変数であるが，その場合でも失敗するのであるから，確率過程は扱いが難しい．
\end{tcolorbox}

\begin{tbox}{red}{問題意識}
    タイトなGauss過程は，最低限の一様連続性を持つため，非常に大事なクラスとなる．
    このクラスに弱収束するための必要十分条件\ref{cor-characterization-of-weak-convergence-of-stochastic-process-2}を探ることを考える．
    条件(2)の漸近的タイト性が厄介な課題となり，経験過程論の発展の重要な動機の一つであってきた．
\end{tbox}

\subsection{有界関数の空間での弱収束}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    見本過程とは評価写像$\ev_\om$による確率過程の像である．これに注目するという技法，
    評価写像が連続であることを用いる論法も，複素解析と少し似ている．
    証明においては，「有限個の点で評価すると必ず有界連続であるようなクラス$\F\subset B(\wt{B}(T))$」がRiesz空間になることに注目する．
    すると，$l^\infty(T)$上の確率分布は，任意の有限周辺分布が一致するならば，分布全体も一致する．
\end{tcolorbox}

\begin{definition}[stochastic process, sample path]\mbox{}
    \begin{enumerate}
        \item \textbf{確率過程}とは，確率変数$\Meas(\Om,\R)$の族$X:=(X_t)_{t\in T}:T\to\Meas(\Om,\R)$をいう．
        \item 確率過程は，同じ確率空間上のBanach空間値確率変数$\Om\to\Map(T,\R)$を定める．このときの実現値の各々を\textbf{見本過程}という．$X(\om):T\to\R$は特に可測とも有界とも限らないことに注意．
    \end{enumerate}
\end{definition}
\begin{example}
    経験過程$(\G_nf)_{f\in\F}:\F\to\Meas(\N,\R)$は，$\forall_{x\in\X}\;\sup_{f\in\F}\abs{f(x)-Pf}<\infty$を満たすとき，確率変数$\G_n:\N\to l^\infty(\F)$を定める．
\end{example}

\begin{definition}[確率過程の周辺分布, version / expression]
    評価写像
    $\ev_{(t_1,\cdots,t_k)}:\wt{B}(T)\to\R^k$を$f\in\wt{B}(T)$に対して
    \[\ev_{(t_1,\cdots,t_k)}(f)=(f(t_1),\cdots,f(t_k))\in\R^k\]
    と定めると，\textcolor{blue}{これは連続}である．
    この連続写像に注目すると，
    \begin{enumerate}
        \item 見本過程へのランダム関数とみた確率過程$X:\Om\to\wt{B}(T)$がBorel可測ならば，$\ev_{(t_1,\cdots,t_k)}\circ X:\Om\to\R^k$も確率変数であるから，
        有限な周辺分布$L^{(X_{t_1},\cdots,X_{t_k})}$が$L\circ(\ev_{(t_1,\cdots,t_k)}\circ X)^*$と与えられる．
        \item ２つの確率過程$X:T\to\Meas(\Om,\R),Y:T\to\Meas(\Om',\R)$について，一方が他方の\textbf{バージョン}または\textbf{表現}であるとは，対応する全ての有限次元周辺分布が一致することをいう：$\forall_{k\in\N}\;\forall_{\{t_1,\cdots,t_k\}\subset T}\;L^{(X_{t_1},\cdots,X_{t_k})}=L^{(Y_{t_1},\cdots,t_k)}$．
        これは２つの異なる確率空間$\Om,\Om'$上の確率変数の族を関係付け得る概念である．
    \end{enumerate}
\end{definition}

\begin{lemma}[見本過程への注目]\label{lemma-characterization-of-asymptotical-measurability-in-terms-of-finite-evaluation}
    写像の列$(X_n:\Om_n\to\wt{B}(T))$を漸近的タイトとする．
    このとき，次の２条件は同値．
    \begin{enumerate}
        \item $(X_n)$は漸近的可測．
        \item 任意の$t\in T$について，確率変数$\Meas(\Om,\R)$の列$(X_n(t))$は漸近的可測．
    \end{enumerate}
\end{lemma}
\begin{proof}
    漸近的可測性の特徴付け\ref{lemma-characterization-of-asymptotical-measurability}による．
    \[\F:=\Brace{f\in B(\wt{B}(T))\mid\forall_{k\in\N}\;\forall_{\{t_1,\cdots,t_k\}\subset T}\;\exists_{g\in B(\R^k)}\;f=g\circ\ev_{(t_1,\cdots,t_k)}}\]
    と定めると，これは代数であり，定数関数を含み，$\wt{B}(T)$の各点を分離するベクトル束である．
    \begin{description}
        \item[(1)$\Rightarrow$(2)] $(X_n)$を漸近的可測とする：$\forall_{g\in B(\R)}\;E^*[g(X_n)]-E_*[g(X_n)]\xrightarrown 0$．
        $\forall_{g\in B(\R)}\;\forall_{z\in\wt{B}(\R)}\;\forall_{t\in T}\;g\circ z(t)=g\circ\ev_t(z)$という関係が成り立つから，$z=X$とすると$\ev_t=X(t)$だから，$E^*[g(X_n(t))]-E_*[g(X_n(t))]\xrightarrown 0$を得る．
        \item[(2)$\Rightarrow$(1)] $(X_n(t))$を漸近的可測とする：$\forall_{t\in T}\;\forall_{g\in B(\R)}\;E^*[g(X_n(t))]-E_*[g(X_n(t))]\xrightarrown0$．ここで，$\ev_{(t_1,\cdots,t_k)}:\wt{B}(T)\to\R^k$は連続なので，漸近的タイトな写像との合成$\ev_{(t_1,\cdots,t_k)}(X_n)$も漸近的タイトである\ref{prop-continous-functions-preserve-asymptotical-properties}．
        この下で，各$(X_n(t_i))$は漸近的可測との仮定より，その積であるから漸近的可測でもある\ref{lemma-asymptotical-character-of-product-sequence}．
        $k\in\N$は任意としたから，結局全ての$f\in\F$に対して$E^*[f(X_n)]-E_*[f(X_n)]\xrightarrown0$．よって補題\ref{lemma-characterization-of-asymptotical-measurability}より$(X_n)$は漸近的可測．
    \end{description}
\end{proof}
\begin{remarks}
    結合写像の漸近的可測性の特徴付け\ref{lemma-asymptotical-character-of-product-sequence}の一般化になっている．
\end{remarks}

\begin{lemma}[有限な周辺分布への注目]\label{lemma-equalness-of-distribution-in-terms-of-finite-marginal-distribution}
    $X:\Om\to\wt{B}(T),Y:\Om'\to\wt{B}(T)$をタイトなBorel可測関数とする．
    このとき，次の２条件は同値．
    \begin{enumerate}
        \item $L^X=L^Y$．
        \item $X$は$Y$の表現である：$\forall_{k\in\N}\;\forall_{\{t_1,\cdots,t_k\}\subset T}\;L^{(X_{t_1},\cdots,X_{t_k})}=L^{(Y_{t_1},\cdots,t_k)}$．
    \end{enumerate}
\end{lemma}
\begin{proof}
    (2)$\Rightarrow$(1)を示す．
    (2)が成り立つ時，全ての$f\in\F$に対しては，
    \[\int_{\wt{B}(T)}fdL^X=\int_{\wt{B}(T)}gdL^{(X(t_1),\cdots,X(t_k))}=\int_{\wt{B}(T)}gdL^{(Y(t_1),\cdots,Y(t_k))}=\int_{\wt{B}(T)}fdL^Y\]
    が成り立つ．
    よって，分布が一致することの特徴付け\ref{lemma-well-definedness-of-weak-convergence}の(4)より，$L^X=L^Y$．
\end{proof}
\begin{remarks}
    収束先の同値類は「バージョン」である，とわかった．
\end{remarks}

\subsection{弱収束の特徴付け：漸近的タイト性}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    関数空間$l^\infty(T)$上での弱収束の必要十分条件として，f.d.d.の収束に加えて必要な条件は「漸近的タイト性」だと判明した．
    そこでこの概念に集中するが，これはまだまだ複雑である．
\end{tcolorbox}

\begin{theorem}[タイトな確率過程に弱収束する条件の特徴付け１]\label{thm-characterization-of-weak-convergence-of-stochastic-process-1}
    $(X_n:\Om_n\to\wt{B}(T))$を写像の列とする．
    \begin{enumerate}
        \item 次の２条件は同値．
        \begin{enumerate}[(a)]
            \item $(X_n)$は$\wt{B}(T)$におけるタイトなBorel確率測度に弱収束する．
            \item $(X_n)$は漸近的タイトで，かつ，全ての有限な周辺写像$(X_n(t_1),\cdots,X_n(t_k))$が弱収束する．
        \end{enumerate}
        \item $(X_n)$は漸近的タイトで，任意の有限な周辺写像$(X_n(t_1),\cdots,X_n(t_k))$がある確率過程$X:T\to\Meas(\Om,\R)$の周辺確率ベクトル$(X(t_1),\cdots,X(t_k))$に弱収束するとする．このとき，$X$のバージョンで，$\wt{B}(T)$に属する見本過程を持つような$\wt{X}$が存在し，$X_n\Rightarrow\wt{X}$が成り立つ．
    \end{enumerate}
\end{theorem}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item \begin{description}
            \item[(a)$\Rightarrow$(b)] 漸近的タイト性はProkhorovの定理の逆\ref{prop-inverse-of-Prokhorov}から．有限な周辺写像の収束は$\ev_{(t_1,\cdots,t_k)}$に関する連続写像定理\ref{thm-continuous-map-theorem}による．
            \item[(b)$\Rightarrow$(a)]
            $(X_n(t))$が弱収束する時，Prokhorovの定理の逆\ref{prop-inverse-of-Prokhorov}より，漸近的可測である．
            $(X_n)$は漸近的可測だから，補題\ref{lemma-characterization-of-asymptotical-measurability-in-terms-of-finite-evaluation}より，各$(X_n(t))$が漸近的可測であることは$(X_n)$が漸近的可測であることに同値．
            よって，Prokhorovの定理\ref{thm-Prokhorov}より，$\{X_n\}$は相対コンパクトである．
            これが弱収束すると示すには，任意の収束する部分列の極限が一致することを示せば良い．

            $\{X_n\}$の列$(X_m),(X_l)$の部分列がそれぞれBorel確率測度$L,G$に弱収束するとする．
            連続写像定理から，$\{t_1,\cdots,t_k\}\subset T$に関して，$(X_{m'}(t_1),\cdots,X_{m'}(t_k)),(X_{l'}(t_1),\cdots,X_{l'}(t_k))$も弱収束し，その極限は必然的に$L$と$G$であるが，仮定から$(X_n(t_1),\cdots,X_n(t_k))$が弱収束しているから，$L\circ\ev_{(t_1,\cdots,t_k)}^*=G\circ\ev_{(t_1,\cdots,t_k)}^*$が必要．
            補題\ref{lemma-equalness-of-distribution-in-terms-of-finite-marginal-distribution}より，これは$L=G$と同値．
        \end{description}
        \item (1)より，$(X_n)$は$\wt{B}(T)$上でタイトなBorel確率測度$L$に弱収束する．この時，$\wt{X}:=\id_{\wt{B}(T)}$とおくと，$L^{\wt{X}}=L$となり，$\wt{X}$は$\wt{B}(T)$上に見本過程を持つ．
        この時，当然$\wt{X}$は$X$のバージョンである．
    \end{enumerate}
\end{proof}
\begin{remarks}
    この構成だと$\wt{X}:\wt{B}(T)\to\wt{B}(T)$は確率要素であって確率過程ではなくない？
\end{remarks}

\subsection{漸近的タイト性の連続度による特徴付け}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=漸近的タイト性は「連続度が0に確率収束する」ことに同値]
    前節で，弱収束を示すには，漸近的タイト性と有限周辺分布の収束を示せば良いと解った．
    周辺写像の収束の議論は，Euclid空間上の弱収束の証明のためのテクニックを用いて議論できるから，最終的に一般の確率過程の弱収束の特徴付け\ref{thm-characterization-of-weak-convergence-of-stochastic-process-1}はAscoli-Arzelàの定理と似たステートメント\ref{cor-characterization-of-weak-convergence-of-stochastic-process-2}に変形できる．

    $T$上の確率場$X_n$が漸近的タイトであることを特徴付けると，各成分$X_n(t)$が漸近的タイトであることと，場$(T,\rho)$が全有界になることと，$X_n$の「連続度の$0$への確率収束」が必要になる．
\end{tcolorbox}

\begin{definition}[asymptotically uniformly $\rho$-equicontinuous in probability]
    $\rho$を$T$上の準距離とする．写像列$X_n:\Om_n\to\wt{B}(T)$が任意の$\ep,\eta>0$に対して$\delta>0$が存在して
    \[\limsupn P^*\paren{\sup_{\rho(s,t)<\delta}\abs{X_n(s)-X_n(t)}>\ep}<\eta\]
    を満たすとき，$(X_n)$は\textbf{漸近的$\rho$-同程度一様確率連続}という．
\end{definition}

\begin{theorem}[漸近的タイト性の特徴付け]\label{thm-characterization-of-asymptotical-tightness}
    $(X_n:\Om_n\to\wt{B}(T))_{n\in\N}$を任意の写像列とする．このとき，次の３条件は同値である．
    \begin{enumerate}
        \item $(X_n)$は漸近的タイトである．
        \item 任意の$t\in T$に対して$(X_n(t):\Om_n\to\R)$は漸近的タイトで，任意の$\ep,\eta>0$に対して$T$の有限分割$T=\cup_{i=1}^kT_i$が存在して
        \[\limsupn P^*\paren{\sup_{1\le i\le k}\sup_{s,t\in T_i}\abs{X_n(s)-X_n(t)}>\ep}<\eta\]
        が成り立つ．
        \item 任意の$t\in T$に対して$(X_n(t):\Om_n\to\R)$は漸近的タイトで，$T$上の準距離$\rho$が存在して$(T,\rho)$が全有界となり，$X_n$は漸近的$\rho$-同程度一様確率連続となる．
    \end{enumerate}
\end{theorem}
\begin{proof}\mbox{}
    \begin{description}
        \item[(1)$\Rightarrow$(3)] 
        $(X_n)$を漸近的タイトとすると，$X_n(t)=\ev_t(X_n)$も漸近的タイトである\ref{prop-continous-functions-preserve-asymptotical-properties}．
        \begin{description}
            \item[構成１] また，$(X_n)$は漸近的タイトだから，$\wt{B}(T)$のコンパクト集合の列$K_1\subset K_2\subset\cdots$であって，$\forall_{\ep>0}\;\liminfn P_*\paren{X_n\in K^\ep_m}\ge 1-1/m$を満たすものが存在するから，
            これを用いて$\rho_m(s,t):=\sup_{z\in K_m}\abs{z(s)-z(t)}\;(s,t\in T)$と定めると，これは$T$上の擬距離であり，\textcolor{blue}{$(T,\rho_m)$は全有界となる}．
            \item[構成２] 
            これを用いて，$T$上の準距離$\rho$を$\rho(s,t):=\summ 2^{-m}(\rho_m(s,t)\land 1)$と定めると，\textcolor{blue}{$(T,\rho)$は再び全有界となる}．
            \item[検証] 
            定め方から，$\forall_{z\in K_m}\;\abs{z(s)-z(t)}\le\rho_m(s,t)$より，$\forall_{\wt{z}\in K_m^\ep}\;\forall_{s,t\in T}\;\abs{\wt{z}(s)-\wt{z}(t)}<2\ep+\rho_m(s,t)$．
            ここで，$\rho_m(s,t)\land 1\le 2^m\rho(s,t)$だから，$\forall_{\ep\in(0,1)}\;K^\ep_m\subset\Brace{z\in\wt{B}(T)\;\middle|\;\sup_{\rho(s,t)<\delta}\abs{z(s)-z(t)}\le 3\ep}$．
            よって，$\delta<2^{-m}\ep$に対して，
            \[\liminfn P_*\paren{\sup_{\rho(s,t)<\delta}\abs{X_n(s)-X_n(t)}\le 3\ep}\ge 1-\frac{1}{m}.\]
        \end{description}
        \item[(3)$\Rightarrow$(2)]
        $(T,\rho)$は全有界だから，任意の$\ep,\eta$に対して，$T$は直径$\delta$の有限個の球で被覆できる．
        これらを互いに素にしたものを$T_1,\cdots,T_k$と定めれば，
        \[\limsupn P^*\paren{\sup_{1\le i\le k}\sup_{s,t\in T_i}\abs{X_n(s)-X_n(t)}>\ep}<\eta\]
        が成り立つ．
        \item[(2)$\Rightarrow$(1)]
        \begin{description}
            \item[準備] $\norm{X_n}_T$は$\R$の列として漸近的タイトである．実際，任意の有限分割$(T_i)_{i\in[k]}$を取ると，ある$t_i\in T_i$に対して
            \[\norm{X_n}_T\le\sup_{i\in[k]}\sup_{t\in T_i}\abs{X_n(t)-X_n(t_i)}+\max_{i\in[k]}\abs{X_n(t_i)}\]
            が成り立つから，少なくとも$1-\eta$の内確率で$\norm{X_n}_T\le\max_{i\in[k]}\abs{X_n(t_i)}+\ep$と抑えられる．

            実写像$(X_n(t_i))$は漸近的タイトであるという仮定より，$\max_{i\in[k]}\abs{X_n(t_i)}+\ep$も漸近的タイトであり（連続写像との合成\ref{prop-continous-functions-preserve-asymptotical-properties}），従って$\norm{X_n}_T$は$\R$で漸近的タイトである．
            \item[$K_m$の構成]
            任意の$\zeta>0$を取る．$(\ep_m)$を$0$に収束する任意の単調減少な正実数列とする．
            $\norm{X_n}_T$の漸近的タイト性を用いて，定数$M$を$\limsupn P^*(\norm{X_n}_T>M)<\zeta$を満たす実数と定める．
            仮定から，$\ep=\ep_m,\eta=2^{-m}\zeta$に対する有限分割$(T_i)_{i\in[k]}$を取る．

            各$T_i$上定値で，値域が$\Brace{0,\pm\ep,\cdots,\pm\Floor{\frac{M}{\ep_m}}\ep_m}$に含まれる関数の全体を$\{z_1,\cdots,z_{p(m)}\}\subset\wB(T)$とし，これを中心とする半径$\ep_m$の閉球の和を$K_m$とする．
            このとき，$M<\Floor{\frac{M}{\ep_m}}\ep_m+\ep_m$という関係に注意すれば，
            \[\begin{cases}
                \norm{X_n}_T\le M\\
                \sup_{i\in[k]}\sup_{s,t\in T_i}\abs{X_n(s)-X_n(t)}\le\ep_m
            \end{cases}\Rightarrow X_n\in K_m\]
            が成り立つ．「各ブロック$T_i$で，ある定数関数$z_i$を選べば，$\ep_m$以上そこから離れることはない」ということを閉球を用いて翻訳した．
            \footnote{これがほとんどの確率で成り立つので，評価への準備ができている．}
            \item[$K$の構成]
            $K:=\capN{m}K_m$とおくと，これは閉である．
            \begin{enumerate}[(a)]
                \item また，全有界でもある．
                \item $\wB(T)$は完備なので，従って$K$はコンパクトである．
                \item $\forall_{\delta>0}\;\exists_{n\in\N}\; K^\delta\supset\cap^m_{i=1}K_i$である．
            \end{enumerate}
            \item[結論]
            (c)より$X_n\notin K^\delta\Rightarrow\exists_{m\in\N}\;X_n\notin\cap^m_{i=1}K_i$より，次のように評価できる．
            \begin{align*}
                \limsupn P^*(X_n\notin K^\delta)&\le\limsupn P^*\paren{X_n\notin\cap^m_{i=1}K_i}\\
                &\le\limsupn P^*(\norm{X_n}_T>M)+\limsupn\sum^m_{i=1}P^*\paren{\sup_{i\in[k]}\sup_{s,t\in T_i}\abs{X_n(s)-X_n(t)}>\ep_m}\\
                &\hphantom{\le\limsupn P^*(\norm{X_n}_T>M)+\limsupn\sum^m_{i=1}P^*}\because K_mの構成と劣加法性\\
                &\le\zeta+\sum^m_{i=1}2^{-i}\zeta<2\zeta.
            \end{align*}
        \end{description}
    \end{description}
\end{proof}
\begin{remarks}
    タイト性（ある種の$\sigma$-有限性）を（擬）距離の言葉に変換することは，複素領域$D\subset\C$から距離空間への連続写像の空間$C(D,S)$を調べる際に用いたコンパクト開位相を引き起こす距離と同様である．
    これらを$1/2^m$を係数として足し合わせる構成も似ている．「最初の有限個以外が効いてこない距離」という定め方である．
    (2)は連続度の概念に通じるから(1)に戻りやすい．
\end{remarks}

\begin{corollary}[タイトな確率過程に弱収束する条件の特徴付け２]\label{cor-characterization-of-weak-convergence-of-stochastic-process-2}
    任意の写像列$(X_n:\Om_n\to\wt{B}(T))_{n\in\N}$が$\wt{B}(T)$においてタイトなBorel可測写像$X$に弱収束するための必要十分条件は，(1)かつ(2)である：
    \begin{enumerate}
        \item 任意の有限部分集合$\{t_1,\cdots,t_k\}\subset T$に対して，$(X_n(t_1),\cdots,X_n(t_k))\Rightarrow(X(t_1),\cdots,X(t_k))$．
        \item $T$が全有界となるような準距離$\rho$が存在して，全ての$\ep>0$に対して次が成り立つ：
        \[\lim_{\delta\searrow 0}\limsupn P^*\paren{\sup_{\rho(s,t)<\delta}\abs{X_n(s)-X_n(t)}>\ep}=0.\]
    \end{enumerate}
\end{corollary}
\begin{proof}
    弱収束することの特徴付け\ref{thm-characterization-of-weak-convergence-of-stochastic-process-1}と，
    漸近的タイト性の特徴付け\ref{thm-characterization-of-asymptotical-tightness}より．
\end{proof}

\subsection{収束先の確率過程の持つ一様連続性}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    収束先であるタイトなBorel可測写像$X:\Om\to\wt{B}(T)$の見本過程はある種の連続性を持つ．
\end{tcolorbox}

\begin{notation}[uniform continuity]
    一様に$\rho$-連続な$z\in\wt{B}(T)$の全体からなる集合を
    \[UC(T,\rho):=\Brace{z\in\wt{B}(T)\mid\lim_{\delta\searrow 0}\sup_{\rho(s,t)<\delta}\abs{z(s)-z(t)}=0}\]
    で表す．
\end{notation}

\begin{proposition}\label{prop-UC-is-Polish}
    $(T,\rho)$を全有界な擬距離空間とする．
    \begin{enumerate}
        \item $UC(T,\rho)$は一様距離に関して可分で完備な部分距離空間(Poland空間)となる．
        \item $UC(T,\rho)$は$\sigma$-コンパクトである．
    \end{enumerate}
\end{proposition}

\begin{theorem}\label{thm-limit-is-in-UC}
    写像列$(X_n:\Om_n\to\wt{B}(T))_{n\in\N}$が$\wt{B}(T)$においてタイトなBorel可測写像$X$に弱収束し，ある準距離$\rho$について$(T,\rho)$は全有界になるとする．
    このとき，次の２条件は同値である．
    \begin{enumerate}
        \item $(X_n)$は漸近的$\rho$-同程度一様確率連続である．
        \item $P(X\in UC(T,\rho))=1$．
    \end{enumerate}
\end{theorem}
\begin{proof}\mbox{}
    \begin{description}
        \item[(1)$\Rightarrow$(2)] 
        \begin{enumerate}[(a)]
            \item $g:\wB(T)\to\wB((0,1))$を
            \[\ev_\delta(g(z))=g(z)(\delta):=\sup_{\rho(s,t)<\delta}\abs{z(s)-z(t)}\quad(\delta\in(0,1))\]
            で定めると，この写像は連続である：$\norm{g(y)-g(z)}_\infty=\sup_{\delta\in(0,1)}\abs{\ev_\delta(g(y))-\ev_\delta(g(z))}\le 2\norm{y-z}_T$．
            すると，合成$\ev_{\delta}(g(-)):\wB((0,1))\to\R$も連続だから，連続写像定理\ref{thm-continuous-map-theorem}から，$\ev_\delta(g(X_n))\Rightarrow\ev_\delta(g(X))$である．
            \item よって，portmanteau定理\ref{thm-portmanteau}(2)から，$\forall_{\delta\in(0,1)}\;\liminfn P_*\paren{\ev_\delta(g(X_n))>\ep}\ge P\paren{\ev_\delta(g(X))>\ep}$．
            \item $(X_n)$は漸近的$\rho$-同程度一様連続という仮定と併せると，任意の$\ep,\eta>0$に対して$\delta\in(0,1)$が存在して，
            \[P\paren{\ev_\delta(g(X))>\ep}\le \liminfn P_*\paren{\ev_\delta(g(X_n))>\ep}<\limsupn P^*\paren{\ev_\delta(g(X_n))>\ep}<\eta.\]
            特に$\ep=\eta=2^{-m}$の場合について考えることで，単調減少な正実数列$(\delta_m)_{m\in\N}$を得る．
            \item すると，Borel-Cantelliの補題より，
            \[P\paren{\ev_{\delta_m}(g(X))>2^{-m}\;\io}=P\paren{\sup_{\rho(s,t)<\delta_m}\abs{X(s)-X(t)}>2^{-m}\;\io}=0.\]
            これは$P(X\in UC(T,\rho))=1$を含意する．
        \end{enumerate}
        \item[(2)$\Rightarrow$(1)] \begin{enumerate}[(a)]
            \item $UC(T,\rho)$は完備で可分\ref{prop-UC-is-Polish}だから，ここに値を取る可測写像$X$は緊密である（補題\ref{lemma-separable-and-tight}）．
            従って，$(X_n)$は漸近的タイト(Prokhorovの定理の逆\ref{prop-inverse-of-Prokhorov})：\[\forall_{\eta,\ep>0}\;\exists_{K\compsub UC(T,\rho)}\;P(X\in K)\ge 1-\eta,\quad\liminfn P_*\paren{X_n\in K^\ep}\ge 1-\eta.\]
            \item コンパクト集合は全有界だから，$K$は$\{z_1,\cdots,z_p\}\subset UC(T,\rho)$が存在してこれを中心とした半径$\ep/3$の開球で被覆できる．
            $z_i\in UC(T,\rho)$より，$\forall_{i\in[p]}\;\exists_{\delta>0}\;\rho(s,t)<\delta\Rightarrow\abs{z_i(s)-z_i(t)}<\ep/3$．
            よって，任意の$z\in K$に対して，$\norm{z-z_i}_T<\ep/3$を満たす$i\in[p]$が存在して，
            \[\rho(s,t)<\delta\Rightarrow\abs{z(s)-z(t)}\le\frac{2\ep}{3}+\abs{z_i(s)-z_i(t)}<\ep.\]
            よって，$K$は同程度一様連続である．
            \item さらに，いま任意の$\wt{z}\in K^\ep$に対して，$z\in K$が存在して$\norm{\wt{z}-z}_T<\ep$を満たすから，$\rho(s,t)<\delta\Rightarrow\abs{\wt{z}(s)-\wt{z}(t)}\le 2\ep+\abs{z(s)-z(t)}<3\ep$．すなわち，$K^\ep\subset\Brace{z\in\wB(T)\;\middle|\;\sup_{\rho(s,t)<\delta}\abs{z(s)-z(t)}\le 3\ep}$．
            (a)と併せると，
            \[\liminfn P_*\paren{\sup_{\rho(s,t)<\delta}\abs{X_n(s)-X_n(t)}\le 3\ep}\ge 1-\eta.\]
            これは漸近的$\rho$-同程度一様確率連続性に同値．
        \end{enumerate}
    \end{description}
\end{proof}
\begin{remarks}
    全く同様の議論を複素解析学で繰り返したが，これはコンパクト集合の全有界性に訴えていたのか．
\end{remarks}

\subsection{準距離と$L^p$距離}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    極限$X$の候補は周辺写像の収束から同定出来る．
    そこで，準距離の見つけ方の指針が必要になる．
    標準的なものが，$L^p$が定める準距離$\rho_r$である．
\end{tcolorbox}

\begin{definition}\mbox{}\label{def-rho-r}
    \begin{enumerate}
        \item $L^p$擬距離を$\rho_r(s,t):=\Brace{E\abs{X(s)-X(t)}^r}^{1/(r\lor 1)},\;(r\in(0,\infty))$と表す．
        \item $\wt{B}(T)$の過程$X$が$T$上の準距離$\rho$に関して\textbf{$r$次平均$\rho$-一様連続}であるとは，$\rho(s_n,t_n)\to0\Rightarrow E\abs{X(s_n)-X(t_n)}^r\to0$が成り立つことをいう．
    \end{enumerate}
\end{definition}

\begin{lemma}\label{lemma-quasimetric-for-tight-measurable-functions}
    $X:\Om\to\wt{B}(T)$をタイトなBorel可測写像とする．
    \begin{enumerate}
        \item このとき，$T$上に準距離$\rho$が存在して$(T,\rho)$は全有界となり，$P(X\in UC(T,\rho))=1$が成り立つ．
        \item さらに，ある$0<\rho<\infty$に対して$X$が$r$次平均$\rho$-連続であるならば，準距離$\rho_r$に対して$(T,\rho_r)$も全有界となり，$P(X\in UC(T,\rho_r))=1$が成り立つ．
    \end{enumerate}
    ただし，全ての見本過程$X(t,\om):T\to\R$は$\rho$-一様連続であることを仮定する．
\end{lemma}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item 定数列$(X)$は漸近的タイト(Prokhorovの定理の逆\ref{prop-inverse-of-Prokhorov})
        だから，漸近的タイト性の特徴付け\ref{thm-characterization-of-asymptotical-tightness}と漸近的$\rho$-同程度一様確率連続性の特徴付け\ref{thm-limit-is-in-UC}より従う．
        \item \begin{description}
            \item[方針] $X:T\to\Map(\Om,\R)$は$r$次平均$\rho$-一様連続とする：$\forall_{\ep>0}\;\exists_{\delta>0}\;\rho(s,t)<\delta\Rightarrow\rho_r(s,t)<\ep$．
            するとまず，$(T,\rho)$が全有界ならば，$(T,\rho_r)$も全有界である．
            ここで，全ての見本過程$X(t,\om):T\to\R$は$\rho$-一様連続であることを仮定する．
            準距離空間上の一様連続関数は，閉包上への連続延長を持つから，完備化$(\o{T},\o{\rho})$上への連続延長$\o{X}(t,\om)$を持つ．$\o{T}$はやはり全有界なので，コンパクトである．
            ここで，このとき殆ど全ての見本過程が$\rho_r$-一様連続であることを示せば，$P(X\in UC(T,\rho_r))=1$を得る\ref{thm-limit-is-in-UC}．
            \item[殆ど全ての見本過程が$\rho_r$-一様連続であることの証明] \mbox{}\\
            \begin{enumerate}[(a)]
                \item $X(t,\om)$が$\rho_r$-一様連続でないならば，ある$s,t\in\o{T}$について$\rho_r(s,t)=0\land \o{X}(s,\om)\ne\o{X}(t,\om)$であることを示す．
                $X(t,\om)$が$\rho_r$-一様連続でないとする：$\exists_{\ep>0}\;\exists_{\{s_n\},\{t_n\}\subset T}\;[\rho_r(s_n,t_n)\to 0\land\forall_{n\in\N}\;\abs{X(s_n,\om)-X(t_n,\om)\ge\ep}]$．
                $\o{T}$のコンパクト性から，$(s_n),(t_n)$は$s\ne t\in\o{T}$に収束する部分列$(s_{n'}),(t_{n'})$を持つ．なお，$\abs{X(s_{n'},\om)-X(t_{n'},\om)}\to\abs{X(s,\om)-X(t,\om)}\ge\ep>0$である．
                次に，$(s_{n'}),(t_{n'})$は$\o{X}$上のCauchy列であり，$X$は$r$次平均$\rho$-一様連続だから，$X(s_{n'})$も$L_r(P)$空間上でCauchy列になる．よって，$s_{n'}\to s$のとき，$X(s_{n'})$はある$X'\in L_r(P)$に$r$次平均収束する．
                今，$\forall_{\om\in\Om}\;X(s_{n'},\om)\to\o{X}(s,\om)$であるから，殆ど全ての$\om$に対して$X'(\om)=\o{X}(s,\om)$\textcolor{blue}{？}．
                よって$\rho_r(s_{n'},s)\to 0,\rho_r(t_{n'},t)\to 0$．
                従って，
                \[\rho_r(s,t)\le\rho_r(s_{n'},s)+\rho_r(t_{n'},t)+\rho_r(s_{n'},t_{n'})\]
                より，$\rho_r(s,t)=0$．
                \item $N:=\Brace{\om\in\Om\;\middle|\;\exists_{s,t\in\o{T}}\;\rho_r(s,t)=0\land \o{X}(s,\om)\ne\o{X}(t,\om)}$と定めて，$P(N)=0$を示す．
                
            \end{enumerate}
        \end{description}
    \end{enumerate}
\end{proof}

\subsection{Gauss過程への弱収束の特徴付け}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    極限として最も頻繁に出現する確率過程がGauss過程と呼ばれるクラスで，この場合２次モーメント準距離$\rho_2$が最も取り扱いやすい．
    そこで，極限過程がGaussであると仮定して，簡単化を試みる．
\end{tcolorbox}

\begin{definition}[Gaussian process]\label{def-Gaussian-process}
    確率過程$X:T\to\Meas(\X,\R)$の全ての有限次元周辺確率ベクトル$(X(t_1),\cdots,X(t_k))\;(t_1,\cdots,t_k\in T)$が$\R^k$上の多変量正規分布に従うとき，$X$を\textbf{Gauss過程}と呼ぶ．\footnote{これは，任意の$X_{t_1},\cdots,X_{t_k}$の有限線型結合が一変数正規分布に従うことに同値．}
\end{definition}

\begin{lemma}\label{lemma-Gauss-process-is-continuous}
    Gauss過程$X:\Om\to\wt{B}(T)$は$r$次平均$\rho$-一様連続である．
\end{lemma}


\begin{theorem}\label{thm-tightness-for-Gaussian-process}
    Gauss過程$X:\Om\to\wt{B}(T)$について，次の２条件は同値．
    \begin{enumerate}
        \item $X$はタイトである．
        \item ある$r>0$に対して（結局は任意の$r>0$に対して），$(T,\rho_r)$は全有界となり，$P(X\in UC(T,\rho_r))=1$となる．
    \end{enumerate}
\end{theorem}
\begin{proof}\mbox{}
    \begin{description}
        \item[(2)$\Rightarrow$(1)] 全有界な擬距離空間$(T,\rho_r)$に対して，$UC(T,\rho_r)\subset\wB(T)$はPolish spaceである\ref{prop-UC-is-Polish}．
        すると定数列$(X)$は漸近的$\rho$-同程度一様確率連続である\ref{thm-limit-is-in-UC}から，$(X)$は漸近的タイト\ref{thm-characterization-of-asymptotical-tightness}，すなわち$X$はタイト\ref{prop-inverse-of-Prokhorov}である．
        \item[(1)$\Rightarrow$(2)]
        $X$はタイトであるとすると，ある擬距離$\rho$が存在して，$(T,\rho)$は全有界となり，$P(X\in UC(T,\rho))=1$である\ref{lemma-quasimetric-for-tight-measurable-functions}．
        $X$は$r$次平均$\rho$-一様連続である\ref{lemma-Gauss-process-is-continuous}ことから従う．
    \end{description}
\end{proof}

\begin{corollary}[タイトなGauss過程に弱収束する条件の特徴付け３]\label{cor-characterization-of-weak-convergence-of-Gaussian-Process}
    $X$をGauss過程とし，これが定める自然な準距離を$\rho_r$とする．任意の写像列$(X_n:\Om_n\to\wt{B}(T))$に対して，$X$のバージョンであるようなタイトなBorel可測写像$\wt{X}:\Om'\to\wt{B}(T)$が存在してこれに弱収束するための必要十分条件は，ある$r>0$が存在して（結局任意の$r>0$に対して）次の３条件が成り立つことである：
    \begin{enumerate}
        \item 任意の有限部分集合$\{t_1,\cdots,t_k\}\subset T$に対して，$(X_n(t_1),\cdots,X_n(t_k))\Rightarrow(X(t_1),\cdots,X(t_k))$．
        \item $(X_n)$は漸近的$\rho_r$-同程度一様確率連続である．
        \item $(T,\rho_r)$は全有界な準距離空間である．
    \end{enumerate}
\end{corollary}
\begin{proof}\mbox{}
    \begin{description}
        \item[十分性] 漸近的タイト性の特徴付け\ref{thm-characterization-of-asymptotical-tightness}より(1),(2),(3)から$(X_n)$は漸近的タイトであり，(1)と併せると弱収束の条件\ref{thm-characterization-of-weak-convergence-of-stochastic-process-1}(2)より従う．
        \item[必要性] 弱収束の条件\ref{thm-characterization-of-weak-convergence-of-stochastic-process-1}(1)より，(1)は従う．次に$\wt{B}$はタイトなGauss過程であるから，定理\ref{thm-tightness-for-Gaussian-process}よりこれは$(T,\rho_r)$が全有界で$P(X\in UC(T,\rho_r))=1$に同値．\ref{thm-limit-is-in-UC}から(2)も従う．
    \end{description}
\end{proof}

\subsection{Banach空間値Gauss確率要素}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    何か米田の補題的なものを感じる．
\end{tcolorbox}

\begin{definition}
    $B$をBanach空間とする．
    $X:\Om\to B$をBorel可測関数とする．このとき，任意の線型形式$\phi:B\to\R\in B^*$に対して$\rho(X)$が正規分布に従うとき，$X$は$B$上の\textbf{Gauss過程}という．
\end{definition}
\begin{remark}
    定義\ref{def-Gaussian-process}よりも明らかに強い条件である．
\end{remark}

\begin{proposition}
    タイトなBorel可測関数$X:\Om\to\wt{B}(T)$について，次の３条件が同値．
    \begin{enumerate}
        \item 任意の有限集合$\{t_1,\cdots,t_k\}\subset T$に対して，$(X_{t_1},\cdots,X_{t_k})$は多変量正規分布に従う．
        \item 任意の連続線型写像$\rho:\wt{B}(T)\to\R$に対して，$\rho(X)$は正規分布に従う．
        \item 任意のBanach空間への任意の連続線型写像$\rho:\wt{B}(T)\to B$に対して，$\rho(X)$は$B$上のGauss過程である．
    \end{enumerate}
\end{proposition}

\section{Glivenko-CantelliクラスとDonskerクラス}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    経験測度$\bP_n$が$P$に各点$f\in\F$で概収束することは，観測値$X_1,\cdots,X_n$が母平均に概収束することと同値で，これを大数の強法則という．
    これが任意の$f\in\F$について一様に収束する$\sup_{f\in\F}\abs{\bP_nf-Pf}\asto0$ためには，$\F$が大きすぎないことが必要である．

    収束先を見るために，$\sqrt{n}$倍して得る経験過程$\bG_n=\sqrt{n}(\bP_n-P)$に注目する．
    これが線型汎関数として$l^\infty(\F)$上でタイトなものに弱収束するための条件は，まず$\sup_{f\in\F}\abs{\bP_nf-Pf}$の一様収束性が必要なので，Glivenko-Cantelliの場合以上に$\F$が大きすぎないことが必要である．
    なお，タイトな過程に弱収束するならば，その極限過程は$F$-固定端Brown運動となる必要がある．
\end{tcolorbox}

\subsection{定義と例}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    一般に$\bP_n-P$は各点収束＝$w^*$-収束するが，一様収束＝$\norm{\bP_n-P}_\F$が収束するかは，$\F$のエントロピーに依る．
    最も簡単な指標はブラケットエントロピーである．
    しかしこれが通用しないことがあり，その場合はより一般的な一様被覆数を用いる．
\end{tcolorbox}

\begin{definition}[empirical measure, empirical process]
    可測空間$(\X,\B)$に値を取る確率変数$X_1,\cdots,X_n$について，
    \begin{enumerate}
        \item これらが標本空間に定める\textbf{経験測度}とは，$\bP_n(C):=\frac{1}{n}\sum^n_{i=1}1_{\Brace{X_i\in C}},\quad(C\in\B)$と定める．これはDirac測度の線型結合になっている．
        \item 経験測度が定める写像$\bP_n:\Meas(\X,\R)\to\R$を$f\mapsto\bP_nf:=\frac{1}{n}\sum^n_{i=1}f(X_i)$と定める．
        \item 標準化したバージョンを$\G_n:=\sqrt{n}(\bP_n-P)$と定めると，この写像$\Meas(\X,\R)\supset\F\to\R$を\textbf{$\F$で添字づけされた経験過程}という．
        \item 符号付測度$\G_n:=\frac{1}{\sqrt{n}}\sum_{i=1}^n(\delta_{X_i}-P)$も経験過程と同一視する．
    \end{enumerate}
\end{definition}
\begin{remarks}
    もやは経験過程と呼びたくないほどには一般的な対象となっている．
\end{remarks}

\begin{proposition}[各点収束の結果は古典的]\label{prop-large-number-theorem-to-empirical-process}
    $P\abs{f}<\infty$または$Pf^2<\infty$とする．
    \begin{enumerate}
        \item 大数の法則より$\bP_nf\asto Pf$．
        \item 中心極限定理より$\G_nf\Rightarrow N(0,P(f-Pf)^2)$．
    \end{enumerate}
\end{proposition}

\begin{notation}[符号付き測度の一様ノルム]
    符号付測度のノルムを
    $\norm{Q}_\F:=\sup\Brace{\abs{Qf}\in\R\mid f\in\F}$と定める．
\end{notation}

\begin{definition}
    空間$\F\subset\Meas(\X,\R)$を考える．
    \begin{enumerate}
        \item 一様大数の法則$\norm{\bP_n-P}_\F\xrightarrow{\as^*}0$を満たす$\F\subset\Meas(\X,\R)$を\textbf{$P$-Glivenko-Cantelliクラス}という．
        \item 一様な外確率収束$\norm{\bP_n-P}_\F\xrightarrow{P^*}0$を満たす$\F\subset\Meas(\X,\R)$を\textbf{弱Gilvenko-Cantelliクラス}という．
        \item $\forall_{x\in\X}\;\sup_{f\in\F}\abs{f(x)-Pf}<\infty$を仮定すると，経験過程$\G_n$は確率変数$\N\to\wt{B}(\F)$とみなせる．
        この確率変数が一様中心極限定理を満たすとき，すなわち，あるタイトなBorel可測写像$\G$に$l^\infty(\F)$上で弱収束するとき，$\F$を\textbf{$P$-Donskerクラス}という．
        \item 可測空間$(\X,\A)$上の任意の確率測度$P$について$P$-Donskerであるとき，普遍的にDonskerであるという．
    \end{enumerate}
\end{definition}

\begin{proposition}[多次元中心極限定理]\mbox{}\label{prop-multivariable-CLT}
    \begin{enumerate}
        \item $Pf^2<\infty$とする．周辺写像$\G_nf$は収束し\ref{prop-large-number-theorem-to-empirical-process}(2)，
        多次元中心極限定理から，$\forall_{k\in\N}\;\forall_{\{f_1,\cdots,f_k\}\subset\F}\;(\G_nf_1,\cdots,\G_nf_k)\Rightarrow N(0,\Sigma)$が成り立つ．
        ただし，$N(0,\Sigma)$は$k$変量正規分布とし，$\Sigma$は$k\times k$行列で$\Sigma_{ij}=P(f_i-Pf_i)(f_j-Pf_j)$とした．
        \item 極限過程$\G:\F\to\R$は平均$0$，共分散関数が$E[\G f\G g]=P[(f-Pf)(g-Pg)]=P[fg]-PfPg$のGauss過程である．
    \end{enumerate}
\end{proposition}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item 多次元中心極限定理から．
        \item $\wB(\F)$上で収束するならば，全ての有限周辺分布も収束する\ref{thm-characterization-of-weak-convergence-of-stochastic-process-1}から．
    \end{enumerate}
\end{proof}

\begin{definition}[Brownian bridge]
    補題\ref{lemma-equalness-of-distribution-in-terms-of-finite-marginal-distribution}
    より，$\G$がタイトであるから，分布がwell-definedである．これを\textbf{$P$-Brown橋}という．
\end{definition}
\begin{remarks}
    どこを切っても正規分布なGauss過程である．
\end{remarks}

\begin{example}[Donskerの結果]
    $X_1,\cdots,X_n$は独立同分布に従う$\R^d$値確率変数とする．
    \[\F:=\Brace{1_{(-\infty,t]}(x)\in\Meas(\R^d,\R)\mid t\in\o{\R}^d}\;((-\infty,t]:=(-\infty,t_1]\times\cdots\times(-\infty,t_d])\]
    と定めると，これはDonskerクラスである．
    すなわち，$\bP_n:\F\to\R;1_{(-\infty,t]}\mapsto\P_n1_{(-\infty,t]}=\frac{1}{n}\sum^n_{i=1}1_{\Brace{X_i\le t}}$はあるタイトな$\wB(\F)$値可測写像に収束する．
\end{example}

\subsection{Donskerクラスの特徴付け}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    $\F\subset\Meas(\X,\R)$がDonskerであることは，位相の言葉で特徴付けられる．
    標本空間$(\X,\A,P)$上の実可測関数全体の集合
    $\Meas(\X,\R)$に，$P$に関する積分について$L_r$-ノルムを入れたものを$L_r(P)$で表すこととする．
    ここには，$L_r$-ノルムの定める距離$\rho_r(s,t):=\Brace{E\abs{X(s)-X(t)}^r}^{1/(r\lor 1)},\;(r\in(0,\infty))$\ref{def-rho-r}だけでなく，
    標準偏差がセミノルム$\rho_P$を定め，これが準距離$d_P$を引き起こす．
\end{tcolorbox}

\begin{proposition}[標準偏差の定めるセミノルム]
    測度$P$が定める積分について$2$ノルムが入った関数空間$L_2(P)$を考える．
    \begin{enumerate}
        \item 標準偏差
        \[\xymatrix@R-2pc{
            \rho_P:L_2(P)\ar[r]&\R\\
            \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
            f\ar@{|->}[r]&\sqrt{P(f-Pf)^2}
        }\]
        を定めると，これは$\Meas(\X,\R)$上の半ノルムとなり，擬距離$d_P$を定める．
        \item クラス$\F\subset L_2(P)$で添字づけられた平均$0$，共分散関数$E[\G f\G g]$のGauss過程$\G:\F\to\R$について\footnote{Kolmogorov extension theoremにより存在が保証される}，$\rho_2(f,g)=\paren{E\abs{\G f-\G g}^2}^{1/2}=\rho_P(f-g)$が成り立つ．
    \end{enumerate}
\end{proposition}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item $\norm{af}=\abs{a}\norm{f}$は明らか．$\norm{f+g}\le\norm{f}+\norm{g}$は
        \begin{align*}
            \sqrt{P((f-Pf)+P(g-Pg))^2}&\le\sqrt{P(f-Pf)^2}+\sqrt{P(g-Pg)^2}\\
            \Leftrightarrow\quad P(f-Pf)^2+P(g-Pg)^2+2P(f-Pf)(g-Pg)&\le P(f-Pf)^2+P(g-Pg)^2+2\sqrt{P(f-Pf)^2P(g-Pg)^2}
        \end{align*}
        より．$P\Brace{(f-Pf)(g-Pg)}$より，$P\abs{f-Pf}\cdot P\abs{g-Pg}$の方が大きい．
        \item 
        Gauss過程$\G:\F\to\R$の共分散関数について，$E[\G f\G g]=P[(f-Pf)(g-Pg)]$が成り立つから，
        \begin{align*}
            \rho_P(f-g)^2&=P((f-Pf)-(g-Pg))^2\\
            &=P(f-Pf)^2+P(g-Pg)^2-2P[(f-Pf)(g-Pg)]\\
            &=E[(Gf)^2]+E[(Gg)^2]-2E[GfGg]\\
            &=E[(G(f-g))^2]=\rho_2(f-g).
        \end{align*}
    \end{enumerate}
\end{proof}

\begin{corollary}[Donskerクラスであることの特徴付け１]\label{cor-characterization-of-Donsker-classes-1}
    $\F\subset L_2(P)$がDonskerクラスであることは，次の２条件に同値：
    \begin{enumerate}
        \item (全有界) $(\F,d_P)$が全有界である．
        \item (漸近的同程度連続性) $\forall_{\ep>0}\;\lim_{\delta\searrow 0}\limsupn P^*\paren{\sup_{\rho_P(f-g)<\delta}\abs{\G_n(f-g)}>\ep}=0$．
    \end{enumerate}
\end{corollary}
\begin{proof}
    $\forall_{f\in\F}\;Pf^2<\infty$ならば，$\F$を添字とした経験過程$\G_n:\N\to\wB(\F)$の任意の有界周辺写像が収束すること\ref{prop-multivariable-CLT}(1)より，
    Gauss過程が弱収束する条件\ref{cor-characterization-of-weak-convergence-of-Gaussian-Process}のうち(1)は必然的に満たされる．
\end{proof}
\begin{remark}[漸近的同程度連続性の特徴付け]
    $\F_\delta:=\Brace{f-g\in\F\mid f,g\in\F,\rho_P(f-g)<\delta}$について，(2)は
    $\forall_{\ep>0}\;\lim_{\delta\searrow0}\limsup_{n\to\infty}P^*(\norm{\G_n}_{\F_\delta}>\ep)=0$に同値．
    よって結局，
    \[\forall_{\delta_n\searrow 0}\;\norm{\G_n}_{\F_{\delta_n}}\xrightarrow{P^*}0\]
    と同値．

    また，(2)は確率収束でなく，弱収束としても十分\cite{Kosorok}(Lemma 8.17)．
\end{remark}

条件$\norm{P}_\F<\infty$がある場合は，$\rho_P$半ノルムの代わりに$L_2(P)$-ノルムを用いることができる．

\begin{tbox}{red}{最終型：}
    \begin{corollary}[Donskerクラスであることの特徴付け２：2ノルムで]\label{cor-characterization-of-Donsker-classes-2}
        $\norm{P}_\F<\infty$ならば，$\F\subset L_2(\X,\B,P)$がDonskerであることは，次の２条件に同値：
        \begin{enumerate}
            \item $\F$は$\norm{\cdot}_{P,2}$が定める距離に関して全有界である．
            \item $\forall_{\delta_n\searrow 0}\;\norm{\G_n}_{\F_{\delta_n}}\xrightarrow{P^*}0$．ただし，$\F_\delta:=\Brace{f-g\in\G\mid f,g\in\F,\norm{f-g}_{P,2}<\delta}$とした．
        \end{enumerate}
    \end{corollary}
\end{tbox}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item $\rho_P$と$\rho_2$が同値だから？
        \item 注意参照．
    \end{enumerate}
\end{proof}

\subsection{漸近的同程度連続性続論}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    任意の可積分なクラス$\F\subset\L_P(\X)$について，標準的なGauss過程$(G_Pf)_{f\in\F}$が存在し，平均$0$で共分散$\Cov(G_P(f),G_P(g))$を持つ．この共分散は，$\L^2_P(\X)$上に半内積と擬距離$\rho_P$を定める．
    $\X=[0,1],P=U(\X),\F=\Brace{1_\{[0,x]\}\mid x\in[0,1]}$のとき，$G_P$は標準Brown橋といい，$B(x)$とも表す．
\end{tcolorbox}

\begin{definition}[pre-Gaussian]\mbox{}
    \begin{enumerate}
        \item クラス$\F\subset\Meas(\X,\R)$が$P$-プレガウスであるとは，$\F$を添字に持つタイトなGauss過程$\X^\infty\to l^\infty(\F)$が存在することをいう．あきらかに，$\F$が$P$-Donskerであることの必要条件であるが，タイトなGauss過程が必ずしも経験過程の極限として得られるとは限らないため，十分ではない．\footnote{$P$が離散測度であり，さらにいくつかの正則条件を満たすとき，$P$-preGaussianならば，$P$-Donskerである．これは密度の言葉で一般化できる．}
        \footnote{種々の必要条件から，結局，この上の標準Gauss過程$(G_Pf)_{f\in\F}:\F\to\Map(\X,\R)$が，各点$x\in\X$について有界で，$\rho_P$-一様連続で，prelinearであることに同値？\url{https://en.wikipedia.org/wiki/Pregaussian_class}．少なくとも，標準Gauss過程のタイトなバージョンが存在することとは同値\cite{van der Vaart and Wellner}．}
    \end{enumerate}
\end{definition}

\begin{lemma}
    クラス$\F\subset\Meas(\X,\R)$について，次の２条件は同値．
    \begin{enumerate}
        \item $\F$は$P$-pre-Gaussianである．
        \item $(\F,\rho_P)$は全有界で，標準Gauss過程$(G_Pf)_{f\in\F}:\F\to\Map(\X,\R)$のバージョンであって，一様に$\rho_P$-連続な見本過程を持つものが存在する．
    \end{enumerate}
\end{lemma}
\begin{proof}
    収束先の一様連続性とタイト性との関係\ref{thm-limit-is-in-UC}より．
\end{proof}

\begin{lemma}
    pre-Gaussianなクラス$\F\subset\Meas(\X,\R)$について，次の２条件は同値．
    \begin{enumerate}
        \item $\F$はDonskerである．
        \item $\G_n$は漸近的タイトである．
    \end{enumerate}
\end{lemma}
\begin{remarks}
    そして，漸近的タイト性は，漸近的同程度一様確率連続性によって測る\ref{thm-characterization-of-asymptotical-tightness}．
    こうしてDonskerクラスにアプローチしていく．
\end{remarks}


\section{連続度を抑えるための準備}



\subsection{Orliczノルムと最大不等式}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
    title=道具１：]
        大数の法則と中心極限定理を一般化するにあたって，いずれの場合も上限を評価する必要がある．
        この共通する手法を，Orliczノルムを用いて整備する．
    \end{tcolorbox}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    経験過程の漸近的同程度連続性を示すのに有用な道具は，最大不等式と呼ばれるクラスの不等式である．
    そのために，$L^p$空間を一般化するBanach空間であるBirnbaum-Orlicz空間を定める．ほとんどのSobolev空間も含む．
    Orliczノルムは，収束についても$L_r$-ノルムと似た同じ性質を持っている．
\end{tcolorbox}

\subsubsection{Orliczノルム}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    $L^p$ノルムの一般化であるが，このノルムの扱いが難しい．
\end{tcolorbox}

\begin{definition}
    $\psi:[0,\infty)\to[0,\infty)$は$\psi(0)=0,\psi\ne 0$を満たす単調増加な凸関数とする．
    \begin{enumerate}
        \item 確率変数$X$の\textbf{Orliczノルム}または\textbf{$\psi$-ノルム}とは，
        \[\norm{X}_\psi:=\inf\Brace{c\in\R_{>0}\;\middle|\;E\Square{\psi\paren{\frac{\abs{X}}{c}}\le 1}}\]
        と定める．ただし，$\inf\emptyset=\infty$と定める．
    \end{enumerate}
\end{definition}

\begin{lemma}[well-definedness]
    $\psi$-ノルムは，確かに$\norm{X}_\psi<\infty$を満たす確率変数がなす集合上でノルムを定める．
\end{lemma}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item $\norm{X}_\psi=0\Rightarrow X=0$．
        \item $\forall_{a\in\R}\;\norm{aX}_\psi=\abs{a}\norm{X}_\psi$は，$\frac{\abs{X}}{c}$という定め方による．
        \item 三角不等式は，Jensenの不等式$\psi(E[X])\le E[\psi(X)]$により，$\psi$が凸のとき
        から従う．\textcolor{blue}{？？}
    \end{enumerate}
\end{proof}

\begin{example}\mbox{}
    \begin{enumerate}
        \item $\psi(x)=x^r\;(r\ge 1)$とすると，この$\psi$-ノルムとは$L_r$-ノルム$\norm{X}_r=(E\abs{X}^r)^{1/r}$をいう．すなわち，$r$次のモーメント．
        \item $\psi_r=e^{x^r}-1\;(r\ge 1)$が定めるOrliczノルムが，$X$の袖の振る舞いを強調するため，極限での振る舞いを考えたり，最大不等式の議論で重要な役割を果たす．
        $x^r\le\psi_r(x)$なので，$\forall_{r\ge 1}\;\norm{X}_r\le\norm{X}_{\psi_r}$．
        $\psi_2$ノルムが有限なクラスを劣ガウスといい，$\psi_1$ノルムが有限なクラスを劣指数的という．
    \end{enumerate}
\end{example}

\begin{proposition}[OrliczノルムとLノルム]\label{prop-Orlicz-norm-L-norm}
    任意の$1\le r\le s$について，
    \begin{enumerate}
        \item $\norm{X}_r\le\ceil{r}!\norm{X}_{\psi_1}$．
        \item $\norm{X}_{\psi_r}\le\norm{X}_{\psi_s}(\log2)^{1/s-1/r}$．
    \end{enumerate}
\end{proposition}

\subsubsection{Orliczノルムと収束}

\begin{lemma}[収束についての性質]\label{lemma-Orlicz-norm-and-convergence}
    $\psi:[0,\infty)\to[0,\infty)$は$\psi(0)=0,\psi\ne 0$を満たす単調増加な凸関数とする．
    任意の確率変数列$(X_n)$に対して，
    \begin{enumerate}
        \item $0\le X_n\nearrow X\;\as\Rightarrow\norm{X_n}_\psi\nearrow\norm{X}_\psi$．
        \item $\norm{X_n}_\psi\to0\Rightarrow X_n\xrightarrow{P}0$．
    \end{enumerate}
\end{lemma}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item 明らか．
        \item $\norm{X_n}_\psi\to0$ならば，$\abs{X_n}$が$0$に収束しない集合の測度は$0$である．
    \end{enumerate}
\end{proof}

\begin{lemma}
    \[P(\abs{X}>x)\le P\paren{\psi\paren{\frac{\abs{X}}{\norm{X}_\psi}}\ge\psi\paren{\frac{x}{\norm{X}_\psi}}}\le 1\land\psi\paren{\frac{x}{\norm{X}_\psi}}^{-1}\]
\end{lemma}
\begin{proof}
    \begin{align*}
        P(\abs{X}>x)&=P\paren{\frac{\abs{X}}{\norm{X}_\psi}>\frac{x}{\norm{X}_\psi}}\\
        &\le P\paren{\psi\paren{\frac{\abs{X}}{\norm{X}_\psi}\ge\psi\paren{\frac{x}{\norm{X}_\psi}}}}&\psi の定義\\
        &\le\frac{E\Square{\psi\paren{\frac{\abs{X}}{\norm{X}_\psi}}}}{\psi\paren{\frac{x}{\norm{X}_\psi}}}\land 1&\text{Markovの不等式}\\
        &\le\frac{1}{\psi\paren{\frac{x}{\norm{X}_\psi}}}\land 1&ノルムの定義
    \end{align*}
\end{proof}

\begin{proposition}[尾部確率の評価]\label{prop-尾部確率の評価}
    確率変数$X$と任意の$r\ge 1$に関して，次の２条件は同値：
    \begin{enumerate}
        \item $\norm{X}_{\psi_r}<\infty$．
        \item $\exists_{0<C,K<\infty}\;\forall_{x>0}\;P(\abs{X}>x)\le Ke^{-Cx^r}$．
    \end{enumerate}
    さらに，もし(1),(2)のいずれかが成り立つならば，(2)について$K=2,C=\norm{X}^{-r}_{\psi_r}$がこれを満たす．また(2)を満たす任意の$0<C,K<\infty$について，$\norm{X}_{\psi_r}\le\paren{\frac{1+K}{C}}^{1/r}$が成り立つ．
\end{proposition}
\begin{proof}\mbox{}
    \begin{description}
        \item[(1)$\Rightarrow$(2)] 
        $\norm{X}_{\psi_r}<\infty$と仮定する．簡単にわかる事実$\forall_{u>0}\;1\land(e^u-1)^{-1}\le 2e^{-u}$と補題より，
        \[P(\abs{X}>x)\le 2\exp\paren{-\frac{x^r}{\norm{X}^r_{\psi_r}}}\]
        という評価を得る．
        \item[(2)$\Rightarrow$(1)]
        任意の$c\in(0,C)$について，確率変数$\psi_r(\abs{X})=e^{c\abs{X}^r}-1$の期待値は，Fubiniの定理を用いて
        \begin{align*}
            E\Square{e^{c\abs{X}^r}-1}&=E\Square{\int^{\abs{X}^r}_0ce^{cs}ds}\\
            &=\int^\infty_0P(\abs{X}>s^{1/r})ce^{cs}ds&\text{Fubiniの定理}\\
            &\le\int^\infty_0Ke^{-Cs}ce^{cs}ds&\text{(2)の仮定}
        \end{align*}
        と評価できる．これについて，$c\le\frac{C}{1+K}\Leftrightarrow c^{-1/r}\ge\paren{\frac{1+K}{C}}^{1/r}$ならば常に$\frac{Kc}{C-c}\le 1$と抑えられるから，
        Orliczノルムについて$\norm{X}_{\psi_r}\le\paren{\frac{1+K}{C}}^{1/r}<\infty$である．
    \end{description}
\end{proof}
\begin{remarks}
    Chebyshev不等式のような使い方．tailを強調するためである．
\end{remarks}

\subsubsection{最大量の動きの評価}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    $\max_{i\in N}\abs{X_i}^r\le\sum_{i\in N}\abs{X_i}^r$という不等式から，$L_r$ノルムに関して
    \[\norm{\max_{i\in\N}X_i}_r\le\paren{E\Square{\max_{i\in\N}\abs{X_i}^r}}^{1/r}\le m^{1/r}\max_{i\in N}\norm{X_i}_r\]
    を得る．同様の不等式が，Orliczノルムについても一般化できる．
\end{tcolorbox}
\begin{proof}
    \begin{align*}
        \Norm{\max_{1\le i\le m}X_i}_r&=\paren{E\Square{\Abs{\max_{1\le i\le m}X_i}^r}}^{1/r}\\
        &\le\paren{E\Square{\max_{1\le i\le m}\abs{X_i}^r}}^{1/r}\\
        &\le\paren{E\Square{\sum_{1\le i\le m}\abs{X_i}^r}}^{1/r}\\
        &\le\paren{m\cdot\max_{1\le i\le m}E[\abs{X_i}^r]}^{1/r}=m^{1/r}\max_{1\le i\le m}\norm{X_i}_r.
    \end{align*}
\end{proof}

\begin{proposition}[最大不等式]\label{prop-max-inequality}
    $\psi:[0,\infty)\to[0,\infty)$は$\psi(0)=0,\psi\ne 0$を満たす単調増加な凸関数であって，\[\exists_{c>0}\;\limsup_{x,y\to 0}\frac{\psi(x)\psi(y)}{\psi(cxy)}<\infty\]を満たすとする．
    この時，任意の確率変数$X_1,\cdots,X_m$について，
    \[\Norm{\max_{1\le i\le m}X_i}_\psi\le\Norm{\max_{1\le i\le m}\abs{X_i}}_\psi\le K\psi^{-1}(m)\max_{1\le i\le m}\norm{X_i}_\psi.\]
    ただし，$K$は$\psi$のみに依存する定数であり，$\psi^{-1}(m)$は逆像の一点を表す．
\end{proposition}
\begin{proof}\mbox{}
    \begin{description}
        \item[特別の$\psi$について] 
        $\psi$は$\exists_{c>0}\;\forall_{x,y\ge 1}\;\frac{\psi(x)\psi(y)}{\psi(cxy)}\le 1,\psi(1)\le\frac{1}{2}$を満たすとする．
        １つ目の仮定より，この時$\forall_{x\ge y\ge 1}\psi\paren{\frac{x}{y}}\le\frac{\psi(cy)}{\psi(x)}\le\frac{\psi(cy)}{\psi(y)}\le\frac{\psi(cx)}{\psi(y)}$であるから，
        任意の$y\ge 1,a>0$について，$\frac{\abs{X_i}}{a}\ge y\ge 1$を満たすときと満たさないときに分けて考えると，
        \begin{align*}
            \max_{1\le i\le m}\psi\paren{\frac{\abs{X}_i}{ay}}&\le\max_{1\le i\le m}\Square{\frac{\psi\paren{\frac{c\abs{X_i}}{a}}}{\psi(y)}+\psi\paren{\frac{\abs{X_i}}{ay}}1_{\frac{\abs{X_i}}{ay}<1}}\\
            &\le\sum^m_{i=1}\frac{\psi\paren{\frac{c\abs{X_i}}{a}}}{\psi(y)}+\psi(1).
        \end{align*}
        特に$a=c\max_{1\le i\le m}\norm{X_i}_\psi$とすると両辺の期待値を取って，
        \begin{align*}
            E\Square{\psi\paren{\frac{\max_{1\le i\le m}\abs{X_i}}{ay}}}&\le\sum^m_{i=1}\frac{E\Square{\psi\paren{\frac{\abs{X_i}}{\max_{1\le i\le m}\norm{X_i}_\psi}}}}{\psi(y)}+\psi(1)\\
            &\le\frac{m}{\psi(y)}+\psi(1).
        \end{align*}
        ただし，最後の評価は$\psi\paren{\frac{\abs{X_i}}{\max_{1\le i\le m}\norm{X_i}_\psi}}\le1$による．
        さらに$y\in\psi^{-1}(2m)$とすると$y\ge1$で，右辺は$\frac{1}{2}+\frac{1}{2}=1$となるから，Orliczノルムは
        \[\norm{\max_{1\le i\le m}\abs{X_i}}_\psi\le ay=c\psi^{-1}(2m)\max_{1\le i\le m}\norm{X_i}_\psi\]
        となる．$\psi$の凸性から$\psi^{-1}(2m)\le 2\psi^{-1}(m)$より，$K:=2c$とすれば成立．
        \item[一般の$\psi$について]
        補題の仮定を満たす関数$\psi$から，$\exists_{c>0}\;\forall_{x,y\ge 1}\;\frac{\phi(x)\phi(y)}{\phi(cxy)}\le 1,\phi(1)\le\frac{1}{2}$を満たす
        単調増加関数$\phi,\phi(0)=0,\phi\ne 0$を構成できることを示す．
    \end{description}
\end{proof}
\begin{remarks}[確率変数列の最大値という特性量の振る舞いの記述]
    特に$\psi_r\;(r\ge 1)$の場合を考える．$c=1$とすると命題の条件を満たすから，
    $\psi_r^{-1}(m)=(\log (m+1))^{1/r}$なので，$\psi$-ノルムの最大量の増大レートは対数関数的である．
\end{remarks}

\begin{lemma}[$\psi_r$-ノルムで尾部を評価する]\label{lemma-尾部確率の評価}
    $m$個の確率変数$X_1,\cdots,X_m$を考える．尾部確率$P(\abs{X_i}>x)$は，
    \[\exists_{a,b\ge 0}\;\forall_{i\in[m]}\;\forall_{x>0}\;P(\abs{X_i}>x)\le 2e^{-\frac{1}{2}\frac{x^2}{b+ax}}\]
    を満たすとする．
    この時，
    \[\Norm{\max_{1\le i\le m}\abs{X_i}}_{\psi_1}\le K\Brace{a\log(1+m)+\sqrt{b}\sqrt{\log(1+m)}}\]
    が成り立つ．ここで，$K$は$a,b$や確率変数に無関係な普遍定数である．
\end{lemma}
\begin{proof}\mbox{}
    \begin{description}
        \item[$a,b>0$のとき] 
        $x\le\frac{b}{a}\Rightarrow b+ax\le 2b$なので，$P(\abs{X_i}>x)\le2\exp\paren{-\frac{x^2}{4b}}$．$x>\frac{b}{a}\Rightarrow\frac{b}{x}+a\le 2a$なので，$P(\abs{X_i}>x)\le 2\exp\paren{-\frac{x}{4a}}$が仮定からわかる．
        よって，任意の$x>0$について，
        \begin{align*}
            P\paren{\abs{X_i}1_{\Brace{\abs{X_i}\le\frac{b}{a}}}>x}&\le 2\exp\paren{-\frac{x^2}{4b}},&P\paren{\abs{X_i}1_{\Brace{\abs{X_i}<\frac{b}{a}}}>x}&\le 2\exp\paren{-\frac{x}{4a}}.
        \end{align*}
        命題\ref{prop-尾部確率の評価}より，
        \begin{align*}
            \norm{\abs{X_i}1_{\Brace{\abs{X_i}\le\frac{b}{a}}}}_{\psi_2}&\le\sqrt{12b},&\norm{\abs{X_i}1_{\Brace{\abs{X_i}<\frac{b}{a}}}}_{\psi_1}&\le 12a.
        \end{align*}
        よって，三角不等式と命題\ref{prop-Orlicz-norm-L-norm}(2)，そして最大不等式より，
        \begin{align*}
            \norm{\max_{1\le i\le m}\abs{X_i}}_{\psi_1}&\le(\log 2)^{-1/2}\norm{\max_{1\le i\le m}\abs{X_i}1_{\Brace{\abs{X_i}\le\frac{b}{a}}}}_{\psi_2}+\norm{\max_{1\le i\le m}\abs{X_i}1_{\Brace{\abs{X_i}<\frac{b}{a}}}}_{\psi_1}\\
            &\le\paren{\frac{\sqrt{12b}}{\sqrt{\log 2}}\psi^{-1}_2(m)+12a\psi^{-1}_1(m)}K.
        \end{align*}
        \item[その他の場合] 
        $a>0,b=0$の場合，$a=0,b>0$の場合は$a,b>0$の場合の極限を取ることで得る．
        $a=b=0$の場合は確率１で$X_i=0$より，自明．
    \end{description}
\end{proof}
\begin{remarks}
    尾部確率は$\psi_r$-ノルムによって評価できる．
    大きな$x$については$\exp(-x/(4a))$で，$0$に近い$x$については$\exp(-x^2(4b))$となる．
\end{remarks}

\begin{lemma}[Bernstein]\label{lemma-Bernstein}
    有界な区間に値を取る確率変数$Y_1,\cdots,Y_n\to[-M,M]$は独立で平均$0$がであるとする．
    この時，任意の$x>0,v\ge\Var(Y_1+\cdots+Y_n)$に対して，
    \[P(\abs{Y_1+\cdots+Y_n}>x)\le 2e^{-\frac{1}{2}\frac{x^2}{v+Mx/3}}.\]
\end{lemma}
\begin{proof}\mbox{}
    \begin{description}
        \item[尾部確率の評価] 
        $S:=Y_1+\cdots+Y_n$とおく．Chebyshevの不等式$\forall_{x,t>0}\;P(S\ge x)\le\frac{E[e^{tS}]}{e^{tx}}=\frac{\prod_{i=1}^nE[e^{tY_i}]}{e^{tx}}$に注意．
        各$i$について，$E[Y_i]=0$したがって$\Var[Y_i]=E[Y_i^2]$に注意すると，広義一様収束より項別積分して，
        \begin{align*}
            E[e^{tY_i}]&=1+E[Y_i]+\sum^\infty_{k=2}\frac{t^k}{k!}E[Y^2_iY^{k-2}_i]\\
            &\le 1+\Var[Y_i]\sum^\infty_{k=2}\frac{t^k}{k!}M^{k-2}
        \end{align*}
        であるから，$g(t):=\frac{e^{tM}-1-tM}{M^2}$とおくと，$E[e^{tY_i}]\le\exp\paren{\Var[Y_i]g(t)}$を得る．
        以上を併せて，$P(S\ge x)\le\exp\paren{vg(t)-tx}$．
        同様にして$P(-S\ge x)\le\exp\paren{vg(t)-tx}$．
        \item[変形]
        以上より，$B(\lambda):=2\frac{(1+\lambda)\log(1+\lambda)-\lambda}{\lambda^2}$とおくと，
        \[P(\abs{S}>x)\le 2\inf\exp\paren{vg(t)-tx}=2\exp\paren{-\frac{1}{2}\frac{x^2B\paren{\frac{Mx}{v}}}{v}}\]
        と評価できる．これと$\forall_{\lambda>0}\;\frac{1}{1+\lambda/3}$を併せれば良い．
    \end{description}
\end{proof}
\begin{remarks}
    実際の補題\ref{lemma-尾部確率の評価}が使える具体例として，有界な範囲に値を取る，独立で平均$0$な確率変数列の部分和が，部分分散の正規分布に従うことなどから現れる．
\end{remarks}

\subsubsection{被覆数と梱包数}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=一般最大不等式の導出]
    確率過程はいわば無限の確率変数を持つから，最大不等式はそのままでは役に立たない．
    Kolmogorovによる連鎖(chaining)と呼ばれる手法で有限への帰着を行う．添字集合$T$に備わる擬距離が定める計量エントロピーに引き戻す．
    エントロピーの対数は，指数関数の引き戻しとして自然に現れるのかな．
\end{tcolorbox}

\begin{definition}[covering number, separated, packing number, entropy number]
    $(T,d)$を擬距離空間とする．
    \begin{enumerate}
        \item $T$を被覆するのに必要な半径$\ep$の閉球の最小個数を\textbf{被覆数}とよび，$N(\ep;T,d)$で表す．
        \item $S\subset T$が\textbf{$\ep$-分離的}であるとは，$\forall_{x,y\in S}\;x\ne y\Rightarrow d(x,y)>\ep$が成り立つことをいう．
        \item $D(\ep;T,d):=\max\Brace{\abs{T}\in\N\mid T\subset Sは\ep\text{-分離的}}$を\textbf{パッキング数}という．ただし，$S$のどの２点も$\ep$-分離的に取れないならば，$D=1$となることに注意．
        \item 被覆数，及び，パッキング数の対数を，\textbf{エントロピー数}という．
    \end{enumerate}
\end{definition}
\begin{remark}
    この用語を用いると，$(T,d)$が全有界であることは，$\forall_{\ep>0}\;N(\ep;T,d)<\infty$に同値かつ$\forall_{\ep>0}\;D(\ep;T,d)<\infty$に同値．
\end{remark}

\begin{lemma}\label{lemma-relation-between-packing-number-and-covering-number}
    \[N(\ep;T,d)\le D(\ep;T,d)\le N(\ep/2,T,d)\]
\end{lemma}
\begin{proof}\mbox{}
    \begin{description}
        \item[$N(\ep;T,d)\le D(\ep;T,d)$] 
        $T$は$D:=D(\ep;T,d)$とすると，ある$x_1,\cdots,x_D$を中心とする半径$\ep$の閉球で覆われる．
        もし被覆しない（漏れ出る点がある）とすると，$D$がパッキング数であること（その最大性）に矛盾．
        \item[$D(\ep;T,d)\le N(\ep/2;T,d)$]
        $T$は$N:=N(\ep/2;T,d)$個の半径$\ep/2$の閉球$B_1,\cdots,B_N$で被覆できる．
        このとき，任意の$\ep$-分離的な集合$S\subset T$は，$\abs{B_i\cap S}\le 1$を満たすことを示せば良いが，これは明らか．
    \end{description}
\end{proof}
\begin{remark}
    $N,D$が距離関数として同値，つまり同じ位相を定める，すなわち$\ep\searrow0$における振る舞いが本質的に同等であることがわかる．
\end{remark}

\subsection{一般化最大不等式}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    supよりは積分の方がマジかなあ．
\end{tcolorbox}

\begin{theorem}[generalized maximal inequality]\label{thm-generalized-max-inequality}
    $\psi:[0,\infty)\to[0,\infty)$は$\psi(0)=0,\psi\ne 0$を満たす単調増加な凸関数であって，\[\exists_{c>0}\;\limsup_{x,y\to 0}\frac{\psi(x)\psi(y)}{\psi(cxy)}<\infty\]を満たすとする．
    確率過程$X:T\to\wB(\Om)$は$T$上のある擬距離$d$に関して可分で，$\forall_{s,t\in T}\;\exists_{r\in\R}\;\norm{X(s)-\norm(t)}_\psi\le rd(s,t)$を満たすとする．
    このとき，
    \begin{enumerate}
        \item 任意の$\eta,\delta>0$に対して，
        \[\Norm{\sup_{d(s,t)\le\delta}\abs{X(s)-X(t)}}\le K\Square{\int^\eta_0\psi^{-1}(D(\ep;T,d))d\ep+\delta\psi^{-1}(D(\eta;T,d)^2)}.\]
        ここで，$K<\infty$は$\psi,r$のみに依存する定数．
        \item \[\Norm{\sup_{s,t\in T}\abs{X(s)-X(t)}}_\psi\le 2K\int^{\diam T}_0\psi^{-1}(D(\ep;T,d))d\ep.\]
    \end{enumerate}
\end{theorem}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item 右辺が可積分な場合について示せば良い．
        各$T_j$が$\eta 2^{-j}$-分離的になるように有限集合の増大列$(T_j)_{j\in\N}$を取ると，$T_\infty$は$T$上で稠密になる．
        \begin{description}
            \item[連鎖の評価] 
            各点$t_{j+1}\in T_{j+1}$に対して，$d(t_j,t_{j+1})\le\eta 2^{-j}$を満たす点$t_j\in T_j$を選び，写像の列$t_{j+1}\to t_j\to\cdots\to t_0$を構成する．
            これを連鎖とよび，各連鎖全体の集合を$T(j+1,j)\subset\Map(T_{j+1},T_j)$と表すと，
            任意の$s_{k+1},t_{k+1}\in T_{k+1}$について，
            \begin{align*}
                \abs{\Brace{X(s_{k+1}-X(t_{k+1}))}-\Brace{X(s_0)-X(t_0)}}&=\Abs{\sum^k_{j=0}\Brace{X(s_{j+1})-X(s_{j})}-\sum^k_{j=0}\Brace{X(t_{j+1})-X(t_{j})}}\\
                &\le 2\sum^k_{j=0}\max_{u,v\in T(j+1,j)}\abs{X(u)-X(v)}
            \end{align*}
            が成り立つ．最大不等式\ref{prop-max-inequality}より，$K_0\in\R$が存在して，このmaxのOrliczノルムは，仮定より$\norm{X(s)-X(t)}_\psi\le rd(u,v)\le r\eta 2^{-j}$だから，
            \begin{align*}
                \Norm{\max_{s,t\in T_{k+1}}\Abs{\Brace{X(s)-X(s_0)}-\Brace{X(t)-X(t_0)}}}_\psi&\le K_0\sum^k_{j=0}\psi^{-1}(D(\eta 2^{-j-1};T,d))\eta 2^{-j}\\
                &=4K_0\sum^k_{j=0}\psi^{-1}(D(\eta 2^{-k+j-1};T,d))\eta 2^{-k+j-2}\\
                &\le 4\eta K_0\int^1_0\psi^{-1}(D(\eta u;T,d))du=4K_0\int^\eta_0\psi^{-1}(D(\ep;T,d))d\ep.
            \end{align*}
            \item[$T_0$に引き戻して評価]
            三角不等式より，
            \[X(s_0)-X(t_0)\le\abs{\Brace{X(s_0)-X(s_{k+1})-\Brace{X(t_0)-X(t_{k+1})}}}+\abs{X(s_{k+1})-X(t_{k+1})}\]
            これらを併せて，最大不等式より，$C\in\R$が存在して，
            \begin{align*}
                \Norm{\max_{s,t\in T_{k+1},d(s,t)<\delta}\abs{X(s)-X(t)}}_\psi&\le\Norm{\max_{s,t\in T_{k+1}}\Abs{\Brace{X(s)-X(s_0)}-\Brace{X(t)-X(t_0)}}}_\psi+\abs{X(s_0)-X(t_0)}\\
                &\le 8K_0\int^\eta_0\psi^{-1}(D(\ep;T,d))d\ep+\Norm{\max_{s_{k+1},t_{k+1}\in T_{k+1}}\abs{X(s_{k+1})-X(t_{k+1})}}_\psi\\
                &\le 8K_0\int^\eta_0\psi^{-1}(D(\ep;T,d))d\ep+C\delta\psi^{-1}(D(\eta;T,d)^2)
            \end{align*}
            よって，$K:=8K_0\lor C$とおくと，
            \[\Norm{\sup_{s,t\in T_{k+1},d(s,t)<\delta}\abs{X(s)-X(t)}}_\psi\le K\Square{\int^\eta_0\psi^{-1}(D(\ep;T,d))d\ep+\delta\psi^{-1}(D(\eta;T,d)^2)}\]
            $X$が可分のとき，$\sup_{s,t\in T_\infty}=\sup_{s,t\in T}$が成立．
        \end{description}
        \item $\delta=\eta=\diam T$とおくと，$D(\eta;T,d)^2=D(\eta;T,d)=1$であり，
        \[\delta\psi^{-1}(D(\eta;T,d)^2)=\int^\eta_0\psi^{-1}(D(\eta;T,d))d\ep\le\int^\eta_0\psi^{-1}(D(\ep;T,d))d\ep.\]
    \end{enumerate}
\end{proof}
\begin{remarks}[可分確率過程]
    可分な確率過程とは，値域が有限個の点で近似可能であることをいう．

    可分性の仮定が現れるが，cadlag確率過程$X:\Om\to D([a,b])$は可分である．
    可分な確率過程は確率１で可分な部分空間に乗るから，全ての$\delta>0$に対して，確率１で
    \[\sup_{s,t\in T;d(s,t)<\delta}\abs{X(s)-X(t)}=\sup_{s,t\in T^*;d(s,t)<\delta}\abs{X(s)-X(t)}\]
    が成り立つということになる．

    ある$\eta>0$について$\int^\eta_0\psi^{-1}(D(\ep;T,d))d\ep<\infty$という可積分性条件を満たすならば，この定理の(1)は$X$がほとんど確実に$d$-一様連続な見本過程を持つことを示している．
    これは$\psi$-ノルムでの収束は確率収束を表す\ref{lemma-Orlicz-norm-and-convergence}ことによる．
    (2)は，$X$が確率１で$UC(T,d)$に値を取ることを言っている，$\forall_{t_0\in T}\;\norm{\sup_{t\in T}\abs{X(t)}}_\psi-\norm{X(t_0)}_\psi\le\norm{\sup_{s,t\in T}\abs{X(s)-X(t)}}_\psi$と併せればわかる．
    $(T,d)$が全有界のとき，$UC(T,d)$は$\sigma$-コンパクトであるから，$X$がBorel可測であることとタイトであることは同値\ref{lemma-separable-and-tight}．
\end{remarks}


\subsection{劣Gauss過程に関する最大不等式}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    興味ある対象のクラスとして劣Gauss過程を定義し，これについて一般化最大不等式を考えると，自然に逆関数としてのエントロピーが現れる．
    Hoeffdingの不等式により，Rademacher過程が劣Gaussであることを導く．
    このように，Hoeffdingの不等式は特に有用な集中不等式である．
\end{tcolorbox}

\begin{definition}[sub-Gaussian process, Rademacher過程]\mbox{}
    \begin{enumerate}
        \item 確率過程$X:T\to\wB(\Om)$が
        \[\forall_{s,t\in T}\;\forall_{x>0}\;P(\abs{X(s)-X(t)}>x)\le 2\exp\paren{-\frac{1}{2}\frac{x^2}{d(s,t)^2}}\]
        満たすとき，$X$は$T$の擬距離$d$に関して\textbf{劣Gauss過程}であるという．
        \item Rademacher確率分布に従う独立同分布な確率変数列$\ep_1,\cdots,\ep_n$に対して，$X:=\sum^n_{i=1}\ep_i$と定めた$X:\R^n\to\R$を\textbf{Rademacher過程}という．
    \end{enumerate}
\end{definition}
\begin{remarks}
    標準正規過程$X$は$P(X>x)=O\paren{\frac{e^{-x^2/2}}{x}}\;(x\to\infty)$の尾部確率をもつことから，係数の２と$-\frac{1}{2}$を得る．
\end{remarks}
\begin{example}\mbox{}
    \begin{enumerate}
        \item 平均$0$のGauss過程は明らかに，標準偏差が定める擬距離$d(s,t)=\sigma(X(s)-X(t))=\Var(X(s)-X(t))^{1/2}$に関して劣Gaussである．
        \item $[0,1]$上のBrown運動は$d(s,t)=\abs{s-t}^{1/2}$に関して可分な劣Gauss過程である．
    \end{enumerate}
\end{example}

\begin{proposition}[Hoeffdingの不等式]
    $\ep_1,\cdots,\ep_n$を独立なRademacher確率変数とする．
    \[\forall_{a=(a_1,\cdots,a_n)^T\in\R^n}\;\forall_{x>0}\;P\paren{\Abs{\sum^n_{i=1}\ep_ia_i}>x}\le 2\exp\paren{-\frac{1}{2}\frac{x^2}{\norm{a}^2}}.\]
    特に，$\Norm{\sum^n_{i=1}\ep_ia_i}_{\psi_2}\le\sqrt{6}\norm{a}$．
\end{proposition}
\begin{proof}
    任意のRademacher確率変数$\ep$について，$\forall_{\lambda\in\R}\;E[e^{\lambda\ep}]=\frac{e^\lambda+e^{-\lambda}}{2}=\sum^\infty_{i=0}\frac{\lambda^{2i}}{(2i)!}\le e^{\frac{\lambda^2}{2}}$．
    ただし，$(2i)!\ge 2^ii!$より従う．
    故に，Markovの不等式と併せると，任意の$\lambda>0$に関して，
    \[P\paren{\sum^n_{i=1}\ep_ia_i>x}\le\frac{E\Square{e^{\lambda\sum^n_{i=1}\ep_ia_i}}}{e^{\lambda x}}\le e^{\frac{\lambda^2}{2}\norm{a}^2-\lambda x}\]
    最良の上界は$\lambda=\frac{x}{\norm{a}^2}>0$とすれば良い．
    $\ep_1,\cdots,\ep_n$に$-1$をかけても結合分布は不変（対称）なので，結論を得る．

    $\psi_2$ノルムについては\ref{prop-尾部確率の評価}による．
\end{proof}
\begin{remark}
    評価$\norm{X(s)-X(t)}_{\psi_2}\le\sqrt{6}d(s,t)$は一般の劣Gauss過程について成り立つ．
    $\psi_2^{-1}(x)=\sqrt{\log(1+x)}$なので，劣Gauss過程の一般最大不等式はエントロピー積分が出現する．
\end{remark}

\begin{corollary}[劣Gauss過程に関する一般化最大不等式]\label{cor-GMI-for-subGauss}
    擬距離$d$に関して可分な劣Gauss過程$X:T\to\wB(\Om)$について，
    \begin{enumerate}
        \item $\forall_{\delta>0}\;E\paren{\sup_{d(s,t)\le\delta}\abs{X(s)-X(t)}}\le K\int^\delta_0\sqrt{\log D(\ep;T,d)}d\ep$．ここで$K$は普遍定数である．
        \item $\forall_{t_0\in T}\;E\paren{\sup_{t\in T}\abs{X(t)}}\le E\abs{X(t_0)}+K\int^{\diam T}_0\sqrt{\log D(\ep;T,d)}d\ep$．
    \end{enumerate}
\end{corollary}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item 一般化最大不等式\ref{thm-generalized-max-inequality}について$\psi:=\psi_2,\eta=\delta$とすると，
        \[\delta\psi_2^{-1}(D(\delta,T,d)^2)\le\delta\sqrt{2}\delta\psi_2^{-1}(D(\delta;T,d))\le\sqrt{2}\int^\delta_0\psi^{-1}_2(D(\ep;T,d))d\ep\]
        という特性より，Orliczノルムが
        \begin{align*}
            \Norm{\sup_{d(s,t)\le\delta}\abs{X(s)-X(t)}}&\le\Square{\int^\delta_0\psi^{-1}_2(D(\ep;T,d))d\ep+\delta\psi^{-1}_2(D(\delta;T,d)^2)}\\
            &\le K'\int^\delta_0\sqrt{\log(1+D(\ep;T,d))}d\ep
        \end{align*}
        と評価できる．いま，$\forall_{0\le\ep\le\diam T}\;D(\ep;T,d)\ge 2$，$\forall_{m\ge 2}\;\log(1+m)\le 2\log m$に注意すると，$\delta<\diam T$ならば，$K'$を十分大きく取ることにより
        対数の引数の中の１は消去できる．
        $\forall_{s,t\in T}\;d(s,t)\le\diam T$であることと，$L_1$ノルムと$\psi_2$ノルムの関係
        \ref{lemma-Orlicz-norm-and-convergence}より，
        \[E\paren{\sup_{d(s,t)\le\delta}\abs{X(s)-X(t)}}\le(\log2)^{-1/2}\Norm{\sup_{d(s,t)\le\delta}\abs{X(s)-X(t)}}.\]
        よって，結論を得る．
        \item $\delta:=\diam T$と取ることによる．
    \end{enumerate}
\end{proof}

\subsection{対称化不等式と可測性}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=道具２：対称化という技法]
    一般の経験過程は対称化された経験過程で抑え，対称化された経験過程はRademacher過程であるから，系\ref{cor-GMI-for-subGauss}の形の最大不等式で抑えられる．
    一般の経験過程の上限は可測ではないから，対称化された経験過程で抑える際に，外積分が必要となる．
\end{tcolorbox}

\subsubsection{対称化不等式}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    経験過程を対称化すると劣Gauss過程になるから，前節までで議論し，なんとか単純な組み合わせ論的な形に還元した最大化不等式を使える．
\end{tcolorbox}

\begin{definition}
    経験測度$\bP_n$に対して，
    \begin{enumerate}
        \item $\bP_n-P:\F\to\R;f\mapsto (\bP_n-P)f=\frac{1}{n}\sum^n_{i=1}\paren{f(x_i)-\int_\Om fdP}$を経験過程という．
        \item $\bP_n^\circ:\F\to\R;f\mapsto\bP_n^\circ f:=\frac{1}{n}\sum^n_{i=1}\ep_if(x_i)$を\textbf{対称化された経験過程}という．
    \end{enumerate}
    ただし，$\ep_1,\cdots,\ep_n$は互いに独立で，$X_1,\cdots,X_n$とも独立なRademacher確率変数とした．
\end{definition}

\begin{lemma}[経験過程を対称化すると劣Gaussである]\mbox{}
    \begin{enumerate}
        \item どちらの過程も，平均関数は$0$となる．
        \item 固定された$X_1,\cdots,X_n$について$\bP_n^\circ$はRademacher過程であり，したがって特に劣Gaussである．
    \end{enumerate}
\end{lemma}

\begin{theorem}[対称化不等式]
    直積空間を$\Om:=(\X^n,\B^n,P^n)\times(\Z,\C,Q)\times(\X^n,\B^n,P^n)$とする．
    この上での期待値を$E$で表す．
    任意の単調増加な凸関数$\Phi:\R\to\R$と，可測関数の族$\F\subset\Meas(\Om,\X)$に対して，
    \[E^*[\Phi(\norm{\bP_n-P}_\F)]\le E^*[\Phi(2\norm{\bP^\circ_n}_\F)].\footnote{特に左辺の外積分は$(\X^n,B^n,P^n)$に関して，右辺の外積分は$(\X^n,B^n,P^n)\times(\Z,\C,Q)$に関するもの．}\]
\end{theorem}
\begin{proof}\mbox{}
    \begin{description}
        \item[方針] 確率変数$X_i$は，の前半への射影$\pr_i:\Om\to\X$とし，$Y_1,\cdots,Y_n$を後半への射影で，$X_1,\cdots,X_n$と同じもの（コピー）とする．
        $\ep_1,\cdots,\ep_n:\Om\to\bZ$を互いに独立なRademacher確率変数とする．
        すると，射影は完全である（補題\ref{lemma-projection-is-perfect}）から，この定理の主張は可測な拡大$\Om\to\Om'$に対して影響を受けないことに注意．
        \item[最初の評価]
        任意の$X_1,\cdots,X_n$について，
        \begin{align*}
            \norm{P_n-P}_\F&=\sup_{f\in\F}\frac{1}{n}\Abs{\sum^n_{i=1}(f(X_i)-E[f(Y_i)])}&定義\\
            &\le E^*_Y\Square{\sup_{f\in\F}\frac{1}{n}\Abs{\sum^n_{i=1}(f(X_i)-f(Y_i))}}&f(Y_i)は可測でも，\sup で包むと可測とは限らない
        \end{align*}
        と評価できる．さらに
        \begin{align*}
            \Phi(\norm{P_n-P}_\F)&\le\Phi\paren{E^*_Y\Square{\sup_{f\in\F}\frac{1}{n}\Abs{\sum^n_{i=1}(f(X_i)-f(Y_i))}}}&\Phi の単調性\\
            &\le E_Y\Square{\Phi\paren{\Norm{\frac{1}{n}\sum^n_{i=1}(f(X_i)-f(Y_i))}_\F^{*Y}}}&\text{Jensenの不等式}\\
            &=E^*_Y\Square{\Phi\paren{\Norm{\frac{1}{n}\sum^n_{i=1}(f(X_i)-f(Y_i))}_\F}}&\Phi が連続の場合は等しい.
        \end{align*}
        最後に$X_1,\cdots,X_n$についても期待値を取ると，
        \[E^*[\Phi(\norm{\bP_n-P}_\F)]\le E^*_X\Square{E^*_Y\Square{\Phi\paren{\Norm{\frac{1}{n}\sum^n_{i=1}(f(X_i)-f(Y_i))}_\F}}}\]
        を得る．Fubiniの定理\ref{thm-Fubini}から，右辺はさらに重外積分$E^*_{XY}$を超えない．
        \item[対称化による評価]

    \end{description}
\end{proof}

\subsubsection{可測性の問題}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    対称化不等式の右辺が可測になってくれると，応用上さらにうまくいく．
    そのためには，各点可測クラスを取れば良いことが分かる．
\end{tcolorbox}

\begin{definition}[measurable class]\label{def-measurable-class}
    $\F\subset\Meas(\X,\R)$が，次を満たすとき，\textbf{$P$-可測クラス}であるという：
    $\forall_{n\in\N}\;\forall_{(e_1,\cdots,e_n)\in\R^n}\;$関数$(X_1,\cdots,X_n)\mapsto\Norm{\sum^n_{i=1}e_if(X_i)}_\F$が$(\X^n,\B^n,P^n)$の完備化について可測．
\end{definition}
\begin{remarks}
    先に$\ep$に関して，次に$X$に関して積分したいので，$\norm{\bP^\circ_n}_\F$が$X_1,\cdots,X_n,\ep_1,\cdots,\ep_n$について可測である時が一番理想的である．
    すなわち，任意の$(e_1,\cdots,e_n)\in\{\pm 1\}^n$に対して$(X_1,\cdots,X_n)\mapsto\Norm{\sum^n_{i=1}e_if(X_i)}_\F$が可測であることを仮定する．
    なお，$\X$の完備化に関して可測であれば（\ref{thm-Fubini}よりも強い意味での）Fubiniの定理には十分．
\end{remarks}

\begin{definition}[pointwise measurable class]
    $\F\subset\Meas(\X,\R)$が，次を満たすとき，\textbf{各点可測クラス}であるという：可算部分集合$\G\subset\F$が存在して，$\forall_{f\in\F}\;\exists_{\{g_m\}\subset\G}\;\forall_{x\in\X}\;g_m(x)\to f(x)$．
\end{definition}

\begin{lemma}
    $\F$が各点可測ならば，$\F$は任意の確率測度$P$に関して$P$-可測クラスである．
\end{lemma}
\begin{proof}
    $\F$が各点可測である時，$\Norm{\sum^n_{i=1}e_if(X_i)}_\F=\Norm{\sum^n_{i=1}e_if(X_i)}_\G$が成り立つため．
\end{proof}

\begin{example}\label{exp-pointwise-measurable}
    定義関数のクラス$\F=\Brace{1_{(-\infty,t]}(x)\mid t\in\R}$は各点可測である．

    実際，可算部分集合を
    \[\cG:=\Brace{1_{(-\infty,t]}\in\Meas(\X,\R)\mid t\in\Q}\]
    と定めると，任意の$1_{(-\infty,t]}\in\F$に対して，ある$\{s_n\}_{n\in\N}\subset\Q$が存在して$\lim_{n\to\infty}s_n=t$であるから，$\{1_{(-\infty,s_n]}\}_{n\in\N}\subset\cG$は$f$に各点収束する．
\end{example}

\begin{lemma}[各点可測性の保存]
    $\F_1,\cdots,\F_k\subset\Meas(\X,\R)$を各点可測とする．
    この時，任意の連続関数$\phi:\R^k\to\R$に対して，クラス
    \[\phi\circ(\F_1,\cdots,\F_k):=\Brace{\phi\circ f(x)\mid f=(f_1,\cdots,f_k)\in\F_1\times\cdots\times\F_k}\]
    は各点可測である．
\end{lemma}
\begin{remarks}
    ほとんどの構成（特に可測関数の構成と同じようなmaxや基本的な演算など）は連続である．
\end{remarks}

\subsubsection{Donskerの定理で必要な可測性}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    実際に可測性が必要になるのは，$\F_\delta,\F_\infty^2$なる集合であるので，これについての各論を展開する．
\end{tcolorbox}

\begin{notation}
    クラス$\F$に対して，
    \begin{enumerate}
        \item $\F_\delta:=\Brace{f-g\in\Meas(\X,\R)\mid f,g\in\F,\norm{f-g}_{P,2}<\delta}\;(\delta\in(0,\infty])$．
        \item $\F^2_\infty:=\Brace{h^2\in\Meas(\X,\R)\mid h\in\F_\infty}$．
    \end{enumerate}
    と定める．
\end{notation}

\begin{definition}[envelope function]\label{def-envelope-function}
    クラス$\F\subset\Meas(\X,\R)$の包絡関数とは，
    次を満たす関数$F:\X\to\R$である：$\forall_{x\in\X}\;\forall_{f\in\F}\;\abs{f(x)}\le F(x)$．
\end{definition}
\begin{example}
    $x\mapsto\sup_{f\in F}(f(x))$は最小の包絡関数である．
\end{example}

\begin{proposition}\label{prop-pointwise-measurability-of-F2-Finf}
    クラス$\F\subset\Meas(\X,\R)$について，$\F$が各点可測で，そのある包絡関数$F$が$P^*F^2<\infty$を満たすならば，全ての$0<\delta\le\infty$に対して$\F_\delta$と$F^2_\infty$は各点可測である．
\end{proposition}

\subsubsection{セミパラメトリック回帰モデルで必要な可測性}

\begin{definition}
    任意の$X=(Y,Z)\in\X:=\R\times\R^k$の分布$P\in\M(\X)$に関して，
    クラス
    \[\F:=\Brace{1_{\Brace{Y-\theta^TZ\le t}}\mid\theta\in\R^k,t\in\R}\]
    はセミパラメトリック回帰モデルの分析で大事になる．
\end{definition}

\begin{proposition}
    $\X$上の任意の確率測度$P$について，
    クラス$\F,\F_\delta,\F^2_\infty$はいずれも各点可測である．
\end{proposition}

\subsection{ブラケットエントロピー}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=道具３：]
    クラス$\F$がGlivenko-Cantelliクラスであるか，またはDonskerクラスであるかは，基本的にはその大きさに依存する．
    そこで，関数空間の部分集合の「大きさ」を定量化する方法を考える．
    有限集合は濃度で測れるが，無限集合はどうするか．これに対してKolmogorovらロシアの学派が始めた取り扱いである．
    ノルムによるもの（球）とブラケットによるものの２つの定義があるが，この２つをつなぐのがRieszの性質$\abs{f}\le\abs{g}\Rightarrow\norm{f}\le\norm{g}$である．
\end{tcolorbox}

\subsubsection{定義と性質}

\begin{notation}
    $(\F,\norm{-})$を，$\Map(X,\R)$内のノルム空間のある部分集合とする．例えば確率測度$Q\in\M(\X)$に関する$L_r(Q)$-ノルム空間など．
\end{notation}

\begin{definition}[covering number, entropy without bracketing, $\ep$-net]\mbox{}
    \begin{enumerate}
        \item $N(\ep,\F,\norm{-}):=\min\Brace{N\in\N\mid (U_n)_{n\in N}は\ep\text{-開球の族で}\F\text{を被覆する}}$．ただし，$\ep$-開球の中心が$\F$に属する必要はない．
        \item $\log N(\ep,\F,\norm{-})$を\textbf{（ブラケットなし）エントロピー}という．
        \item 部分集合$\cG\subset\F$が\textbf{$\ep$-網}であるとは，$\forall_{f\in\F}\;\inf_{g\in\cG}\norm{f-g}<\ep$が成り立つことをいう．
    \end{enumerate}
\end{definition}
\begin{remarks}
    $\ep$-網というのは，$\F$内部に存在する「被覆する開球の中心として取れば良い点」となる．
    逆に，全ての開被覆に対して同じ濃度の$\ep$-網が対応する．したがって，任意の$\ep$-網に対して，同数で被覆するブラケットを構成できる算譜を示すことが基本的な手法となる．
\end{remarks}

\begin{definition}[bracket, bracketing number, bracketing entropy]\mbox{}
    \begin{enumerate}
        \item 関数の組$l\le u\in\Map(X,\R)$に対して，集合$[l,u]:=\Brace{f\in\Map(X,\R)\mid l\le f\le u}$を\textbf{ブラケット}という．
        \item $\norm{u-l}\le\ep$を満たすブラケット$[l,u]$を\textbf{$\ep$-ブラケット}という．
        \item $\F$を覆うために必要な$\ep$-ブラケットの最小個数を\textbf{ブラケット数}といい，$N_{[]}(\ep,\F,\norm{-})$で表す．$l,u$は$\F$の元である必要はない．
        \item $\log N_{[]}(\ep,\F,\norm{-})$を\textbf{ブラケットエントロピー}という．
    \end{enumerate}
\end{definition}

\begin{lemma}[Rieszの性質]\mbox{}\label{lemma-Riesz}
    \begin{enumerate}
        \item $L_r(Q)$-ノルムはRieszの性質を満たす：$\abs{f}\le\abs{g}\Rightarrow\norm{f}\le\norm{g}$．
        \item Rieszの性質を満たすノルム$\norm{-}$について，任意の$\ep>0$と任意のクラス$\F\subset\Map(\X,\R)$について$N(\ep,\F,\norm{-})\le N_{[]}(2\ep,\F,\norm{-})$．
        \item ノルム$\norm{-}$は一様ノルム$\norm{-}_\infty$に優越されるとする：$\forall_{f\in\F}\;\norm{f}\le\norm{f}_\infty$．この時，(2)の逆の不等式も成り立つ：$\forall_{\ep>0}\;N_{[]}(2\ep,\F,\norm{-})\le N(\ep,\F,\norm{-}\infty)$．
    \end{enumerate}
\end{lemma}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item 1
        \item $2\ep$-ブラケット$[l,u]$について，$f\in[l,u]\Rightarrow U_{\ep}\paren{\frac{l+u}{2}}$．
        \item 任意の$\ep$-網に対して，同じ個数で被覆するブラケットが構成できる算譜を示せば良い．
        $\F$を被覆する一様$\ep$-網$\{f_1,\cdots,f_m\}$を考えると，$\norm{-}$に関する$2\ep$-ブラケット$[f_1-\ep,f_1+\ep],\cdots,[f_m-\ep,f_m+\ep]$は$\F$を覆う．
    \end{enumerate}
\end{proof}

\subsubsection{Sobolevクラス}

\begin{lemma}\label{lemma-bracket-number-for-uniform-norm}
    
\end{lemma}

\subsubsection{Lipschitz連続なクラスのブラケット}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    添字集合$T$に関してある連続性条件を仮定すると，\ref{lemma-Riesz}(3)の性質を拡張できる．
\end{tcolorbox}

\begin{theorem}\label{thm-bracket-number-for-Lischitz-class}
    距離空間$(T,d)$上の
    クラス$\F=\{f_t\}_{t\in T}\subset\Map(\X,\R)$を考える．ある関数$F:\X\to\R$が存在して，$\forall_{x\in\X}\;\abs{f_s(x)-f_t(x)}\le F(x)\cdot d(s,t)$が成り立つとする(添字に関するLipschitz連続性)．
    この時，任意の$\ep>0$と$\F$上の任意のノルム$\norm{-}$で$\norm{F}<\infty$を満たすものに関して$N_{[]}(2\ep\norm{F},\F,\norm{-})\le N(\ep,T,d)$が成り立つ．
\end{theorem}
\begin{proof}
    $(T,d)$を被覆する$\ep$-網$t_1,\cdots,t_k$に対して，$2\ep\norm{F}$個で被覆するブラケットが必ず構成できることを示す．
    $[f_{t_1}-\ep F,f_{t_1}+\ep F],\cdots,[f_{t_k}-\ep F,f_{t_k}+\ep F]$とすれば良い．
\end{proof}
\begin{remarks}
    そりゃそう．この本の基本手法が見えてきた，写像$F$とか言って種々の手法を抽象化して抽象的な定理を示してから，具体的に使う．
    しかもその具体例は1,2個しかない．
\end{remarks}
\begin{remark}
    $\norm{-}$が$\norm{-}_\infty$で優越されるとは，$T=\F,d=\norm{-}_\infty,F=\id_\F$の場合に当たる．
\end{remark}

\subsubsection{和と積に対する保存性}

\begin{lemma}
    クラス$\F,\cG\subset\Meas(\X,\R)$と確率測度$Q\in\M(\X)$に対して，
    \begin{enumerate}
        \item $\forall_{1\le r\le\infty}\;\forall_{\ep>0}\;N_{[]}(2\ep,\F+\cG,L_r(Q))\le N_{[]}(\ep,\F,L_r(Q))N_{[]}(\ep,\cG,L_r(Q))$．
        \item $\sup_{f\in\F}\norm{f}_\infty\le 1,\sup_{g\in\cG}\norm{g}_\infty\le 1$が成り立つ時，$\forall_{1\le r\le\infty}\;\forall_{\ep>0}\;N_{[]}(2\ep,\F\cdot\cG,L_r(Q))\le N_{[]}(\ep,\F,L_r(Q))N_{[]}(\ep,\cG,L_r(Q))$．
    \end{enumerate}
\end{lemma}

\section{Glivenko-Cantelli型定理}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    被覆数が有限とは，
    全有界と同じ雰囲気を感じる．
    $\F$が本質的に有限だから成り立つ性質であるという消息を暴いている．
\end{tcolorbox}

\subsection{ブラケットナンバーの十分条件}

\begin{theorem}\label{thm-Glivenko-Cantelli-1}
    クラス$\F\subset\Meas(\X,\R)$が$\forall_{\ep>0}\;N_{[\;]}(\ep,\F,L_1(P))<\infty$を満たすとする．この時，$\F$は$P$-Glivenko-Cantelliクラスである：$\norm{\bP_n-P}_\F\xrightarrow{\as^*}0$．
\end{theorem}

\begin{example}[Glivenko-Cantelliの定理]
    経験分布関数$\bF_n:\o{\R}\to[0,1]$に関する一様収束性$\norm{\bF_n-F}_\infty\xrightarrow{\as}0$はGlivenko-Cantelliの定理と呼ばれる．
    経験分布関数は，経験測度の$\F:=\Brace{1_{(-\infty,t]}(x)\in\Meas(X,\R)\mid t\in\o{\R}}$への制限
    とみなせるから，$\norm{\bP_n-P}_\F\xrightarrow{\as}0$に同値．これについて定理を考えると，真の分布関数$F$の高々有限個の$\ep$以上のジャンプを分点としてブラケットを取れば，$\F$を被覆することができるから$N_{[\;]}(\ep,\F,L_1(P))<\infty$．よって，確かに$\F$はGilvenko-Cantelliクラスである．
\end{example}

\subsection{被覆エントロピーの十分条件}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    被覆数については，任意の$\ep>0$について有限であるだけでなく，$n$に関して緩増加であることも必要．
\end{tcolorbox}

\begin{theorem}
    クラス$\F\subset\Meas(\X,\R)$が
    \begin{enumerate}[(a)]
        \item $P$-可測クラス\ref{def-measurable-class}で，
        \item その包絡関数$F$は$E^*[F]<\infty$を満たすとする\ref{def-envelope-function}．
        \item $M>0$について，$\F_M:=\Brace{f1_{\Brace{F\le M}}\mid f\in\F}$と定める．
        \item $\forall_{\ep>0}\;\forall_{M<\infty}\;\log N(\ep,\F_M,L_1(\bP_n))=o^*_P(n)$
    \end{enumerate}
    ならば，次の２条件が成り立つ．
    \begin{enumerate}
        \item $E\norm{\bP_n-P}^*_\F\to0$．
        \item $\norm{\bP_n-P}^*_\F\xrightarrow{\as}0$．
    \end{enumerate}
    特に，$\F$は$P$-Glivenko-Cantelliクラスである．
\end{theorem}
\begin{proof}\mbox{}
    \begin{description}
        \item[方針] まず，$\Phi:=\id_X$に関する対称不等式とFubiniの定理より，
        \begin{align*}
            E^*\Square{\norm{\bP_n-P}_\F}&\le 2E_X\Square{E_\ep\Square{\Norm{\frac{1}{n}\sum^n_{i=1}\ep_if(X_i)}_\F}}&\because P\text{-可測より外積分が取れる}\\
            &\le 2E^*_X\Square{E_\ep\Square{\Norm{\frac{1}{n}\sum^n_{i=1}\ep_if1_{\Brace{F\le M}}(X_i)}_\F}}\\
            &\hphantom{=====}+2E^*_X\Square{E_\ep\Square{\Norm{\frac{1}{n}\sum^n_{i=1}\ep_if1_{\Brace{F>M}}(X_i)}_\F}}&三角不等式\\
            &\le 2E^*_X\Square{E_\ep\Square{\Norm{\frac{1}{n}\sum^n_{i=1}\ep_if(X_i)}_{\F_M}}}\\
            &\hphantom{=====}+2E^*\Square{F1_{\Brace{F>M}}}.
        \end{align*}
        仮定(b)より，第二項は$M>0$を十分大きく取ることで任意に小さくできる．第一項が任意の$M>0$に対して$0$に収束することを示せば(1)が示せる．
        (2)は次の補題による．
        \item[第一項の評価] $E_\ep\Norm{\frac{1}{n}\sum^n_{i=1}\ep_if(X_i)}_{\F_M}$を評価する．仮定(d)より，$\delta$-net $\cG\subset\F$を取れば，
        \[E_\ep\Square{\Norm{\frac{1}{n}\sum^n_{i=1}\ep_if(X_i)}_{\F_M}}\le E_\ep\Square{\Norm{\frac{1}{n}\sum^n_{i=1}\ep_ig(X_i)}_{\cF}}+\delta.\]
    \end{description}
\end{proof}

\begin{lemma}\label{lemma-for-Gilvenko-Cantelli-1}
    確率空間$(\X^\infty,\B^\infty,P^\infty)$について，
    \begin{enumerate}[(a)]
        \item クラス$\F\subset\Meas(\X,\R)$は包絡関数$F$をもち，$E^*[F]<\infty$を満たす．
        \item フィルトレーション$\Sigma_n$は，最初の$n$個の変数の任意の置換について対称な全ての可測関数が生成する$\sigma$-加法族とする．
        $\Pi_n:=\Brace{\sigma\in\Sym(\N)\mid\forall_{i\ge n+1}\;\sigma(i)=i}$について，$H_n:=\Brace{h\in\Meas(\X^\infty,\R)\mid\forall_{\sigma\in\Pi_n}\;h((x_{\sigma(i)})^\infty_{i=1})=h((x_i)_{i=1}^\infty),(x_i)\in\X^\infty}$としたとき，$\Sigma_n:=\sigma[h;h\in H_n]\subset\B^\infty$．
    \end{enumerate}
    この時，
    \begin{enumerate}
        \item $E[\norm{\bP_n-P}^*_\F|\Sigma_{n+1}]\ge\norm{\bP_{n+1}-P}^*_\F\;\as$
        \item $\norm{\bP_n-P}^*_\F$のバージョンで，このfiltrationに適合するもの＝$\Sigma_n$-可測なものが存在する．
        \item このようなバージョンは全て逆進sub-martingaleで，ある$P^\infty$可積分確率変数に確率１で収束する．
    \end{enumerate}
\end{lemma}


\subsection{一様エントロピーの十分条件}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    経験分布だけでなく，（考え得る）あらゆる測度について被覆数を考える．
    すると，十分条件は少しは簡単になる．
    そしてこの十分条件は意外と使える．
\end{tcolorbox}

\begin{definition}[uniform covering number]\mbox{}
    \begin{enumerate}
        \item クラス$\F$の包絡関数$F$に対して，$\norm{F}_{Q,r}>0$を満たす有限離散確率測度$Q$の全体を$\cQ_{F,r}$とする．
        \item $\sup_{Q\in\cQ_{\F,r}}N(\ep\norm{F}_{Q,r},\F,L_r(Q))$を\textbf{一様被覆数}という．
        \item その対数を\textbf{一様エントロピー}という．
    \end{enumerate}
\end{definition}

\begin{theorem}\label{thm-Glivenko-Cantelli-2}
    可測関数のクラス$\F$は$P$-可測クラスで包絡関数$F\in L^1(P)$を持つとし，全ての$\ep>0$に関して一様被覆数は有限とする：$\sup_{Q\in Q_{F,1}}N(\ep\norm{F}_{Q,1},\F,\norm{-}_{L^1(Q)})<\infty$．
    このとき，$\F$は$P$-Gilvenko-Cantelliクラスである．
\end{theorem}

\section{Donsker型定理}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=11/8/2021]
    
\end{tcolorbox}

\subsection{第一定理：一様エントロピー}

\begin{definition}[uniform entropy integral]
    包絡関数$F$を持つ可測関数のクラス$\F\subset\Meas(\X,\R)$について，一様エントロピーの積分を\textbf{一様エントロピー積分}という：
    \[J(\delta,\F,L_r):=\int^\delta_0\sqrt{\log\sup_{Q\in\cQ_{F,r}}N(\ep\norm{F}_{Q,r},\F,L_r(Q))}d\ep,\quad\delta\in(0,\infty].\]
\end{definition}

\begin{lemma}
    $\X$上の有限離散確率測度の全体を$\cQ$とする．
    \[\forall_{0<\delta\le\infty}\;\int^\delta_0\sqrt{\log\sup_{Q\in\cQ}N(\ep\norm{F_c}_{Q,r},\F,L_r(Q))}d\ep\le J(\delta,\F,L_r)\]
\end{lemma}

\begin{notation}
    $\F_\delta:=\Brace{f-g\in\Meas(\X,\R)\mid f,g\in\F,\norm{f-g}_{P,2}<\delta}$と表す．
\end{notation}

\begin{theorem}\label{thm-Donsker-1}
    可測関数のクラス$\F\subset\Meas(\X,\R)$は包絡関数$F\in L^2(P)$をもち，$J(1,\F,L_2)<\infty$を満たすとする．
    任意の$0<\delta\le\infty$について，クラス$\F_\delta,\F^2_\infty:=\Brace{h^2\in\Meas(\X,\R)\mid h\in\F_\infty}$
    は$P$-可測とする．このとき，$\F$は$P$-Donskerクラスである．
\end{theorem}

\subsection{第二定理：ブラケットエントロピー}

\begin{definition}[bracketing integral]
    可測関数のクラス$\F$に対して，次を\textbf{ブラケット積分}という：
    \[J_{[\;]}(\delta,\F,L_r(P)):=\int^\delta_0\sqrt{\log N_{[\;]}(\ep,\F,L_r(P))}d\ep,\quad\delta\in(0,\infty].\]
    一様エントロピー積分の定義の際に必要な$Q\in\cQ_{\F,r}$は考えず，真の測度$P$のみを含む．
\end{definition}

\begin{theorem}\label{thm-Donsker-2}
    可測関数のクラス$\F$は$J_{[\;]}(\infty,\F,L_2(P))<\infty$を満たすとする．このとき，$\F$は$P$-Donskerクラスである．
\end{theorem}

\begin{lemma}
    ２乗可積分な有界関数$f$からなる有限集合$\F$に対して，
    \[E[\norm{\G_n}_\F]\lesssim\max_{f\in\F}\frac{\norm{f}_\infty}{\sqrt{n}}\log(1+\abs{\F})+\max_{f\in\F}\norm{f}_{P,2}\sqrt{\log(1+\abs{\F})}.\]
\end{lemma}
\begin{proof}
    任意の$x>0$について，Bernsteinの不等式\ref{lemma-Bernstein}を
    \[P(\abs{\G_nf}>x)\le 2e^{-\frac{1}{2}\frac{x^2}{Pf^2+\norm{f}_\infty x/\sqrt{n}}}\]
    の形で利用する．
\end{proof}

\begin{lemma}
    可測関数のクラス$\F\subset\Meas(\X,\R)$は包絡関数$F$をもち，全ての$f\in\F$に対して$Pf^2<\delta^2$を満たすとする．
    このとき，
    \[a(\delta):=\frac{\delta}{\sqrt{1\lor\log N_{[\;]}(\delta,\F,L_2(P))}}\]
    に対して，
    \[E^*[\norm{\G_n}_\F]\lesssim J_{[\;]}(\delta,\F,L_2(P))+\sqrt{n}E^*[F1_{F>\sqrt{n}a(\delta)}].\]
\end{lemma}

\begin{remark}[全てのDonskerクラスはGilvenko-Cantelliクラスである]
    系\ref{cor-characterization-of-Donsker-classes-2}より，Donskerクラスであることは$(\F,d_P)$が全有界で，$\forall_{\delta_n\searrow0}\;\norm{\G_n}_{\F_{\delta_n}}\xrightarrow{P^*}0$に同値．
    後者の条件は$\forall_{\delta_n\searrow0}\;E^*[\norm{\G_n}_{\F_{\delta_n}}]\to0$と同値．
    よって，Donsker性の$\lim_{n\to\infty}x^2\sup P^*(\norm{\G_n}_\F>x)=0$より，$\forall_{0<r<2}\;E^*[\norm{f-Pf}^r_{\F}]<\infty\land E^*[\norm{\G_n}^r_\F]\to E[\norm{\G}^r_\F]<\infty$が成り立つ．
    よって，$\F$は弱$P$-Gilvenko-Cantelliクラスである．
    あとは補題\ref{lemma-for-Gilvenko-Cantelli-1}による．
\end{remark}

\subsection{例}

\begin{example}[区間の定義関数クラス]
    経験分布関数$\bF_n(t):\R\to[0,1]$は，経験測度$\bP_n:\B(\R)\to[0,1]$の定義関数のクラス$\F:=\Brace{1_{(-\infty,t]}\in\Meas(\R,[0,1])\mid t\in\o{\R}}$への制限と同一視できるのであった．
    経験分布関数は有界なcàdlàg関数であるから，任意の$\ep\in(0,1]$に対して，$\R$の分割$(t_i)_{i=0,\cdots,k}$が存在して，$F(t_i-)-F(t_{i-1})\le\ep$を満たす．
    この分割を用いて，$\ep$-ブラケットの族を$([1_{(-\infty,t_{i-1}]},1_{(-\infty,t_i)}])_{i=0,\cdots,k}$と定めると，
    それぞれの$i=0,\cdots,k$について$\norm{1_{(-\infty,t_i)}-1_{(-\infty,t_{i-1})}}_{L_1(P)}=F(t_i-)-F(t_{i-1})\le\ep$を満たし，
    そのサイズ$k$は$k\le 1+\floor{1/\ep}\le2/\ep$などと評価できる（よって特に，$\F$は$P$-Glivenko-Cantelliクラスである\ref{thm-Glivenko-Cantelli-1}）．
    \begin{description}
        \item[第二定理からの確認] 
    $0\le f\le 1$のとき$0\le f^2\le f\le 1$より，一般に$P[f^2]\le P[f]$であるから，
    $L_1(P)$ノルムについての$\ep$-ブラケットは$\norm{1_{(-\infty,t_i)}-1_{(-\infty,t_{i-1})}}_{L_2(P)}=(P[1_{(t_{i-1},t_i)}^2])^{1/2}\le\sqrt{\ep}$より，そのまま$L_2(P)$ノルムについての$\sqrt{\ep}$ブラケットの例となっている．
    したがって，$N_{[\;]}(\ep,\F,L_2(P))\le N_{[\;]}(\ep^2,\F,L_1(P))\le\frac{2}{\ep^2}$．
    よって，ブラケット積分は，$\ep>1$のときは$N_{[\;]}(\ep,\F,L_2(P))=1$であることに注意すると，
    \begin{align*}
        J_{[\;]}(\infty,\F,L_2(P))&=\int^\infty_0\sqrt{\log N_{[\;]}(\ep,\F,L_2(P))}d\ep\\
        &\le\int^{1}_0\sqrt{\log 2-2\log\ep}d\ep\\
        &\le\int^{1/e}_0(\log 2-2\log\ep)d\ep+\int^1_{1/e}\sqrt{\log 2-2\log\ep}d\ep&\because \log 2-2\log\ep\ge\log 2+2>1\\ &&(0\le\ep\le 1/e)\\
        &\le\frac{\log 2}{e}+\frac{4}{e}+2\paren{1-\frac{1}{e}}=2+\frac{2+\log2}{e}&\because0\le\sqrt{\log2-2\log\ep}\le\sqrt{\log2+2}<2\\ &&(1/e\le\ep\le1)\\
    \end{align*}
    というように評価できる．よって，$\F$はDonskerクラスでもある（定理\ref{thm-Donsker-2}）．
    \item[第一定理からの確認]
    また，明らかに$\forall_{f\in\F}\;\forall_{x\in\R}\;\abs{f(x)}\le 1$であるから，定数関数$F:=1$は$\F$の可積分な包絡関数である．
    一様エントロピー積分については，
    一般の確率測度$Q$に対して，$L_r(Q)\;(1\le r\le\infty)$ノルムはRieszの性質$\abs{f}\le\abs{g}\Rightarrow\norm{f}\le\norm{g}$を満たすから，
    $N(\underbrace{\ep\norm{F}_{Q,2}}_{=\ep},\F,\norm{-}_{L_r(Q)})\le N_{[\;]}(2\ep,\F,\norm{-}_{L_2(Q)})$である\ref{lemma-Riesz}から，
    \begin{align*}
        J(1,F,L_2)&=\int^1_0\sqrt{\log\sup_{Q\in\cQ_{F,2}}N(\ep\norm{F}_{Q,2},\F,L_2(Q))}d\ep\\
        &\le\int^1_0\sqrt{\log N_{[\;]}(2\ep,\F,\norm{-}_{L_2(Q)})}d\ep=J_{[\;]}(\infty,\F,L_2(P))<\infty
    \end{align*}
    と評価できる．
    $\F$は各点可測\ref{exp-pointwise-measurable}で，包絡関数が$P[F^2]<\infty$を満たすから，$\forall_{\delta\in(0,\infty]}\;\F_\delta,\F^2_\infty$は各点可測\ref{prop-pointwise-measurability-of-F2-Finf}．
    よって，ほとんど等価な議論だが，定理\ref{thm-Donsker-1}からも$P$-Donskerクラスであることがわかる．
    \end{description}
\end{example}

\begin{example}[パラメータに関するLipschitzクラス]
    パラメータの空間$(\Theta,d)$によって添字づけられたクラス$\F:=\{f_\theta\}_{\theta\in\Theta}\subset\Meas(\X,\R)$であって，ある$F:\X\to\R$が存在して，Lipschitz連続性
    \[\forall_{\theta,\theta'\in\Theta}\;\forall_{x\in\X}\;\abs{f_\theta(x)-f_{\theta'}(x)}\le d(\theta,\theta')F(x)\]
    を満たすものを考える．
    \begin{enumerate}
        \item ある$r\in[1,\infty]$に対して，もし$\norm{F}_{P,r}<\infty$を満たすように取れるならば，定理\ref{thm-bracket-number-for-Lischitz-class}より
        \[\forall_{\ep>0}\quad N_{[\;]}(2\ep\norm{F}_{P,r},\F,L_r(P))\le N(\ep,\Theta,d)\]
        と評価できる．
        \item 例えば$\Theta$を$\R^d$内の有界集合とすると，$N(\ep,\Theta,d)$が有限であるから，(1)を使って$\F$がDonskerであることを示せる．
        まず，$\Theta$は１辺$\ep$の立方体を$\ceil{\diam\Theta/\ep}^d$個によって被覆できるので，$\forall_{\ep>0}\;\exists_{K\in\R}\;N(\ep,\Theta,d)\le K\paren{\frac{\diam\Theta}{\ep}}^d$．
        よって，$\exists_{K'\in\R}\;\forall_{0<\ep<\diam\Theta}\;N_{[\;]}(\ep,\F,L_2(P))\le\frac{K'}{\ep^d}$と評価でき，$\ep>\diam\Theta$については$N_{[\;]}(\ep,\F,L_2(P))=1$だから，
        \begin{align*}
            J_{[\;]}(\infty,\F,L_r(P))&=\int^\infty_0\sqrt{\log N_{[\;]}(\ep,\F,L_r(P))}d\ep\\
            &\le\int^{\min\{\diam\Theta,1\}}_0\sqrt{\log K-d\log\ep}d\ep\\
            &\le\int^\al_0(\log K-d\log\ep)d\ep+\int^1_\al\sqrt{\log K-d\log\ep}d\ep&0<\al<1は\log K-d\log x=1の解とした\\
            &\le\al\log K-\underbrace{d\al\log\al}_{=\al(\log K-1)}+d\al+(1-\al)=1+\al d
        \end{align*}
        よって，定理\ref{thm-Donsker-2}より，Donskerであることが従う．
    \end{enumerate}
\end{example}

\begin{example}[Sobolevクラス]
    \[\F_k:=\Brace{\eta:[0,1]\to\R\;\middle|\;
    \begin{array}{l}
        \norm{\eta}_\infty\le 1\text{ かつ }\eta^{(k-1)}\text{ は絶対連続で}\\
        \int^1_0(\eta^{(k)}(x))^2dx\le 1\text{ を満たす}
    \end{array}}\quad k\in\N
    \]
    は$P$-Donskerクラスである．
    \begin{enumerate}
        \item \[\exists_{K\in\R}\quad\forall_{\ep>0}\;\log N(\ep,\F_k,\norm{-}_\infty)\le\frac{K}{\ep^{1/k}}\]
        \item 補題\ref{lemma-bracket-number-for-uniform-norm}より，一様ノルムについてはブラケット数は
        \[\forall_{\ep>0}\quad \log N_{[\;]}(2\ep,\F,\norm{-}_\infty)\le\log N(\ep,\F,\norm{-}_\infty)\le K\ep^{-1/k}\]
        と評価できるから，ブラケット積分は，
        \begin{align*}
            J_{[\;]}(\infty,\F,L_2(P))&:=\int^\infty_0\sqrt{\log N_{[\;]}(\ep,\F,L_2(P))}d\ep\\
            &\le\sqrt{C}\int^1_0x^{-\frac{1}{2k}}dx+\int_1^\infty\sqrt{\log N_{[\;]}(\ep,\F,L_2(P))}d\ep\\
            &=\sqrt{C}\int^1_0x^{-\frac{1}{2k}}dx+\int_1^\infty \sqrt{\log N_{[\;]}(\ep,\F,L_2(P))}d\ep
        \end{align*}
        第一項は$\frac{2k}{2k-1}$に収束し，第二項もブラケットエントロピーは十分大きな$\ep$に関しては$0$なので有界である．
        定理\ref{thm-Donsker-2}より，任意の$k\in\N$に関して，$\F_k$はDonskerであることが従う．
    \end{enumerate}
\end{example}

\begin{tbox}{red}{３つの例に共通するパターン}
    最後の２つの例では被覆数を抑えてから，ブラケット数に関する条件に還元してから，第二定理\ref{thm-Donsker-2}の方を用いている．ブラケット積分$J_{[\;]}(\infty,\F,L_2(P))$の収束は，ブラケットエントロピーは十分大きい$\ep$に関しては$0$であるから上に有界であることと，
    \[\int^1_0x^\al dx=\begin{cases}
        \frac{1}{\al+1},&-1<\al,\\
        \infty,&\al\le-1.
    \end{cases}\]
    より下にも有界であることを組み合わせて示す．
\end{tbox}

\section{Glivenko-CantelliクラスとDonskerクラスの構成}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    統計モデルとは，$\x$を$y$に変換する関数の集合で，統計的な推論を行うために「とりあえず」考えておくものです．
    次の問題は，学習誤差から，予測誤差を見積もる事になる．これは大数の法則の漸近展開である．
    漸近展開ができないならば，大数の法則の精緻化であるHoeffdingの不等式などで評価するしかない．
    最大不等式は最悪評価に使う．

    次に推定量の収束スピードなど諸々がわかったのちには，モデル選択が問題になる．
    基本的にモデルが大きいと小さくなる学習誤差の項と，エントロピーの形をした項がある．

    「表現力＝VC次元が高すぎると学習がうまく進まない」
\end{tcolorbox}

\begin{notation}
    $\F\subset\Meas(\X,\R)$に対して，$\F$の列$(f_m)_{m\in\N}$の各点収束極限でもあり，$L_r(P)$収束極限でもあるような元に関する閉包を$\o{\F}^{P,r}$と表す．
\end{notation}

\subsection{Glivenko-Cantelliクラスの簡単な構成}

\begin{proposition}
    $\F,\cG$を$P$-Glivenko-Cantelliクラスとする．
    \begin{enumerate}
        \item $\H\subset \F$は$P$-Glivenko-Cantelliである．
        \item $\F\cup\cG$は$P$-Glivenko-Cantelliである．
        \item $\F+\cG$は$P$-Glivenko-Cantelliである．
        \item $\o{\F}^{P,1}$は$P$-Glivenko-Cantelliである．
    \end{enumerate}
\end{proposition}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item 測度のノルムは$\norm{Q}_\F=\sup_{f\in\F}\abs{Qf}$と定めたから，
        $\norm{\bP_n-P}_\H\le\norm{\bP_n-P}_\F\xrightarrow{\as^*}0$より．
        \item $\norm{\bP_n-P}_{\F\cup\cG}\le\max\{\norm{\bP_n-P}_\F,\norm{\bP_n-P}_\cG\}\xrightarrow{\as^*}0$．
        \item 積分の線形性より，$\sup_{f+g\in\F+\cG}\abs{Q(f+g)}=\sup_{f+g\in\F+\cG}\abs{Qf+Qg}\le\sup_{f\in\F}\abs{Qf}+\sup_{g\in\cG}\abs{Qg}$だから，
        $\norm{\bP_n-P}_{\F+\cG}\le\norm{\bP_n-P}_\F+\norm{\bP_n-P}_\cG\xrightarrow{\as}0$．
        \item $\sup_{f\in\F}\abs{(\bP_n-P)f}=\sup_{\wt{f}\in\o{\F}^{P,1}}\abs{(\bP_n-P)\wt{f}}$より．$\le$は$\F\subset\o{\F}^{P,1}$より明らかで，逆は任意の$\wt{f}\in \o{\F}^{P,1}$に対して，これに各点収束しかつ$L_1(P)$収束する$\F$の列$(f_n)$が存在するため．
    \end{enumerate}
\end{proof}

\subsection{更なる構成}

\begin{theorem}
    クラス$\F_1,\cdots,\F_k\subset\Meas(\X,\R)$は$P$-Glivenko-Cantelliで，$\max_{1\le j\le k}\norm{P}_{\F_j}<\infty$を満たすとし，関数$\phi:\R^k\to\R$を連続とする．
    このとき，クラス
    \[\phi\circ(\F_1,\cdots,\F_k)=\Brace{\phi\circ f\in\Meas(\X,\R)\mid f:=(f_1,\cdots,f_k)\in\F_1\times\cdots\times\F_k}\]
    に可積分な包絡関数が存在するならば，$P$-Glivenko-Cantelliである．
\end{theorem}

\begin{corollary}
    $\F,\cG\subset\Meas(\X,\R)$は可積分な包絡関数$F,G$をそれぞれ持つ$P$-Glivenko-Cantelliクラスとする．
    \begin{enumerate}
        \item $P[FG]<\infty$ならば，$\F\cdot\cG$も$P$-Glivenko-Cantelliである．
        \item 値域の合併を$R:=\cup_{f\in\F}\Im f\subset\R$とし，$\psi:\o{R}\to\R$をその閉包上に定まった連続関数とする．クラス$\psi\circ\F$が可積分な包絡関数を持つならば，これは$P$-Glivenko-Cantelliである．
    \end{enumerate}
\end{corollary}
\begin{proof}
    $\F,\cG$に可積分な包絡関数$F,G$が存在するとき，$\norm{\F}_\F=\sup_{f\in\F}\abs{Pf}\le PF<\infty$を満たすことに注意．
    \begin{enumerate}
        \item $FG$を可積分な包絡関数として，積$\cdot:\R^2\to\R$を連続関数$\phi$と見れば良い．
        \item 関数$\psi:\o{R}\to\R$の連続な延長$\o{\psi}:\R\to\R$であって，$\o{\psi}\circ F$が可積分になるようなものを任意に１つ取れば良い(Tietzeの拡張定理)．
        実際，$\forall_{f\in\F}\;\psi(f)=\o{\psi}(f)$より，$\o{\psi}\circ\F=\psi\circ\F$は可積分な包絡関数$\o{\psi}\circ F$を持つ$P$-Glivenko-Cantelliクラスである．
    \end{enumerate}
\end{proof}

\subsection{Donskerクラスの簡単な構成}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    系\ref{cor-characterization-of-Donsker-classes-1}の特徴付けを用いて，初等的な結果を得る．
\end{tcolorbox}

\begin{definition}[convex hull, symmetric convex hull]
    $\F\subset\Meas(\X,\R)$に対して，
    \begin{enumerate}
        \item $\Conv\F:=\Brace{f=\sum^m_{i=1}\al_if_i\in\Meas(\X,\R)\;\middle|\; f_i\in\F,\al_i\in\R_+,\sum_{i=i}^m\al_i\le 1}$を\textbf{凸包}という．
        \item $\Sconv\F:=\Brace{f=\sum^m_{i=1}\al_if_i\in\Meas(\X,\R)\;\middle|\; f_i\in\F,\al_i\in\R,\sum_{i=i}^m\abs{\al_i}\le 1}$を\textbf{対称凸包}という．
    \end{enumerate}
\end{definition}
\begin{remark}
    通常の凸包の定義と違い，「原点も含んだ最小の凸集合」を定めている．
    $A$の対称凸包とは，原点について対称な集合$A'$と，原点とを併せた$A\cup A'\cup\{0\}$を含む最小の凸集合に等しい．
\end{remark}

\begin{proposition}\label{prop-Donsker-preservation-1}
    $\F$を$P$-Donskerクラスとする．
    \begin{enumerate}
        \item $\cG\subset\F$は$P$-Donskerである．
        \item $\o{\F}^{P,2}$は$P$-Donskerである．
        \item $\o{\Sconv\F}^{P,2}$は$P$-Donskerである．
    \end{enumerate}
\end{proposition}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item (1)：クラス$\F$が$d_P$に関して全有界ならば，$\cG$も全有界．(2)の漸近的同程度連続性も，$\forall_{\delta_n\searrow0}\;\norm{\G_n}_{\cG_{\delta_n}}\le\norm{\G_n}_{\F_{\delta_n}}\xrightarrow{P^*}0$からわかる．
        \item \begin{description}
            \item[全有界] $\F$が全有界ならば$\o{\F}^{P,2}$も全有界．
            \item[漸近的同程度連続] クラス$\F$は平均$0$のクラスであり，したがって$\rho_2=d_P$であると仮定しても一般性は失われない．
            実際，$E[\G]=:c\in\R$としたとき，$\F$がDonskerであることと，$\F-c$がDonskerであることは同値である．
            よって，$\rho_P$-セミノルムの代わりに，$L_2(P)$-ノルムで考える．
            
            $\cG\subset\Meas(\X,\R)$の連続度を
            \[w_\cG(\delta):=\sup_{f,g\in\cG,\norm{f-g}_{P,2}<\delta}\abs{\G_n(f-g)}\]
            と定める．
            $\forall_{\delta>0}\;w_{\o{F}^{P,2}}(\delta)\le w_F(2\delta)$を示せば，$\F$の漸近的同程度連続性から$\o{F}^{P,2}$の漸近的同程度連続性が従う．
            任意に$\delta>0,\ep>0$を取る．
            するとまず，連続度の定義より，$\norm{f-g}_{P,2}<\delta$を満たす$f,g\in\o{\F}^{P,2}$が存在して，
            \[w_{\o{F}^{P,2}}(\delta)-\abs{\G_n(f-g)}<\frac{\ep}{3}\]
            をみたす．次に，$\o{F}^{P,2}$は$L_2(P)$-閉包に含まれるから，$\norm{f-f_*}_{P,2}<\frac{\delta}{2},\norm{g-g_*}_{P,2}<\frac{\delta}{2}$を満たす$f_*,g_*\in\F$が存在して，
            \[\abs{\G_n(f-f_*)}<\frac{\ep}{3},\quad\abs{\G_n(g-g_*)}<\frac{\ep}{3},\]
            を満たす．このとき，$\norm{f_*-g_*}_{P,2}\le 2\delta$である．
            よって，
            \begin{align*}
                w_{\o{F}^{P,2}}(\delta)-\G_n(f_*-g_*)&=\Abs{w_{\o{F}^{P,2}}(\delta)-\G_n(f-g)+\G_n(f-f_*)+\G_n(g-g_*)}\\
                &\le\Abs{w_{\o{F}^{P,2}}(\delta)-\G_n(f-g)}+\abs{\G_n(f-f_*)}+\abs{\G_n(g-g_*)}<\ep.
            \end{align*}
            すなわち，$w_{\o{F}^{P,2}}(\delta)\le\G_n(f_*-g_*)+\ep\le w_F(2\delta)$．$\ep>0$は任意としたから，$w_{\o{F}^{P,2}}(\delta)\le w_F(2\delta)$を得る．
        \end{description}
        \item $\{\psi_i\}$を$\F$を含む$L_2(P)$部分空間$V$の直交基底とし，$Z_1,Z_2,\cdots$を標準正規分布に従うi.i.d.な確率変数とする．
        \begin{enumerate}[(a)]
            \item $\F$は特にpre-Gaussianだから，$f\mapsto\sum_{i=1}^\infty(P(f-Pf)\psi_i)Z_i\in l^\infty(\F)$は一様収束極限で，あるタイトなBrown橋を表現する．
            \item したがって，$\G_k:=\sum_{i=1}^k(P(f-Pf)\psi_i)Z_i$と定めると，$\norm{\G_k-\G_l}_{\o{\Sconv\F}}=\norm{\G_k-\G_l}_\F\xrightarrow[k,l\to\infty]{\as}$であるから，列$(\G_k)_{k\in\N}$は$l^\infty(\o{\Sconv\F})$上でも至る所Cauchy列であるから，共通の極限$\G$に概収束する．
            各$\G_k$は線型汎函数で$\o{\Sconv\F}$上$\rho_P$-一様連続であるから，$\G$も同じ性質を確率１で満たす．
            よって，$\o{\Sconv\F}$はpre-Gaussianである．
            \item 概表現定理1.10.4より，確率空間$(\Om,\U,P)$と完全写像$\phi_n:\Om\to\X^n$と$\phi:\Om\to$が存在して，
            \[\Norm{\frac{1}{\sqrt{n}}\sum^n_{i=1}\paren{f(\phi_n(\om)_i)-Pf}-\G(f,\phi(\om))}_\F\xrightarrow{\as^*}0.\]
            これは$\F$を$\o{\Sconv\F}$としても成り立つ．すなわち，$\G$という一様連続な見本過程に，$l^\infty(\o{\Sconv\F})$上外概収束する経験過程のバージョンが存在する．これは$\o{\Sconv\F}$がDonskerであることに他ならない．
        \end{enumerate}
    \end{enumerate}
\end{proof}
\begin{remarks}
    (1),(2)は$l^\infty(\F)$上の$*$-弱収束の特徴付け\ref{cor-characterization-of-weak-convergence-of-stochastic-process-2}（任意の周辺分布が収束し，漸近的同程度連続）からすぐに従う．
    議論は，新たなクラスでも連続度が変わらないことから従う．

    $\F$がpre-Gaussianとは，一様中心極限定理$\G_n:=\sqrt{n}(\bP_n-P)\Rightarrow\G\in l^\infty(\F)$を満たすような確率変数$\G:\Om\to l^\infty(\F)$が存在する，すなわち，
    平均$0$共分散$E[\G f\G g]$のGauss過程はKolmogorovの拡張定理により常に存在するが，そのタイトでBorle可測なバージョン$\Om\to l^\infty(\F)$がある確率空間$\Om$上に存在することをいう．
    $\F$がpre-Gaussianであることは，$(\F,\rho_P)$が全有界であり，かつ，$\G$のバージョンであって見本過程$f\mapsto\G(f)$が一様$\rho_P$連続であるものが存在することに同値．
    $\F$がDonskerであるためには（すなわち，その極限過程$\G$に実際に弱収束するには），$\F$がpre-Gaussianであることに加えて，漸近的タイトであることが必要．
    ２つ併せると悪名高い漸近的同程度連続性となる．
\end{remarks}

\begin{theorem}[almost sure representation theorem]
    $X_\al:\Om_\al\to D$をネットとし，極限$X_\infty$をBorel可測で可分な確率変数とする．$X_\al\Rightarrow X_\infty$と弱収束するならば，ある確率空間$(\o{\Om},\o{\A},\o{P})$とネット$\o{X}_\al:\o{\Om}\to D$が存在して，
    \begin{enumerate}
        \item $\o{X}_\al\xrightarrow{\au}X_\infty$，
        \item $\forall_{f\in l^\infty(D)}\;\forall{\al\in\Lambda}\;E^*[f(\o{X}_\al)]=E^*[f(X_\al)]$．
    \end{enumerate}
\end{theorem}

\subsection{更なる構成}

\begin{theorem}
    クラス$\F_1,\cdots,\F_k\subset\Meas(\X,\R)$は$P$-Donskerで，$\max_{1\le j\le k}\norm{P}_{\F_j}<\infty$を満たすとし，関数$\phi:\R^k\to\R$は
    \[\forall_{f,g\in\F_1\times\cdots\times\F_k}\;\forall_{x\in\X}\;\exists_{c\in\R}\quad\abs{\phi\circ f(x)-\phi\circ g(x)}\le c^2\sum^k_{i=1}(f_i(x)-g_i(x))^2\]
    を満たすとする．
    このとき，$\exists_{f\in\F_1\times\cdots\times\F_k}\;\norm{\phi\circ f}_{P,2}<\infty$を満たすならば，
    クラス
    \[\phi\circ(\F_1,\cdots,\F_k)=\Brace{\phi\circ f\in\Meas(\X,\R)\mid f:=(f_1,\cdots,f_k)\in\F_1\times\cdots\times\F_k}\]
    は$P$-Donskerである．
\end{theorem}
\begin{remark}
    条件$\max_{1\le j\le k}\norm{P}_{\F_j}<\infty$が満たされるとき，系\ref{cor-characterization-of-Donsker-classes-2}より，$\F_i$はそれぞれ2-ノルム$\norm{-}_{P,2}$に関して全有界，特に有界であることに注意．

\end{remark}

\begin{corollary}
    $\F,\cG$を$P$-Donskerクラスとする．
    \begin{enumerate}
        \item $\F\cup\cG,\F+\cG$は$P$-Donskerである．
        \item $\norm{P}_{\F\cup\cG}<\infty$ならば，$\F\land\cG,\F\lor\cG$は$P$-Donskerである．
        \item $\F,\cG$が共に一様有界ならば，$\F\cdot\cG$は$P$-Donskerである．
        \item $R:=\cup_{f\in\F}\Im f$の閉包上の関数$\psi:\o{R}\to\R$はLipschitz連続であるとする．$\exists_{f\in\F}\;\norm{\psi\circ f}_{P,2}<\infty$ならば，$\psi\circ\F$は$P$-Donskerである．
        \item $\norm{P}_\F<\infty$ならば，任意の有界な可測関数$g$に対して，$\F\cdot g$は$P$-Donskerクラスである．
    \end{enumerate}
\end{corollary}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item $f\in\Meas(\X,\R)$に対して，$\dot{f}:=f-Pf$とおく．
        $\dot{\F}:=\Brace{\dot{f}\in\Meas(\X,\R)\mid f\in\F}$と表すと．$\G_n\dot{f}=\G_nf-\G_n(Pf)=\G_nf$より，$\F\cup\cG,\F+\cG$がDonskerであることと$\dot{\F}\cup\dot{\cG},\dot{\F}+\dot{\cG}$がDonskerであることは同値．
        \begin{enumerate}
            \item いま，$\forall_{f\in\dot{\F}\cup\dot{\cG}}\;P\dot{f}=Pf-P(Pf)=0$より，$\norm{P}_{\dot{\F}}=\norm{P}_{\dot{\cG}}=\norm{P}_{\dot{\F}\cup\dot{\cG}}=0$．
            \item Lipschitz関数$+:\R^2\to\R$について，$+\circ(\dot{\F},\dot{\cG})$を考えれば良い．
            \item $\norm{P}_{\dot{\F}\cup\dot{\cG}}=0<\infty$であるから，$\dot{F}$は$L_2(P)$-ノルムについて全有界，特に有界である（Donskerクラスの特徴付け\ref{cor-characterization-of-Donsker-classes-2}）．
            よって，三角不等式より，$\norm{f+g}\le\norm{f}+\norm{g}<\infty$より，３つ目の条件も確かに満たされている．
        \end{enumerate}
        $\dot{\F}\cup\{0\}\subset\o{\Sconv\dot{\F}}^{P,2}$もDonskerである\ref{prop-Donsker-preservation-1}(3)ことより，
        $\dot{\F}\cup\dot{\cG}\subset(\dot{\F}\cup\{0\})+(\{0\}\cup\dot{\cG})$より，$\dot{\F}\cup\dot{\cG}$も$\F\cup\cG$もDonsker．
        \item \begin{enumerate}[(a)]
            \item $\max\brace{\norm{P}_{\F\land\cG},\norm{P}_{\F\lor\cG}}\le\norm{P}_{\F\cup\cG}<\infty$．
            \item $f=(f_1,g_1),g=(f_2,g_2)\in\F\times\cG$とし，
            $\phi(f(x))=\max\{f_1(x),g_1(x)\}$とおく．すると，
            $\abs{\phi(f(x))-\phi(g(x))}^2\le\norm{f-g}^2_{l^2}$は明らか．
            \item $\norm{\phi(f)}_{P,2}=\max{\norm{f_1}_{P,2},\norm{g_1}_{P,2}}<\infty$．
        \end{enumerate}
        \item \begin{enumerate}[(a)]
            \item $\exists_{c_1,c_2\in\R}\;c_1<\F\cup\cG<c_2$より，$\max\{\norm{P}_\F,\norm{P}_\cG\}\le\max\{\abs{c_1},\abs{c_2}\}$．
            \item 乗算$\cdot:\R^2\to\R$は有界集合$[c_1,c_2]^2$に制限するとLipschitz連続である．
            \item $\norm{\phi(f)}_{P,2}\le\norm{f_1}_{P,2}\norm{g_1}_{P,2}\le\max\{\abs{c_1},\abs{c_2}\}^2$
        \end{enumerate}
        \item a
        \item $f_1,f_2\in\F$について，$\abs{f_1(x)g(x)-f_2(x)g(x)}\le\norm{g}_\infty\abs{f_1(x)-f_2(x)}$より，Lipschitz連続性を満たし，$\norm{f\cdot g}_{P,2}<\infty$もみたす．
    \end{enumerate}
\end{proof}

\section{BUEIクラスとPEクラスの構成}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    有界な一様エントロピー積分を持つクラス(Bounded Uniform Entropy Integral)と各点可測(Pointwise Measurable)なクラスの構成は並行に行える．
    前者はVCクラスを含む．VCクラスがDonskerであるためには，各点可測性さえ満たせば良い．
\end{tcolorbox}

\section{クラスの例とエントロピー評価}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    VC理論は60-90にVladimir VapnikとAlexey Chervonenkisによって創られた統計的学習理論で，DudleyとVapnikが後に経験過程論にも応用した．
    Vapnikはサポートベクトルマシンの発明者でもある．
    エントロピー評価によって，その経験過程がどのクラスに属するかが判る．
\end{tcolorbox}

\subsection{Vapnik-\v{C}ervonenkis class}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    VC classという組み合わせ論的に定義されるクラスについては，
    被覆数の増大が多項式で抑えられるので，
    一様エントロピー積分の条件が満たされる．
    
    集合系$\C\subset P(X)$がVCクラスであるとは，分解性能が高すぎないことをいう．
\end{tcolorbox}

\begin{definition}[VC class: pick out, shatter, VC-index]
    集合族$\cC\subset P(\X)$について，VC次元$V:P(\X)\to\N\cup\{\infty\}$を定義する．$n\ge 1$とする．
    \begin{enumerate}
        \item 有限部分集合$A\subset\{x_1,\cdots,x_n\}\subset\X$について，$\exists_{C\in\cC}\;A=C\cap\{x_1,\cdots,x_n\}$を満たすとき，$\cC$は$A$を\textbf{抽出する}という．
        \item 各有限部分集合$\{x_1,\cdots,x_n\}$について，$\cC$によって抽出される部分集合の個数を$\Delta_n(\cC;x_1,\cdots,x_n)$で表す．\\$\Delta_n(\cC;x_1,\cdots,x_n)=2^n$であるとき，$\cC$は$\{x_1,\cdots,x_n\}$を\textbf{完全分解}するという．
        \item \begin{align*}
            V(\cC)&:=\min\Brace{n\in\N\mid\forall_{\{x_1,\cdots,x_n\}\subset\X}\;\Delta_n(\cC;x_1,\cdots,x_n)<2^n}\\
            &=\min\Brace{n\in\N\mid\text{どの大きさ}n\text{の有限部分集合}\{x_1,\cdots,x_n\}\subset\X\text{も}\cC\text{によって完全分解されない}}\\
            &=\sup\Brace{n\in\N\mid\exists_{\{x_1,\cdots,x_n\}\subset\X}\;\Delta_n(\cC;x_1,\cdots,x_n)=2^n}
        \end{align*}
        を\textbf{VC次元}という．なお，右辺が空集合である時は$V(\cC)=\infty$とおく．
        \item $V(\cC)<\infty$を満たす$\cC$を\textbf{VCクラス}という．
    \end{enumerate}
\end{definition}

\begin{example}
    $\X=\R^d$の部分集合族$\cC=((-\infty,c])_{c\in\R^d}$のVC-指数は$d+1$，$\cC=((a,b])_{a,b\in\R^d}$のVC-指数は$2d+1$となる．
    ただし，$a={}^t\!(a_1,\cdots,a_d),b={}^t\!(b_1,\cdots,b_d)$について$((a,b])$とは，$(a,b]=(a_1,b_1]\times\cdots\times(a_d,b_d]$を表す．
    \begin{enumerate}
        \item $\X=\R$の部分集合族$\cC:=((-\infty,c])_{c\in\R}$を考えると，$n=0,1$の場合は完全分解するが，$n=2$のとき，$\{x_1,x_2\}\subset\R\;(x_1<x_2)$について，$\{x_2\}\subset\{x_1,x_2\}$を抽出できない．よって，$V(\cC)=2$．
        \item $\X=\R$の部分集合族$\cC:=((a,b])_{a,b\in\R}$を考えると，$n=0,1,2$の場合は完全分解する．$n=3$の場合は$\{x_1,x_2,x_3\}\subset\R\;(x_1<x_2<x_3)$について，$\{x_2\}\subset\{x_1,x_3\}$を抽出できない．よって，$V(\cC)=3$．
    \end{enumerate}
\end{example}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item $n$元の部分集合$\Brace{\begin{pmatrix}x_1^1\\\vdots\\x_d^1\end{pmatrix},\cdots,\begin{pmatrix}x_1^n\\\vdots\\x_d^n\end{pmatrix}}$であって，辞書式順序について$\begin{pmatrix}x_1^1\\\vdots\\x_d^1\end{pmatrix}<\cdots<\begin{pmatrix}x_1^n\\\vdots\\x_d^n\end{pmatrix}$を満たすとする．
        $n\le d$のとき，
    \end{enumerate}
\end{proof}

\begin{example}\mbox{}
    \begin{enumerate}
        \item $\R^d$の半空間の全体$\cC:=\Brace{x\in\R^d\mid\brac{x,u}\le c}_{u\in\R^d,c\in\R}$は，$V(\cC)=d+2$を満たすVC-クラスである．
        \item $\R^d$の閉球の全体$\cC:=\Brace{x\in\R^d\mid\norm{x-u}\le c}_{u\in\R^d,c\in\R_{\ge0}}$は，$V(\cC)\le d+3$を持つVC-クラスである．
    \end{enumerate}
\end{example}

\begin{notation}
    $\X$の可測集合の族$\cC$に対応する定義関数のクラスを$1_{\{\cC\}}:=\Brace{1_C(x)\in\Meas(\X,\R)\mid C\in\cC}$と表す．
    また定理の証明中では，$\cC$自体と適宜同一視する．
\end{notation}

\begin{theorem}
    ある実数$K\in\R$が存在して，任意の$\cC$がVC-クラスと，任意の確率測度$Q$と実数$r\ge 1,0<\ep<1$について，
\[N(\ep,1_{\{\cC\}},L_r(Q))\le K\cdot V(\cC)(4e)^{V(\cC)}\paren{\frac{1}{\ep}}^{r(V(\cC)-1)}.\]
\end{theorem}

\begin{example}
    $F:=1$は$1_{\{\cC\}}$の可積分な包絡関数だから，
    \begin{enumerate}[(a)]
        \item 一様被覆数は$\forall_{\ep>0}\;\sup_{Q\in\cQ_{F,1}}N(\ep\norm{F}_{Q,1},1_{\{\cC\}},L_1(Q))<\infty$より，$1_{\{\cC\}}$は$P$-Glivenko-Cantelliである\ref{thm-Glivenko-Cantelli-2}．
        \item 一様エントロピー積分について
        \begin{align*}
            J(1,1_{\{\cC\}},L_2)&=\int^1_0\sqrt{\log\sup_{Q\in\cQ_{F,2}}N(\ep\norm{F}_{Q,2},1_{\{\cC\}},L_2(Q))}d\ep\\
            &\le\int^1_0\sqrt{\log K\cdot V(\cC)(4e)^{V(\cC)}(1/\ep)^{2(V(\cC)-1)}}d\ep\\
            &=\int^1_0\sqrt{\log K\cdot V(\cC)(4e)^{V(\cC)}+2(V(\cC)-1)\log(1/\ep)}d\ep\\
            &\le\int^1_0\log K\cdot V(\cC)(4e)^{V(\cC)}d\ep+\int^1_0\sqrt{2(V(\cC)-1)\log(1/\ep)}d\ep&\because\text{関数}y=\sqrt{x}\text{は上に凸}\\
            &=A+B\int^1_0\sqrt{\log(1/\ep)}d\ep\qquad(A,B\in\R)
        \end{align*}
        と評価でき，$x:=\log(1/\ep)$と置換することにより，
        \begin{align*}
            \int^1_0\sqrt{\log(1/\ep)}d\ep=\int_0^\infty x^{1/2}e^{-x}dx=\Gamma\paren{\frac{3}{2}}=\frac{1}{2}\Gamma\paren{\frac{1}{2}}=\frac{\sqrt{\pi}}{2}.
        \end{align*}
        とわかるから，$J(1,1_{\{\cC\}},L_2)<\infty$．よって，
        $(1_{\{\cC\}})_\delta,(1_{\{\cC\}})_\infty^2\;(\delta\in(0,\infty])$が$P$-可測ならば，
        $1_{\{\cC\}}$はDonskerでもある\ref{thm-Donsker-1}．
    \end{enumerate}
    VCクラスは漸近的可測性に関する条件を満たせば，十分余裕を持って，普遍Donskerである．
\end{example}

\subsection{定理の証明}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    経験測度が任意の確率測度に収束することが大きい．
    議論を経験測度に限れば，これは所詮離散分布であるため，事象をうまく設定しなおせば一様測度に均すことが出来る．

\end{tcolorbox}

\begin{lemma}[Sauer's lemma]\mbox{}
    \begin{enumerate}
        \item $n$元集合$\{x_1,\cdots,x_n\}\subset\X$について，
        \[\Delta_n(\cC;x_1,\cdots,x_n)\le\Abs{\Brace{A\in P(\{x_1,\cdots,x_n\})\mid\Delta_m(\cC;A)=2^m,m\le n}}\]
        \item (Sauer's lemma) \[\max_{x_1,\cdots,x_n\in\X}\Delta_n(\cC;x_1,\cdots,x_n)\le\sum^{V(\cC)-1}_{j=0}\begin{pmatrix}n\\j\end{pmatrix}.\]
        \item \[\forall_{n\ge V(\C)-1}\quad\max_{x_1,\cdots,x_n\in\X}\Delta_n(\cC;x_1,\cdots,x_n)\le\paren{\frac{ne}{V(\cC)-1}}^{V(\cC)-1}.\]
    \end{enumerate}
\end{lemma}
\begin{remarks}
    今後度々使う手法として，「遺伝的集合」と呼ばれるような集合系$\C$に議論を還元する手法を整備する．
    遺伝的集合$\C$を符号化すると，$\{0,1\}^n$に一対一対応させることができる．
\end{remarks}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item \begin{enumerate}[(a)]
            \item $\X$を$\X':=\{x_1,\cdots,x_n\}$と取り直し，$\C$を$\C':=\Brace{C'\in P(\{x_1,\cdots,x_n\}\mid C'=C\cap\X',C\in\C}$と取り直すことより，任意の$A\subset\{x_1,\cdots,x_n\}$について$A\cap C=A\cap C'$なので，
            $\C$が$\Delta_n(\C;x_1,\cdots,x_n)=\abs{\C}$を満たすと仮定しても，一般性を失わない．
            \item 集合系$\C$が遺伝的であるとき，すなわち，$\forall_{C\in\C}\;B\subset C\Rightarrow B\in\C$をみたすとき，$\C$の元はすべて完全分解されるから，不等式は必ず成立する．
            問題は一般の集合系$\C$についてであるが，濃度$\abs{\C}$と，完全分解される$A\subset\{x_1,\cdots,x_n\}$の数とを変えない集合系$\D\subset P(\{x_1,\cdots,x_n\})$であって遺伝的であるものに変換できることを示せば良い．
            \item 写像$T_i:\C\to P(\{x_1,\cdots,x_n\})\;(1\le i\le n)$を，
            \[T_i(C):=\begin{cases}
                C\setminus\{x_i\},&C\setminus\{x_i\}\notin\C,\\
                C,&C\setminus\{x_i\}\in\C.
            \end{cases}\]
            で定めると，これは単射である．また，任意の$A\subset\{x_1,\cdots,x_n\}$について，$A$が$\C$によって完全分解されることと，$T_i(\C)$によって完全分解されることは同値である．
            実際，$x_i\notin A$ならば，$T_i$は$\C$の各要素について$x_i$が属するかのみを変化させるので，$\forall_{C\in\C}\;C\cap A=T_i(C)\cap A$より，$A$を完全分解する性質は変えない．
            $x_i\in A$のとき，$\C$が$A$を完全分解するならば，$\forall_{B\subset A}\;\exists_{C\in\C}\;C\cap A=B$である．$C\setminus\{x_i\}\in\C$のとき，$T_i(C)=C$より，これが$B$を抽出する．$C\setminus\{x_i\}\notin\C$のとき，$T_i(C)=C\setminus\{x_i\}$で，
            $T_i(C)\cap A=B\setminus\{x_i\}\ne B$であるが，$A$は$\C$によって完全分解されるから，ある$C'\in\C$が存在して，$C'\cap A=B\setminus\{x_i\}$．この$C'$は$x_i\notin C'$より，$C'\setminus\{x_i\}=C'\in\C$だから，$T_i(C')=C'\in\Im T_i$．よって，$T_i(\C)$も任意の$B\subset A$を抽出する．
            逆に$T_i(\C)$が$A$を完全分解する時，$\forall_{B\subset A}\;\exists_{C\in\C}\;T_i(C)\cap A=B\cup\{x_i\}$である．このとき$x_i\in T_i(C)$だから，$T_i(C)=C$かつ$C\setminus\{x_i\}\in\C$．よって，$C\cap A=B\cup\{x_i\},(C\setminus\{x_i\})\cap A=B\setminus\{x_i\}$．
            よって，$x_i\in B$が成り立つかの如何に依らず，任意の$A$の部分集合$B\subset A$抽出できる．
            \item したがって，一般の$\C$が(1)を満たすことは，$T_1(\C)$が満たすことに同値．これを繰り返すことで，$T:=T_n\circ\cdots\circ T_1$について，$T(\C)$が満たすことに同値．
            $T:P(\{x_1,\cdots,x_n\})\to P(\{x_1,\cdots,x_n\})$は不動点$\D$を持ち，これは遺伝的になる．
        \end{enumerate}
        \item $V(\C)$元以上の集合は，いずれも完全分解されない．したがって，$\min\{V(\C)-1,n\}$元以下の集合の総数によって抑えられる．
        \item 次の評価と(2)より．$S:=V(\C)-1$とおく．
        \begin{align*}
            \sum^S_{i=0}\begin{pmatrix}n\\i\end{pmatrix}&\le\sum^S_{i=0}\begin{pmatrix}n\\i\end{pmatrix}\paren{\frac{n}{S}}^{S-i}&\because S\le n\\
            &\le\sum^n_{i=0}\begin{pmatrix}n\\i\end{pmatrix}\paren{\frac{n}{S}}^{S-i}&\because S\le n\\
            &\le\paren{\frac{n}{S}}^S\sum^n_{i=0}\begin{pmatrix}n\\i\end{pmatrix}\paren{\frac{S}{n}}^i\\
            &\le\paren{\frac{n}{S}}^S\paren{1+\frac{S}{n}}^n<\paren{\frac{n}{S}}^S e^S&\because\text{二項定理}
        \end{align*}
    \end{enumerate}
\end{proof}
\begin{remarks}
    $\Delta_n(\cC;x_1,\cdots,x_n)<2^n$ならば，特に多項式オーダーで抑えられる．
    そもそも，完全分解可能な集合の最大濃度は多項式オーダーで増加することが組み合わせ論的に解っている．
    ここに二項係数が現れる理由は(1)にて，$S$元集合の大きさ$n$以下の冪集合の数を数え上げているためである．
\end{remarks}

\begin{lemma}
    $\F\subset\Meas(\X,\R)$は，ある経験測度$Q$と関数$g:(0,1)\to\R$について，$\forall_{\ep\in(0,1)}\;D(\ep,\F,L_r(Q))\le g(\ep)$を満たすとする．
    このとき，任意の確率測度$Q$について，同様の不等式が成り立つ．
\end{lemma}
\begin{proof}\mbox{}
    \begin{description}
        \item[パッキング数は有限である] 任意の$\ep>0$と確率測度$P$について，パッキング数は有限であるから，$D(\ep,\F,L_r(P))=m\in\N$とする．
        仮に有限でないとすると，任意の$f\in\F$について，大数の強法則より，$\bP_n\abs{f}^r\xrightarrow{\as}P\abs{f}^r$より，$\forall_{f\in\F}\;\norm{f}_{L_r(\bP_n)}\to\norm{f}_{L_r(P)}$であるから，
        任意の$m\in\N$に対して，十分大きな$n\in\N$と$X_1,\cdots,X_n\in\X$が存在して，
        $L_r(\bP_n)$ノルムについて，$\F$では$\ep$-分離的な$m$点が取れる．
        $\ep$-分離的な$m$点$f_1,\cdots,f_m$について，
        $d:=\min_{i\ne j\in[m]}(\norm{f_i-f_j}_{L_r(P)}-\ep)>0$とし，$\max_{i,j\in[m]}\abs{\norm{f_i-f_j}_{L_r(\bP_N)}-\norm{f_i-f_j}_{L_r(P)}}<d\;(N\ge n)$となる$n$を取れば，
        この$m$点$f_1,\cdots,f_m$はノルム$L_r(\bP_n)$が定める距離に関して引き続き$\ep$-分離的である．
        しかしこれは，$D(\ep,\F,L_r(\bP_n))\le g(\ep)<\infty$に矛盾．
        よって，パッキング数は有限．
        \item[証明] 任意の確率測度$P$について，$D(\ep,\F,L_r(P))=m\in\N$のとき，$m\le g(\ep)$であることを示す．
        パッキング数の定義より，$m$個の点$f_1,\cdots,f_m\in\F$が取れて，$P\abs{f_i-f_j}^r>\ep^r\;(i\ne j)$を満たす．
        大数の強法則より，$\bP_n\abs{f_i-f_j}^r\xrightarrow{\as}P\abs{f_i-f_j}^r$であるから，ある$n\in\N,X_1,\cdots,X_n\in\X$が存在して，
        $\bP_{X_1,\cdots,X_n}\abs{f_i-f_j}^r>\ep^r$が成り立つ．
        したがって，$f_1,\cdots,f_m$は$L_r(\bP_n)$ノルムについても$\ep$-分離的である．
        よって，$m\le D(\ep,\F,L_r(\bP_n))\le g(\ep)$．
    \end{description}
\end{proof}

\begin{notation}[グラフ]\mbox{}
    \begin{enumerate}
        \item 集合$A$に対して，$[A]^k\subset P(A)$を，$A$の部分集合であって$k$元よりなるもの全体からなる集合とする．
        \item 有向グラフ$G=(V,E)$に対して，$E(v)$とは，点$v\in V$から出る辺全体からなる集合とする．
    \end{enumerate}
\end{notation}

\begin{lemma}
    $\cZ\subset\{0,1\}^n$を集合$\{x_1,\cdots,x_n\}$上のVCクラス$\C$の符号化（特性関数のグラフと同一視したもの）とする．
    \begin{enumerate}
        \item $\cZ$が定めるグラフ$G=(V,E)$には，任意の頂点に対して，多くとも$V(\C)-1$の辺が出ているような，すなわち$\forall_{z\in V}\;\abs{E(z)}<V(\C)$を満たすように向きを入れることが出来る．
        \item $Z:\Om\to\cZ$を確率変数とする．
        このとき，次が成り立つ：
        \[\sum^n_{i=1}E[\Var[Z_i|Z_j,j\ne i]]\le V(\C)-1.\]
    \end{enumerate}
\end{lemma}
\begin{remarks}
    (1)の組み合わせ論的な結果を使えば(2)の証明は速いが，(1)と独立にも示せる．
\end{remarks}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item 略．遺伝的な場合に議論を還元し，Hallの結婚定理を適用する．
        \item \begin{description}
            \item[分散の評価] $v,w\in\cZ$はHamming距離が$1/n$であるとする．すなわち，ある$i\in[n]$が存在して，$v_i=0,w_i=1,v_j=w_j\;(j\ne i)$を満たすとき，
            分布$P$の密度関数を$p(z):=P(Z=z)$と表すとすると，確率変数$Z_i:\Om\to\{0,1\}$は，$p:=\frac{p(w)}{p(v)+p(w)}$についてのBernoulli変数であるから，その分散は$\Var[Z_i|Z_j,j\ne i]=p(1-p)$．

            仮に，Hamming距離が$1/n$となる２点が$\cZ$内に存在しないとする．$m:=\min\Brace{d(w,z)\in[0,1]\mid w,z\in\cZ,w\ne z}$とし，$d(v,w)=m$とする．
            このとき，$v,w$で値が異なる$nm$個の成分の集合を$J\subset[n]$とすると（$\forall_{j\in J}\;v_j\ne w_j$），やはり$\Var[Z_i|Z_j,j\notin J]=p(1-p)$となる．
            （この場合は$\Var[Z_i|Z_j,j\ne i]=0$だから考えなくてよい\textcolor{red}{？}）
            \item[和の評価]
            $\cZ\subset\{0,1\}^n$は，$\{0,1\}^n$を$n$-次元立方体のなすグラフとみると，その部分グラフ$G=(V,E)$を，
            \begin{align*}
                E&:=\Brace{\{w,z\}\in[\cZ]^2\mid d(w,z)=m},&V&:=\Brace{z\in\Z\mid\exists_{w\in\Z}\;d(w,z)=m},
            \end{align*}
            によって定める．$E_i:=\Brace{(w,z)\in E\mid w_i\ne z_i}\;(i\in[n])$とする．ただし，$[\Z]^2:=\{A\in P(\Z)\mid\abs{A}=2\}$とした．

            このとき，
            \begin{align*}
                \sum^n_{i=1}E[\Var[Z_i|Z_j,i\ne j]]&\sum^n_{i=1}\sum_{\{v,w\}\in E_i}(p(v)+p(w))\frac{p(v)}{p(v)+p(w)}\frac{p(w)}{p(v)+p(w)}=\sum^n_{i=1}\sum_{\{v,w\}\in E_i}\frac{p(v)p(w)}{p(v)+p(w)}\\
                &\le\sum_{\{v,w\}\in E}p(v)\land p(w)
            \end{align*}
            と評価できるが，(1)より，$\forall_{z\in\Z}\;E(z)\le V(\C)-1$を満たすような向きをグラフ$G$に入れられるから，これについて
            \[\sum_{\{v,w\}\in E}p(v)\land p(w)=\sum_{z\in V}\sum_{(z,w)\in E}p(v)\land p(w)\le V(\C)-1\]
            と評価できる．
            ただし，グラフ$G$について，$E(v)$を点$v$から出る辺全体の集合とした．

            一方で，(1)の事実を使わなくとも証明できる．
            \item[(1)の別導出]
            \begin{enumerate}[(a)]
                \item $\C$が遺伝的である場合を考える．
                $V$に定まる順序$v<w:\Leftrightarrow \forall_{i\in[n]}\;v_i<w_i$について，$(v,w)\in E:\Leftrightarrow v>w$によって向きが定まり，$\abs{E(v)}\le V(\C)-1$を満たす．
                実際，$\C$が遺伝的である場合は$m=1$で$V=\Z$となり，$<$は$V$上にたしかに順序を定め，また$\C$は遺伝的であるから，$\{w\in\Z\mid (z,w)\in E\}\cup\{z\}\in\C$は完全分解されるため，$\abs{\{w\in\Z\mid (z,w)\in E\}\cup\{z\}}\le V(\C)$．
                \item 
            \end{enumerate}
        \end{description}
    \end{enumerate}
\end{proof}

\begin{theorem}
    ある実数$K\in\R$が存在して，任意のVC-クラス$\cC$と，任意の確率測度$Q$と実数$r\ge 1,0<\ep<1$について，
\[N(\ep,1_{\{\cC\}},L_r(Q))\le K\cdot V(\cC)(4e)^{V(\cC)}\paren{\frac{1}{\ep}}^{r(V(\cC)-1)}.\]
\end{theorem}
\begin{remarks}
    実は，$r=1$で$Q$は経験測度の場合のみについて示せば十分である．
    経験測度は，これを定める標本$X_1,\cdots,X_n$に注目することにより，$[n]$上の一様分布と等価になり，この上に等長同型な空間$(\wt{C},L_1(\wt{Q}))$を構成できる．
    そこで，この自然数上の一様測度（離散空間$2^n$上のHamming距離に等価）に限って考えればよく，ここまで還元されるとパッキング数を使った組み合わせ論的な議論がしやすい．
    なぜならば，「抽出」が射影によって表現できることが非常に議論を簡明にする．
    評価の途中で分散に注目する手法の要諦はまだ見えない．
\end{remarks}
\begin{proof}\mbox{}
    \begin{description}
        \item[証明の方針] \mbox{}
        \begin{enumerate}
            \item $1_{\{\cC\}}$の元である定義関数について，ノルムは
            \[\forall_{C,D\in\C}\quad\norm{1_C-1_D}_{Q,r}=\paren{\int\abs{1_C-1_D}^rdQ^{1/r}}=(Q(C\triangle D))^{1/r}\]
            と表わせ，$\Im Q\subset[0,1]$なので，$r$が大きくなるほど$\norm{1_C-1_D}_{Q,r}$は単調に増加する．
            したがって，$r=1$の場合について示せば十分．
            \item 補題より，$Q$は任意の経験測度として示せば十分である．
            そこで，$Q$は$\{y_1,\cdots,y_k\}\subset\X$に，値$Q(\{y_i\})=\frac{l_i}{n}\;(l_i\in\N_{>0})$を持つとする．
            このとき，$\C$を$\C':=\Brace{C'\in P(\{y_1,\cdots,y_k\})\mid C'=C\cap\{y_1,\cdots,y_k\},C\in\C}$と取り直すことで，
            $\C\subset P(\{y_1,\cdots,y_k\})$であるとして証明すれば十分である．
            実際，この場合について$N(\ep,1_{\{\C'\}},L_1(Q))=N\in\N$ならば，
            全く同じ$N$個の$\ep$-球について$1_{\{\C\}}$も被覆されるから，$N(\ep,1_{\{\C\}},L_1(Q))=N$である．
            以降，この意味での$\C'$を$\C$と表す．
            \item そこで，標本$X_1,\cdots,X_n$の重複を展開して，問題を添字集合である自然数の集合$[n]:=\{1,2,\cdots,n\}$上に還元することを考える．\footnote{この$n$は経験測度を定める標本$X_1,\cdots,X_n$の数であることに注意．}
            $x_1,\cdots,x_n$を，$y_i$を$l_i$個含んだ多重集合とする．
            このとき，任意の$C\subset\{y_1,\cdots,y_k\}$に対して，多重集合$\wt{C}$が，次のように写像$\phi$に関して定まる：
            写像$\phi:[n]\to\{y_1,\cdots,y_k\}$は，$\Abs{\phi^{-1}(y_i)}=l_i$を満たすように任意に取る（標準的なものは１つさだまるが）．
            これに対して，逆像$\wt{C}:=\phi^{-1}(C)$とし，各$x_i\in\X$は添字$i\in[n]$と同一視する．
            この対応は，写像$\wt{-}:P(\{y_1,\cdots,y_k\})\to P([n])$を定めるが，
            この写像による$\C\subset\{y_1,\cdots,y_k\}$の像を，$\wt{\C}$で表す．
            \item (3)での構成の仕方から，次が成り立つ：
            \begin{quote}
                ある$J\subset[n]$が$\wt{\C}$によって完全分解されるならば，制限$\phi|_J:J\to\{y_1,\cdots,y_k\}$は単射であり，また像$\phi(J)$は$\C$によって完全分解される．
            \end{quote}
            この対偶命題を考えることより，$V(\wt{\C})\le V(\C)<\infty$で，$\wt{\C}$もVC-クラスであることがわかる．
            また同様に構成より，$\X$上の経験測度$Q$に対応する$[n]$上の測度$\wt{Q}$は$[n]$上の一様測度で，$Q(C\triangle D)=\wt{Q}(\wt{C}\triangle\wt{D})$が成り立つ．\footnote{積み上げられたブロックをばらして一列にしたので，その上の測度は一様になる．これを狙って(3)のように構成した．}
            これにより，２つの距離空間$(\C,L_1(Q)),(\wt{\C},L_1(\wt{Q}))$は等長同型である．
            以上より，$N(\ep,\wt{\C},L_1(\wt{Q}))=N(\ep,\C,L_1(Q))$である．
            \item 記法と問題設定を整理する．
            
            以降，$\wt{Q}$を$Q$と同一視し，$\wt{\C}$を$\C$と同一視する．$\C\subset P([n])$の元$C\in\C$は，特性関数$1_C:[n]\to\{0,1\}$を考えることで，$\{0,1\}^n=(\partial[0,1])^n$の元と同一視出来る．
            したがって，$\C\subset P(\{y_1,\cdots,y_k\})$は，$P([n])$の部分集合とも，$2^n$の部分集合$\cZ$とも見れる．
            以降特に，$\C$を$2^n$の部分集合と見たときの部分空間$\cZ$を，各要素を列ベクトルに持つ$n\times\#\C$-行列と見る．
            行ベクトルの組を$J\subset[n]$と指定した時，$\cZ_J$によって，$J$に含まれる行のみを残し，列ベクトルについても一次独立でない行は削除して得る行列とすると，
            $\cZ_J$は，射影$\pr_J:\cZ\mono[0,1]^n\epi[0,1]^J$の像に他ならない．具体的には，
            \[\cZ_J=\Brace{C\cap\{x_j\in\X\mid j\in J\}\mid C\in\C}\]
            と表せる．
            このとき，次が成り立つ：
            \begin{quote}
                $\cZ_J$の列が$2^{\abs{J}}$個あるか，または，$\cZ_J=(\partial\{0,1\})^J$であるとき，$\cZ_J$は$\C\subset P(\{y_1,\cdots,y_k\})$によって完全分解される．
            \end{quote}
            $\cZ_J$完全分解されるとき，$\abs{J}<V(\C)$が必要であるから，$S:=V(\C)-1$とおくと$\abs{J}\le S$が成り立つ．
            \item $\{0,1\}^n$上にHamming距離（の正規化）$d(w,z):=\frac{1}{n}\sum^n_{i=1}\abs{w_i-z_i}\;(w,z\in 2^n)$を定めると，
            $(\cZ,d)$は$(\C,L_1(Q)),(\wt{\C},L_1(\wt{Q}))$のいずれとも等長同型である．実際，$C,D\in\C$に対応する点を$z,w\in\cC$とすると，
            \[\norm{1_C-1_D}_{L_1(Q)}=Q(C\triangle D)=d(w,z).\]
        \end{enumerate}
        \item[証明] $\C$の$\ep$-分離的な最大の部分集合を取る\footnote{距離を経験測度で測っているため，有限に取れてしまう．}．簡単のため，これを改めて$\C$とし，$\C$自身を$\ep$-分離的と考える．
        このとき，$D(\ep,\C,L_1(Q))=\abs{\C}$を上から評価することで，パッキング数と被覆数の関係\ref{lemma-relation-between-packing-number-and-covering-number}より，同じ値が被覆数の上界となる．
        \begin{enumerate}[(i)]
            \item $Z:\Om\to\cZ$を，$\cZ$上の一様分布に従う確率変数とする．
            すると，各成分$Z=(Z_1,\cdots,Z_n)\;(Z_i\in\{0,1\})$は，２項分布$B(n,1/2)$に従うBernoulli変数となる．
            $n\le S$であるとき，$\sum^n_{i=1}E[\Var[Z_i|Z_j,j\ne i]]\le n\le S$は成り立つ．\textcolor{red}{?}
            $S<n$の場合も同様の不等式が成り立つことを示す．
            $S\le m<n$を満たす整数$m\in\Z$を任意に取り，
            それに対して$\abs{I}=m+1\le n$を満たす部分集合$I\subset[n]$を任意に取る．
            補題より，確率変数$Z_I:=\pr_I\circ Z:\Om\to\cZ_I$について，
            \[\sum_{i\in I}E[\Var[Z_i|Z_{I\setminus\Brace{i}}]]\le S\]
            が成り立つ．条件を満たす部分集合$I\subset[n]$の取り方は$\begin{pmatrix}n\\m+1\end{pmatrix}$通りあるから，それぞれの不等式を足し合わせて
            \[\sum_{J\in P([n]),\abs{J}=m}E\Square{\sum_{i\notin J}\Var[Z_i|Z_J]}\le \begin{pmatrix}n\\m+1\end{pmatrix}S\]
            を得る．
            \item 各$\sum_{i\notin J}\Var[Z_i|Z_J=s]\;(s\in\cZ^J)$を下から評価する．このときに$\#\cZ$なる項が最終的に左辺に残るようにすることで，最終的な不等式の証明に向かう．
            
            $Z_J=s\in\cZ^J$のとき，確率変数$Z:\Om\to\cZ$は部分集合$\W:=\Brace{z\in\cZ\mid z_J=s}$上に一様分布する．
            $\abs{\W}=:N_s\in\N$とおく．
            
            いま，$W,\wt{W}:\Om'\to\W$を，同様に$\W$上の一様分布に従う独立な確率変数とすると，
            $\cZ$は$\ep$-分離的としたから，$d(W,\wt{W})>\ep\;(W\ne\wt{W})$が成り立つ．
            $W\ne\wt{W}$が成り立つ確率は$1-1/N_S$であることと，$\Var[Z_i|Z_J=s]=\Var[W_i]=E\Square{\frac{(W_i-\wt{W_i})^2}{2}}\;(i\notin J)$に注意すると，
            \begin{align*}
                \sum_{i\notin J}\Var[Z_i|Z_J=s]&=\frac{1}{2}\sum_{i\notin J}E[(W_i-\wt{W_i})^2]\\
                &=\frac{1}{2}E\Square{n\cdot d(W,\wt{W})}>\frac{1}{2}n\cdot\ep\paren{1-\frac{1}{N_s}}
            \end{align*}
            と評価できる．
            \item (ii)の式を，さらに$s\in\cZ_J$上で期待値を取り，各$J\in P([n]),\abs{J}=m$について足し合わせたものが，(i)の式の左辺である．
            一様分布$P(Z_J=s)=\frac{N_s}{\abs{\cZ}}$を仮定したから，(ii)の右辺は，集合$\cZ_J$の元の数の平均を$\o{\abs{\cZ_J}}=E[\abs{\cZ_J}]$と表せば，
            \begin{align*}
                \sum_{J\in P([n]),\abs{J}=m}\sum_{s\in\cZ_J}\frac{N_s}{\abs{\cZ}}\frac{1}{2}\ep n\paren{1-\frac{1}{N_s}}&=\sum_{J\in P([n]),\abs{J}=m}\frac{1}{2}\ep n\sum_{s\in\cZ_J}\paren{\frac{N_s}{\abs{\cZ}}-\frac{1}{\abs{\cZ}}}\\
                &=\begin{pmatrix}n\\m\end{pmatrix}\frac{1}{2}\ep n\paren{1-\frac{\o{\abs{\cZ_J}}}{\abs{\cZ}}}
            \end{align*}
            となる．
            \item 以上，(i),(ii),(iii)の結果を併せると，
            \begin{align*}
                &&\begin{pmatrix}n\\m\end{pmatrix}\frac{1}{2}\ep n\paren{1-\frac{\o{\abs{\cZ_J}}}{\abs{\cZ}}}&<\begin{pmatrix}n\\m+1\end{pmatrix}S\\
                &\Leftrightarrow&\frac{n!}{m!(n-m)!}\frac{1}{2}\ep n\paren{1-\frac{\o{\abs{\cZ_J}}}{\abs{\cZ}}}&<\frac{n!}{(m+1)!(n-m-1)!}S\\
                &\Leftrightarrow&(m+1)\frac{\ep n}{2}\paren{1-\frac{\o{\abs{\cZ_J}}}{\abs{\cZ}}}&<(n-m)S\\
                &\Leftrightarrow&1-\frac{\o{\abs{\cZ_J}}}{\abs{\cZ}}&<\frac{2(n-m)S}{(m+1)\ep n}\\
                &\Leftrightarrow&\frac{\o{\abs{\cZ_J}}}{\abs{\cZ}}&>1-\frac{2(n-m)S}{(m+1)\ep n}=\frac{n(\ep m-2S)+\ep n+2mS}{(m+1)\ep n}\\
                &\Rightarrow&\abs{\cZ}&<\o{\abs{\cZ_J}}\frac{\ep m}{\abs{\ep m-2S}}\cdot\paren{}
            \end{align*}
            と評価できる．\textcolor{red}{最終行}

            (i)で狙ったとおり，$\abs{\cZ_J}$とは，$\cZ_J=\Brace{C\cap\Brace{x_j\in\X\mid j\in J}\in P(\X)\mid C\in\C}$であったから，$\C$によって$\{x_j\}_{j\in J}$から抽出される部分集合の個数$\Delta_{\abs{J}}(\C;(x_j)_{j\in J})$を表す．
            よって，$m\ge S$に注意すれば，Sauerの補題より，
            \[\abs{\cZ_J}\le\sum^S_{j=0}\begin{pmatrix}m\\j\end{pmatrix}\le\paren{\frac{em}{S}}^S.\]
            
            これと併せて，$\abs{\cZ}$は，任意の整数$m\in[S,n)\cap\bZ$に関して，
            \[\abs{\cZ}\le\paren{\frac{e}{S}}^S\frac{\ep m^S(m+1)}{\ep m-2S}\]
            と評価できる．
            特に$m=\frac{2(S+1)}{\ep}$（整数とは限らない）の場合を考えると，
            \[\paren{\frac{e}{S}}^S\frac{1}{2}\paren{\frac{2(S+1)}{\ep}}^{S+1}\ep=\paren{\frac{2e}{\ep}}^S(S+1)\paren{\frac{1}{S}+1}^S<\paren{\frac{2e}{\ep}}^{V(\C)-1}V(\C)e.\]
            実際には$m$は整数であるが，$\frac{2(S+1)}{\ep}$に最も小さい整数を取ることは，上式の右辺にある普遍定数倍をすることで変動を抑えられる．
        \end{enumerate}
    \end{description}
\end{proof}

\subsection{VC-subgraph class}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    VCクラスは集合系に関する大きさの評価であった．関数空間の大きさを評価するために，subgraphを通じてVC次元の概念を流入させ，$V:P(\Meas(\X,\R))\to\N\cup\{\infty\}$を定義する．
\end{tcolorbox}

\begin{definition}[VC-subgraph class]\mbox{}
    \begin{enumerate}
        \item 可測関数のクラス$\F\subset\Meas(\X,\R)$が\textbf{VC-サブグラフクラス}であるとは，$f\in\F$のサブグラフがなす集合族$\{(x,t)\in\X\times\R\mid t<f(x)\}_{f\in\F}$がVC-クラスであることをいう．
        \item 確率過程$(f_t)_{t\in T}:T\to\Meas(\X,\R)$がVC-サブグラフクラスであるとは，$\F:=\{f_t\}_{t\in T}$がVC-サブグラフクラスであることをいう．
    \end{enumerate}
\end{definition}

\begin{example}[線型空間との関係]
    $\F\subset\Meas(\X,\R)$を有限次元線型部分空間とする．
    $\F$は$V(\F)\le\dim\F+2$を満たすVC-サブグラフクラスである．
\end{example}
\begin{proof}
    $n:=\dim\F+2$個の点$(x_1,t_1),\cdots,(x_n,t_n)$を任意にとり，これが$\F$のサブグラフによって完全分解されないことを示せば良い．

    いま，$(f(x_1)-t_1,\cdots,f(x_n)-t_n)^T$は$f\in\F$に依らず，$\R^n$のある$n-1$次元部分空間$V$内に入る．
    これは，$\F$の基底$f_1,\cdots,f_{n-2}$を用いて，$(f_1(x_1),\cdots,f_1(x_n)),\cdots,(f_{n-2}(x_1),\cdots,f_{n-2}(x_n)),(t_1,\cdots,t_n)$が生成する部分空間を取れば良い．
    このとき，$a\in V^\perp\setminus\{0\}$を取ると，
    \[\forall_{f\in\F}\quad\Brace{(x_i,t_i)\in\X\times\R\mid a_i>0}\ne\Brace{(x_i,t_i)\in\X\times\R\mid t_i<f(x_i)}\]
    が成り立ち，$\Brace{(x_i,t_i)\in\X\times\R\mid a_i>0}$で定まる点は$\F$のサブグラフによって抽出できない．
    なぜならば，$a\perp V$より，
    \[\forall_{f\in\F}\quad\sum_{a_i>0}a_i(f(x_i)-t_i)=\sum_{a_i<0}(-a_i)(f(x_i)-t_i)\]
    が成り立つが，仮に$\Brace{(x_i,t_i)\in\X\times\R\mid a_i>0}$が抽出できたとすると，左辺が正で，右辺が非正となり，矛盾．
\end{proof}

\begin{example}
    $X:\R\supset T\to\Meas(\X,\R)$を単調増加な確率過程とすると，これは$V(X)=2$の$VC$-サブグラフクラスである．
\end{example}
\begin{proof}
    $(x_1,t_1),(x_2,t_2)\in\X\times\R$を任意に取る．
    この２点を$X$のサブグラフが完全分解するためには，特に，２つの見本過程$X_t(x_1),X_t(x_2):T\to\R$が$\R^2$上に定める関数$(X_t(x_1),X_t(x_2)):T\to\R^2;t\mapsto \begin{pmatrix}X_t(x_1)\\X_t(x_2)\end{pmatrix}$
    が，点$(t_1,t_2)\in\R^2$に対して，４つの象限$\Brace{(x,y)\in\R^2\mid x>t_1,y>t_2},\Brace{(x,y)\in\R^2\mid x>t_1,y<t_2},\Brace{(x,y)\in\R^2\mid x<t_1,y>t_2},\Brace{(x,y)\in\R^2\mid x<t_1,y<t_2}$のいずれをも通ることが必要．
    しかしこれは，見本過程$T\to\R$がいずれも$T$について単調であり，したがって$(X_t(x_1),X_t(x_2)):T\to\R^2;t\mapsto \begin{pmatrix}X_t(x_1)\\X_t(x_2)\end{pmatrix}$のグラフも$\R^2$上で単調であることに矛盾する．
    したがって，$V(X)=2$．
\end{proof}

\begin{theorem}
ある実数$K\in\R$が存在して，任意の二乗可積分な包絡関数$F$を持つVC-サブグラフクラス$\F$と，実数$r\ge 1,0<\ep<1$と，$\norm{F}_{Q,r}>0$を満たす任意の確率測度$Q$について，
\[N(\ep\norm{F}_{Q,r},\F,L_r(Q))\le K\cdot V(\F)(16e)^{V(\F)}\paren{\frac{1}{\ep}}^{r(V(\F)-1)}.\]
\end{theorem}
\begin{proof}
    $\C:=\Brace{C_f\subset\X\times\R\mid C_f=\{(x,t)\in\X\times\R\mid t<f(x)\},f\in\F}$とおく．
    \begin{description}
        \item[$r=1$のとき] $\lambda$を$\R$上のLebesgue測度とすると，Fubiniの定理より，任意の$\X$上の確率測度$Q$に対して，
        \[Q|f-g|=(Q\times\lambda)(C_f\triangle C_g).\]
        よって，$P:=\frac{Q\times\lambda}{2\cdot QF}$と定めると，$\Y:=\Brace{(x,t)\in\X\times\R\mid\abs{t}\le F(x)}$上の確率測度となり（包絡関数は$F\ge 0$であることに注意すると，$Q\times\lambda(\Y)=2\cdot QF$），
        定める$L_1$-距離は$\frac{1}{2\cdot QF}$倍になる．
        よって，定理より，
        \[N(\ep 2QF,\F,L_1(Q))=N(\ep,\C,L_1(P))\le KV(\F)\paren{\frac{4e}{\ep}}^{V(\F)-1}\]
        \item[一般の$r$のとき]
        $R$を，密度関数$\frac{F^{r-1}}{QF^{r-1}}$が定める$\X$上の確率測度とすると，
        三角不等式より$\abs{f-g}\le\abs{f}+\abs{g}\le 2F$だから，
        \[Q\abs{f-g}^r\le Q\abs{f-g}(2F)^{r-1}=2^{r-1}R\abs{f-g}QF^{r-1}\]
        と表現できるから，新たな確率測度$R$についての$L_1$-ノルムによって
        \[\norm{f-g}_{Q,r}\le 2(QF^{r-1})^{1/r}\norm{f-g}_{R,1}^{1/r}\]
        と評価できる．
        $RF=\int_\X FdR=\int_\X\frac{F^r}{QF^{r-1}}dQ=\frac{QF^r}{QF^{r-1}}$であることに注意すると，
        \[\frac{R\abs{f-g}}{Q\abs{f-g}^r}\ge\frac{RF}{2^rQF^r}\]
        より，$L_r(Q)$-ノルムで半径$\ep 2\norm{F}_{Q,r}$である球は，$L_1(R)$-ノルムでいうと半径は$\ep^rRF$より小さい．
        よって，
        \[N(\ep 2\norm{F}_{Q,r},\F,L_r(Q))\le N(\ep^rRF,\F,L_1(R)).\]
        よって，$1/\ep$の指数を$r$倍すれば，定理が成り立つ．
    \end{description}
\end{proof}

\begin{theorem}
    統計モデル$\F$を用いて学習を行うとき，任意の確率分布に対して予測誤差$L(\wt{f})$が$\inf_{f\in\F}L(f)$に一様に確率収束することと，$\VC(\F)$が有限であることとは同値．
\end{theorem}
\begin{remarks}
    なんでも説明できるような反証不可能な仮説$\VC(\F)=\infty$は，科学的仮説とはいえず，予測能力は持たない」ということを表していると考えられる．
    分解能とトレードオフ？
\end{remarks}

\subsection{滑らかな関数族}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    VCクラスは組み合わせ論的な議論で被覆数に関する結果を得たが，解析的な議論でブラケット数に関する結果を得る手法もある．
\end{tcolorbox}

\subsection{単調関数族}

\section{確率過程のChaining}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    Chainingは一般の確率過程$(X_t)_{t\in T}$に関して，一様な上界を得る方法である．
    経験過程の枠に囚われずに考えてみたい．
    統計的学習理論では，被覆数などの幾何学的性質よりも，さらに組み合わせ論的なVC次元が応用に近い．
    さらに評価を精密にしlogarithmic gapを消すためには，より幾何学的なTalagrand汎関数$\gamma_2(T)$を考える，これを"generic chaining"という．
\end{tcolorbox}

\subsection{Dudleyの不等式}

\begin{definition}[sub-gaussian increments]
    距離空間$(T,d)$上の
    確率過程$(X_t)_{t\in T}$が\textbf{劣ガウス増分}を持つとは，
    \[\exists_{K\ge0}\;\forall_{s,t\in T}\;\norm{X_t-X_s}_{\psi_2}\le Kd(t,s)\]
    を満たすことをいう．
\end{definition}

\chapter{推定理論}

\begin{quotation}
    $\sqrt{n}$-推定可能なパラメータのみに限定する．
    実際，多くのパラメータは，漸近正規性などの従来の大標本理論の枠組みには入らないこともある．
\end{quotation}

\chapter{機械学習}

\begin{quotation}
    機械学習とは，統計推測 with an attitudeである．
\end{quotation}

\section{データセットと教師あり学習}

\begin{definition}[data set]\mbox{}
    \begin{enumerate}
        \item データセット$\D$とは，データ生成分布（母集団）\footnote{ただし，独立同分布に従うとする．}からサンプリングされた確率変数の実現値の集合をいう．$(x_n,y_n)\sim P(x,y)$である時，$\D:=\Brace{(x_b,y_n)}_{n=1}^N$となる．
        \item $N:=\abs{\D}$をデータセットサイズという．
        \item 変数$x,y$は実験者の意味論から，入力変数と出力変数と呼び分けられることがある．
        \item データ生成分布を記述するのに用いる関数の集合を\textbf{仮設集合}や\textbf{モデル}という．パラメトリックモデルとは，有限の添字により族とみなせるモデルである．
    \end{enumerate}
\end{definition}

\begin{definition}[supervised learning, over learning / over fitting, generalization, inductive bias]\mbox{}
    \begin{enumerate}
        \item \textbf{訓練データ}と呼ばれる有限集合$D_{train}$から，$P(y|x)$を統計的に推定する問題をいう．
        \item この問題に対する訓練の失敗として，訓練データのみにしか使えない場合を\textbf{過学習}や\textbf{過剰適応}という．実際訓練データは有限だから，組み合わせ論的な解は存在する．
        \item 一方で理想的な状況を\textbf{汎化}という．こちらが人間にとって本当に解きたい問題であり，数学の存在意義でもある．\footnote{現実に使われている NN はパラメタ数がデータより非常に多く，一見すると自由度が高すぎて過学習が起きやすいモデルに思えます．それにも関わらず，なぜ NN の学習は上手くいくのでしょうか？実はパラメタ数が多くなっても，学習された NN は過学習を起こしにくいことが実験的に示唆されています．例えば，Neyshabur ら [1] による実験では，NN のパラメタ数が増えても未知のデータに対する予測精度は保たれていて，過学習が防げていることが分かります．Zhang ら [2] による別の実験でも，𝑙2-正則化などの明示的な正則化がなくても学習後のNN の性能は良いことが示されています．これらの結果は，パラメタ数が多く明示的に正則化が行われない状況でも，何らかの形で過学習が抑制される正則化がかかっていることを示唆しています．\url{https://tech.preferred.jp/ja/blog/implicit-bias/}}
        \item 未知のデータに対して行う何らかの仮定を\textbf{帰納バイアス}という．
        \item 誤差関数に罰金(penalty)項を付加することにより係数が大きな値になることを防ぐことを\textbf{正則化}という．\footnote{暗黙的な正則化（implicit bias）の正体は何なのでしょうか？Neyshabur ら [1] は最適化アルゴリズムの性質によるものだという仮説を提示しました．例えば，確率的勾配降下法 (Stochastic Gradient Descent; SGD) は連続的にパラメタを更新していくアルゴリズムなため，初期値からあまり離れることができません．そのため，初期値が非常に小さい場合は，学習されたパラメタのノルムが小さくなると期待されます（図１）．この小ノルム性が正則化として機能し，未知のデータに対する汎化性能に効いているのだというのが彼らの仮説です．Zhang ら [2] も同様に SGD に起因する小ノルム性に基づいた議論を行っています．}
    \end{enumerate}
\end{definition}

\begin{theorem}[no free lunch theorem]
    
\end{theorem}
\begin{remark}[Transformer]
    Transformerというモデルは，万能帰納バイアスとして注目を集めている．
    万能であるということは人間がモデルの中に仕込んだ帰納バイアスが弱いということであり，
    そのためTransformerを訓練するためには大量のデータを要する．
    しかしながらCNN (Convolutional Neural Network)などの他の強い帰納バイアスとは異なりTransformerには，データや計算資源のスケールアップに従い単調に性能が向上するというべき則が成立すると考えられている．
\end{remark}

\chapter{参考文献}

\begin{thebibliography}{99}
    \bibitem{久保木・鈴木}
    久保木久孝・鈴木武『セミパラメトリック推測と経験過程』(朝倉書店 統計ライブラリー，2015)
    \bibitem{吉田}
    吉田朋広『数理統計学』(朝倉書店，2006)
    \bibitem{竹村}
    竹村彰道『現代数理統計学』（学術図書，2020）
    \bibitem{久保川}
    久保川達也『現代数理統計学の基礎』（共立出版，2017）
    \bibitem{渡辺澄夫}
    渡辺澄夫『代数幾何と学習理論』（森北出版，2006）
    \bibitem{Bickel}
    Bickel - Efficient and Adaptive Estimation for Semiparametric Models (1993)
    厳密な議論がなされている．実証科学者には難しすぎるとのことでTsiatisが書かれた．
    \bibitem{Pfanzagl}
    Pfanzagl - Estimation In Semiparametric Model
    \bibitem{Kosorok}
    Michael R. Kosorok "Introduction to Empirical Processes and Semiparametric Inference" (Springer, 2008)
    \bibitem{Tsiatis}
    Anastasios A. Tsiatis "Semiparametric Theory and Missing Data" (2006)
    最初の５章は欠測データのないセミパラメトリックモデルを扱い，パラメータに対する推定量の構成法を議論する．特に幾何的な手法を見る．
    \bibitem{van der Vaart and Wellner}
    van der Vaart and Wellner "Weak Convergence and Empirical Processes"
    \bibitem{Asymptotic Statistics}
    Van der Vaart, A. W. (2000). Asymptotic statistics, volume 3. Cambridge university press.
    \bibitem{Tsybakov}
    Tsybakov - Introduction to Nonparametric Estimation
    \bibitem{vanderVaart Semiparametric Theory}
    Semiparametric Theory

    \bibitem{Hines}
    Oliver Hines et. al. Demystifying statistical learning based on
    efficient influence functions (2021)
\end{thebibliography}

\end{document}