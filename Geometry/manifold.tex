\documentclass[uplatex,dvipdfmx]{jsreport}
\title{多様体}
\author{}
\pagestyle{headings} \setcounter{secnumdepth}{4}
\input{/Users/hirofumi.shiba48/Desktop/数理科学/preamble_no_fonts.tex}
\usepackage[math]{anttor}
\begin{document}
\tableofcontents

\chapter{Euclid空間}

\begin{quotation}
    Euclid空間$\R^n$が全ての多様体の原型となり，「観測道具」となる．
    ここに向かう射を座標と呼ぶ．
    結局Decartesの発明とは，観念の，実数による観測である．
    正則関数は$\C$に向かうように，理想的な連続写像がHausdorff空間へと向かうように．

    $\R^n$上で大域的に積分できることが目眩しになる，標準的な大域的座標を持っているために，微分$n$-形式が$\R^n$上の関数と同一視できるためである．
    本当に積分できる対象は微分形式の方であるという認識が遅れる．
    さらに言えば，ここではJacobi行列という最強の数値的特徴づけがある．
    ここからどういう代数的構造を抽出するか．

    多様体論の基礎は，線型代数化の歩みである．
    滑らかな関数はHadamardの補題のような魅惑的な解析的構造だけでなく，
    代数の構造を持つ．
    これに対する微分はベクトル場に一致する．
    代数幾何が始まる．
\end{quotation}

\begin{notation*}[多様体論の基礎は，線型代数化の歩みである]\mbox{}
    \begin{enumerate}
        \item $p$に於ける関数の芽の集合$C^\infty_p(X)=C^\infty(X)\times\O_p/\Brace{(f,U),(g,V)\mid \exists_{W\subset U\cap V}\;f|_W=g|_W}$は$\R$上の代数である．\footnote{非交和を2-tupleとして構成するのと自然に同一視することを思い出す．$v\in T_pM$と$(v,p)\in TM$を同一視する．}
        \item 代数とは，２つの内算法(not-necessarily unital)と１つの外算法を持つ代数系をいう．適宜部分代数を取り出して，環や環上の加群や群作用の部分模様に言及することが多いためにこの語の運用があるのだと思う．
        \item $C^\infty(U)=\mathcal{F}(U)$は$\R$上の代数である(algebra of smooth functions)．
        \item 点$p$に於ける導分(derivaration)／$C^\infty_p(X)$の点導分の集合$\mathcal{D}_p(\R^n)=\Brace{D\in\Hom_R(C_p^\infty,\R)\mid D(fg)=(Df)\cdot g+f\cdot (Dg)}$は実部分空間である．
        \item 点$p$での接ベクトル$v\in T_p(\R^n)$に対する方向微分$T_p(\R^n)$は点導分であり，それに限る：$T_p(\R^n)\simeq\mathcal{D}_p(\R^n)$．これは代数法則（Leibniz則）による接ベクトルの特徴づけである．
        \item $TX=\coprod_{p\in X}T_pX=\Brace{(x,v)\mid x\in T_pX}$を接空間といい，射影$\pr_1:TX\to X$を接束という．この束の言葉で「各点毎の線型代数」が整う．この切断$X\to TX$をベクトル場という．
        \item 微分論とは，線型化関手(tangent functor) $T:\Diff\to\Vect(\Diff)$の理論である．微分可能多様体の間の射を，接束とその間の$df$に移す関手を定める理論である．
        \item $\mathcal{X}(U)=\Brace{X\in\prod_{p\in U}T_p(\R^n)\mid XはU上でC^\infty 級}$は実線型空間である．
        \item 環$C^\infty(U)$からの左外算法により，左$C^\infty(U)$-加群となる．
        \[\xymatrix@R-2pc{
            C^\infty\times\mathcal{X}(U)\ar[r]&\mathcal{X}(U)\\
            \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
            (f,X)\ar@{|->}[r]&fX=\sum^n_{i=1}fa^i\pp{}{x^i}
        }\]
        \item 環$C^\infty(U)$への右外算法（作用）$\mathcal{X}(U)\times C^\infty(U)\to C^\infty(U)$も持つ．これはLeibniz則をみたし，Leibniz則を満たす線型自己準同型の部分空間$\Der_\R(C^\infty)\subset\End_\R(\C^\infty)$に一意する：$\mathcal{X}(U)\simeq\Der_\R(C^\infty)$．$C_p^\infty$の$p$を$p\in U$上で走らせて一般化した．\footnote{\href{https://ncatlab.org/nlab/show/derivations+of+smooth+functions+are+vector+fields}{Derivations of smooth functions are vector fields}}
        \item 実線型空間$V$からの$k$-テンソル$V^{\otimes k}\to\R$の集合を$L_k(V)$と表し，そのうち交代的なものを$A_k(V)\subsetneq L_k(V)$とし，その元を$k$-コベクトルという．この構成は，一般に$R$-加群$V$から$R$-代数を作り出している関手としてみると，忘却関手の左随伴となる自由関手である．
        \item $k$-テンソルへの置換群による左外算法（群作用）を定義する．$A_k$はこの作用が$\sgn(\sigma)$倍写像に退化する部分空間として特徴付けられる．
        \[\xymatrix@R-2pc{
            S_k\times L_k(V)\ar[r]&L_k(V)\\
            \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
            (\sigma,f)\ar@{|->}[r]&(\sigma f)(v_1,\cdots,v_k):=f(v_{\sigma(1)},\cdots,v_{\sigma(k)})
        }\]
        \item 対称化／交代化作用素$S,A:L_k(V)\to L_k(V)$を定める．後者の交代化作用素$A$はdetの定義に等しい．これによる商代数が対称代数や外積代数(Grassmann algebra)である．
        \item テンソルの集合は，テンソル積$\otimes:L_k(V)\times L_l(V)\to L_{k+l}(V)$によるgraded algebraである．これが核$A_k(L)$に自然に定める構造により，$A_k(V)$も結合的で反交換的なgraded algebra＝次数付き可換代数である．\footnote{The free supercommutative algebras are the Grassmann algebras.\url{https://ncatlab.org/nlab/show/supercommutative+algebra}}
        \item 以上より，次数付き代数の例として$\R[x,y]$やテンソル代数$T^*(V):=\bigotimes_{k=0}^\infty V^{\otimes k}$を得て，反交換な自由代数として$A_*(V)=\bigotimes_{k=0}^\infty A_k(V)=\bigotimes_{k=0}^n A_k(V)$を得た．
        \item \[\xymatrix@R-2pc{
            \bracket{\;,\;}:T_p(\R^n)\times C_p^\infty(\R^n)\ar[r]&\R\\
            \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
            (X_p,f)\ar@{|->}[r]&X_pf
        }\]
        接ベクトル$X_p$を$\bracket{X_p,-}$と定義したが，微分$(df)_p$はその双対$\bracket{-,f}$と定める．
    \end{enumerate}
\end{notation*}
\begin{remark*}\mbox{}
    \begin{enumerate}
        \item (Milnor's exercise) 関手$C^\infty(-):\SmoothMnf\to\Alg_\R^\op$は充満忠実である．同値な命題$C(X,Y)\simeq\Hom_\R(C^\infty(Y),C^\infty(X))$の方がわかりやすい．
        多様体の定義を変えて，非可算な連結部分を認めるなどすると，この結果は敗れる．
        \item 座標関数は0-形式なので上つき添字を附ける．cohomologyに繋がるので反変である．代数的な対象は上つき．
    \end{enumerate}
\end{remark*}

\section{Taylor級数展開}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white, breakable ,colbacktitle=ForestGreen!40!white, coltitle=black,fonttitle=\bfseries\sffamily,
    title=全体のポイント]
    複素微分可能ならば解析的であるが，実微分可能性は例え$C^\infty$級でも，実解析的とは限らない．
\end{tcolorbox}

\begin{definition}[real analytic]
    関数$f$が点$p\in\R^n$で\textbf{実解析的}であるとは，$p$のある近傍（$p$を含むある開集合）において，その$p$におけるTaylor級数と一致することをいう．
\end{definition}

\begin{lemma}[$C^\infty$級でも実解析的とは限らない]\mbox{}\label{lemma-Taylor's-theorem}
    \begin{enumerate}
        \item 実解析的な関数は$C^\infty$級である．
        \item $C^\infty$級関数は一般的には実解析的ではない．
        \item (剰余項を持つTaylorの定理) しかし，$C^\infty$級関数には剰余項を持つTaylorの定理が成り立つ．一番簡単な場合について，$U\subset\R^n$が$p=(p^1,\cdots,p^n)$に関して星形とし，その上の$C^\infty$級関数$f$には，
        \[f(x)=f(p)+\sum^n_{i=1}(x^i-p^i)g_i(x),\quad g_i(p)=\dd{f}{x^i}(p)\qquad \forall_{x\in U}\]
        をみたす関数$g_1,\cdots,g_n\in C^\infty(U)$が存在する．
    \end{enumerate}
\end{lemma}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item 収束冪級数は，収束領域内で項別微分が可能であるため．
        \item \begin{description}
            \item[Step1] まず次の命題を帰納法により示す：
            \[f^{(k)}(x)=p_{2k}\paren{\frac{1}{x}}\cdot e^{-\frac{1}{x}}\qquad(x>0,k\ge 0,p_{2k}\in\R[X],\deg p_{2k}=2k)\]
            $k=0$のとき，$p_0=1$とすれば良い．$k>0$のとき，
            \begin{align*}
                f^{(k+1)}&=p_{2k}'\paren{\frac{1}{x}}e^{-\frac{1}{x}}+p_{2k}\paren{\frac{1}{x}}\frac{1}{x^2}e^{-\frac{1}{x}}\\
                &=\paren{\paren{\frac{1}{x}の2k-1次式}\cdot\paren{-\frac{1}{x^2}}+\paren{\frac{1}{x}の2k+2次式}}e^{-\frac{1}{x}}\\
                &=:p_{2(k+1)}\paren{\frac{1}{x}}e^{-\frac{1}{x}}
            \end{align*}
            は，$p_{2(k+1)}(X):=p'_{2k}(X)\cdot(-X^2)+p_{2k}(X)\cdot X^2$と定めれば成り立つ．
            \item[Step2]
            すると，任意の$k\in\N$について，$\lim_{x\to+0}p_{2k}(1/x)e^{-1/x}=0$は$2k$回l'Hôpitalの定理を適用することより判る．
            即ち$f^{(k)}$は$\R$上で連続で，$f^{(k-1)}$の導関数である．以上より，$f$は$C^\infty$級であり，$(\forall_{k\in\N})\;f^{(k)}(0)=0$である．
            即ち，$f$のTaylor級数展開は零であるが，$f$はいかなる近傍上でも零関数ではない．即ち，$f$は実解析的ではない．
        \end{description}
    \end{enumerate}
\end{proof}

\begin{lemma}[Hadamard's lemma]
    任意の$f\in C^\infty(\R)$について，$f=f(0)+xg$を満たす$g\in C^\infty(\R)$が存在する．
\end{lemma}

\section{導分としての接ベクトル}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white, breakable ,colbacktitle=ForestGreen!40!white, coltitle=black,fonttitle=\bfseries\sffamily,
    title=接ベクトルとその場を，外算法の言葉で特徴付ける．]
    $\R^n$での計算を，座標に依らない形に書き直すために，接ベクトルを，矢印や数ベクトルなどではなく，関数上の導分として定義する．
    これが接ベクトルの，真に座標に依らない特徴付けであることは驚愕である．
    これは，関数上の作用素としての外算法的な見方である．
    こうして抽出した外算法は，線型代数の上に乗る．特に，導分(derivative)の代数的特徴付けは，\textbf{Leibniz則を満たす線型写像}である：$T_p(\R^n)\cong\cD_p(\R^n)$（定理\ref{thm-isomorphism-between-tangent-vector-and-point-derivative}）．
    続いて，点$p$に於ける接ベクトルが関数の芽$C^\infty_p$の点導分と同一視できるのと同様に，開集合$U$上のベクトル場は代数$C^\infty(U)$の導分と同一視できる．
    \begin{enumerate}
        \item 接空間には双線型形式$\cD_p(\R^n)\times C_p^\infty(\R^n)\to\R$が定まる．これを点$p$に於ける点導分という．代数$C_p^\infty$の導分$D_p(\R^n)\times C_p^\infty(\R^n)\to C_p^\infty(\R^n)$とはならない．
        \item 代数$\C^\infty(U)$には導分$\fX(U)\times C^\infty(U)\to C^\infty(U)$が定まり，これをベクトル場という．
    \end{enumerate}
\end{tcolorbox}

\subsection{関数の芽からなる代数}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white, breakable ,colbacktitle=ForestGreen!40!white, coltitle=black,fonttitle=\bfseries\sffamily,
    title=]
    理論を展開する前に，いきなり関数を同値類として考え始める．
    要はこれは，Taylor級数展開表示を主軸として有象無象の関数を整理し直したとも考えられる．
    少し抽象的であるが，$C^\infty(U)$も，$C^\infty_p$も，多元環として理解できるのでまだ手に負える．
    関数の芽の概念は，層と前層の背後にある．
\end{tcolorbox}

\begin{definition}[germ]
    $X$を位相空間とし，$p\in X$を点とする．
    $p$の近傍$U$と，$C^\infty$級関数$f\in C^\infty(X)$の組$(f,U)$を考える．
    \begin{enumerate}
        \item $(f,U)\sim(g,V):\Leftrightarrow (\exists_{開集合W\subset U\cap V})\;f|_W=g|_W$と定めると，これは同値関係である．
        \item 同値類$\o{(f,U)}$を，$p$における$f$の\textbf{芽}と呼ぶ．
        \item $p$における$X$上の$C^\infty$級関数の芽の集合を$C^\infty_p(X)$と表す．
    \end{enumerate}
\end{definition}

\begin{example}
    $f(x)=\frac{1}{1-x}$で定まる関数$f:\R\setminus\{1\}\to\R$と，$g(x)=\sum^\infty_{i=1}x^i$で定まる関数$g:(-1,1)\to\R$は，開区間$(-1,1)$上の任意の点$p\in(-1,1)$において同じ芽を持つ．
\end{example}

\begin{definition}[algebra (over a field) / linear ring]\mbox{}\label{del-linear-ring}
    \begin{enumerate}
        \item 
    体$K$上のベクトル空間$A$であって，双線型な乗法$\mu:A\times A\to A$を備えたものを，\textbf{代数}または\textbf{多元環}という．
    \footnote{代数と多元環はalgebraを直訳するかの違いで日本語として同義．可換環上の加群があって，そこに両立する積構造を考える順番で，その積が満たす代数的性質によって，結合多元環，分配多元環などと呼ぶ．結合多元環のことを，Bourbakiは線型環という．（結合的な）環の上に線型代数を構築したという順序である．}
    特に結合性を満たすものについて，その条件を公理にすると，$\forall_{a,b,c\in A},\forall_{r\in K}$について，次の３つである．
    \begin{enumerate}
        \item (結合性) $(ab)c=a(bc)$．
        \item (分配性／双線型性) $(a+b)c=ac+bc,a(b+c)=ab+ac$．
        \item (斉次性) $r(ab)=(ra)b=a(rb)$．
    \end{enumerate}
        \item 線型写像$L:A\to A'$が代数の積を保つとき（即ち$L(ab)=L(a)L(b)$），$L$を代数の準同型という．
    \end{enumerate}
\end{definition}
\begin{remarks}
    ２つの内算法を備える環(not-necessarily unital)であって（積に関する単位元はなくても良い），体による作用も受ける代数系を，代数という．
    結合性を仮定しない流派もある．
\end{remarks}

\begin{example}\mbox{}
    \begin{enumerate}
        \item 開集合$U\subset\R^n$上の全ての$C^\infty$級関数からなる集合$C^\infty(U)$とは，$\R$上の多元環である．これを$\mathcal{F}(U)$ともかく．
        \item $C^\infty_p(\R^n)$も$\R$上の代数となる．
    \end{enumerate}
\end{example}

\subsection{導分としての接ベクトル}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white, breakable ,colbacktitle=ForestGreen!40!white, coltitle=black,fonttitle=\bfseries\sffamily,
    title=]
    点$p$上の接ベクトルの空間$T_p(\R^n)$の実態を解明したい．
    接ベクトルの特徴として，「Leibniz則を満たす線型写像」という性質を持つ線型形式(derivativeと呼ぶ)を抽出すると，
    正確な特徴付けとなる．即ち，$T_p(\R^n)\cong\cD_p(\R^n)$．
\end{tcolorbox}

\begin{discussion}[方向微分の研究]\label{discussion-tangent-vector-as-differential}
    接ベクトル$v=\begin{bmatrix}v^1\\\vdots\\v^n\end{bmatrix}\in T_p(\R^n)$は，次の$\R$-線型形式を定める．
    \[\xymatrix@R-2pc{
        D_v:C^\infty_p(\R^n)\ar[r]&\R\\
        \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
        f\ar@{|->}[r]&D_vf:=\sum^n_{i=1}v^i\pp{f}{x^i}(p)
    }\]
    これを\textbf{方向$v$に沿った方向微分}といい，$D_v=\sum v^i\paren{\pp{}{x^i}}_p$とも$\sum v^i\left.\pp{}{x^i}\right|_p$ともかく．
    この定義の根拠は，$c(t):=p+tv$と関数$c:(-\epsilon,\epsilon)\to\R^n$をおき，$D_vf:=\left.\dd{f(c(t))}{t}\right|_{t=0}$と置くと，連鎖律より，$=\sum^n_{i=1}\pp{f}{x^i}(p)\dd{c^i}{t}(0)=\sum^n_{i=1}v^i\pp{f}{x^i}(p)$が従うからである．
    これはLeibniz則$D_v(fg)=(D_vf)g(p)+f(p)D_vg$を満たす．
    \begin{align*}
        D_v(fg)&=\sum^n_{i=1}v^i\paren{\pp{(fg)}{x^i}}_p\\
        &=\sum^n_{i=1}v^i\paren{\left.\pp{f}{x^i}\cdot g\right|_p+\left.f\cdot \pp{g}{x^i}\right|_p}\\
        &=g(p)\underbrace{\sum^n_{i=1}v^i\paren{\pp{f}{x^i}}_p}_{=D_vf}+f(p)\underbrace{\sum^n_{i=1}v^i\paren{\pp{g}{x^i}}_p}_{=D_vg}.
    \end{align*}
\end{discussion}

\begin{definition}[derivatice]\mbox{}
    \begin{enumerate}
        \item Leibniz則を満たす線型写像$D:C^\infty_p\to\R$を，\textbf{$p$における導分}または$C^\infty_p$の\textbf{点導分}という：
        \[D(fg)=(Df)g(p)+f(p)Dg\]
        \item $p$における導分全体からなる集合を$\cD_p(\R^n)\subsetneq(C_p^\infty)^\vee$とする．これは$\R$-ベクトル空間である．
    \end{enumerate}
\end{definition}

\begin{lemma}\label{lemma-differential-of-constant-function}
    点導分$D\in\cD_p(\R^n)$について，任意の定数関数$c\in C^\infty_p(\R^n)$に対して，$D(c)=0$である．
\end{lemma}
\begin{proof}
    $\R$-線形性より，$D(c)=cD(1)$だから，定数関数$1\in C^\infty_p$に対して$D(1)=0$を示せば十分．
    Leibniz則$D(1)=D(1\cdot 1)=D(1)\cdot 1+1\cdot D(1)=2D(1)$より従う．
\end{proof}

\begin{theorem}[接ベクトルと導分の同一視]\label{thm-isomorphism-between-tangent-vector-and-point-derivative}
    議論より，$\R$-線型写像
    \[\xymatrix@R-2pc{
        \phi:T_p(\R^n)\ar[r]&\cD_p(\R^n)\\
        \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
        v\ar@{|->}[r]&D_v
    }\]
    が定まる．これは同型である．
\end{theorem}
\begin{proof}\mbox{}
    \begin{description}
        \item[$\Ker\phi=0$を示す] \mbox{}\\$v\in\Ker\phi$，即ち，$D_v=0$と仮定する．
        すると特に，座標関数$x^j\;(j\in[n])$についても，
        \begin{align*}
            0=D_v(x^j)&=\sum^n_{i=1}v^i\paren{\pp{f}{x^i}}_p(x^j)\\
            &=\sum^n_{i=1}v^i\delta^j_i=v^j
        \end{align*}
        が成り立つから，$v=0$が従う．
        \item[$\phi^{-1}(D)\ne\emptyset$を示す] \mbox{}\\
        $D\in\cD_p(\R^n)$を任意に取って，これを定める接ベクトル$v\in T_p(\R^n)$を構成すれば良い．
        $C^\infty_p$に属するある関数の芽の代表元$(f,V)$を任意に取る．
        $V$を十分小さく取り直すことで，これを開球，よって星形としても一般性は失われない．
        よって，Taylorの定理\ref{lemma-Taylor's-theorem}より，
        \[f(x)=f(p)+\sum^n_{i=1}(x^i-p^i)g_i(x),\qquad g_i(p)=\pp{f}{x^i}(p)\]
        を$V$上で満たす関数$g_i\in C^\infty(V)$が存在する．
        この両辺の$D$による値を取ると，導分$D$のLeibniz則より，補題\ref{lemma-differential-of-constant-function}により$D(f(p))=0,D(p^i)=0$に注意して，
        \begin{align*}
            Df(x)&=\sum^n_{i=1}(Dx^i)g_i(p)+\sum_{i=1}^n(p^i-p^i)Dg_i(x)\\
            &=\sum^n_{i=1}(Dx^i)\pp{f}{x^i}(p)
        \end{align*}
        より，$f$は任意であったので，これは$v^i:=Dx^i$と定めれば，$D=D_v$となる．
    \end{description}
\end{proof}
\begin{remarks}[本当にLeibniz則のみで$T_p(\R^n)$を同型を除いて一意に定めることができた]
    Taylorの級数展開表示が全てである．
    $C_p^\infty(\R)$には，（実解析的とはならずとも）１次の範囲ならば，Taylorの級数表示という標準形がある．
    これにLeibniz則を満たしながら作用する実線型作用素が存在するとしたら，それはある$v\in T_p(\R^n)$が存在して
    それが定める方向微分に一致する．
\end{remarks}

\begin{notation}
    同型$\phi:T_p(\R^n)\iso\cD_p(\R^n)$による標準基底$e_i$の値は$\paren{\pp{}{x^i}}_p$である．
    よって，この同一視により，接ベクトル$v$は$v=\sum v^i\paren{\pp{}{x^i}}_p$と表す．
\end{notation}

\subsection{ベクトル場}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white, breakable ,colbacktitle=ForestGreen!40!white, coltitle=black,fonttitle=\bfseries\sffamily,
    title=]
    $C^\infty$級ベクトル場の集合$\fX(U)$は，環$C^\infty(U)$上の左加群である．
\end{tcolorbox}

\begin{definition}[vector field]\mbox{}
    \begin{enumerate}
        \item $X\in\prod_{p\in U}T_p(\R^n)$を$U\subset\R^n$上のベクトル場という．普通$U$は開集合とする．
        \item 各$T_p(\R^n)$の基底$\paren{\pp{}{x^i}}_p\;(i=1,\cdots,n)$に関して，$X=\sum^n_{i=1}a^i\pp{}{x^i}$と表す．
        \item ベクトル場$X$が$U$上で$C^\infty$級とは，係数関数$a^i$が$U$上で$C^\infty$級であることをいう．$U$の$C^\infty$級ベクトル場からなる集合を$\fX(U)$と表す．
    \end{enumerate}
\end{definition}

\begin{definition}[ベクトル場の左外算法]
    積$C^\infty(U)\times\fX(U)\to\fX(U)$を，$fX:=\sum_{i=1}^n(fa^i)\pp{}{x^i}$で定める．
\end{definition}

\begin{definition}[module]\mbox{}
    \begin{enumerate}
        \item 単位的な可換環$R$に対して，アーベル群$A$がスカラー倍$\mu:R\times A\to A$をもち，次の３条件を満たすとき，\textbf{（左）$R$-加群}という．
        任意の$r,s\in R$と$a,b\in A$と単位元$1\in R$について，
        \begin{enumerate}
            \item $(rs)a=r(sa)$．
            \item $1a=a$．
            \item $(r+s)a=ra+sa,r(a+b)=ra+rb$．
        \end{enumerate}
        \item 次を満たす写像$f:A\to A'$を$R$-加群の準同型という．
        \begin{enumerate}
            \item $f(a+b)=f(a)+f(b)$．
            \item $f(ra)=rf(a)$．
        \end{enumerate}
    \end{enumerate}
\end{definition}

\subsection{導分としてのベクトル場}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white, breakable ,colbacktitle=ForestGreen!40!white, coltitle=black,fonttitle=\bfseries\sffamily,
    title=]
    $C^\infty$級ベクトル場の集合$\fX(U)$は，環$C^\infty(U)$上の左加群であると同時に，
    右外算法も持つ．
    左右両方からの作用に耐えるとは，少し双線型写像の扱いに似ている．
    点$p$に於ける接ベクトルが関数の芽$C^\infty_p$の点導分と同一視できるのと同様に，開集合$U$上のベクトル場は代数$C^\infty(U)$の導分と同一視できる．
\end{tcolorbox}

\begin{definition}[ベクトル場の右外算法]
    積$\fX(U)\times C^\infty(U)\to\fX(U)$を，$Xf:=\sum^n_{i=1}a^i\pp{f}{x^i}$で定める．
\end{definition}

\begin{proposition}[ベクトル場の作用のLeibniz則]
    \[(\forall_{X\in\fX(U)}),(\forall_{f,g\in C^\infty(U)})\;X(fg)=(Xf)g+fXg\]
\end{proposition}
\begin{proof}
    各点$p\in U$において，導分$X_p\in\cD_p(\R^n)$のLeibniz則より，
    $X_p(fg)=(X_pf)g(p)+f(p)X_pg$
    であるから，$p\in U$の関数としては$X(fg)=(Xf)g+fXg$．書き下せば，$\sum^n_{i=1}a^i\pp{(fg)}{x^i}(-)=g(-)\sum^n_{i=1}a^i\pp{f}{x^i}(-)+f(-)\sum^n_{i=1}a^i\pp{g}{x^i}(-)$を導いたのみである．
\end{proof}

\begin{definition}[derivative of algebra]\mbox{}
    \begin{enumerate}
        \item 体$K$上の代数$A$の\textbf{導分}とは，$K$-線型写像$D:A\to A$であってLeibniz則$D(ab)=(Da)b+aDb$を満たすもののことである．
        \item $A$の導分全体の集合は線型部分空間をなし，これを$\Der(A)\subsetneq\End_K(A)$とかく．
    \end{enumerate}
\end{definition}


\begin{theorem}[ベクトル場と導分の同一視]
    $\R$-線型写像
    \[\xymatrix@R-2pc{
        \varphi:\fX(U)\ar[r]&\Der(C^\infty(U))\\
        \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
        X\ar@{|->}[r]&(f\mapsto Xf)
    }\]
    は同型である．
\end{theorem}
\begin{proof}\mbox{}
    用意でない．
\end{proof}

\section{多重コベクトルの外積代数}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white, breakable ,colbacktitle=ForestGreen!40!white, coltitle=black,fonttitle=\bfseries\sffamily,
    title=テンソル代数，外積代数，対称代数．]
    Hermann Grassmannによるベクトル空間上の交代多重線型関数の形式論．微分形式を支える形式科学である．
    これは線型代数と呼ばれる代数で，特に認知容易性が高いので，普遍的に発見されている構造である．
    \begin{quotation}
        多様体論の基本原理は，全ての多様体が局所的に点における接空間という線型な対象で近似できるという線型化原理である．

        接ベクトルを考える代わりに，双対の観点を取り入れて，接空間上の関数を考えるのが一層実りある結果となる．
    \end{quotation}
    \begin{enumerate}
        \item 基底$e_1,\cdots,e_n\in V$の双対基底$b^1,\cdots,b^n\in V^\vee$を座標関数という．
        \item 置換の符号を，群の埋め込み$\{\pm 1\}\to\Z$として定義する．
        \item 多重線型写像$V^{\times k}\to\R$とテンソル$V^{\otimes k}\to\R$を同一視し，特に交代的なもの$A_k(V)\subset L_k(V)$に注目する．この\textbf{交代的なテンソルを}，次数$k$の多重コベクトルという．
        \item 置換群の左作用$S_k\otimes L_k(V)\to L_k(V)$をテンソルとして定める．テンソルの対称性・交代性はこの射の言葉で特徴付けられる．
        \item 対称化作用素と交代化作用素$S,A:L_k(V)\to L_k(V)$を定める．
        \item 線型写像のテンソル積$L_k(V)\times L_l(V)\to L_{k+l}(V)$をテンソルとして定める．
        \item 外積$\wedge:A_k(V)\times A_l(V)\to A_{k+l}(V)$を，代数の言葉でテンソル積と交代化と縮小の合成として，また，組み合わせ論の言葉で，２通りに定義する．
        \item 外積は反交換的（交代的）である．これはコベクトル$A_k(V)$の交代性の系でもあるが，外積の代数的定義から示せる．
        \item 外積の代数的定義から，その結合性を示す．即ち，テンソル積の結合性を，対称化作用素は保存する．
        \item 
    \end{enumerate}
\end{tcolorbox}
\begin{tbox}{red}{線型空間の定める代数：普遍性の方が大事}
    体上の多元環＝代数とは，数の一般化概念である．
    「体上の加群」と同様の語法であるが，体の線形性のみ違う．これはよく「双線型な乗法をもつ体上の加群」と呼ばれる．
    したがってBourbakiでは単位的なものを線型環ともいう．線型空間であるだけでなく，双線型乗法ももつというわけだ．

    $K$-線型空間$V$に対して，体$K$上の多元環$T^*(V)$が引き起こされる．まず$n$次テンソル冪(tensor power)関手$(-)^{\otimes n}:\Vect^{\otimes n}\to\Vect^{\otimes n}$を定める．
    これらの$V^{\otimes n}$の直和対象はテンソル積についてのモノイドの構造を保ち，テンソル代数と呼ばれる．新たにテンソル積という演算が加わったので，体上の加群から体上の多元環に昇格する．
    これは忘却関手$K$-$\Alg\to\Vect$の左随伴であり，自由対象となっている．
    こうして関手$T^*:\Vect\to K$-$\Alg$を得る．この構成は明らかに任意のモノイド圏で行える．

    構成としては外積代数はテンソル代数の商として得る．
\end{tbox}

\begin{history}
    Hermann Grassmannは多重コベクトルを元に広大な体系を構築したが，生前は評価されず，Élie Cartanの手によって微分形式の理論の代数的基礎として認識されるようになった．
    "ON CERTAIN DIFFERENTIAL EXPRESSIONS AND THE PFAFF PROBLEM" nnales Scientifiques de l'École Normale Supérieure, 16: 239–332 (1899).
\end{history}

\subsection{双対空間}

\begin{example}\label{example-coordinates-as-dual-mappings}
    基底$e_1,\cdots,e_n\in V$の双対基底は，基底$e_1,\cdots,e_n$に関する座標関数$b^1,\cdots,b^n$に他ならない．
    基底を取るとは座標関数を定めるということでもあるわけだ．
\end{example}

\subsection{置換}

\begin{lemma}
    どんな置換$\sigma\in\mathfrak{S}_n=\Aut([n])$も交わりのないサイクル（巡回置換）の積$(a_1\cdots a_r)(b_1\cdots b_s)$の形に表せる．
\end{lemma}
\begin{proof}
    帰納法で示す．$1\in[n]$に$\sigma$を繰り返し適用することでサイクルを得る．これを除いたものから，再び同じことを繰り返せば良い．
\end{proof}

\begin{definition}[permutation]\mbox{}
    \begin{enumerate}
        \item 置換を互換の積で表したとき，その個数が偶数か奇数かによって，\textbf{偶}か\textbf{奇}かを定める．それぞれ，符号を$\sgn(n)=1,-1$と定める．
        \item 置換$\sigma$の\textbf{転位}とは，$i<j$だが$\sigma(i)>\sigma(j)$であるような順序対$(\sigma(i),\sigma(j))$のことである．
    \end{enumerate}
\end{definition}
\begin{remark}[置換の符号の求め方]\mbox{}\label{remark-置換の符号の求め方}
    \begin{enumerate}
        \item 置換の符号を求める算譜に，まずサイクルに分解し，サイクルの長さをみる方法がある．サイクルの長さが偶数／奇数ならば，そのサイクルは奇／偶である．あとは群準同型の関手性$\sgn(\sigma\tau)=\sgn(\sigma)\sgn(\tau)$を用いて求める．
        \item 転位の個数の奇偶をみる算譜もある．転位の個数と積で表すのに必要な互換の個数は一致する．
    \end{enumerate}
\end{remark}

\subsection{多重線型関数}

\begin{notation}\mbox{}
    \begin{enumerate}
        \item $V$上の全ての$k$-tensor（$k$重線型関数のことをいう）からなるベクトル空間を$L_k(V)$と表す．
        \item $V$上の全ての交代$k$重線型関数（交代$k$-tensor，$k$-covectorともいう）からなる空間を$A_k(V)$と表す．
    \end{enumerate}
\end{notation}

\begin{definition}[symmetric, alternative]
    $k$重線型関数$f:V^k\to\R$は，任意の置換$\sigma\in S_k$について，
    \begin{enumerate}
        \item $f(v_{\sigma(1)},\cdots,v_{\sigma(k)})=f(v_1,\cdots,v_k)$ならば\textbf{対称的}という．
        \item $f(v_{\sigma(1)},\cdots,v_{\sigma(k)})=\sgn(\sigma)f(v_1,\cdots,v_k)$ならば\textbf{交代的}という．
    \end{enumerate}
\end{definition}

\subsection{多重線型関数上の置換群の左作用}

\begin{definition}
    積$S_k\times L_k(V)\to L_k(V)$を，$(\sigma f)(v_1,\cdots,v_k)=f(v_{\sigma(1)},\cdots,v_{\sigma(k)})$と定める．
    これは，$L_k(V)$上の線型写像として作用している．
\end{definition}
\begin{example}[対称性・交代性の特徴付け]\label{example-characterization-of-alternizingness}\mbox{}
    \begin{enumerate}
        \item $f$が単位的とは，$\sigma$の作用が単位的$\forall_{\sigma\in S_k}\;\sigma f=f$であることをいう．$f$が交代的であるとは，$\sigma$の作用が$\sgn(\sigma)$倍写像となることである．
        \item $k=1$の時，$S_1$は単位群で，線型写像$f$は対称的でも交代的でもある：$A_1(V)=L_1(V)=V^\vee$．
    \end{enumerate}
\end{example}

\begin{lemma}[群作用である]
    $\tau(\sigma f)=(\tau\sigma)f$．
\end{lemma}
\begin{proof}
    置換$\sigma$が$V^k$上に定める自己同型を$\sigma^k$とする．
    次の写像の列の合成に関する結合律から従う．
    \[\xymatrix@1{
        V^k\ar[r]^-\tau&V^k\ar[r]^-\sigma&V^k\ar[r]^-f&V^k
    }\]
\end{proof}

\subsection{対称化作用素と交代化作用素}

\begin{proposition}[symmetrizer, alternizer]\mbox{}\label{prop-alternizer}
    $f\in L_k(V)$とする．
    \begin{enumerate}
        \item $Sf:=\sum_{\sigma\in S_k}\sigma f$は対称$k$重線型関数である．
        \item $Af:=\sum_{\sigma\in S_k}(\sgn \sigma)\sigma f$は交代$k$重線型関数である．
    \end{enumerate}
\end{proposition}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item 例\ref{example-characterization-of-alternizingness}より，任意の$\tau\in S_k$について，$Sf$への作用が単位的になることを示せば良い．
        \begin{align*}
            \tau(Sf)&=\tau\sum_{\sigma\in S_k}\sigma f\\
            &=\sum_{\sigma\in S_k}\tau\sigma f\\
            &=Sf&\tau\sigma はS_k上を走る.
        \end{align*}
        \item 任意の$\tau\in S_k$について，$Af$への作用が$\sgn(\tau)$倍写像となることを示せば良い．
        \begin{align*}
            \tau(Af)&=\tau\sum_{\sigma\in S_k}(\sgn\sigma)\sigma f\\
            &=\sum_{\sigma\in S_k}(\sgn\sigma)\tau\sigma f\\
            &=\frac{1}{\sgn\tau}\sum_{\sigma\in S_k}\sgn(\tau\sigma)\tau\sigma f\\
            &=\sgn(\tau)Af.
        \end{align*}
    \end{enumerate}
\end{proof}

\begin{proposition}[交代重線型写像への交代化作用素の作用]
    $Af=(k!)f$
\end{proposition}
\begin{proof}
    $S_k$の位数が$k!$であることに注意して，
    \begin{align*}
        Af&=\sum_{\sigma\in S_k}(\sgn\sigma)\sigma f\\
        &=\sum_{\sigma\in S_k}(\sgn\sigma)^2f\\
        &=\sum_{\sigma\in S_k}f=(k!)f.
    \end{align*}
\end{proof}

\subsection{テンソル積}

\begin{definition}
    テンソル積$L_k(V)\times L_l(V)\to L_{k+l}(V)$を，$f\otimes g(v_1,\cdots,v_{k+l})=f(v_1,\cdots,v_k)g(v_{k+1},\cdots,v_{k+l})$によって定める．
    これは，$V$上の積の結合性から，明らかに結合的であるが，一般に可換ではない．
\end{definition}

\begin{example}[双線型形式のテンソル積による表現]
    $e_1,\cdots,e_n\in V$を基底とし，その双対基底を$\alpha^1,\cdots,\alpha^n\in V^\vee$とする．
    ある双線型形式$\bracket{-,-}:V\times V\to\R$について，
    $g_{ij}:=\bracket{e_i,e_j}\in\R$とおくと，各$v=\sum^n_{i=1}v^ie_i,w=\sum^n_{i=1}w^ie_i\in V$について，
    \begin{align*}
        \bracket{v,w}&=\sum_{i,j=1}^nv^iw^j\bracket{e_i,e_j}\\
        &=\sum_{i,j=1}^n\alpha^i(v)\alpha^j(w)g_{ij}\\
        &=\sum_{i,j=1}^ng_{ij}\cdot(\alpha^i\otimes\alpha^j)(v,w)
    \end{align*}
    が成り立つから，
    \[\bracket{-,-}=\sum_{i,j}g_{ij}\alpha^i\otimes\alpha^j\]
    と表せる．
\end{example}

\subsection{ウェッジ積}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white, breakable ,colbacktitle=ForestGreen!40!white, coltitle=black,fonttitle=\bfseries\sffamily,
    title=ウェッジ積の定義]
    ウェッジ積を２通りで定義した．
    \begin{enumerate}
        \item 交代化作用素とテンソル積のことばで定義した．双線型性などの代数的性質と，代数的構成が見えやすい定義で，理論的な支柱になる．
        \item また組み合わせ論的な本質に寄り添えば，riffle shuffleの発想で定義すると，$\begin{pmatrix}k+l\\k\end{pmatrix}$項が直接書き下せる．計算機が計算する時はこちらが適している．
    \end{enumerate}
    置換による交代性の特徴付け（例\ref{example-characterization-of-alternizingness}）も，非常に使い心地が良い．
\end{tcolorbox}

\begin{screen}
    \begin{definition}[wedge product]
        積$\wedge:A_k(V)\times A_l(V)\to A_{k+l}(V)$を，$f\wedge g=\frac{1}{k!l!}A(f\otimes g)$で定めると，命題\ref{prop-alternizer}よりこれは確かに$A_{k+l}(V)$の元である．
    \end{definition}
\end{screen}
\begin{remark}[riffle shuffleの発想による別定義]\mbox{}
    \begin{enumerate}
        \item $k=0$の時，これはスカラー倍$\R\times A_l(V)\to A_l(V)$に一致する．
        \item この定義では$A$の作用によって，$k+l$項の和が生まれている．置換$\sigma\in S_{k+l}$で，$\sigma(1)<\cdots<\sigma(k),\sigma(k+1)<\cdots<\sigma(k+l)$を満たすものは$(k,l)$-shuffleと呼ばれ，
        カードのriffle shuffleで現れる．これを用いて$f\wedge g=\sum_{\sigma:(k,l)\;\mathrm{shuffle}}(\sgn\sigma)f(v_{\sigma(1)},\cdots,v_{\sigma(k)})g(v_{\sigma(k+1)},\cdots,v_{\sigma(k+l)})$と定めると，$\begin{pmatrix}k+l\\k\end{pmatrix}$項の和に抑えられる．
    \end{enumerate}
\end{remark}

\begin{example}
    $k=2,l=1$とすると，
    \begin{align*}
        (f\wedge g)(v_1,v_2,v_3)&=\frac{1}{2!1!}A(f\otimes g)(v_1,v_2,v_3)\\
        &=\frac{1}{2}\sum_{\sigma\in S_3}(f\otimes g)(v_1,v_2,v_3)\\
        &=\frac{1}{2}\left(f(v_1,v_2)g(v_3)+f(v_2,v_3)g(v_1)+f(v_3,v_1)g(v_2)\right.\\
        &\hphantom{====}\left. -f(v_2,v_1)g(v_3)-f(v_3,v_2)g(v_1)-f(v_1,v_3)g(v_2)\right)\\
        &=f(v_1,v_2)g(v_3)+f(v_2,v_3)g(v_1)+f(v_3,v_1)g(v_2).
    \end{align*}
    riffle shuffleで考えると，$f$の引数としては順に$(1,2),(1,3),(2,3)$のみを考えればよく，置換$\begin{bmatrix}1&2&3\\1&2&3\end{bmatrix},\begin{bmatrix}1&2&3\\1&3&2\end{bmatrix},\begin{bmatrix}1&2&3\\2&3&1\end{bmatrix}$の符号をそれぞれ考えて，
    $f(v_1,v_2)g(v_3)-f(v_1,v_3)g(v_2)+f(v_2,v_3)g(v_1)$となる．
\end{example}

\begin{example}[一番単純な場合：covectorのwedge product]
    covector $f,g\in A_1(V)$とvector $v_1,v_2\in V$について，
    \begin{align*}
        (f\wedge g)(v_1,v_2)&\overset{def}{=}1\cdot A(f\otimes g)(v_1,v_2)\\
        &=\sum_{\sigma\in S_2}(\sgn\sigma)\sigma(f\otimes g)(v_1,v_2)\\
        &=(f\otimes g)(v_1,v_2)-(g\otimes f)(v_1,v_2)\\
        &=f(v_1)g(v_2)-f(v_2)g(v_1).
    \end{align*}
\end{example}

\begin{example}[2-covectorのwedge積をshuffleで見る]
    \textbf{それぞれの引数が昇順になるようにする}と，
    $f,g\in A_2(V)$に対して$f\wedge g=\sum_{\sigma:(2,2)\mathrm{shuffle}}(\sgn\sigma)\sigma(f\otimes g)$より，
    \begin{align*}
        (f\wedge g)(v_1,v_2,v_3,v_4)&=f(v_1,v_2)g(v_3,v_4)-f(v_1,v_3)g(v_2,v_4)+f(v_1,v_4)g(v_2,v_3)\\
        &\hphantom{===}+f(v_2,v_3)g(v_1,v_4)-f(v_2,v_4)g(v_1,v_3)+f(v_3,v_4)g(v_1,v_2).
    \end{align*}
    $f$の引数を決めたら$g$の引数の順番が決まる．最後に，互換何個で戻せるかを考えて符号を決める（置換の符号の求め方\ref{remark-置換の符号の求め方}）．
\end{example}

\subsection{ウェッジ積の反交換性}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white, breakable ,colbacktitle=ForestGreen!40!white, coltitle=black,fonttitle=\bfseries\sffamily,
    title=全体のポイント]
    
\end{tcolorbox}

\begin{proposition}[anticommutativity of wedge product]
    ウェッジ積$\wedge:A_k(V)\times A_l(V)\to A_{k+l}(V)$は反交換的である．
    \[\forall_{f\in A_k(V)}\;\forall_{g\in A_l(V)}\;f\wedge g=(-1)^{kl}g\wedge f\]
\end{proposition}
\begin{proof}
    $\tau\in S_{k+l}$を
    \[\tau=\begin{bmatrix}1&\cdots&l&l+1&\cdots&l+k\\k+1&\cdots&k+l&1&\cdots&k\end{bmatrix}\]
    と定めると，$\sgn\tau=(-1)^{k+l}$である．
    これについて，任意の$v_1,\cdots,v_{k+l}\in V$に関して次が成り立つ：
    \begin{align*}
        A(f\otimes g)(v_1,\cdots,v_{k+l})&=\sum_{\sigma\in S_{k+l}}(\sgn\sigma)f(v_{\sigma(1)},\cdots,v_{\sigma(k)})g(v_{\sigma(k+1)},\cdots,v_{\sigma(k+l)})\\
        &=(\sgn\tau)\sum_{\sigma\in S_{k+l}}(\sgn\sigma\tau)f(v_{\sigma\tau(l+1),\cdots,v_{\sigma\tau(l+k)}})g(v_{\sigma\tau(1)},\cdots,v_{\sigma\tau(l)})\\
        &=(\sgn\tau)A(g\otimes f)(v_1,\cdots,v_{k+l}).&\because\sigma\tau もS_{k+l}上を走る
    \end{align*}
\end{proof}
\begin{remarks}
    やはり$\sgn\sigma=\sgn\tau\sgn\sigma\tau$が詐欺っぽいが，$\{\pm 1\}\hookrightarrow\Z$という群の埋め込みを用いて，認知容易性を上げている表現だろう．
\end{remarks}

\begin{corollary}
    $f$を$V$上の奇数次の多重covectorとする．$f\wedge f=0$である．
\end{corollary}

\subsection{ウェッジ積の結合性}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white, breakable ,colbacktitle=ForestGreen!40!white, coltitle=black,fonttitle=\bfseries\sffamily,
    title=全体のポイント]
    C. Godbillonの方法で外積代数の結合性を示す．
    ここで交代化作用素$A$を用いた定義が活きる．
\end{tcolorbox}

\begin{lemma}[交代化作用素の性質]
    $f\in L_k(V),g\in L_l(V)$を多重線型関数とする．
    \begin{enumerate}
        \item $A(A(f)\otimes g)=k!A(f\otimes g)$．
        \item $A(f\otimes A(g))=l!A(f\otimes g)$．
    \end{enumerate}
\end{lemma}
\begin{proof}
    \begin{align*}
        A(A(f)\otimes g)&=\sum_{\sigma\in S_{k+l}}(\sgn\sigma)\sigma\paren{\sum_{\tau\in S_k}(\sgn\tau)\tau f}\otimes g\\
        &=\sum_{\sigma\in S_{k+l}}\sum_{\tau S_{k}}(\sgn\sigma)(\sgn\tau)\sigma\tau(f\otimes g)&\because \otimes の+に対する分配性
    \end{align*}
    ただし，$\tau\in S_{k+l}$は，$\forall_{i=k+1,\cdots,k+l}\tau(i)=i$を満たすように$\tau\in S_k$を延長した．
    いま，各$\mu\in S_{k+l}$に対して，$\mu=\sigma\tau$を満たす$\sigma\in S_{k+l}$は，$\tau\in S_{k+l}$に対して１つずつあるから，
    \[A(A(f)\otimes g)=k!\sum_{\mu\in S_{k+l}}(\sgn\mu)\mu(f\otimes g).\]
\end{proof}
\begin{remarks}
    これは交代化作用素$A$の性質で，任意の$\sigma\in S_k$について$A\paren{(\sgn\sigma)(\sigma f)\otimes g}=A(f\otimes g)$であるために起こる．種$\sigma\in S_k$が何であろうと，$A$はそれを展開して同じところに持っていくのである．軌道みたいな．
\end{remarks}

\begin{proposition}
    $V\in\Vect_R$とし，$f,g,h$をそれぞれ次数$k,l,m$の$V$上の交代多重線型関数とする．このとき，$(f\wedge g)\wedge h=f\wedge(g\wedge h)$．
\end{proposition}
\begin{proof}
    \begin{align*}
        (f\wedge g)\wedge h&=\frac{1}{(k+l)!h!}A((f\wedge g)\otimes h)\\
        &=\frac{1}{(k+l)!h!}\frac{1}{k!l!}A(A(f\otimes g)\otimes h)&\because Aの線形性\\
        &=\frac{1}{k!l!h!}A((f\otimes g)\otimes h)&\because 補題
    \end{align*}
    テンソル積$\otimes$の結合性より，$(f\wedge g)\wedge h=f\wedge (g\wedge h)=\frac{1}{k!l!h!}A(f\otimes g\otimes h)$である．
\end{proof}

\begin{notation}
    $(i,j)$成分が$b^i_j$である行列を$[b^i_j]$で表す．
\end{notation}

\begin{corollary}[wedge product of 1-covectors]\label{cor-wedge product of 1-covectors}
    $\alpha^1,\cdots,\alpha^k\in V^\vee,v_1,\cdots,v_k\in V$とする．
    \[(\alpha^1\wedge\cdots\wedge\alpha^k)(v_1,\cdots,v_k)=\det[\alpha^i(v_j)].\]
\end{corollary}
\begin{proof}
    \begin{align*}
        (\alpha^1\wedge\cdots\wedge\alpha^k)(v_1,\cdots,v_k)&=1\cdot A(\alpha^1\otimes\cdots\otimes\alpha^k)(v_1,\cdots,v_k)\\
        &=\sum_{\sigma\in S_k}(\sgn\sigma)\alpha^1(v_{\sigma(1)})\cdots\alpha^k(v_{\sigma(k)})\\
        &=\det[\alpha^i(v_j)]
    \end{align*}
\end{proof}

\subsection{$k$-covector空間の基底}

\begin{notation}[multi-index notation]
    $e_1,\cdots,e_n\in V$を基底とし，$\alpha^1,\cdots,\alpha^n\in V^\vee$をその双対基底とする．
    多重指数の記号$I:=(i_1,\cdots,i_k)$を導入し，$e_I:=(e_{i_1},\cdots,e_{i_k}),\;\alpha^I:=\alpha^{i_1}\wedge\cdots\wedge\alpha^{i_k}$と表す．
\end{notation}

\begin{lemma}[狭義昇順の多重指数で定まれば一致する]
    $e_1,\cdots,e_n\in V$を基底とし，$\alpha^1,\cdots,\alpha^n\in V^\vee$をその双対基底とする．
    $I=(1\le i_1<\cdots<i_k\le n),\;J=(1\le j_1<\cdots<j_k\le n)$が狭義昇順な長さ$k$の多重指数ならば，
    \[\alpha^I(e_J)=\delta^I_J.\]
\end{lemma}
\begin{proof}
    系\ref{cor-wedge product of 1-covectors}より，$\alpha^I(e_J)=\det[\alpha^i(e_j)]_{i\in I,j\in J}=[\delta^i_j]_{i\in I,j\in J}$．
    $I=J$のとき，これは確かに$\det 1=1$である．
    $I\ne J$のとき，$\exists_{l\in[n]}\;(i_l\ne j_l\land \forall_{1\le j\le l-1}i_k=j_k)$であるが，$i_l<j_l$としても一般性は失われない．
    このとき，$\forall_{k=1,\cdots,l-1}i_l\ne j_k$であるだけでなく，$J$は狭義昇順だから$i_l<j_l<j_k\;(\forall_{k=l+1,\cdots,n})$でもある．よって，第$l$行は$0$であるから，$\det[\alpha^i(e_j)]_{i\in I,j\in J}=0$．
\end{proof}

\begin{proposition}[$k$-covector空間の基底]
    交代$k$重線型関数$\alpha^I\;I=(i_1<\cdots<i_k)$は$A_k(V)$の基底をなす．
\end{proposition}
\begin{proof}
    
\end{proof}

\begin{corollary}
    $\dim V=n\Rightarrow \dim A_k(V)=\begin{pmatrix}n\\k\end{pmatrix}$．
\end{corollary}

\begin{corollary}
    $k>\dim V\Rightarrow A_k(V)=0$．
\end{corollary}

\begin{definition}[graded]
    体$K$上の代数$A$について，
    \begin{enumerate}
        \item Abel群の直和$A=\bigoplus^\infty_{k=0}A^k$に分解できて，乗法写像$A^k\times A^k\to A^{k+l}$が定まっている時，これを\textbf{次数付き}であるという．
        \item 次数付き代数$A$が$\forall_{a\in A^k}\;\forall_{b\in A^l}\;ab=(-1)^{kl}ba$を満たす時，\textbf{反交換}または\textbf{次数付き可換}であるという．
    \end{enumerate}
\end{definition}

\begin{example}[次数付き代数 / supercommutative / graded-commutative]\mbox{}
    \begin{enumerate}
        \item 多項式代数$A=\R[x,y]=\bigoplus_{k=0}^\infty\bigoplus_{l=0}^\infty\R x^ly^{k-l}$は，多項式の次数について次数付きである．
        \item \textbf{テンソル代数}$T^*(V):=\bigoplus^\infty_{k=0}T^k(V)$．ただし，$T^k(V):=V^{\otimes k}$とし，積をテンソル積$T^k\otimes T^l\to T^{k+l}$とした．
        \item \textbf{外積代数／Grassman代数}$A_*(V)=\bigoplus^\infty_{k=0}A_k(V)=\bigoplus^n_{k=0}A_k(V)$．ただし，$n:=\dim V$とした．
        \item 斉次座標環？
    \end{enumerate}
\end{example}

\begin{itembox}[l]{この節で定義したもの：外積代数}
    R-加群のテンソル代数は自然に R-代数になり、またその商代数である外積代数と対称代数も同様である。圏論的な言葉で言えば、R-加群をそのテンソル代数へ写す函手は R-代数を台となる R-加群へ写す函手（環構造を忘れる忘却函手）の左随伴である。
\end{itembox}

\section{Euclid空間上の微分形式}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white, breakable ,colbacktitle=ForestGreen!40!white, coltitle=black,fonttitle=\bfseries\sffamily,
    title=]
    $\R^n$上の微分形式を，ウェッジ積と外微分と共に導入する．
    ひとまず，標準基底の言葉で定義するが，これは基底に依らず，一般の多様体で定義できる概念である．
\end{tcolorbox}

\subsection{微分1-形式と関数の微分}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white, breakable ,colbacktitle=ForestGreen!40!white, coltitle=black,fonttitle=\bfseries\sffamily,
    title=関数の微分とは余ベクトル場である]
    今まで僕らが見ていたもの$\pp{f}{x}$は，多様体上に内在的に定まっている関数の微分$df$が，標準基底を暗黙の前提にすることによって，退化したものである．微分係数という語が偶然一致するが，係数関数にあたる．
    まあ，人間にとって，結局はそれ（形式と計算）以外に捉えようがないが．
\end{tcolorbox}

\begin{definition}[cotangent space, differential 1-form, differential]\mbox{}
    \begin{enumerate}
        \item 余接空間を$T^*_p(\R^n):=(T_p(\R^n))^\vee$と定める．
        \item \textbf{（微分）1-形式}または\textbf{余ベクトル場}とは，写像$\omega\in\prod_{p\in U}T^*_p(\R^n)$をいう．
        \item 関数$f\in C^\infty(\R^n)$に対して，1-形式$df$を$(df)_p(X_p):=X_pf$と定め，$f$の\textbf{微分}という．
    \end{enumerate}
\end{definition}
\begin{remarks}[関数の微分とは1-形式である，座標に依らずに微分は最初から多様体上に定まっている]
    これは，方向微分
    \[\xymatrix@R-2pc{
        \bracket{\;,\;}:T_p(\R^n)\times C_p^\infty(\R^n)\ar[r]&\R\\
        \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
        (X_p,f)\ar@{|->}[r]&X_pf
    }\]
    について，接ベクトル$X_p$を$\bracket{X_p,-}$と同一視し，微分$(df)_p$は$\bracket{-,f}$のことだと見れる．
\end{remarks}

\begin{proposition}[関数の微分の成分表示]
    $f\in C^\infty(U)$について，$df=\sum\pp{f}{x^i}dx^i$．
\end{proposition}
\begin{proof}\mbox{}
    \begin{description}
        \item[$dx^i$は基底である] 
        \[(dx^i)_p\paren{\pp{}{x^j}}_p\overset{def}{=}\paren{\pp{}{x^j}}x^i=\delta^i_j\]
        より，$dx^i_p\in T^*_p(U)$は$\paren{\pp{}{x^i}}_p\in T_p(U)$の双対基底である．
        よって，
        \[(df)_p=\sum a_i(p)(dx^i)_p\in T^*_p(U)\]
        を満たす実数$a_i(p)\in\R$が存在し，結局は関数$a_i:U\to\R$が存在する．
        \item[同一法]
        従って，$df=\sum a_idx^i\in\prod_{p\in U}T^*_p(U)$の両辺の$\pp{}{x^i}$での値を取ると，
        左辺は$df\paren{\pp{}{x^i}}=\pp{}{x^i}f=\pp{f}{x^i}$であり，右辺は$\sum_{j}a_jdx^j\paren{\pp{}{dx^i}}=\sum a_j\delta^i_j=a_i$．
        よって，$a_i=\pp{f}{x^i}\in C^\infty(U)$とわかる．
    \end{description}
\end{proof}
\begin{remarks}
    今まで僕らが見ていたものは，多様体上に内在的に定まっている関数の微分$df$が，標準基底を暗黙の前提にすることによって，退化したものである．
    まあ，結局はそれ以外に捉えようがないが．
\end{remarks}

\begin{proposition}[双対命題]
    $df$とは余ベクトル場であるから，ベクトル場$X$についても，
    $X=\sum dx^i\pp{}{x^i}$が成り立つ．
\end{proposition}
\begin{proof}
    まず$X_p=\sum b^i(X_p)\paren{\pp{}{x^i}}_p\Rightarrow b=dx^i\in T^*(U)$が成り立つ．
\end{proof}

\subsection{微分$k$-形式}

\begin{definition}[$k$-form]
    一般に，微分$k$-形式とは，$U$上の各点に交代$k$-重線型形式を割り当てる写像$w\in\prod_{p\in U}A_k(T_p(\R^n))$である．$A_1(T_p(\R^n))=T^*_p(\R^n)$である．
    $U$上の$C^\infty$級$k$-形式からなる実線型空間を$\Omega^k(U)$と表す．
\end{definition}

\begin{lemma}
    wedge積は反交換で結合的な双線型写像$\wedge:\Omega^k(U)\times\Omega^l(U)\to\Omega^{k+l}(U)$を定める．
\end{lemma}

\begin{lemma}
    直和$\Omega^*(U)=\bigotimes^n_{k=0}\Omega^k(U)$は$\R$上の反交換次数つき代数となる．
    同時に，環$C^\infty(U)$上の加群でもある．
\end{lemma}

\subsection{多重線型形式としての微分形式}

\begin{lemma}
    次のように$\mathcal{F}(U)$-双線型写像が定まる．
    \[\xymatrix@R-2pc{
        \Omega^k(U)\times\mathcal{X}(U)\times\cdots\times\mathcal{X}(U)\ar[r]&C^\infty(U)\\
        \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
        (\omega,X_1,\cdots,X_k)\ar@{|->}[r]&\omega(X_1,\cdots,X_k)
    }\]
\end{lemma}

\subsection{外微分}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    外微分を代数法則により特徴付ける．
\end{tcolorbox}

\begin{definition}[exterior derivative]
    \[\xymatrix@R-2pc{
        \Omega^k(U)\ar[r]&\Omega^{k+1}(U)\\
        \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
        \omega=\sum_Ia_Idx^I\ar@{|->}[r]&d\omega:=\sum_Ida_I\wedge dx^I
    }\]
\end{definition}

\begin{definition}[反導分]\mbox{}
    \begin{enumerate}
        \item 次数つき代数$A=\bigoplus_{k=0}^\infty A^k$の\textbf{反導分}とは，
        $a\in A^k,b\in A^l$に対して$D(ab)=(Da)b+(-1)^kaDb$を満たす$K$-線型写像$D:A\to A$のことをいう．
        この代数規則をgraded Leibniz ruleという．
        \item $\exists_{m\in\Z}\;\forall_{k\in\N}\;D(A^k)\subset A^{k+m}$を満たすとき，$D$を次数$m$の反導分という．
    \end{enumerate}
\end{definition}

\begin{proposition}[外微分の性質]\mbox{}
    \begin{enumerate}
        \item 外微分$d:\Omega^*(U)\to\Omega^*(U)$は次数１の反導分である：$d(\omega\wedge\tau)=(d\omega)\wedge\tau+(-1)^{\deg\omega}\omega\wedge d\tau$．
        \item $d^2=0$．
        \item $f\in C^\infty(U),X\in\mathcal{X}(U)$に対して，$(df)(X)=Xf$．
    \end{enumerate}
\end{proposition}

\begin{proposition}[外微分の特徴付け]
    命題の３条件を満たす線型写像$D:\Omega^*(U)\to\Omega^*(U)$は外微分$d$である．
\end{proposition}

\subsection{閉形式と完全形式}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    $d\omega=0$を閉形式という．微分は境界演算子と考えられるからである．
    $\omega=d\tau$を満たす$k-1$-形式$\tau$が存在する場合完全形式という．$\C$上の単連結領域みたいなものである．
\end{tcolorbox}

\begin{definition}[cochain complex]
    微分複体またはコチェイン複体$V^\bullet$とは，線型空間の族$(V^k)_{k\in\N}$と$d_{k+1}\circ d_k=0$を満たす線型写像の族$d_k:V^k\to V^{k+1}$の組をいう．
    de Rham複体とは，$(\Omega^\bullet(U),d)$が定める列
    \[0\xrightarrow{d}\Omega^0(U)\xrightarrow{d}\Omega^1(U)\xrightarrow{d}\Omega^2(U)\to\cdots\]
    である．
\end{definition}

\begin{definition}[de Rham cohomology]
    de Rham複体のコホモロジー$H^k(U):=Z_n(V)/B_n(V)=\Ker(d_{n-1})/\Im(d_n)$をde Rham cohomologyという．
\end{definition}

\chapter{多様体}

\begin{quotation}
    \begin{description}
        \item[多様体] $\R^n$を数という祈りの高い形式として構成した．
        これを聖典として，「$\R^n$を用いて観測・分析可能な対象」として多様体を構成する．
        多様体は各点の近傍の性質が一定であるような等質な空間であることがわかる．このような等質な空間の理論がきちんと出来上がることにより，特異点を持つような空間も扱えるようになる．\cite{坪井}
        これは$\R^n$上にリフトできる圏論的構造物となる．
        \item[圏論化] 多様体という構造物を圏論化することが目標である．すると，Euclid空間の場合も含めて，微積分の理論を関手的に理解できる．
        \item[幾何学の土台] ベクトル場の全体はLie代数の構造をもち，その積分としてLie群の作用などが考えられる．微分形式は次数付き微分加群の構造をもち，de Rhamコホモロジーという不変量を与える．多様体が定義されると，その上部構造として
        Riemann構造，複素構造などが定式化される．こうして新しい視点で幾何学を見直すことができるようになったのである．
    \end{description}
    \begin{itemize}
        \item Hausdorffで第２可算な局所Euclidな空間を位相多様体という．
        \item それらのチャートが$C^r$級で両立する時，これを$C^r$級微分可能多様体という．
        \item チャートを１つ定めると，変数変換で写り合う関係は同値関係を定め，その同値類として極大チャートが自動的に定まるという構造がある．これを微分構造という．\footnote{事情は連結成分の議論と似ている．}
    \end{itemize}
\end{quotation}

\begin{history}
    Gaussは1827の『曲面の研究』ですでにチャートのアイデアを持っていた．
    その後Riemannの就任公演が高次元微分幾何の礎となった．
    manifoldとはRiemannの使った言葉Mannigfaltigkeitの直訳である．
\end{history}

\section{多様体の定義}

\begin{notation}\mbox{}
    \begin{enumerate}
        \item $e^1,\cdots,e^n\in\R^n$を標準座標とし，局所座標$\varphi$に対して局所座標関数を$x^i:=e^i\circ\varphi$とする．
    \end{enumerate}
\end{notation}

\subsection{定義}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=局所Euclid空間のうちHausdorffなものが位相多様体で，チャート同士が$C^r$級で両立するものが微分可能多様体]
    多様体は観測の対象全体がなす空間である．
    また，座標近傍$(U,\varphi)$の$U$は観測できる範囲，$\varphi$は観測の仕方に対応する．
    多様体上の函数$f$が$C^s$級である，ということは任意の観測
    （任意の座標近傍）について$f$が$C^s$級に見える，ということにより定める．
    例えば観測にあたる$\varphi_1,\varphi_2,\psi_1,\psi_2$も同相写像でしかなく，
    これらについては微分を直接考えることはできないし，
    $f$の微分も直接計算することはできない．
    一方，$M,N$が$C^r$級の多様体であるというのは，$\varphi_2\circ\varphi_1^{-1}$や$\psi_2\circ\psi_1^{-1}$が$C^r$級である，ということである．
    これは，観測の差は$C^r$級の法則（式）に従う，と考えることができる．
\end{tcolorbox}

\begin{definition}[$C^r$ manifold]\label{def-manifold}
    局所Euclid的な位相空間$(M,\O)$が$C^r$級多様体であるとは，次の２条件を満たすことをいう．
    \begin{enumerate}
        \item $M$は第２可算でHausdorffである．（$\Lambda$が可算に，特に$\Lambda=\N$と取れる）．\footnote{これを落とすとWhitneyの埋め込み定理が成り立たない．}
        \item $M$の開集合の族$\U=(U_\lambda)_{\lambda\in\Lambda}\subset\O$であって，次の２条件を満たすものが存在する：
        \begin{enumerate}[(a)]
            \item $\U$は$M$の被覆である．
            \item $\forall_{\lambda\in\Lambda}\;\exists_{V_\lambda\in\O_{\R^n}}\;\exists_{\varphi_\lambda\in\Isom_\Top(U_\lambda,V_\lambda)}\;\forall_{\mu\in\Lambda}\;\varphi_\mu\circ\varphi_\lambda^{-1}|_{\varphi_\lambda(U_\lambda\cap U_\mu)}:C^r\text{級}$．
        \end{enumerate}
    \end{enumerate}
    \begin{itemize}
        \item $\varphi_\mu\circ\varphi_\lambda^{-1}|_{\varphi_\lambda(U_\lambda\cap U_\mu)}:\varphi_\lambda(U_\lambda\cap U_\mu)\to\varphi_\mu(U_\lambda\cap U_\mu)$を\textbf{座標変換}という．
        \item 組$(U_\lambda,\varphi_\lambda)$を座標近傍といい，その族$((U_\lambda,\varphi_\lambda))_{\lambda\in\Lambda}$を座標近傍系という．
        \item $n:=\dim M$を次元と呼ぶ．
        \item $V$の座標は$(x_1^\lambda,x_2^\lambda,\cdots,x_n^\lambda)$と表し，$U$上の局所座標という．それぞれの$x_\lambda^i$を座標関数という．
        \item $\R^n$の代わりに$\C^n$，$\varphi_\mu\circ\varphi_\lambda^{-1}|_{\varphi_\lambda(U_\lambda\cap U_\mu)}$を$C^r$級ではなく複素解析的とすると，この$M$を複素多様体という．
        \item $r=\omega$とすると，\textbf{解析多様体}という．
        \item (2)(b)の条件を「局所$C^r$級微分同相的」という．この条件を単に同相写像とすると，位相多様体といい，この時の(2)(b)の条件を「局所Euclid的」ともいう．
        \item （極大な$C^\infty$級）アトラスを，位相多様体$M$上の\textbf{微分構造}ともいう．
    \end{itemize}
\end{definition}
\begin{remarks}
    (1)が「入れ物から抜け出す」ための位相空間論からの霊性．可算基を持つ位相多様体上の$C^r$級微分構造は必ず$C^\infty$級可微分構造に従属する．\footnote{$C^\infty$級チャートと$C^r$級で両立するということ．}
    (2)(a)がEuclid部分多様体に於ける逆関数定理による知識，(b)が陰関数定理による知識と対応する．
\end{remarks}

\begin{example}\mbox{}
    \begin{enumerate}
        \item (cusp) 関数$f(x)=x^{2/3}$のグラフは2次元位相多様体である．
        \item (cross) $\R^2$の部分空間$[-1,1]\times[-1,1]$は位相多様体にはなり得ない．仮に$n$次元位相多様体とすると，$p$を中心とするchart $(U,\varphi)$が存在するはずだが，$\varphi(U\setminus\{p\})$は４つの連結成分からなるのに対して，$\varphi(U)\setminus\{\varphi(p)\}$は$n\ge 2$のとき連結，$n=1$のとき２つの連結成分からなる．よって，$\varphi$が同相写像であることに矛盾．
        \item $0$次元多様体とは，$\R^0=1$と局所同相な，第２可算Hausdorffな位相空間であるから，可算な離散空間のことである．
        \item 開集合$U\subset\R^n$上の滑らかな関数$f\in C^\infty(U)$のグラフ$\Gamma(f)$は，１つのチャート$(\Gamma(f),q_n)$のみからなる$C^\infty$級多様体である．
        \item 一般線型群は$\GL_n(\R)=\det^{-1}(\R\setminus\{0\})\subset\R^{n^2}$の開集合であるから，多様体である．
        \item $S^n\subset\R^{n+1}$に微分構造を入れたものを標準$n$球面という．John Milnorは1956年に$S^7$と同相だが微分同相ではないexotic $7$球面を発見した．
        その後63年にMichel Kervaireと$S^7$上には28個の異なる微分構造があり得る（入り得るatlasのなす半順序が極大を28もつ）ことを証明した．Michel Kervaireは微分構造を持たない位相多様体を構成した．
        \item $n<4$では全ての位相多様体はただ一つの微分構造を持つ．が，$n\ge 4$では微分構造を持たないものがある．$n>4$でも全ての位相多様体は，コンパクトならば有限個の微分構造を持つ．一方で$S^4$の微分構造の数は未解決問題である．
        \item Kochの雪片は$S^1$と同相であり，同じ微分構造ももつ（！）．
        \item (long line) 第一非可算順序数との直積$L_+:=\omega_1\times[0,1)$を長い半直線，$L:=L\coprod L/(\{((0,0,0),(1,0,0))\}\cup\Delta)$を長い直線という．ただし，辞書式順序である．これは局所Euclid空間でパラコンパクトかつHausdorffである（したがって正規，Dieudonnéの定理）．
        \item (Poincaré) ３次元多様体がコンパクト，連結，単連結ならば，$S^3$と同相．こうして一般に，$n$次元多様ツアいが，単連結（基本群が自明）でホモロジー群が$n$次元球面と同じならば，$S^n$と同相であることが一般的にわかった．
    \end{enumerate}
\end{example}

\subsection{微分構造：極大アトラスのこと}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=極大ではないかもしれないアトラスを１つ定めることと，微分構造を１つ定めることは同値である．]
    チャートが両立するとは$C^\infty$級の座標変換が存在することをいう．
    位相多様体$M$を被覆して$C^\infty$級で両立するチャートの族を単に
    アトラスという．すると，アトラスのなす半順序のなかで，極大のものが定まる．\footnote{松島多様体には，「位相空間の基本近傍系が位相を定義するのと同様の考え方である」とある．}
    これを微分構造と呼ぶ．
\end{tcolorbox}

\begin{lemma}
    チャートが両立するという関係は，反射的で対称的だが，推移的ではない．
\end{lemma}

$U_1\cap U_2,U_2\cap U_3$で両立するからといって，
$U_1\cap U_3\setminus(\cup_{i=1,2,3}U_i)$上でも両立する保証はない．
そこで，次のように考える．

\begin{lemma}
    ２つのチャート$(U,\varphi),(V,\psi)$がアトラス$\{U_\alpha,\varphi_\alpha\}$と両立するならば，互いに両立する．
\end{lemma}

\begin{proposition}[アトラスの極大性はあまり気にしないで良い]
    局所Euclid空間上の任意のアトラス$\U=\{U_\alpha,\phi_\alpha\}$は，ただ一つの極大アトラスが存在してこれに含まれる．
\end{proposition}
\begin{proof}
    アトラスを$\mathcal{M}:=\U\cup\{(V,\psi)\mid チャート(V,\psi)は\U と両立する\}$と定めれば良い．
\end{proof}

\subsubsection{アトラス論再考}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=多様体とは上部構造付きの構造である．]
    座標近傍とは局所的な消息であるから，チャートは座標近傍の族というよりかは，取り方の族を指定していると考えてた方がいい．
    すなわち，開集合と同相写像の組$(U,\varphi)$が与えられるたびに，これが近傍系かを判定できる空間である．
    
    多様体$M$上のアトラス$\U:=\{(U_\alpha,\varphi_\alpha,V_\alpha)\}_{\alpha\in A},\O:=\{(O_\lambda,\psi_\lambda,W_\lambda)\}_{\lambda\in\Lambda}$
    は，集合$\U,\O\subset(P(M)\times)P(M\times\R^m)(\times P(M))$とみなせる．
\end{tcolorbox}

\begin{definition}[equivalence of charts]
    ２つのチャートが同値$\U\simeq\O$であるとは，恒等写像が定める多様体の射$1_A:(M,\U)\to(N,\O)$が$C^r$級微分同相写像であることをいう．
    この定義は，組$(M,\U\cup\O)$が$C^r$級多様体であることと同値．つまり，両立するということである．
\end{definition}

\begin{lemma}
    関係$\simeq$は同値関係である．このとき，$(M,\U)=(M,\O)$と表し，極大アトラスを完全代表系とする．
\end{lemma}

\begin{definition}[maximal atras]
    $\U^\mathrm{max}$を極大アトラスとし，単に$M$と書いて$(M,\U^\mathrm{max})$のことを表す．
\end{definition}

\begin{example}
    開集合$O\subset\R^m$について，$(O,(O,\id_O,O))$は$m$次元多様体である．
    が，完全代表系としては，$(U_\alpha)_{\alpha\in A}$を$O$内の全ての開集合として，$(O,\{(U_\alpha,\varphi_\alpha,V_\alpha)\}_{\alpha\in A})$を考える．
\end{example}

\subsubsection{微分同相写像と微分構造}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=多様体の座標関数を特徴づけることができる]
    座標写像は微分同相写像であるが，実は$\Iso_\Diff(M,\R^n)$は，多様体$M$の極大アトラスに参加している座標写像に限る．
    つまり，極大アトラスというのは，多様体$M$が「生成する充満部分圏」のようなものか．
\end{tcolorbox}

\begin{lemma}[次元の位相不変性]
    $r\ge 1,M\ne\emptyset$とする．$C^r$級微分同相写像$f:M\iso_N$が存在するとき，$\dim M=\dim N$である．
\end{lemma}
\begin{proof}
    $x\in M\ne\emptyset$を取ると，ある$\alpha\in A,\lambda\in\Lambda$が存在して，
    \[\psi_\lambda f\varphi^{-1}_\alpha:\varphi_\alpha(U_\alpha\cap f^{-1}(O_\lambda))\to\psi_\lambda(f(U_\alpha)\cap O_\lambda)\subset\R^n\]
    は$C^r$級である．$f$は可逆だから，同様にして，
    \[\varphi_\alpha f^{-1}\psi^{-1}_\lambda:\psi_\lambda(f(U_\alpha)\cap O_\lambda)\to \varphi_{\alpha}(U_\alpha\cap f^{-1}(O_\lambda))\subset\R^n\]
    が存在し，これはEuclid空間の間の可逆な$C^r$級微分同相写像になっている．
    よって，補題\ref{lemma-Jacobi-matrix-of-diffeomorphism}より，$\dim M\overset{def}{=}m=n\overset{def}{=}\dim N$．
\end{proof}
\begin{remark}
    $r=0$でも成り立つが，Jacobi行列の議論が使えないために，証明を変える必要がある．
    \[H_q(M,M\setminus\{x\})\underset{切除同型}{\simeq}H_q(\R^m,\R^m\setminus\{x\})=\begin{cases}
        \Z,&\mathrm{if}\; q=n,\\
        0,&\mathrm{if}\; q\ne n.
    \end{cases}\]
    を用いて矛盾を導く．
\end{remark}

\begin{proposition}
    $(U,\phi)$が位相多様体$M$のチャートとする．
    $C^\infty$級で両立することは要請されるが，$\phi$自体は同相写像という条件しか課していなかった．
    いま，$\varphi:U\to\varphi(U)\subset\R^n$は微分同相写像である．
\end{proposition}

\begin{proposition}
    $U\subset M$を開集合とする．$F:U\to F(U)\subset\R^n$が微分同相写像であるとする．
    $(U,F)$は$M$の微分構造（＝極大チャート）のチャートである．
\end{proposition}
\begin{proof}
    $(U,F)$は極大アトラスと両立する．微分構造の極大性より，$(U,F)$は微分構造に属する．
\end{proof}

\subsection{公理の弱化}\label{subsection-sheaf}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    (1)での２つの仮定を精査する．
    Hausdorff性を仮定したので$C^\infty$級関数は大域への延長をもち，第２可算性を仮定したので，これはEuclid空間に埋め込める．
    また，圏をなし，自由な構成が可能である．
    こうしてRiemannの霊性を湛えた数学的対象を得た．
\end{tcolorbox}

\subsubsection{Hausdorff性の準備}

\begin{lemma}
    $X$をHausdorff空間とする．
    \begin{enumerate}
        \item Hausdorff空間$X$への連続写像$f,g:Z\to X$について，$\{z\in Z\mid f(z)\ne g(z)\}$は開集合であり，その補集合は閉集合である．
        \item コンパクトな部分空間$K\subset X$は閉集合である．$X$がコンパクトならば逆も成り立つ．
    \end{enumerate}
\end{lemma}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item $(f-g)^{-1}(0)$はHausdorff空間の一点集合，特に閉集合の逆像であるから閉である．
        \item 包含写像$i:K\to X$は連続である．これがcompact集合からHausdorff空間への連続写像であるから閉写像である．$K$は$K$-閉集合であるから，$K\subset X$も$X$-閉集合である．
    \end{enumerate}
\end{proof}
\begin{remark}
    コンパクト台をもつ$C^\infty$級関数というものを全体に延長する．
    これに第２可算性を付け加えると，$\exists_{N>1}\;\R^N$に埋め込むことが可能になる．
\end{remark}

\subsubsection{Hausdorffでない局所Euclid空間}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    $C^\infty$級関数の芽の層はHausdorffではない．ここからたくさんの例を作れる，例えば$x$軸と，$C^\infty$級関数$f(x)=0\;(x\le 0),\;f(x)=e^{-1/x}\;(x>0)$とでは，$x=0$での関数の値は同じだが，関数の芽としては違う．
    一方で，正則関数の層はHausdorffである．解析接続が可能であるのは，このHausdorff性による．
\end{tcolorbox}

\begin{example}[line with two origins]
    Euclid空間$\R$の直和上の同値関係$\sim\subset\R\coprod\R$を，$(i,x)\sim (i,y):\Leftrightarrow (x=y)\land\lnot(x=0\land i\ne j)$と定めた時，商空間$\R\coprod\R/\sim$を２つの原点を持つ直線という．
    この空間の２つの原点の開近傍は必ず交わってしまう．
    しかし，局所$C^\infty$級微分同相である．
\end{example}

\begin{example}[branching line]
    $\sim=\{((i,x),(j,y))\in(\R\coprod\R)^2\mid x<0\land y<0\}$として，$\R\coprod\R/\sim$は原点にて分岐する直線である．
\end{example}

\subsection{パラコンパクト性}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    局所コンパクトハウスドルフ空間が，Euclid空間などを含む標準的な対象である．
    距離空間は全てパラコンパクトである．

    局所化された位相用語は，全て存在命題．
\end{tcolorbox}

\begin{definition}[Lindelöf]\mbox{}
    \begin{enumerate}
        \item 被覆$(U_i)_{i\in I}$が\textbf{局所有限}とは，任意の点$p$に対して，$\abs{\Brace{i\in I\mid V_p\cap A_i}}<\infty$を満たす近傍$V_p$が存在することをいう．
        \item $X$が\textbf{パラコンパクト}とは，任意の開被覆$(U_i)_{i\in I}$に対して，局所有限な開細分が存在するHausdorff空間のことをいう．
        \item $X$が\textbf{局所コンパクト}とは，任意の点$p$に対して，$\o{U}$がコンパクトであるような近傍$U$が存在することをいう．
        \item $X$が\textbf{可算基を持つ}とは，可算な開集合の族$(O_\alpha)_{\alpha\in A}$であって，$\forall_{O\in\Op(X)}\;\forall_{p\in X}\;\exists_{\alpha\in A}\;p\in O_\alpha\subset O$が成り立つことをいう．
        \item $X$が可算個のコンパクト集合の和集合として表されるとき，これを\textbf{$\sigma$-コンパクト}という．
        \item $X$が\textbf{リンデレーフ}であるとは，任意の開被覆に対して，可算な部分被覆が存在することをいう．
    \end{enumerate}
\end{definition}

\begin{lemma}
    $X$を位相多様体とする．次の３条件は同値．
    \begin{enumerate}
        \item $X$は可算基を持つ．
        \item $X$はLindelöf空間である．
        \item $X$は$\sigma$-コンパクトである．
    \end{enumerate}
\end{lemma}

\section{Euclid空間の部分多様体}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=Euclid空間の部分多様体とは，局所的にEuclid空間のAffine部分空間に微分同相な空間である．ここから入れ物からの離脱を試みる．]
    Euclid空間での多様体の定義の特徴づけは，写像の生息地としてEuclid空間に似たものとする．
    それは，局所的にEuclid空間のAffine部分空間と見做せて，いつも通りの平面と見做せることが条件となる．
    微積分とは線型化であるから，微分可能多様体論では，ここで自然に行列と線型空間論が生じている．

    ここでは，Jacobi行列という最強の数値的道具があり，ここに引き戻すことが観測であり，
    物理学的な理論の祈りである．
    Yacobianが消えている＝ランク落ちしているならば，局所$C^r$級微分同相で，座標変換が存在する．この２つの知識は逆関数定理と陰関数定理と呼ばれ，多様体の定義に昇華される．
    この２つの定理の証明に用いられる，微積分学と線形代数学の交差が本当に綺麗だ．
    しかし，Euclid空間に埋め込まれている状態の知識では，数値的な議論には強いが，定性的な議論には不透明さが残り，抽象化が足りないと言える．

    思ったが，逆関数定理は，標準分解の形に似ているが，全射と全射で同型を挟む部分が違い，これは
    同型部分の抽出という意味がつく．
    標準分解の時からそうであるが，この写像の分解の形が，「$M$上の射」や「束の射」に形が似ている．
    今回は２つとも全射であるから，束の理論につながるのである．
    これが線型化の理論であり，微分の本質であると言えるだろう．
    また２つの全射が引き起こす同型部分は共変的であるから，微分を$F_*$と表す．
\end{tcolorbox}

\subsection{Euclid空間の局所微分同相性と逆関数定理}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
    title=Euclid空間に埋め込まれた多様体とは，行列式関数の正則点からなる集合のこと]
        Euclid空間の部分空間が部分多様体をなすことを示すためには，すでに(1)Hausdorff性と第２可算性，(2)(a)の局所同相な開被覆の存在も解っているから，
        \textbf{局所$C^r$級微分同相性}（定義\ref{def-manifold}の(2)(b)の条件）
        のみを確かめれば良いが，これは逆写像定理より，各点についてYacobianが消えないことを確認することに同値．

        逆関数定理：微分同相写像$U\iso V$は各点$x\in U$でJacobianが消えていないが（局所的に線型写像で近似してもその線型写像は可逆になる），これが局所的には逆も成り立つ．
        これはベクトル束の局所自明性としても理解できる．
        こうして，局所の消息の貼り合わせが問題になる．
        \footnote{ここで，標準的なテンソル場$JF$の役割と普遍性が見えてくる．
        この議論が成り立つのは，３つの定理が同値だからである．
        これをまず一番canonicalな場合でみる．}
\end{tcolorbox}

\begin{lemma}[Yacobi行列の性質]\mbox{}
    \begin{enumerate}
        \item $A\in M_{nm}(\R)$倍写像$A:\R^n\to\R^m$について，$\forall_{p\in\R^n}\;(JA)_p=A$．特に，$\forall_{p\in\R^n}\;(J\id_{\R^n})_p=I_n$．
        \item $C^r$級写像$F:\R^n\supset U\to\R^m,F':\R^m\supset U'\to \R^l$について，合成$F'\circ F:F^{-1}(U')\to\R^l$も$C^r$級写像で，$\forall_{p\in F^{-1}(U')}\;J(F'\circ F)_p=(JF')_{F(p)}(JF)_p$．
    \end{enumerate}
\end{lemma}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item Yacobi行列は$A$倍写像$f$の偏微分を並べた行列である．退化した例だと$a$倍写像$f(x)=ax:\R\to\R$で，これの微分は$a$である．一般の場合も$f_i=a_{i1}x_1+a_{i2}x_2+\cdots+a_{in}x_n$となる．
        \item 偏微分についてのChain Ruleから成り立つ．
    \end{enumerate}
\end{proof}
\begin{remarks}
    (1)は，線型写像の微分＝線形近似は，自分自身に他ならないことを言っている．
    (2)は，$C^r$級写像が射をなし得ることをいう．
\end{remarks}

\begin{lemma}[微分同相ならばJacobianは消えない]\label{lemma-Jacobi-matrix-of-diffeomorphism}
    $F:\R^m\supset U\iso U'\subset\R^n$を$C^r$級微分同相とする$r\in[0,\infty]$．
    任意の$p\in U$について，$(JF)_p$は可逆で，逆写像を$G:U'\to U$とすると逆行列は$(JG)_{F(p)}$である．
    特に$U\ne\emptyset$ならば，$n=m$である．
\end{lemma}
\begin{proof}\mbox{}
    \begin{description}
        \item[$r>0$のとき] $G\circ F=\id_{U},F\circ G=\id_{U'}$を微分して，$(JG)_{F(p)}(JF)_p=I_n$，$(JF)_p(JG)_{F(p)}=I_m$．よって互いに逆行列だし，両方の跡を取ると$n=m$．
        \item[$r\ge 0$のとき] 相対cohomologyが
        \[H_k(U,U\setminus\{p\};\Z)=\begin{cases}
            \Z&k=n\\
            0&otherwise.
        \end{cases}\]
        となることより．
    \end{description}
\end{proof}
\begin{remark}
    逆は成り立たない．Jacobianが各所で消えないからと言って，それらを貼り合わせて全体で可逆とは限らないが，局所的には成り立つのが$C^r\;(1\le r\le\infty)$級連続写像である．
    ランクの半連続性\ref{lemma-semicontinuity-of-rank}のような消息もある．
    これは各点で少しずつ変化する行列の貼り合わせである．
\end{remark}

\begin{theorem}[逆関数定理：局所微分同相性の$\R^n$に於ける特徴付け]\label{thm-inverse-mapping-theorem}
    $f:\R^n\supset U\to\R^n$を開集合上の$C^r$級写像とする．
    点$p_0\in U$において$\det(JF)_{p_0}\ne 0$ならば，ある$F(p_0)$近傍$V\subset\R^n$が存在して，$C^r$級微分同相写像$\varphi:U\iso V$が存在する．
\end{theorem}
\begin{proof}
    
\end{proof}
\begin{remarks}[逆関数定理の立ち位置]
    Jacobianは連続なスカラー場だから，ある一点$p$で消えていないならば，その近傍で消えていない，というだけの話である．
    ベクトル束が局所自明になる，という議論に昇華される．
    これが微分＝線型近似という行為なのだ．
    そしてこの近似は十分に便利で，元の得体の知れない写像の可逆性が，線型近似の行列式という言葉で特徴付けられる，という到達点である．
\end{remarks}

\subsection{陰関数定理と正則部分多様体の定義}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=$C^\infty$級ならば，多様体を線型化する座標変換を構成する算譜が存在する]
    $C^\infty$級写像の正則点$p_0$の周りでの挙動は全射線型写像で記述できるとする．
    すると，ある全射を加えたのちの$U\osub O$上で，affine部分空間（の開部分集合）への同型と，$q_m$とに分解できる．
    これは，うまく線形化するような座標変換が存在するとも言える．
    %すると，今はEuclid空間のみを考えていることもあり，$F^{-1}(F(p_0))$の$p_0$の周りと，$F(p_0の近傍)$とはいずれも$C^\infty$級部分多様体となる．

    陰関数定理と逆関数定理の関係とは，$M$上の射と，多様体の間の射との関係に似ているのかも知れない．
\end{tcolorbox}

まず，自明化の理論への更なる抽象化を持つと考えられるから，
次の議論を付しておく．

\begin{discussion}[$\R^n$上の微分]
    開集合$U\subset\R^n$上の$C^r$級写像$F:U\to\R^m$に対応して，
    $C^{r-1}$級テンソル場$dF:U\to M_{nm}(\R)$が定まる．
    また，写像
    \[\xymatrix@R-2pc{
        dF=(F\circ\pr_1,JF):U\times\R^n\simeq TU\ar[r]&\R^m\times\R^m\\
        \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
        (p,u)\ar@{|->}[r]&\paren{F(p),(JF)_p(u)}=\paren{F(p),u\cdot JF(p)}
    }\]
    が定まる．これは$U$の接束$TU$上のchartだとみなせて，$F(p)$を底座標（行き先の座標），$(JF)_p(u)$をfiber座標（接ベクトルの成分表示）とみなせる．
    $U\times\R^n$となっているのが局所自明である．
    こうして，ベクトル束の圏への共変関手
    \[\xymatrix@R-2pc{
        d:\Top\ar[r]&\Top(\Diff)\\
        \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
        U\subset\R^n\ar@{|->}[r]&U\times\R^n\\
        F\subset\R^n\ar@{|->}[r]&dF
    }\]
    が定まる．
\end{discussion}

\begin{theorem}[陰関数定理]
    $0\le m\le n$とする．
    $0$の開近傍$O\subset\R^n$上の$C^\infty$級写像$F:\R^n\supset O\to\R^m$で$F(0)=0$を満たすものを考える．
    $\rank(JF)_0=m$（全射である）ならば，開近傍$0\in U\subset O\subset\R^n,0\in V\subset\R^n$とその間の$C^\infty$級微分同相写像（座標変換）$\varphi:U\iso V$であって$\varphi(0)=0$を満たし，
    次の図式を可換にするものが存在する：
    \[\xymatrix{
        \R^n\osup O\ar[r]^-F&\R^m\\
        U \;\ar@{^{(}->}[u]^-i\ar@{.>}[r]_-{\varphi}^-\sim&V\osub\R^{n-m}\times\{0\} \;\ar@{->>}[u]_-{q_m}
    }\]
    ただし，$q_m:=(\pr_1,\cdots,\pr_m)$とした．\footnote{このように表すと，写像の標準分解と同じ文脈で捉えられる．違いは，２段階の全射で，可逆部分を挟むのである．この「可逆部分の抽出」は逆写像定理に由来する．}
    つまり，$F=q_m\circ\varphi$である．
    また特に$F^{-1}(0)=\varphi^{-1}(q_n^{-1}(0))=\varphi^{-1}(\{0\}\times\R^{n-m})$．
\end{theorem}
\begin{proof}
    $F={}^t\!(f_1,\cdots,f_m)$とする．
    全射性の定義より，$\exists_{1\le k_1<\cdots< k_m\le n}\;\det\paren{\pp{f_i}{x_{k_i}}(0)}_{1\le i,j\le m}\ne 0$である．
    残った座標関数を$\{l_1<l_2<\cdots<l_{n-m}\}:=\{1,2,\cdots,n\}\setminus\{k_1,k_2,\cdots,k_m\}$とする．
    \begin{description}
        \item[構成] $C^\infty$級連続写像
    \[\xymatrix@R-2pc{
        \widehat{F}:O\ar[r]&\R^n=\R^m\times\R^{n-m}\\
        \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
        x={}^t\!(x_1,\cdots,x_n)\ar@{|->}[r]&\widehat{F}(x):={}^t\!({}^t\!F(x),x_{l_1},\cdots,x_{l_{m-n}})
    }\]
        について，
        \[(J\widehat{F})_0=\begin{pmatrix}\paren{\pp{f_i}{x_{j}}(0)}_{1\le i\le m, 1\le j\le n}\\(\delta_{l_\alpha,\beta})_{1\le\alpha\le n-m, 1\le\beta\le n}\end{pmatrix}\sim\begin{pmatrix}\paren{\pp{f_i}{x_{k_i}}(0)}_{1\le i,j\le m}&O\\O&I_{n-m}\end{pmatrix}\]
        より，$(J\wh{F})_0\ne 0$．
        逆写像定理から，$0\in{}^{\exists}V\subset^\circ\R^n,\;0\in{}^\exists U\subset^\circ O$とその間の$C^\infty$級微分同相写像$\varphi:=\wh{F}|_U:U\iso V$が存在する．
        \item[検証]
        これについて，任意の$y={}^t\!(y_1,\cdots,y_n)\in V$について，
        \[\begin{pmatrix}y_1\\\vdots\\y_m\\y_{m+1}\\\vdots\\y_n\end{pmatrix}=\wh{F}\circ\varphi^{-1}(y_1,\cdots,y_n)=\begin{pmatrix}F\circ\varphi^{-1}(y_1,\cdots,y_n)\\x_{l_1}\circ\varphi^{-1}(y_1,\cdots,y_n)\\\vdots\\x_{l_{n-m}}\circ\varphi^{-1}(y_1,\cdots,y_n)\end{pmatrix}\]
        が成り立つから，上の$m$成分に注目して，$F\circ\varphi^{-1}(y_1,\cdots,y_n)={}^t\!(y_1,\cdots,y_m)$．
    \end{description}
\end{proof}
\begin{remarks}[抽象的な構成だが，Euclid部分多様体の局所座標は標準基底と同じに取れる]
    陰関数を逆に解く問題は，逆関数の問題を孕んでいる．
    まさか．最初の$m$要素についての射影$q_m$の切断である「量増し写像$\widehat{F}$」の逆射として構成するのか．

    $JF$は$0\in O$で全射と仮定した．
    すると，まだ働いていない$n-m$個の座標関数を無理やり働かせることで，同次元空間への$C^\infty$級写像$\wh{F}:\R^n\to\R^n$を定め，$J\wh{F}$も$0\in O$で全射にできる（$n-m$個の座標方向は未使用だったので線型独立）．
    \[\xymatrix{
        &\R^n\\
        \R^n\osup O\ar[r]^-F\ar[ur]^-{\wt{F}}&\R^m \;\ar@{^{(}->}[u]\\
        U \;\ar@{^{(}->}[u]^-i\ar@{.>}[r]_-{\varphi}^-\sim&V\osub\R^{n-m}\times\{0\} \;\ar@{->>}[u]_-{q_m}
    }\]
    すると$\wt{F}$は$0\in O$にて正則行列による線形近似を持つから，逆関数定理より，可逆成分$\xymatrix{
        O\ar[r]^-{\wt{F}}&\R^n\\
        U\ar[r]^-\sim_-{\varphi} \;\ar@{^{(}->}[u]&V \;\ar@{^{(}->}[u]
    }$
    を取れる．すると当然$\wt{F}\circ\varphi^{-1}=\id_{\R^n}|_V$つまり$\wt{F}=\varphi$である．
    上$m$成分に注目することは$q_m$のpost compositionに同値で，$F=q_m\circ\varphi$が成り立つ．

    形式的な水増し空間$\R^n$を借りることで，これを上$m$成分で切り取って再解釈すると「局所的にはaffine部分空間」という意味が突然付くのは不思議である．
\end{remarks}

\subsection{Euclid空間での正則部分多様体の定義：Jacobianによる特徴付け}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=数の空間$\R^n$では，多様体の構成に鮮やかな代数的手法がある．]
    ２つの知識
    \begin{enumerate}
        \item (逆関数定理) 局所微分同相性が，Euclid空間ではJacobianが消えないこととして特徴付けられる．
        \item (陰関数定理) 局所微分同相ならば，座標は標準基底と同じく，正規直交にとれる．
    \end{enumerate}
    を綜合して，Euclid空間における部分多様体の定義を得る．
    これは，「どの点でもJacobianが消えていない開集合」である．

    この定義を逆手に取ると，既知の$C^\infty$級関数を定義方程式として，その正則値の逆像として
    多様体が構成できる．\footnote{多様体からの関数が，たまたま同じ点にだが，局所同相な状態．別の点でもいい，点$q_0$は忘れてもいい，ここからAffineという概念が生じる．}
    これが代数多様体／正則部分多様体である．
    この時から動きがFiberっぽいのが肝である．
    この陰関数定理の双対によって，varietyが考えられる．
\end{tcolorbox}

\begin{definition}[(regular) submanifold in Euclidean spaces]\label{def-regular-submanifold-in-Euclidean-space}
    整数$0\le l\le n$について，部分空間$M\subset\R^n$が\textbf{$l$次元$C^\infty$級部分多様体}であるとは，
    次が成り立つことをいう：
    \begin{quote}
        任意の点$p\in M$について，その開近傍$p\in U\subset\R^n$と開近傍$0\in V\subset\R^n$とその間の$C^\infty$級微分同型写像$\varphi:U\iso V$が存在して，
        $M\cap U=\varphi^{-1}(\{0\}\times\R^l)\;(0\in\R^{n-l})$が成り立つことをいう．\footnote{左辺の$M\cap$を$U$への作用と見たら，これと，右辺で$n-l$成分を潰すこととが対応する，と見る．これが「正則」部分多様体の定義である．}
    \end{quote}
\end{definition}
\begin{remarks}
    局所的に$JF$が単射であるからと言って，部分空間への同相写像であるとは限らない．
    これを試すには，一般の写像$F:N\to M$では$M$で$F(N)$と比べるのは難しい．
    ということで，局所的に$\R^n\times\{0\}$と同相ならば良いのである．
    逆関数定理より，全てのチャート$\varphi:U\to V\osub\R^n$は適当にとっても$V$を線型化可能なのであるから，
    Euclid空間のaffine部分空間$\R^n\times\{0\}$を共通言語とすれば良い．
\end{remarks}

\begin{discussion}[chain rule]
    関手$d:\Diff\to\Diff$は，$f:X\to Y,g:Y\to Z$を$d(g\circ f):TX\to TZ$に移す．
    特に$f,g:\R\to\R$に対しては，自明な接束$T\R=\R\times\R$上に線型写像
    \[\xymatrix@R-2pc{
        df:\R\times\R=T\R\ar[r]&T\R=\R\times\R\\
        \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
        (x,v)\ar@{|->}[r]&(f(x),df_x(v))=(f(x),vf'(x))
    }\]
    を定めて，次の図式を可換にする．
    \[\xymatrix{
        TX\ar[r]^-{df}\ar[d]&TY\ar[d]\\
        X\ar[r]^-f&Y
    }\]
    したがって，$d(g\circ f):(x,v)\mapsto(f(x),vf'(x))\mapsto(g(f(x)),vf'(x)g'(f(x)))$を定めるから，退化したJacobi行列について$(g\circ f)'(x)=f'(x)g'(f(x))$の関係式をえる．
\end{discussion}

\begin{corollary}[定義方程式による多様体の定義：正則等位集合定理の系]\label{cor-kernel-of-Cinfty-diffeomorphism}
    $F:\R^n\supset O\to\R^m$を開集合$O\subset\R^n$上の$C^\infty$級写像とする．
    $F$が$q_0\in\R^m$の逆像$F^{-1}(q_0)$上の任意の点でJacobianが消えていないならば，$F^{-1}(q_0)\subset\R^n$は$(n-m)$-次元$C^\infty$級部分多様体である．
\end{corollary}
\begin{remarks}
    局所的にはこの逆が成り立つ．すなわち，部分多様体ならば，これを零点の集合として表す$F_U:U\to\R^n$の貼り合わせがある．
    この特徴付けを，多様体の定義として採用するのである．
\end{remarks}
\begin{example}[$n$次元球面]
    $C^\infty$級写像$f(x_1,\cdots,x_{n+1}):=\sum^{n+1}_{i=1}x_i^2-1$について，$f^{-1}(0)=S^n$は部分多様体である．
    実際，$Jf=2{}^t\!x\ne 0\;(\forall_{x\in S^n})$．
\end{example}

\subsection{正則部分多様体}\label{subsection-regular-submanifold}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=各点でdetが正則点であることさえ確かめれば良いのは，Euclid空間特有の非常に特殊な状況．]
    Euclid空間上では，正則点を適当に集めた開集合はすぐに正則部分多様体になる（何かしらの正則値$c\in\R$に対する等位集合$\mathrm{det}^{-1}(c)$でなくとも）．
    これはおそらくランクの半連続性と開部分多様体にも関係がある．

    正則点の定義にトリックがあり，$f:N\to M$で$n<m$のとき，$N$の点は正則点になりえない．
    なので非対称だが，正則点の特徴付けにsubmersionの言葉が使える．submersionの定義域の全ての点は正則点である．

    正則部分多様体は埋め込みとして一般化される．正則でない部分多様体は，嵌め込みである．
    核による構成が簡単であるとは，多様体の理論でも成り立つのか．もちろん測度論でも成り立つ．
    射があると代数支配になるのか．
\end{tcolorbox}

\begin{lemma}[semi-continuity of rank]\label{lemma-semicontinuity-of-rank}
    任意の$l\ge 0$に対して，実$nm$次元線型空間$M_{n,m}(\R)$の部分空間$\{A\in M_{n,m}(\R)\mid \rank A\ge l\}$は開である．
\end{lemma}
\begin{proof}
    $A$のランクが$l$以上であるとは，$A$に対して，$l\times l$小行列の行列式の最大値を選び出す写像
    $f:M_{n,m}(\R)\to\R$が$0$に写さないということである．
    $f$は連続写像であるため，$\{A\in M_{n,m}(\R)\mid \rank A\ge l\}=f^{-1}(\R^\times)$は開である．
\end{proof}
\begin{remark}
    行列が少し変わろうとも，rankは変わらない．これが開集合という言葉で捉えられている．一方閉集合は，極限捜査において閉じていると捉えられる．
    今回，$\rank f=l$も$\rank f\le l$も開集合を定めるとは限らないので，半連続性という．
    だが$f$が最大ランクであることは条件$\rank f\ge m$とも捉えられるので，開な条件である．
\end{remark}

\begin{lemma}
    定義\ref{def-regular-submanifold-in-Euclidean-space}の$\{0\}\times\R^l$は，任意の$l$次元affine部分空間$L\subset\R^n$について成り立つ．
\end{lemma}
\begin{proof}
    平行移動$T:\R^n\to\R^n\in\GL_n(\R)$を新たに合成すれば良い．
\end{proof}

\begin{definition}[regular point, regular value]
    $F:\R^n\supset^\circ O\to\R^m$を$C^\infty$級写像とする．
    \begin{enumerate}
        \item $p\in O$が臨界点であるとは，$\rank(JF)_p<m$であることをいう．そうでない$O$の点を正則点という．
        \item $q\in\R^m$が臨界値であるとは，ある臨界点$p\in O$が存在して$F(p)=q$を満たすことをいう．そうでない$\R^m$の点を正則値という．
    \end{enumerate}
\end{definition}
\begin{remark}
    $n<m$のとき，$O$の任意の点は臨界点であり，$F(O)$の任意の点は臨界値である．$n=m$のとき，正則点であることと局所微分同相であることは，逆写像定理により同値になる．
    これを部分多様体の定義は逆手にとっている．
\end{remark}

\begin{example}[special linear group]\label{example-GL-as-submanifold-of-Euclidean-space}
    $\det:M_n(\R)\to\R$は$C^\infty$級微分同相写像であるから，系\ref{cor-kernel-of-Cinfty-diffeomorphism}より，
    $\GL_n(\R)=\mathrm{det}^{-1}(\R\setminus\{0\})$は正則値の逆像で多様体である．
    特に$1\in\R$は$\det$の正則値であるから，$\SL_n(\R)=\det^{-1}(1)$は$M_{n,m}(\R)$-部分多様体である．
    $n\ge 2$のとき，コンパクトでない．
    \begin{lemma}
        $\lambda\in\R$は$\det$の正則値である$\Leftrightarrow\lambda\ne 0$．
    \end{lemma}
    \begin{proof}
        $(J\det)_A$の$(i,j)$要素は，行列$A\in\GL_n(\R)$の第$(i,j)$余因子行列式である．
        よって，$\Rightarrow$は，$\lambda=0$は零行列の像であるから臨界値であり，$\Leftarrow$は任意の$\det A\ne 0$を満たす行列$A$はある$0$でない余因子行列式を持つことから従う．
    \end{proof}
\end{example}

\begin{example}[orthogonal group]
    写像
    \[\xymatrix@R-2pc{
        F:M_n(\R)\ar[r]&S_n(\R)\\
        \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
        A\ar@{|->}[r]&{}^t\!AA
    }\]
    は$C^\infty$級写像である．
    \begin{align*}
        F(A+X)-F(A)&={}^t\!(A+X)(A+X)-{}^t\!AA\\
        &={}^t\!XA+{}^t\!AX+{}^t\!XX
    \end{align*}
    であり，${}^t\!XX$は全て$x$の２次式からなるから，
    \[\xymatrix@R-2pc{
        (JF)_A:M_n(\R)\ar[r]&S_n(\R)\\
        \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
        X\ar@{|->}[r]&{}^t\!XA+{}^t\!AX.
    }\]
    $X\mapsto{}^t\!AX\mapsto{}^t\!({}^t\!AX)+({}^t\!AX)$と分解すると，初めの写像はランクが$n^2$だが，$Y\mapsto{}^t\!Y+Y$のランクは$\frac{n(n+1)}{2}$である．これが余次元．条件式が，$\frac{n(n+1)}{2}$個の方程式の積写像の形で与えられているということに他ならない．
    $I_n\in S_n(\R)$は正則値であるから，正則等位集合定理\ref{thm-the-implicit-function-theorem}より，$O(n):=F^{-1}(I)$は$\frac{1}{2}n(n-1)$次元の$C^\infty$級部分多様体である．
    \begin{itemize}
        \item $O(n)$の列ベクトルは，全て長さ１のベクトルからなる直交基底となるから，$O(n)\subset(\o{U_n}(0,1))^n$であるから，コンパクトである．
        \item $\det=\pm 1$となる２つの連結部分からなる．
    \end{itemize}
\end{example}

\subsubsection{複素代数多様体}

\begin{lemma}
    $F:\C^n\to\C^m$を複素多項式が定める写像とする．任意の$p\in\C^n$について，$\rank(JF^\R)_p=2\rank(JF)_p$である．
    \[\xymatrix{
        \C^n\ar[r]^-{F}&\C^m\\
        \R^{2n}\ar[u]\ar[r]^-{F^\R}&\R^{2m}\ar[u]
    }\]
\end{lemma}

\begin{example}[Fermat curve]
    $n\ge 1$について，$f(z,w)=z^n+w^n-1$と置く．$C:=f^{-1}(0)$とすると，$JF=\paren{\pp{f}{z}\;\pp{f}{w}}=(nz^{n-1}\;nw^{n-1})$であり，
    Yacobianが消えるのは$(JF)=0\Leftrightarrow (z,w)=(0,0)$のとき．よって，$0\in\C$は正則値であるから，$C$は実２次元$C^\infty$級多様体である．
    これをコンパクト化したものはFermat曲線と呼ばれる．
    \begin{definition}[Fermat curve]
        体$k$上の射影代数曲線$x^n+y^n=z^n\;(n\ge 2)$をFermat曲線という．
        $n=2$のとき，これは射影直線$\P^1(\C)$である．non-singularで，種数$\frac{1}{2}(n-1)(n-2)$を持つ．
    \end{definition}
    \begin{theorem}[Fermat's last theorem]
        $n>2$のとき，$xyz=0$の場合を除いて，有理数上に解を持たない．
    \end{theorem}
\end{example}

\begin{example}[hyperelliptic curve]
    $f(z)=z^n+a_1z^{n-1}+\cdots+a_{n-1}z+a_n\in\C[z]$を$n$次多項式とする．これに対して，$h(z,w):=w^2-f(z)$と定めた時のファイバー$C:=h^{-1}(0)$は，
    $h_z=-f'(z),h_w=2w$であるが，$f(z)$が重根を持たない時，$h_z=h_w=h=0$は解を持たないから，$C$は実２次多様体である．
    これをコンパクト化したものは超楕円曲線という．
    $n=2g+1$のとき種数が$g$でtruncateが１つ，$n=2g+2$のとき種数が$g$でtruncateが２つである．
\end{example}

\begin{example}[unitary group]
    ユニタリ群については，直交群の時に構成した$F:M_n(\C)\to S_n(\C)$は正則ではない．したがって考え直す必要がある．
\end{example}

\subsection{陰関数定理の双対}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    速度ベクトルが消えない「正則な」曲線を，（退化した）Jacobi行列が単射であると表現すると，双対性がはっきりする．
    fiberの向き（ある正則値の上に集まってくる正則点）で構成する方法（$n\ge m$のとき）は議論したが，$n\le m$のとき，像としても多様体は構成することができるはずである．
\end{tcolorbox}

\begin{theorem}[陰関数定理の双対]\label{thm-dual-of-implicit-function-theorem}
    $F:\R^n\supset^\circ O\to\R^m$を$C^\infty$級写像とする．$n,m\ge 0$．
    $F(0)=0$で，$(JF)_0:\R^n\to\R^m$が単射であるとき（即ち$n\le m$が必要），
    $0$の開近傍$0\in U,V\subset^\circ\R^m$とその間の座標変換$\psi:U\iso V$とが存在して，次の図式を可換にする：
    \[\xymatrix{
        O\ar[r]^-F&\R^m\\
        {}^\exists O_1\ar@/_2pc/@{.>}[rr]_-{i}\ar@{^{(}->}[u]\ar@{.>}[r]^-{F}&{}^\exists U\ar@{^{(}->}[u]\ar[r]^-{\sim}_{{}^\exists\psi}&V\ar@{^{(}->}[ul]
    }\]
    即ち，$F(O_1)\subset U$が定まり，これについて，$(\psi\circ F)\begin{pmatrix}x_1\\\vdots\\x_n\end{pmatrix}=\begin{pmatrix}x_1\\\vdots\\x_n\\0\\\vdots\\0\end{pmatrix}\;(\forall_{(x_1,\cdots,x_n)\in O_1})$である．
    特に$F(O_1)\subset\R^m$は，近傍座標$\psi:U\to V$によって$n$次元$C^\infty$級部分多様体である．
\end{theorem}
\begin{proof}\mbox{}
    \begin{description}
        \item[終域$\R^m$の座標の準備→自然に$\psi$の構成が終わる] 
        $(JF)_0$は単射であるから，ランク落ちしていない：$1\le{}^\exists j_1<\cdots<{}^\exists j_n\le m\;\det\paren{\pp{f_{j_\alpha}}{x_\beta}(0)}_{1\le\alpha,\beta\le n}\ne 0$．
        この座標の残りを$\{i_1<i_2<\cdots<i_{m-n}\}:=\{1,2,\cdots,m\}\setminus\{j_1,j_2,\cdots,j_n\}$と名付けると，$\pp{F}{x_1}(0),\cdots,\pp{F}{x_n}(0),e_{i_1},\cdots,e_{i_{m-n}}$は$\R^m$の基底となる．
        これは，Yacobi行列を用いて，正則な$n\times n$部分行列の列ベクトルと，その補空間の標準基底とを用いて，終域を$\R^m\simeq F(O)\oplus\R^{m-n}$と分解したことに当たる．
        これは元の空間と同型である．同型射は，例えば次のような，基底$e_1,\cdots,e_m$と$\pp{F}{x_1}(0),\cdots,\pp{F}{x_n}(0),e_{i_1},\cdots,e_{i_{m-n}}$とが定める同型射が
        見つかる：
        \[\xymatrix@R-2pc{
            \Phi:O\times\R^{m-n}\ar[r]^-{\sim}&\R^m\\
            \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
            {\begin{pmatrix}p\\t_1\\\vdots\\t_{m-n}\end{pmatrix}}\ar@{|->}[r]&F(p)+\sum^{m-n}_{\alpha=1}t_{\alpha}e_{i_\alpha}
        }\]
        これは$\Phi(0)=0$かつ，同型であるからもちろん$\det(JF)_0\ne0$であるから，
        逆写像定理\ref{thm-inverse-mapping-theorem}より，可逆で$C^\infty$級な制限$\Psi:V\iso U$が見つかる．
        \item[構成した$\psi$の検証]
        これに対して$\psi:=\Psi^{-1}$とし，$O_1:=\{p\in O\mid\Psi(p,0)\in U\}$と定めると，これは$O$の開集合で，\footnote{定義域$O$が狭まるのが謎である．}
        $\psi(0)=0$であり，任意の$(x_1,\cdots,x_n)\in O_1$については$F(x_1,\cdots,x_n)=\Phi(x_1,\cdots,x_n,0,\cdots,0)\in U$と$\Phi$で表現できるので確かに像は$U$内にあり，
        また$\psi$は$\Phi$の逆写像としたから，$\psi\circ F(x_1,\cdots,x_n)=\Psi^{-1}\circ\Psi(x_1,\cdots,x_n,0,\cdots,0)=(x_1,\cdots,x_n,0,\cdots,0)$を満たしている．
        \item[$F(O_1)$が多様体であることについて]
        Jacobi行列の正則な$n$個の縦ベクトル$x_{j_1},\cdots,x_{j_n}$（$\Phi$の最初の$n$要素）について，合成写像$(f_{j_1},\cdots,f_{j_n}):O_1\xrightarrow{i}O\times\R^{m-n}\xrightarrow{(x_{j_1},\cdots,x_{j_n})}\R^n$は，局所$C^\infty$級で，$F(O_1)$の局所座標となっている．
    \end{description}
\end{proof}
\begin{remarks}[本当にすごい証明だ]
    $V$は$V\subset\R^m$というより，$V\subset O\times\R^{m-n}$と構成するから，$i:O_1\mono V$が自然と入るのである．
    受け入れ空間$V\subset O\times\R^{m-n}$をYacobi行列の列ベクトルを用いて，基底を最初から準備してそれによる直和分解を最初から作っておくと，$i:O_1\to V$は自然に引き起こされるのである．
    その具体的な方法は，逆関数定理により，$\Phi:O\times\R^{m-n}\to\R^m$の制限$\Psi:V\iso U$を選び出してから，その逆写像$\psi:U\iso V$として構成する．
    \[\xymatrix{
        V\ar@{.>}@/_2pc/[d]^-{{}^\exists\Psi}&\ar@{}[l]|-{\subset}O\times\R^{m-n}\ar[d]^-{\Phi}\\
        U\ar@{.>}@/_2pc/[u]^-{{}^\exists\psi}&\ar@{}[l]|-{\subset}\R^m
    }\]
\end{remarks}
\begin{remark}
    開集合$O$の制限は$O_1$は，自己交叉の解消など，正則なパラメータ付を持っていても，大域的には単射でないことがあるため．
\end{remark}

\begin{theorem}[陰関数から抽出できる安定的概念：$q$次元部分多様体]
    $p+q=n$とする．部分集合$M\subset\R^n$について，次の３条件は同値である．
    \begin{description}
        \item[陰関数表示] 任意の$x^0\in M$に対し，ある近傍$x^0\in U$を取ると，その上でJacobi行列のランクが$q$であるような$C^\infty$級関数$F:U\to\R^q$が存在し，$M\cap U=\{x\in U\mid F(x)=F(x^0)\}$となる．
        \item[グラフ表示] 任意の$x^0\in M$に対し，ある近傍$x^0\in U$を取ると，うち$p$個の座標が張る空間での$(x^0_{i_1},\cdots,x^0_{i_p})$の近傍$W$上で定義された，残りの$q$個の座標が張る空間への$C^\infty$級写像$G:W\to\R^q$が存在して，$M\cap U=\{(x_{i_1},\cdots,x_{i_p},G(x_{i_1},\cdots,x_{i_p}))\mid (x_{i_1},\cdots,x_{i_p})\in W\}$を満たす．
        \item[パラメータ表示] 任意の$x^0\in M$と任意の近傍$x^0\in U$に対し，ある近傍$x^0\in V\subset U$を取ると，$p$次元Euclid空間内の開球$W\subset\R^p$上の$C^\infty$級単射$\Phi:W\to V$であって，$W$上ランクが$p$で一定かつ$M\cap V=\{\Phi(u)\mid u\in W\}$を満たすものが存在する．
    \end{description}
\end{theorem}

\begin{tbox}{red}{}
    \begin{description}
        \item[パラメータ表示] 多様体とは，正則な＝微分が途中で消えないで描かれる曲線である，とする動的な描像．一般化すると$n$次元曲面となる．陰関数定理の双対\ref{thm-dual-of-implicit-function-theorem}は入射する$C^\infty$級写像の微分が単射ならばいつでも成り立つ．が，いつでも陰関数定理が成り立つわけではないように，近傍の取り直しが必要である．これはパラメータの空間と同じ位相を像にも要請してしまうためである．\footnote{代数学での，像より核が単純というスキームの１つであるか？}
        \item[グラフ表示] 一筆書きといっても，$(t,\varphi(t))$という点を，空間$X\times Y$に定めていることに等しい．すると，Jacobi行列は多少基本変形について遊びの出来る一般的な概念になる．任意のグラフが，うまく陽関数で表示できるとは限らないが，ランクに何も制限のない$C^\infty$級条件式$G$でなら表せる．これを一般化すると，余次元$n$の曲面＝超曲面となる．
        \item[陰関数表示] 陰関数というのは，グラフ表示をさらに内部化して，写像の定値性として条件に言及する技法である．実はこれが一番発展性があり，fiberationの考え方へと発展するが，等位面，等高線として理解できる．曲面($n\le m$のとき)と超曲面($n\ge m$のとき)を包含するスキームである．するとこれを近傍座標$\varphi$と呼ぶ．
    \end{description}
\end{tbox}

\subsection{陰関数定理の発展：階数一定定理}\label{subsection-constant-rank-thm-in-Euclidean-space}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    陰関数定理を一般の線型空間へ，そして多様体へ拡張する道を見据える．
    正則部分多様体の手法は，単にfull rankなものというだけではなく，一般の$C^\infty$級写像$G:O'\to\R^l$に一般化できる．
    「逆写像定理を用いて，切断として定める」が常套手段である．
\end{tcolorbox}

\begin{theorem}[座標変換により，ベクトルの空間の標準的な埋め込みにできる]
    $C^\infty$級写像$F:\R^n\supset^\circ O\to\R^m$は$\forall_{p\in O}\;\rank(JF)_p=l(\ge 0)$（一定）を満たすとする．\footnote{これは正則部分多様体の一般化である．}
    このとき，任意の点$p_0\in O$に対して，
    \[\xymatrix{
        \R^n\supset O\supset{}^\exists U\ni p_0\ar[r]^-{F}\ar[d]_-{{}^\exists\varphi}&{}^\exists U'\subset\R^m\ar[d]^-{{}^\exists\psi}\\
        \R^n\supset{}^\exists V\ar@{.>}[r]_-{i}&{}^\exists V'\subset\R^m
    }\]
    で$\varphi(p_0)=0,\psi(F(p_0))=0$，
    \[\psi F\varphi^{-1}\begin{pmatrix}x_1\\\vdots\\x_n\end{pmatrix}=\begin{pmatrix}x_1\\\vdots\\x_l\\0\\\vdots\\0\end{pmatrix}=i\begin{pmatrix}x_1\\\vdots\\x_n\end{pmatrix}\qquad\forall\begin{pmatrix}x_1\\\vdots\\x_n\end{pmatrix}\in V\]
    を満たす．
\end{theorem}
\begin{proof}\mbox{}
    \begin{description}
        \item[方針] 平行移動との合成を適宜考えることにより，$p_0=0\in\R^n,F(p_0)=0\in\R^m$として良い．また，行・列の置換行列も適宜$\varphi,\psi$に含めることにより，初めから$F={}^t\!(f^1,\cdots,f^m)$について$\det\paren{\pp{f_j}{x_i}(0)}_{1\le i,j\le l}\ne 0$として良い．
        \[\xymatrix{
            \R^n\supset O\supset{}^\exists U_1 \ar@[red][d]^-{\Phi} & \ar@{^{(}->}[l]\; U \ni p_0\ar[r]^-{F}\ar[d]_-{{}^\exists\varphi}&{}^\exists U'\subset\R^m\ar[d]^-{{}^\exists\psi}\\
            \R^n\supset{}^\exists V_1 & \ar@{^{(}->}[l]\; V \ar@{.>}[r]_-{i}&{}^\exists V'\subset\R^m\ar@/_1pc/@[red][u]_-{\Psi}
        }\]
        \item[$\varphi$の構成] 
        $f$の正則な部分に，座標関数を水増しした写像$\Phi:={}^t\!(f_1,\cdots,f_l,x_{l+1},\cdots,x_n):O\to\R^n$を考えると，もちろん$\det(J\Phi)_0\ne 0$より，逆写像定理から$\varphi:\R^n\subset^\circ U_1\iso V_1\subset^\circ\R^n$が定まる．特に，$V_1=(-\epsilon,\epsilon)^n$と取れる．
        \item[$\varphi$の成功]
        この時，
        \[\exists_{g_{k+1},\cdots,g_{n}\in C^{\infty}(V_1,\R)}\;F\circ\varphi^{-1}\begin{pmatrix}x_1\\\vdots\\x_n\end{pmatrix}=\begin{pmatrix}x_1\\\vdots\\x_l\\g_{k+1}\\\vdots\\g_m\end{pmatrix}\]
        であり，$\rank(J(F\circ\varphi^{-1}))=\rank(JF)=l$より，$\forall_{l+1\le j\le m,l+1\le i\le n}\;\pp{g_j}{x_i}=0\;(\on V_1)$である．さらに，$(-\epsilon,\epsilon)^{n-l}$は連結だから，
        \[\forall_{l+1\le j\le m}\;g\begin{pmatrix}x_1\\\vdots\\x_n\end{pmatrix}=g\begin{pmatrix}x_1\\\vdots\\x_l\\0\\\vdots\\0\end{pmatrix}\;\on V_1\]
        である．\footnote{偏微分が$0$なので．}
        \item[$\psi$の構成] $t_i\in C^\infty((-\epsilon,\epsilon)^l\times\R^{m-l},\R^m)\;(i=t+1,\cdots,m)$を座標関数として，
        $\Psi:=(F\circ\varphi^{-1},0^{m-l})+\sum^m_{k=l+1}t_ke_k$と置くと，$\Psi(0)=0$で，$(J\Psi)_0=\begin{pmatrix}I_l&0\\*&I_{m-l}\end{pmatrix}$であるから，逆写像定理より，$\psi:=\Psi^{-1}:U'\iso V'\subset(-\epsilon,\epsilon)^l\times\R^{m-l}$が定まる．
        これに対して，$V=i^{-1}(V')=\{(x_1,\cdots,x_n)\in V_1\mid (x_1,\cdots,x_l,0,\cdots,0)\in V'\}$及び$U:=\varphi^{-1}(V)$とおく．
        \item[$\psi$も含めた全ての成功]
        任意の$x=(x_1,\cdots,x_n)\in V$について，\[F\circ\varphi^{-1}(x)=F\circ\varphi^{-1}(x_1,\cdots,x_l,0,\cdots,0)=\Psi(x_1,\cdots,x_l,0,\cdots,0)\]より，$\psi\circ F\circ\varphi^{-1}(x)=(x_1,\cdots,x_l,0,\cdots,0)$である．
    \end{description}
\end{proof}

\begin{theorem}[一般化]\label{thm-generalized-implicit-function-theorem}
    $m,n,l\ge 0$とする．２つの$C^\infty$級写像$F:\R^n\supset^\circ O\to O'\subset^\circ\R^m$と$G:O'\to\R^l$と，点$a_0\in O,b_0\in O',c_0\in\R^l$が，次の３条件を満たすとする．
    \begin{enumerate}
        \item $F(a_0)=b_0$．
        \item $G\circ F(O)=\{c_0\}$（合成関数は定値）．
        \item $\R^n\xrightarrow{(JF)_{a_0}}\R^m\xrightarrow{(JG)_{b_0}}\R^l$が完全．
    \end{enumerate}
    このとき，$b_0$の開近傍$W\subset\R^m$が存在して，$W\cap F(O)=W\cap G^{-1}(c_0)$が成り立ち，$W\cap F(O)$は$\R^m$の$C^\infty$級部分多様体となる．\footnote{$G$とはさっきの$\rank$であった．}
\end{theorem}
\begin{proof}\mbox{}
    \begin{description}
        \item[方針] $a_0,b_0,c_0$はそれぞれのEuclid空間の原点であるとしても一般性を失わない．$(JF)_0,(JG)_0$の階数を$r,\rho$とすると，完全性より，$r+\rho=m$である．
    \end{description}
\end{proof}

\section{多様体の射}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    多様体の射に対する微分可能性を整合的に(well-definedに)定義するために，微分可能多様体の条件に$C^r$級での両立性がある．
    これは多様体を１つの対象として独立させるために必要な圏論的な条件である（$M$上の圏というかなんというか）．
    これは「観測に依らない」ということでもあり，これが多様体を幾何学的に真に普遍的な対象へと押し上げる．

    %多様体の射は本質的に線型空間の理論への回帰を内包している．
    多様体の本質はEuclid空間に囲まれて，そこへの射の様相によってEuclid空間とみなせる空間である．
    ここに逆関数定理を移植して，始まりの定義\ref{def-manifold}の特徴づけを得ていく．
    Jacobianの消えない微分可能な$\R^n$-値関数を局所座標系とよび，
\end{tcolorbox}

\subsection{可微分関数と局所座標系}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=可微分関数と局所座標系とは形式的には違いのない概念である，という認識が大事．]
    chartを両立するように定義したので，$C^\infty$級関数の概念は，$\exists_{(U,\varphi)}\;\varphi_*f$が$C^\infty$級と定義すれば，
    「座標変換」として用意していた$M$のスライス圏上の射により連鎖的に$C^\infty$級の射が引き起こされ，定義はatlasに依らない．
    このことが要請する微分に遺伝する関手性を貼り合わせの条件ともいう．
    偏微分の概念を一般の局所座標関数に一般化して，逆関数定理を移植する．\textbf{すると，局所座標系の特徴づけを得る}．
\end{tcolorbox}

\begin{definition}[smooth function on manifolds]
    関数$f\in C(U)$が$p\in U$で$C^r$級であるとは，
    任意に取ったチャート$(U_\alpha,\varphi_\alpha)$について引き戻し$(\varphi_\alpha^{-1})^*f:\R^n\supset\varphi_\alpha(U_\alpha)\to\R$が$\varphi_\alpha(p)$の近傍で$C^r$級であることをいう．
    特に，$C^r$級チャート$(U_\alpha,\varphi_\alpha)$の局所座標$x_\alpha^i$は$C^r$級である．
\end{definition}
\begin{remark}[well-definedness]
    チャートが$C^s$級($s\ge r$)であるとき，多様体の定義\ref{def-manifold}の(2)(b)より，１つのチャートで$C^r$級であることと，他のチャートで$C^r$級であることは同値になる．
    これが「上の圏」を展開して，圏の中で一つの対象を構成する技法である．
\end{remark}

\begin{lemma}[貼り合わせの条件＝Chain Rule]\label{lemma-patching-condition}
    \[\xymatrix{
        &\R\\
        V_\beta\ar[ur]^-{F_\beta}&U_\alpha\cap U_\beta\ar[l]_-{\varphi_\beta}\ar[r]^-{\varphi_\alpha}\ar[u]^-f&V_\alpha\ar@/^1pc/[ll]^-{f_{\beta\alpha}}\ar[ul]_-{\F_\alpha}
    }\]
    $\paren{\pp{F_\alpha}{u^i}}_{u:=\varphi_\alpha(q)}$を$\pp{f}{x^i_\alpha}(q)$と表す．
    このとき，$\pp{f}{x^i_\alpha}(q)$と$\pp{f}{x^i_\beta}(q)$の間に次の関係がある：
    \[\paren{\pp{f}{x^1_\alpha}\;\cdots\;\pp{f}{x^n_\alpha}}=\paren{\pp{f}{x^1_\beta}\;\cdots\;\pp{f}{x^n_\beta}}\begin{pmatrix}\pp{x^1_\beta}{x^1_\alpha}&\cdots&\pp{x^1_\beta}{x^n_\alpha}\\\vdots&\ddots&\vdots\\\pp{x^n_\beta}{x^1_\alpha}&\cdots&\pp{x^n_\beta}{x^n_\alpha}\end{pmatrix}\]
\end{lemma}
\begin{remark}\mbox{}
    \begin{enumerate}
        \item 特に$f=\varphi_\alpha$とすると，左辺は単位行列となり，$1=\paren{\pp{x_\alpha}{x_\beta}}\paren{\pp{x_\beta}{x_\alpha}}$となる．特に，$\frac{D(x^1_\beta,\cdots,x^n_\beta)}{D(x^1_\alpha,\cdots,x^n_\alpha)}\ne 0$が$U_\alpha\cap U_\beta$の全域で成り立つ．これはそれぞれの行列が表現する写像$f_{\beta\alpha}:V_\alpha\iso V_\beta$が微分同相写像であることから当然である．
        \item 接ベクトルの変換性は，この例として捉えられる．特に$f$を取り去ると，$T_p(M)$の基底変換行列である．
        
        可微分写像$\varphi:(a,b)\to M$が，$t_0\in(a,b)$について，$\varphi(t_0)\in M$で定める接ベクトルとは，
        近傍座標系$(x^1,\cdots,x^n)$を用いて，$\varphi^i$を次のように定めると，$\paren{\paren{\dd{\varphi^1}{t}}_{t=t_0}\;\cdots\;\paren{\dd{\varphi^n}{t}}_{t=t_0}}$のことをいう．
        \[\xymatrix{
            M\ar[r]^-{x^i}&\R\\
            (a,b)\ar[u]^-{\varphi}\ar@{.>}[ur]_-{\varphi^i}
        }\]
    \end{enumerate}
\end{remark}

\begin{lemma}[局所座標系]
    $C^s$級関数$f^1,\cdots,f^n$が$\frac{D(f^1,\cdots,f^n)}{D(x^1_\alpha,\cdots,x^n_\alpha)}_p\ne 0$を満たすとき，組$(f^1,\cdots,f^n)$を$p$の周りの\textbf{$C^s$級局所座標系}と呼ぶ．
\end{lemma}
\begin{proof}
    上の定義が$\alpha\in A$の取り方に依らないことを示す．
    貼り合わせの条件\ref{lemma-patching-condition}より，
    \[\frac{D(f^1,\cdots,f^n)}{D(x^1_\beta,\cdots,x^n_\beta)}_p=(\det f_{\alpha\beta}(q))\frac{D(f^1,\cdots,f^n)}{D(x^1_\alpha,\cdots,x^n_\alpha)}_p\]
    より，条件$\frac{D(f^1,\cdots,f^n)}{D(x^1_\alpha,\cdots,x^n_\alpha)}_p\ne 0$は$\alpha\in A$の取り方に依らない．
\end{proof}
\begin{remark}[逆関数定理の一般化と思えば良い]\label{remark-generalization-of-inverse-mapping-theorem}
    逆関数定理で「Jacobianが消えない」という条件が普遍性を持ったのは，微分の関手性に由来することがわかる．
    チャート$(U_\alpha,x^1,\cdots,x^n)$は$\frac{D(x^1_\alpha,\cdots,x^n_\alpha)}{D(x^1_\alpha,\cdots,x^n_\alpha)}=1$より，確かに近傍座標系である．
    すると，他の任意の微分構造のメンバーも，Jacobianは消えない．
\end{remark}

\begin{tbox}{red}{圏内の構造物としての多様体}
    $M$上の圏$C^M$のような構造物が多様体である．
    \begin{enumerate}
        \item $f_{\beta\alpha}$をあらかじめ$C^r$級としたとき，$F_\alpha=F_\beta\circ f_{\beta\alpha}$が$C^r$級であることと$F_\beta$が$C^r$級であることは同値．
        \item よって微分には$JF_\alpha=JF_\beta Jf_{\beta\alpha}$という関係が必要．これはChain Ruleに他ならないが，変数変換・貼り合わせの条件として理解される．
    \end{enumerate}
\end{tbox}

\subsection{可微分写像と構成}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    全く同様にして，引き戻しの言葉によって$C^\infty$級写像を定義し，Diffの射として定まっていることを証明する．
    圏Diff内の群対象がLie群である．
\end{tcolorbox}

\begin{definition}[differentiable mapping]
    可微分写像の定義には２つの流儀がある．連続写像$F:N\to M$が$p\in N$上$C^\infty$級であるとは，
    \begin{enumerate}
        \item $F(U)\subset V$を満たす$M$-chart $(V,\psi)$と$p$の周りのchart $(U,\varphi)$が存在して，
        $\psi\circ F\circ\varphi^{-1}:\varphi(U)\to\psi(V)$が$\varphi(p)\in\R^n$上$C^\infty$級であることをいう．
        \item 任意の$F(p)$の近傍で連続な写像$f\in C^\infty_p(M)$に対して，$f\circ F$が$p$の近傍で$C^\infty$級であることをいう．
    \end{enumerate}
    \[\xymatrix{
        \varphi(U)\ar@{.>}[r]^-{\psi\circ F\circ\varphi^{-1}}&\psi(V)\\
        N\ar[u]^-{\varphi}\ar[r]^-F\ar@{.>}[dr]_-{F^*f}&M\ar[u]_-{\psi}\ar[d]^-f\\
        &\R
    }\]
\end{definition}

\begin{lemma}[well-definedness]
    連続写像$f:M\to N$について，次の２条件は同値．
    \begin{enumerate}
        \item 多様体の射$f:(M,\U)\to(N,\O)$は$C^r$級である．
        \item $\forall_{x\in M}\;\exists_{\alpha\in A}\;\exists_{\lambda\in\Lambda}\;\st x\in U_\alpha\;f(x)\in O_\lambda\;\psi_\lambda f\varphi^{-1}_\alpha:\varphi_\alpha(U_\alpha\cap f^{-1}(O_\lambda))\to W_\lambda\subset\R^n$が$\varphi_\alpha(x)$の近傍で$C^r$級である．
    \end{enumerate}
    \[\xymatrix{
        M\ar[r]^-f&N\\
        U_{\alpha}\ar@{^{(}->}[u]\ar[d]_-{\varphi_\alpha}&W_\lambda\ar@{^{(}->}[u]\ar[d]^-{\psi_\lambda}\\
        \R^m\ar@{.>}[r]^-{C^r}&\R^n
    }\]
\end{lemma}
\begin{proof}\mbox{}
    \begin{description}
        \item[(1)$\Rightarrow$(2)] 成り立つように定義した．
        \item[(2)$\Rightarrow$(1)] 
        $\beta\in A,\mu\in\Lambda$を任意に取る．任意の$x\in U_\beta\cap f^{-1}(O_\mu)$について
        \[\psi_\mu f\varphi^{-1}_\beta:\varphi_\beta(U_\beta\cap f^{-1}(O_\mu))\to W_\mu\subset\R^n\]
        が$\varphi_\beta(x)$の近傍で$C^r$級と示せば良い．
        いま，(2)より$\alpha\in A,\lambda\in\Lambda$が存在して
        \[\psi_\lambda f\varphi^{-1}_\alpha:\varphi_\alpha(U_\alpha\cap f^{-1}(O_\lambda))\to W_\lambda\subset\R^n\]
        が$\varphi_\alpha(x)$の近傍で$C^r$級である．
        よって，$\psi_\mu f\varphi^{-1}_\beta=(\psi_\mu\psi_\lambda)(\psi_\lambda f\varphi^{-1}_\alpha)(\varphi_\alpha\varphi_\beta^{-1})$も$C^r$級である：
        \[\xymatrix{
            \R^m\ar[r]&\R^n\\
            M\ar[u]^-{\varphi_\beta}\ar[d]_-{\varphi_\alpha}&M\ar[u]_-{\psi_\mu}\ar[d]^-{\psi_\lambda}\\
            \R^m\ar[r]^-{\psi_\lambda f\varphi^{-1}_\alpha}&\R^n
        }\]
    \end{description}
\end{proof}
\begin{remarks}
    これが成り立つように，多様体の$C^r$級というものを定義した．したがって各$\varphi_\alpha$が$C^r$級であることを直接は明言しない．
\end{remarks}

\begin{lemma}[product manifold]
    $(M,\{(U_\alpha,\varphi_\alpha,V_\alpha)\}_{\alpha\in A}),(N,\{(O_\lambda,\psi_\lambda,W_\lambda)\}_{\lambda\in\Lambda})$
    をそれぞれ，$m,n$次元$C^r$多様体とする．
    族$\{(U_\alpha\times O_\lambda,\varphi_\alpha\times\psi_\lambda,V_\alpha\times W_\lambda)_{(\alpha,\lambda)\in A\times\Lambda}\}$は積空間$M\times N$の$(m+n)$次元$C^r$級多様体である．
\end{lemma}

\begin{proposition}[product]\mbox{}
    \begin{enumerate}
        \item 射影$\pr_1:M\times N\to M$は$C^\infty$級写像である．
        \item 写像$f_i:N\to M_i\;(i=1,2)$が$C^\infty$級写像であることと，積写像$(f_1,f_2):N\to M_1\times M_2$が$C^\infty$級であることとは同値である．
    \end{enumerate}
\end{proposition}

\subsection{chartの言葉による滑らかさの特徴付け}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    引き戻しによる圏論的な定義から始めたが，
    成分の言葉による還元論的な特徴付けを得る．
\end{tcolorbox}

\subsection{多様体上の偏微分と逆写像定理}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    局所微分同相写像であるための必要条件は，Yacobianが消えないことである．
\end{tcolorbox}

\section{商：射影空間とaffine空間}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    多様体の構成法を与える．それは，商位相空間が多様体になるための条件である．
\end{tcolorbox}

\subsection{等化写像}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
    title=]
        等化写像$f:X\to Y$とは$f^*$がframeの同型となるような連続写像のことで，Topの中で２つを位相的に同一視できる．（$Y$から出る連続写像と$X$から出る連続写像とが一対一対応する）．
        これは商写像の使いやすさ，テンソルの「後ろ盾」の感覚，そのような「いくつかの対象をまとめて圏の中で新しい対象を構成する」という構成の一般化である．
\end{tcolorbox}

\begin{definition}[identification map / quotient map]
    商写像の技法を一般化する．像位相の技法，すなわち，逆像の対応$p^*$によって，同型に相当する概念を，単射性の分だけ緩めることができる．
    これは，「任意の位相空間$Z$への連続写像の空間が対応している」という圏論的特徴付の方を主軸に考えた方が良い．
    \begin{enumerate}
        \item 全射連続写像$X\epi Y$が次の同値な条件を満たすとき，\textbf{等化写像}であるという．
        \begin{enumerate}[(a)]
            \item 任意の部分集合$O\subset Y$について，$O\osub Y\Lrarrow p^{-1}(O)\osub X$．
            \item 任意の位相空間$Z$と射$f:Y\to Z$について，$f:Y\to Z$が連続であることと$f\circ p:X\to Z$が連続であることとは同値．
        \end{enumerate}
    \end{enumerate}
\end{definition}
\begin{example}\mbox{}
    \begin{enumerate}
        \item 商写像は等化写像である．条件(a)は，$p$が，$p$の定める同値関係$\sim\subset X\times X$について，商写像$p:X\to Y/\sim$を定める条件に同値だからである．
        \item 開区間$I$に一点$*$を付け加え，$\partial I$と$\{*\}$を同一視することで全射$p:I\cup\{*\}\to S^1$が導かれる．これは全射だが単射ではなく，等化写像である．ただし，$p(*)$は開ではないので$p$は開写像ではない．
        \item 任意の全射な連続開写像と，任意の全射な連続閉写像は，商写像（等化写像）である．特に，compact空間からHausdorff空間への連続全射は商写像である．
        $p$が連続であることが(a)の$\Rightarrow$の定義．$\Leftarrow$は$p$が開写像であるときに成り立つ：$p(p^{-1}(O))=O\osub Y$．
        \item $X$の開被覆$(U_{\alpha})_{\alpha\in A}$からの標準的な射影$\coprod_{\al\in A}U_\al\to X$は，全射な連続開写像であるから，商写像／等化写像である．
    \end{enumerate}
\end{example}
\begin{remark}[開写像は閉写像とは限らない]
    $f(X\setminus U)=f(X)\setminus U$が成り立たないためである．
    例えば，
    閉集合$\{(x,y)\in\R^2\mid xy=1\}$を，閉写像$\pr_2:\R^2\to\R$は開集合$\R\setminus\{0\}$に移す．
\end{remark}

\subsection{商空間にHausdorffが遺伝するための条件：開同値関係}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    次は同値．
    \begin{enumerate}
        \item $X/\sim$がHausdorffである．
        \item 同値関係のグラフ$\sim\subset X\times X$が閉集合である．
        \item $\pi$の各fiberが閉である．
    \end{enumerate}
    (1)$\Lrarrow$(2)は，商位相の定義より$X/\sim$の対角集合が閉であることが，その$\pi$による逆像が閉であることに同値であるため．(3)ならば(2)が成り立ち，(1)のとき$X/\sim$の一点集合は閉だから(3)が従う．
\end{tcolorbox}

\begin{theorem}\label{thm-characterization-of-quotient-Hausdorff}
    $\sim$を位相空間$S$上の開同値関係とする．\footnote{商写像$\pi:S\to S/\sim$が開写像であることを，同値関係$\sim$が開という．}
    \begin{enumerate}
        \item $S/\sim$がHausdorffである．
        \item $\sim\subset S\times S$が閉である．
    \end{enumerate}
\end{theorem}
\begin{proof}
    (2)は，任意の$x\not\sim y$である$x,y\in S$すなわち任意の元$[x],[y]\in S/\sim$が開集合で分離できることをいっている．
\end{proof}

\begin{theorem}
    $\sim$を位相空間$S$上の開同値関係とする．
    $\B=(\B_\alpha)$が$S$の開基ならば，その$\pi$による像$(\pi(B_\alpha))$も$S/\sim$の開基である．
\end{theorem}
\begin{proof}
    $U\subset S/\sim$を開集合とする．任意の$x\in U$について，$\pi^{-1}\in V\subset\pi^{-1}(U)$を満たす$V\in\B$が存在する．これについて，$x\in\pi(V)\subset U$．$\pi(V)$は開集合だから，結論を得る．
\end{proof}

\begin{corollary}\label{cor-characterization-of-quotient-second-countable}
    $\sim$が第２可算空間$S$上の開同値関係ならば，商空間$S/\sim$は第２可算である．
\end{corollary}

\subsection{群作用による商多様体（軌道分解）の例}

\begin{lemma}[等化写像としての軌道分解]
    位相群$G$の連続な左作用$\mu:G\times X\to X$を考える．
    軌道分解の定める同値関係を$x_0\sim x_1:\Lrarrow\exists_{g\in G}\;x_1=gx_0$とすると，
    商写像$p:X\to G\backslash X=X/\sim$は開な連続全射である．
\end{lemma}
\begin{proof}\mbox{}
    \begin{description}
        \item[任意の連続な作用$\mu:G\times X\to X$は連続な表現$\mu:G\to\Aut_\Top(X)$を定める] $\mu(g,-):X\to X$の逆射が$\mu(g^{-1},-)$であるため．実際，作用の公理より，$\mu(gg^{-1},-)=\mu(g,\mu(g^{-1},-))=\mu(1,-)=\id_X$．
        \item[連続性] 商位相の定め方より，連続．
        \item[開] 任意の$U\osub X$について，各$g$の作用は連続だから，$p^{-1}(p(U))=\cup_{g\in G}gU\osub Y$より．
    \end{description}
\end{proof}

\begin{example}[円板への巡回群の連続作用による軌道分解は円錐表面になる]
    閉円板$D^2=\{z\in\C\mid \abs{z}\le 1\}$に対する，有限巡回群の作用$\Z/m\curvearrowright D^2$を
    \[\xymatrix@R-2pc{
        \Z/m\times D^2\ar[r]&D^2\\
        \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
        ([k],z)\ar@{|->}[r]&\exp\paren{\frac{2\pi ik}{m}}z
    }\]
    とする．
    写像
    \[\xymatrix@R-2pc{
        D^2/(\Z/m)\ar[r]&D^2\\
        \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
        [z]\ar@{|->}[r]&z^m
    }\]
    は連続全単射．$D^2$はコンパクトよりその商写像の像$D^2/(\Z/m)$もコンパクト，$D^2$はハウスドルフだから，これは同型．
\end{example}

\begin{remark}[lens space：高次元版]
    3次元レンズ空間$L(p;q)$は，$S^3\subset\C^2$として，群作用
    \[\xymatrix@R-2pc{
        \Z/p\Z\times S^3\ar[r]&S^3\\
        \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
        ([k],(z_1,z_2))\ar@{|->}[r]&(e^{\frac{2\pi ik}{p}}z_1,e^{\frac{2\pi ikq}{p}}z_2)
    }\]
    による軌道分解である．
    3次元レンズ空間はそのホモロジーおよび基本群だけからは決定することができない3次元多様体の最もよく知られた例であり、そして同相型 (homeomorphism type) がそのホモトピー型から決まらない閉多様体の最も簡単な例である。
    Tietzeの1908年のレンズ空間の導入を以って（代数的位相幾何学から分かれて）幾何学的位相幾何学 (geometric topology) の起こりと考えられる。
\end{remark}

\subsection{射影空間}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    射影空間は，球面の対蹠点または大円を同一視した商空間とも，
    原点を通る１次元部分空間（直線）全体の集合ともみなせる．
    この２つのものの見方は，それぞれ被覆写像とGrassmann多様体の概念に対応する．
    前者について，スカラー倍についての軌道を潰した空間と考えると，
    斉次座標が「比が等しい点の中での座標」として理解できる．
    定数倍について潰すのであるから，元の空間で座標$x^0,\cdots,x^n$を取ろうとも，比しか真の自由度をなさないのである．
    本質的に線型代数的な発想である．
    またスカラー倍の群作用の様子は複素と実で違う．
    実の場合は，球面上に正規化して考えると$O_n(\R)$が残り，あとは符号反転について潰すと良い：$\R P^n\simeq S^n/{\pm 1}$．
    複素数の作用の場合は，絶対値を潰して，球面上に正規化した後も，回転群$S^1=\{e^{i\theta}\mid\theta\in\R\}$による作用が残り，あとは回転群$S^1$について潰す必要がある，と分けて考えると：$\C P^n\simeq S^{2n+1}/S^1$．
    この最後の潰す部分は単位球面からの連続全射\footnote{実は$C^\infty$級可微分でもある．}であるから，射影空間はコンパクトであることがわかる．
\end{tcolorbox}

\begin{definition}[projective space, homogeneous coordinate]
    スカラー倍という群作用$\R^\times\curvearrowright\R^{n+1}\setminus\{0\}$による軌道分解の定める同値関係を
    同値関係を$x\sim y:\Leftrightarrow\exists_{t\in\R^\times}\;y=tx$で定める．
    商空間$\pi:\R^{n+1}\setminus\{0\}\epi\R P^n$を\textbf{実射影空間}とよび，
    この切断を（$(a^0,\cdots,a^n)$の同値類を）$[a^0:\cdots:a^n]$と表し，\textbf{斉次座標}と呼ぶ．
\end{definition}

\begin{lemma}
    この商写像$\pi:\R^{n+1}\setminus\{0\}\to\P^n(\R)$は開である．
\end{lemma}
\begin{proof}
    任意の開集合$U\subset\R^{n+1}\setminus\{0\}$について，$\pi(U)$が開集合であること，すなわち，商位相の定義より，$\pi^{-1}(\pi(U))$が開集合であることを示せば良い．
    いま，
    \[\pi^{-1}(\pi(U))=\cup_{t\in\R^\times}\{tp\mid p\in U\}=\cup_{t\in\R^\times}tU\]
    であるが，$t$倍写像$t\times:\R^{n+1}\setminus\{0\}\iso\R^{n+1}\setminus\{0\}$は同相写像であるから，
    各$tU$は開．
\end{proof}

\begin{proposition}\mbox{}
    \begin{enumerate}
        \item $P^n(\R)$は第２可算である．
        \item $P^n(\R)$はHausdorffである．
    \end{enumerate}
\end{proposition}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item 系\ref{cor-characterization-of-quotient-second-countable}より．
        \item 定理\ref{thm-characterization-of-quotient-Hausdorff}より，同値関係のグラフ$R=\{(x,y)\in S\times S\mid \exists_{t\in\R^\times}\;y=tx\}$が閉であることを示せば良い．
        $R$は$(n+1)\times 2$行列$(x\;y)$のうち，階数が$1$以下のものとして特徴付けられる．すなわち，$R\subset M_{n+1,2}$は$n+1$個の$2\times 2$小行列式が$0$であることとして特徴付けられるから，閉集合の有限共通部分で，閉集合である．
    \end{enumerate}
\end{proof}
\begin{remarks}[核としての分離]
    こういう線形代数の使い方，とても美しい．
    ２つの点が同一視される場合とは，ベクトルとして並行な場合であるから，行列式の言葉で，$C^\infty$級写像$M_{n+1,2}\to\R$の核に帰着する．
    この応用として次のような直接的な示し方もある．相異なる元$[z],[z']\in\K P^n$について，$z,z'\in\K^{n+1}$は一次独立だから，これを延長して$\K^{n+1}$の基底を得て，この基底のノルムを対応させるが，$z'$だけ$0$を対応させることにより同型$\K^{n+1}\to\K$を得る．これを用いて$f:\K P^n\to\K$を$f([z]):=\frac{\abs{h(z)}}{\norm{z}}$とすると，
    これは$\forall_{a\in\K^\times}\;\frac{\abs{f(az)}}{\norm{az}}=\frac{\abs{f(z)}}{\norm{z}}$よりwell-definedで，$[z],[z']$を分離する．実際，$[z]\in f^{-1}\paren{\paren{\frac{2}{3},\infty}},[z']\in f^{-1}\paren{\paren{-\infty,\frac{1}{3}}}$．
\end{remarks}

\begin{example}[球面の同値類としての射影空間]\mbox{}
    \begin{enumerate}
        \item $S^n$上の同値関係を$x\sim y:\Leftrightarrow x=\pm y$で定める．
        \[\xymatrix@R-2pc{
            f:\R^{n+1}\setminus\{0\}\ar[r]&S^n\\
            \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
            x\ar@{|->}[r]&\frac{x}{\norm{x}}
        }\]
        は同相写像$\o{f}:P^n(\R)\to S^n/\sim$を定める．\footnote{線型部分空間と球面との交点を考えると，対蹠点の同一視により対応がつくことがわかる．実際，これは同相になる．}
        \item 特に$(S^1/\sim)\simeq S^1$である．したがって，$P^1(\R)\simeq S^1$が結論づけられる．この場合は，$[2:1]$とは$\paren{\frac{2}{\sqrt{5}},\frac{1}{\sqrt{5}}}$に対応する．確かに，同値類は「比が等しい集合」となっている．
        \item 閉円板の周$\partial\Delta$上の同値関係を$(x,y)\sim(-x,-y)$とすると．$(S^2/\sim)\simeq([\Delta]/\sim)$である．したがって，$P^2(\R)\simeq[\Delta]/\sim$が結論づけられる．\footnote{これは$\R^3$には埋め込めないが，自己交叉（非単射）を許して埋め込むことはでき，これをcross-capという．}
    \end{enumerate}
\end{example}

\begin{proposition}[Hopf fibration]\mbox{}
    \begin{enumerate}
        \item 複素射影空間$\C P^n$はコンパクトである．
        \item $S^{2n+1}/S^1\simeq\C P^n$．
        \item $S^n/S^0=S^n/\{\pm 1\}\simeq\R P^n$．
    \end{enumerate}
\end{proposition}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item 商写像$\varpi:\C^{n+1}\to\C P^n$の球面$S^{2n+1}$への制限$\pi:=\varpi|_{S^{2n+1}}:S^{2n+1}\epi\C P^n$は連続全射となる．
        この全射をHopf fibrationと呼ぶ．
        実際，任意の$z\in C^{n+1}\setminus\{0\}$について，$\frac{z}{\norm{z}}\in\pi^{-1}(z)$．
        コンパクト集合$S^{2n+1}$からの連続写像の像であるから，$\C P^n$はコンパクト．
        \item 
        $\C^\times\acts\C^{n+1}\setminus\{0\}$の制限$S^1\acts S^{2n+1}$を考える．これについての軌道分解$S^{2n+1}/S^1$に，$\pi$は連続全単射，すなわち同型を引き起こす：
        \[\xymatrix{
            S^{2n+1}\ar[r]^-{\pi}\ar[d]&\C P^n\\
            S^{2n+1}/S^1\ar@{.>}[ur]
        }\]
        $\C^\times$の作用は回転と拡大があって，拡大についてはすでに潰したのが複素射影空間であるから，残りは回転群$S^1$しか残っていない．
        \item まったく同様の原理である．複素についてのHopf fibrationが大円からなるのならば，実のHopf fibrationは２点反転（対蹠点の対応）からなる．
        $SO_n(\R)=O_n(\R)/\{\pm 1\}$ということのはず．
    \end{enumerate}
\end{proof}
\begin{remark}
    元々Hopfが構成したのは$S^1\mono S^3\epi S^2$であり，$S^3$がコンパクト，$S^2$がHausdorffであることに注意して，
    これは準同型定理より
    \[\xymatrix{
        S^3\ar@{|->>}[r]^-p\ar@{-->}[d]_-{\pi}&S^2\ar@{.>}[d]\\
        S^3/S^1\ar@{-->}[ur]^-{\sim}\ar@{-->}[r]^-{\sim}&\C P^1
    }\]
    となる．
\end{remark}

\subsection{射影空間の射}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    斉次多項式は線型写像の一般化である．多項式は次数付き環なので，斉次多項式に分解できる．\footnote{最初の２段についての射がaffine空間の射か？}
    Chow(周)の定理により，射影空間の部分集合が正則関数の族の零点集合であることと斉次多項式の零点集合であることは同値である．
\end{tcolorbox}

\begin{definition}[canonical atlas]
    $U_i:=\{[a^0,\cdots,a^n]\in\R P^n\mid a^i\ne 0\}$はwell-definedであり，$\pi^{-1}(U_i)=\{(x^0,\cdots,x^{n+1})\in\R^{n+1}\mid x^i\ne 0\}\cup\{0\}$は開集合より，$U_i$は$\R P^n$の開集合である．
    これに対して
    \[\xymatrix@R-2pc{
        \phi_i:U_i\ar[r]&\R^n\\
        \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
        [a^0,\cdots,a^n]\ar@{|->}[r]&\frac{1}{a^i}(a^1,\cdots,\wt{a^i},\cdots,a^n)
    }\]
    と定める．ただし，$\wt{\cdot}$とはその成分を除くこととした．
    すると，任意の$x\in\R^n,x_i\ne 0,x_j\ne 0$について，$\phi_i\circ\phi_j^{-1}(x)=\phi_i([x^1,\cdots,\wh{1}^j,\cdots,x^n])=\frac{1}{x^i}(x^1,\cdots,\wh{x_i},\cdots,\wh{1}^j,\cdots,x^n)$より，$C^\infty$級で両立している．
\end{definition}
\begin{remarks}[斉次座標の例とRiemann球面との同型]
    affine空間は線型空間に他ならないがその射が違う．射は線型写像と定数関数の和とする．
    これは，$A\in\GL_{n}(K),b\in\R^n$を用いて，affine変換$A+b$は，
    拡張された空間$\R^{n+1}:=\R^n\oplus\R$における線型写像のうち，特に剪断写像であるクラス
    \[
        \begin{pmatrix}A&b\\0&1\end{pmatrix}\begin{pmatrix}x\\1\end{pmatrix}=\begin{pmatrix}Ax+b\\1\end{pmatrix}
    \]
    と理解できる．なお，線型空間$\R^{n+1}$の原点は$(0,\cdots,0,1)$である．
    これは斉次座標の例である．
    確かにここでも$1$は，比の意味しかなしていない．

    Riemann球面への同型$\psi:S^2\to\C P^1$も同様の精神で構成できる．
    \[\psi(w,t):=\begin{cases}
        [w:1+t],&(w,t)\ne(0,-1)のとき,\\
        [1:0],&(w,t)=(0,-1)のとき.
    \end{cases}\]
    と定めると，逆が立体射影の知識を用いて
    \[\xymatrix@R-2pc{
        \C P^1\ar[r]&S^2\\
        \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
        [z_1:z_2]\ar@{|->}[r]&\paren{\frac{2z_1\o{z_2}}{\abs{z_1}^2+\abs{z_2}^2},\frac{-\abs{z_1}^2+\abs{z_2}^2}{\abs{z_1}^2+\abs{z_2}^2}}
    }\]
    同様に，$S^1\simeq\R P^1$が$(x,y)\mapsto[x:1+y]$で定まる．
\end{remarks}

\begin{lemma}
    射影空間の開部分空間$W\osub\K P^n$から，$C^\infty$多様体$M$への写像$f:W\to M$について，
    次の２条件は同値．
    \begin{enumerate}
        \item $f$は$C^\infty$級．
        \item $f\circ\varpi:\varpi^{-1}(W)\to M$は$C^\infty$級．
    \end{enumerate}
\end{lemma}
\begin{proof}
    $\Leftarrow$について示せば良い．
    任意の座標写像
    \[\xymatrix@R-2pc{
        s_i:U_i\ar[r]&\K^{n+1}\setminus\{0\}\\
        \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
        {[z_0:\cdots:z_{n}]}\ar@{|->}[r]&\paren{\frac{z_0}{z_i},\cdots,\frac{z_{i-1}}{z_i},1,\frac{z_{i+1}}{z_i},\cdots,\frac{z_n}{z_i}}
    }\]
    について，$\varpi\circ s_i=1_{U_i}$である（切断である）から，
    $f|_{W\cap U_i}=(f\circ\varpi)\circ(s_i|_{W\cap U_i})$と$C^\infty$級写像の合成で表せた．
\end{proof}

\begin{example}[projective transformation / homography]
    任意の$A\in\GL_{n+1}(\K)$について，$A$倍写像は射影変換
    \[\xymatrix@R-2pc{
        A\times:\K P^n\ar[r]&\K P^n\\
        \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
        [z]\ar@{|->}[r]&[Az]
    }\]
    を定める．スカラー倍写像は中心であるため，$\GL_{n+1}(\K)$の各元と可換である．
\end{example}

\begin{example}[Möbius transformation]
    $\P^1(\C)$の射影変換の群は，一次分数変換$\Aut(\hatC)$である．
\end{example}

\begin{definition}[projective (algebraic) variety]
    斉次多項式$f:\K^n\to\K$の零点集合を$Z(f):=\{[z]\in\K P^n\mid f(z)=0\}$とする．
    これは$\forall_{\lambda\in\K^\times}\;f(z)=0\Lrarrow f(\lambda z)=0$より，well-definedである．
    これが$(\K P^n,(U_i)_{i\in n+1},(\varphi_i)_{i\in n+1})$の$C^\infty$級部分多様体であるとき，これを$\K$上の射影多様体という．
    $C^\infty$級多様体になるための条件は，座標写像$\varphi_i$は
    $Z(f)\cap U_i$上に同型$Z(f)\cap U_i\simeq\Brace{(\xi_1,\cdots,\xi_n)\in\K^n\mid f(\xi_1,\cdots,\xi_{i-1},1,\xi_i,\cdots,\xi_n)=0}$を
    定めるので，$\wh{f}_i(\xi_1,\cdots,\xi_n):=f(\xi_1,\cdots,\xi_{i-1},1,\xi_i,\cdots,\xi_n)$とすると，
    次の通り．
    \begin{align*}
        Z(f)がC^\infty 級多様体である&\Lrarrow \forall_{1\le i\le n+1}\;Z(f)\cap U_iがC^\infty 級多様体である\\
        &\Lrarrow \forall_{1\le i\le n+1}\;\wh{f}_i:\K^n\to\K は0を正則値にもつ
    \end{align*}
\end{definition}
\begin{remarks}
    この，通常の多項式が射影空間に乗る物語のきっかけは，斉次関数$\forall_{\alpha\in\K^\times}\;f(\alpha z)=\alpha^nf(z)$
    の$0$に対する条件$\forall_{\lambda\in\K^\times}\;f(z)=0\Lrarrow f(\lambda z)=0$から始まる．
    この条件がscaler倍について安定であるから，$Z(f)$を射影空間上の多様体だと思うと，調べるべきことが減って簡略化する．
\end{remarks}

\begin{definition}[modular curve]
    上半平面$\H$への合同部分群$\Gamma\subset\SL_2(\Z)$の作用による商として定義されるRiemann面をmodular曲線という．
\end{definition}
\begin{example}[Klein quantics：level 7 modular曲線のcompact化]
    "homogeneous polynomial"をCayleyやKleinの時代はquanticsと言った．
    部分群として$\Gamma:=\PSL_2(\Z/7)$の作用を考えると，
    \[X(7)=K=\Brace{[X:Y:Z]\in\C P^2\mid X^3Y+Y^3Z+Z^3X=0}\]
    となる．$z\ne 0$のとき，すなわち$U_3$上では，$f_3(z,w)=z^3w+w^3+z$となる．
    $f_3:\C^3\to\C$は$0$を正則値に持つ．全く同様に$U_1,U_2$も正則部分多様体となるから，$K\subset\C P^2$は2次元部分多様体となる．
    $\PSL_2(\Z/7)$とは168の元で，これについて向きも含めて保つ自己同型を持つことになるが，これは種数3のコンパクトリーマン面の中で最大である．
\end{example}

\subsection{affine空間}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    ある対象$\R^n\in\Diff$を標準とし，この上の圏$C^V$を考えて抽象化条件を課すという点において，
    affine空間とは本質的に多様体的な概念である（より一般的にはVectで展開され，$\R^n$は一般の基準線型空間$V$となる）．
\end{tcolorbox}

\begin{example}[affine space]
    $(\R^n,\id_{\R^n})$は解析多様体である．
    これを\textbf{affine空間}と呼ぶ．\footnote{この考え方はいい．affine空間とは，埋め込み$\Vect\to\Aff$である．つまり，射が違う（平行移動の分だけ緩めた）ベクトル空間である．}
    Diffに埋め込まれたEuclid空間を元に多様体の定義をして良い．
    これが「平行移動の分だけ吸収する」みたいなダサい議論を迂回する．
\end{example}

\begin{definition}[affine空間の座標]\mbox{}
    \begin{enumerate}
        \item affine空間の局所座標系$(f^1,\cdots,f^n)$（Jacobianが消えない関数の組）を\textbf{曲線座標系}と呼ぶ．
        \item 特に，各$f^i$が一次式$f^i(x)=\sum^n_{j=1}a^i_jx^j+b^i$であるとき，$\frac{D(f^1,\cdots,f^n)}{D(x^1,\cdots,x^n)}=(a^i_j)_{1\le i,j\le n}$であり，このとき$(f^1,\cdots,f^n)$はaffine空間$\R^n$全域で定義されており，これを\textbf{affine座標系}または\textbf{線型座標系}と呼ぶ．
    \end{enumerate}
\end{definition}

\begin{definition}[affine空間の射と同型]
    写像$\varphi:\R^n\to\R^n$が$\varphi^*x^i=\sum^n_{j=1}a^i_jx^j+b^i$と表されるとき，$\varphi$を$\R^n$のaffine写像という．
    \begin{enumerate}
        \item $b^i=0$のとき，$\varphi$を一次写像という．
        \item $a^i_j=\delta^i_j$のとき，平行移動という．
        \item $\varphi$が$\R^n$の微分同型であることと，$\det(a^i_j)\ne 0$は同値で，これを満たすときaffine変換という．
    \end{enumerate}
\end{definition}

\begin{definition}[射影空間の同型]
    $\R^{n+1}$の一次写像$\varphi$は，$\det(a^i_j)\ne 0$のとき微分同型である．
    これは
    \[\xymatrix{
        \R^{n+1}\setminus\{0\}\ar[r]^-\varphi_\sim\ar[d]^-{\pi}&\R^{n+1}\setminus\{0\}\ar[d]^-\pi\\
        P^n(\R)\ar@{-->}[r]^-{\o{\varphi}}&P^n(\R)
    }\]
    を引き起こす．これは$P^n(\R)$の微分同型を定めており，\textbf{射影変換}という．
\end{definition}

\begin{proposition}[射影変換群の構造]
    零でないスカラー行列の全体を$Z$とすると，$Z\rsub\GL_{n+1}(\R)$である．
    射影空間の射影変換群について，$\PGL_n(\R):=\Aut_\Diff(P^n(\R))\simeq\GL_{n+1}(\R)/Z$である．
\end{proposition}
\begin{remarks}
    これは，射影空間というのが$\R^{n+1}$(自己同型は$\GL_{n+1}(\R)$)をスカラー倍の群作用についての軌道分解として理解できることから従う．
    たまたまスカラー倍というのは，$\GL_{n+1}(\R)$の中心となる．

    単位円板$\Delta$の正則自己同型は，$f(a)=0$のとき，$e^{i\theta}\frac{z-a}{1-\o{a}z}\;(\theta\in\R)$と表せる．
    スカラー倍について潰した
\end{remarks}

\begin{proposition}[一次変換の推移性の一般化]
    $\R^n$の$n+1$個の点$p_0,\cdots,p_n$が一次独立とは，$\vec{p_0p_1},\cdots,\vec{p_0p_n}$が一次独立であることを言う．
    ２組の一次独立な$n+1$個の点$p_0,\cdots,p_n$と$q_0,\cdots,q_n$とについて，$\varphi(p_i)=q_i\;(i\in n+1)$を満たすaffine変換$\varphi\in\Aff(\R^n)$がただ一つ存在する．
\end{proposition}

\chapter{接空間}

\begin{quotation}
    前節で可微分多様体とその射を定義した．
    この上での微積分理論を展開するが，これは接関手(tangent functor) $T:\Diff\to\Vect(\Diff)$の理論となる．
    各点毎に$\Mfd^*\to\Vect_\R$と定める．
    その理由は，Diffという圏を構築して，その上の構造物として多様体を定義した以上，
    微分理論が単に$\R^n$上の理論から圏論化されたのである．
    あまりにも綺麗だ．ここから幾何学が始まる．
    %接空間は曲線の同値類であり，接束はそれらの無縁和である．
    %多様体間の滑らかな写像は，局所的には対応する点の接空間の間に線型写像を引き起こし，
    %結果的にそれは接束の間に微分と呼ばれる線型写像を引き起こす．
    %これは線型化関手(tangent functor) $T:\Diff\to\Vect(\Diff)$の理論である．
    %微分可能多様体とその間の写像を，接束とその間の束写像$df$に移す関手を定める理論である．
    %これを座標関数で引き戻すと，我々が慣れ親しんだ退化した概念である関数の微分である．
    %こうしてシステマチックに多様体の間の写像を局所的に線型化して観測する，というのが人が見出してきた数理科学で用いられる微積分と呼ばれる形式的道具の本質である．

    多様体の議論がうまくいった最大のポイントの一つは，多様体上に，一つの座標近傍の上だけに台をもつ無限回微分可能な関数が存在することである．
    このことから，多様体は再びEuclid空間に埋め込まれることとなる．ここで，１つの輪が閉じることになる．
\end{quotation}

\section{接空間}

\begin{quote}
    $(x,v)\in TX$は２つの見方が出来る．曲線の同値類としてと，導分（＝Leibniz則を満たす線型汎函数）からなる関数空間として．
\end{quote}

\subsection{接ベクトルと接空間}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
    title=一階の反変テンソル]
    反変テンソルとは勿論，関数空間である．
    したがってそこでの局所座標系とは，Hom集合の間の関手となる，というだけである．
    その構成の流儀には２通りある．
    \begin{description}
        \item[解析的定義] Leibniz則を満たす線型写像の空間$T_p(M)\subsetneq\Hom_\R(C^\infty_p(M),\R)$として．
        \item[幾何的定義] 曲線の同値類$T_p(M)=\Hom_\Diff(\R,M)/\sim$として．
    \end{description}
    この構成は関手的である．この関手性を連鎖律という．\footnote{合成関数の微分則というのはどう考えても関手性を指す．}
    %多様体上の$C^s$級曲線は「どんな観測から見ても$C^s$級曲線に見えるもの」である．
    %幾何とは$M$へ入る写像の研究であり，接ベクトルも曲線の同値類$T_p:=C^\infty(\R,X)/\sim$として定めたから，座標関数$\varphi$の定めるpost-compositionによる共変関手$\varphi_*:T_p(M)\iso\R^n$により接ベクトルの空間が線型空間として構築できる．\footnote{この共変関手は接写像$d\varphi$に他ならない．}
    %道という概念を使えば，道を道に移すpost-composition対応として，共変関手$df$が，代数の間の射$df:-\circ f:$として代数的に実装できる，という構成意図である．\footnote{そして$TM$は$(p,v)$とすると，自然と各点の接空間は階層分けして保存される．}
    %この同型が$e_i\in\R^n$に対応して定める基底を$\pp{}{x^i}\in T_pM$などと表す．
    %したがって，基底の座標（係数関数）に対する変換律は反変的になる．
\end{tcolorbox}

\subsubsection{松島多様体}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=解析的定義]
    Leibniz則を満たすような作用素がなす部分空間$T_p(M)\subset(C^\infty_p(M))^*$として接ベクトルを定めると，座標関数$\varphi:M\osup U\to V\osub\R^n$がこの関数空間の上に接束の座標$\varphi_*:\Hom(M,\R)\iso\Hom(\R^n,\R)$を定める．
    これは，多様体$M$上での微積分演算子を，Euclid空間に押し出す形で足をつけることで定義するということ．
\end{tcolorbox}

\begin{definition}[tangent vector]\mbox{}
    \begin{enumerate}
        \item 点$p$の近傍上で定義された$C^\infty$級関数上の線型汎函数$v:C^\infty_p(M)\to\R$であって，Leibniz則$v(fg)=v(f)g(p)=f(p)v(g)$を満たすものを，点$p$における$M$の\textbf{接ベクトル}という．
        \item こうして定まる$(C^\infty_p(M))^*$の部分空間を$T_p(M)$と表し，\textbf{接空間}という．
        この基底としては，近傍座標$x^i$の定める微分作用素$\pp{}{x^i}_p$などが取れる．これは「局所座標$\varphi=(x^1,\cdots,x^n)$によって$p\in U$を$\varphi(p)\in V\osub\R^n$に写し，そこで$x^i$について偏微分を取る」という作用$\pp{}{x^i}_pf=\pp{f}{x^i}(p)$を表す．\footnote{左辺は形式的な記号で$\pp{}{x^i}_p\in T_p(M)$，右辺は完全に$\R^n$での微積分学である．}
    \end{enumerate}
\end{definition}

\begin{theorem}[接空間の次元]\label{thm-dimention-of-tangent-space}
    接ベクトル空間$T_p(M)$は$n:=\dim M$次元である．
\end{theorem}
\begin{remarks}
    微分同相写像$\varphi:U\iso V$が，線型同型$\varphi_*:\Hom_\Diff(\R,U)\iso\Hom_\Diff(\R,V)$を誘導する．
\end{remarks}

\subsubsection{nLabと足助先生}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=幾何学的定義]
    曲線の同値類$T_p(M):=C^\infty(\R,M)/\sim$として定めると，座標関数$\varphi:M\osup U\to V\osub\R^n$がこの関数空間の上に接束の座標$\varphi_*:\Hom(\R,M)\iso\Hom(\R,\R^n)$を定める．
    これは，$M$上の接ベクトルは$\R^n$上の接ベクトルに押し出して捉えることに当たる．
    $\R^n$上の接ベクトルとは速度ベクトルである．
    この座標関数$\varphi_*$を線型同型とみなせて，$\varphi=(x^1,\cdots,x^n)$と$\paren{\pp{}{x^1},\cdots,\pp{}{x^n}}$とが定める線型同型となる．
\end{tcolorbox}

%\begin{lemma}[接ベクトルの押し出し：canonicalな場合]
%    $V_1,V_2\subset\R^n$を開集合，$\varphi:V_1\to V_2$を$C^1$級同相写像とする．
%    $p\in V_1$上の接ベクトル$v\in T_p\R^n$に対して，対応する$\varphi(p)\in V_2$上の接ベクトルを，共変関係に注意して，
%    $v$を定める曲線$\gamma:(-\epsilon,\epsilon)\to V_1$を用いて
%    \[\varphi_{*p}v:=\frac{d(\varphi\circ\gamma)}{dt}(0)\]
%    と定める．\footnote{$v$とは$M$上の構造$C_p^\infty$から出る線型汎函数としたため，共変対応になる．}するとこれは，$\gamma$の選び方に依らずに定まる．
%\end{lemma}
%\begin{proof}
%    多様体$(-\epsilon,\epsilon)$から出る可微分写像$\gamma$と$\varphi\circ\gamma$の間の変換則（補題\ref{lemma-patching-condition}）と，
%    接ベクトルが満たすべき変換則とが一致するためである．
%\end{proof}

\begin{lemma}[接触関係：tangency relation]
    $M$を$C^1$級多様体，$p\in M$とする．$C^1$級曲線$\gamma_i:(-\epsilon,\epsilon)\to M\;(i=1,2)$が$p$において同じ接ベクトルを定める：$\gamma_1\sim_p\gamma_2$とは，
    \begin{enumerate}
        \item $\gamma_1(0)=\gamma_2(0)=p$．
        \item $p\in U$を満たす任意の座標近傍$(U,\varphi)$について，$D(\varphi\circ\gamma_1)(0)=D(\varphi\circ\gamma_2)(0)$．\footnote{ある座標近傍が存在してこれを満たすだけで十分であることに注意．}
    \end{enumerate}
    とする．このとき，関係$\gamma_1\sim_p\gamma_2$は同値関係である．
\end{lemma}

\begin{definition}[tangent space, tangent bundle]
    $M$を$C^1$級多様体，$p\in M$とする．
    \begin{enumerate}
        \item $T_pM:=\{\gamma\in C^1((-\epsilon,\epsilon),M)\mid\gamma(0)=p\}/\sim_p$．
        \item 無縁和$TM:=\coprod_{p\in M}T_pM$を接束という．
    \end{enumerate}
\end{definition}

\begin{proposition}[接ベクトルの変換]\label{prop-transformation-of-tangent-vector}
    $v\in T_pM$は２つの座標変換$(U,\varphi),(U',\varphi')$について，
    \begin{align*}
        \varphi_{*p}v&=v^1\frac{\partial}{\partial x^1}_q+v^2\frac{\partial}{\partial x^2}_q+\cdots+v^n\frac{\partial}{\partial x^n}_q\\
        \varphi'_{*p}v&=w^1\frac{\partial}{\partial y^1}_{q'}+w^2\frac{\partial}{\partial y^2}_{q'}+\cdots+w^n\frac{\partial}{\partial y^n}_{q'}
    \end{align*}
    と表されるとする．
    \[\xymatrix{
        &p\in M\ar[dl]_-{\varphi_x}\ar[dr]^-{\varphi'_y}\\
        q\in\varphi(U)\ar@{.>}[rr]^-{\varphi'\circ\varphi^{-1}}&&\varphi'(U)\ni q'
    }\]
    このとき，
    \begin{enumerate}
        \item 係数はJacobi行列によって変換される：$w=D(\varphi'\circ\varphi^{-1})(q)v$または
        \[\begin{pmatrix}w^1\\\vdots\\\vdots\\w^n\end{pmatrix}=\underbrace{\begin{pmatrix}\pp{(\varphi'\circ\varphi^{-1})^1}{x^1}(q)&\cdots&\pp{(\varphi'\circ\varphi^{-1})^1}{x^n}(q)\\\vdots&\ddots&\vdots\\\pp{(\varphi'\circ\varphi^{-1})^n}{x^1}(q)&\cdots&\pp{(\varphi'\circ\varphi^{-1})^n}{x^n}(q)\end{pmatrix}}_{=D(\varphi'\circ\varphi^{-1})(q)}\begin{pmatrix}v^1\\\vdots\\\vdots\\v^n\end{pmatrix}\]
        \item また，$p$を含む任意の座標近傍の間でこの変換則を満たす係数の選び方$\Lambda\nrightarrow\R^n$に対して，$v\in T_pM$が一意に存在する．
    \end{enumerate}
\end{proposition}
\begin{remarks}[反変1-テンソルの変換則]
    変換則としてYacobi行列を得た時点で，微分が幾何学化された．
    ベクトルの実体は数学的には，導分の空間$\mathcal{D}_p(M)\subset\Hom_\R(\Map(I,M),\R)$の中に対日したから，元の間の関係は共変関手$\varphi_{*p}:T_pM\iso\varphi_{*p}T_pM=\bracket{\frac{\partial}{\partial x^1}_{\varphi(p)},\cdots,\frac{\partial}{\partial x^n}_{\varphi(p)}}$である．
    一方で，観測者に依存する所の係数と基底変換の間の関係は，反変（縦ベクトルにYacobi行列が作用する）になっている．

    観測$(U,\varphi)$毎に定まる$(v^i)\in\R^n$であって，上の変換則を満たすものを１次の反変テンソルという．
    わざわざテンソルというときは，物理量・観測量としての，係数である$(v^i)\in\R^n$のことを指すことに注意．
\end{remarks}

\begin{definition}[接空間の線型構造]\mbox{}
    \begin{enumerate}
        \item $\varphi_{*p}(T_p(M)):=\Brace{\varphi_{*p}v\in T_{\varphi(p)}(\R^n)\mid v\in T_p(M)}$とおき，$\varphi_{*p}(T_p(M))$に$\pp{}{x^1}_{\varphi(p)},\cdots,\pp{}{x^n}_{\varphi(p)}$を基底とする実線型空間の構造を入れる．
        \item $T_p(M)$には，$\varphi_{*p}:T_p(M)\iso\varphi_{*p}(T_p(M))$が実線型同型として，実線型空間の構造を入れる．
    \end{enumerate}
\end{definition}

\subsection{接空間の２つの定義の同値性}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=導分として構成すると，強固な支持を得る．]
    接空間$TM_p\subset\Hom_R(C_p^\infty,\R)$は，関数の芽の代数(algebra of smooth functions)を実数に移す線型汎函数のうち，Leibniz則を満たす部分空間として特徴付けられる．
    そしてこれが，各座標関数についての導分＝偏微分を基底に持つ，というシナリオであったのだ！\footnote{「任意の方向微分は，偏微分の重ね合わせである」}

    ここから写像の微分がどう形式的に定義できるかを見る．
    道という概念を使えば，道を道に移すpost-composition対応として，共変関手$df$が実装できる，という構成意図なのであった．
    滑らかな関数のなす代数の間の射$f^*=-\circ f:C^\infty(Y)\to C^\infty(X)$を考える．
    すると，$df(x,v)=(f(x),v\circ f^*)$として，$df:TX\to TY$が定まる．
    これは第２成分については，「$X$に引き戻してから導分をとるという導分」という言葉で指定していることとなる．

    以上より，写像の微分とは本質的に完全に関手的なものであり，その関手性をchain ruleという．
\end{tcolorbox}

\begin{proposition}
    実線型写像$\alpha:C_p^\infty\to\R$が，$\alpha(fg)=\alpha(f)g(p)+f(p)\alpha(g)$を満たすならば，ある接ベクトル$v\in T_pM$がただ一つ存在して，これについての導分$\alpha=v$に他ならない．
\end{proposition}
\begin{proof}\mbox{}
    \begin{description}
        \item[一意性] ２つの$v,v'\in T_pM$について，２つの導分であるならば，$\id:U_p\to\R^m$について，$v(\id)=v=v'=v'(\id)$が従う．
        \item[存在] 
    \end{description}
\end{proof}

\section{微分論}

\begin{quote}
    接空間を定義した．微分とは，可微分写像$\varphi:M\to M'$を，接空間の間の対応$T_pM\to T_qM'$へと線型化する，線型化の技法である．
    この構成を関手的に定めて，微分と呼ぶ．
    \begin{enumerate}
        \item 関数の微分を微分形式を用いて定める．
        \item これの補助を得る形で写像の微分が定まる．すると線型化の理論を得たわけであるから，多様体論に線型代数を流入させることができる．可微分写像に階数の言葉が定まる．
        \item 階数の言葉で部分多様体(Diffのmonoとepi)を定義する．
    \end{enumerate}
\end{quote}

\subsection{関数の微分と臨界点}

\begin{definition}\mbox{}
    \begin{enumerate}
        \item 関数$f:M\to\R$の$p\in M$での微分$(df)_p\in T_p^*(M)$を，$(df)_p(v):=v(f)$と定める．
        \item $(dx^1)_p,\cdots,(dx^n)_p$が$\pp{}{x^1}_p,\cdots,\pp{}{x^n}_p$の双対基底となる．
    \end{enumerate}
\end{definition}

\begin{proposition}
    関数$f^1,\cdots,f^n:M\to\R$について，次の２条件は同値．
    \begin{enumerate}
        \item $(df^1)_p,\cdots,(df^n)_p$が一次独立である．
        \item $(f^1,\cdots,f^n)$は$p$の周りの局所座標系である．
    \end{enumerate}
\end{proposition}
\begin{proof}
    \[(df^i)_p=\pp{f^i}{x^1}(dx^1)_p+\cdots+\pp{f^i}{x^n}(dx^n)_p\]
    より，$(df^i)_p$の成分は，行列$\frac{D(f^1,\cdots,f^n)}{D(x^1,\cdots,x^n)}$の横ベクトルに等しい．
\end{proof}

\subsection{写像の微分}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    可微分写像$\varphi:M\to M'$は接空間＝関数空間の上に事前合成$\varphi^*=(-)\circ\varphi:\Hom_\Diff(M',N)\to\Hom_\Diff(M,N)$を定める．
    これを用いて，接ベクトルの押し出し$\varphi_*$が定まる．$\varphi_{*p}v$とは，その上の関数を$\varphi^*$を用いて引き戻して$v$で微分する線型汎函数と定めれば良い．\footnote{この動きは像測度と全く同じだ．}
\end{tcolorbox}

\begin{lemma}
    可微分写像$\varphi:M\to M'$に対して，事前合成$\varphi^*f=f\circ\varphi$により対応$\Hom_\Diff(M',N)\to\Hom_\Diff(M,N)$が定まるから，これを用いて，
    $v\in T_p(M)$に対して，$(\varphi_*)_pv(f)=v(\varphi^*f)$と定める．
    \begin{enumerate}
        \item $(\varphi_*)_pv\in T_{\varphi(p)}(M')$である．すなわち，Leibniz則を満たす線型写像である．
        \item 対応$(\varphi_*)_p:T_p(M)\to T_{\varphi(p)}(M')$は線型写像である．
    \end{enumerate}
\end{lemma}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item Leibniz則は次のように，$v$のLeibniz則から従う：
        \begin{align*}
            ((\varphi_*)_pv)(fg)&=v(\varphi_*(fg))=v(\varphi_*f\cdot\varphi_*g)\\
            &=v(\varphi^*f)\varphi^*g(p)+\varphi^*f(p)v(\varphi^*g)=((\varphi_*)_pv)(f)\cdot g(\varphi(p))+f(\varphi(p))\cdot ((\varphi_*)_pv)(g).
        \end{align*}
        \item 接ベクトル$v\in T_pM$の線形性から従う：
        $(\varphi_*)_p(v+w)=(v+w)(\varphi^*-)=v(\varphi^*-)+w(\varphi^*-)=(\varphi_*)_p(v)+(\varphi_*)_p(w)$．
    \end{enumerate}
\end{proof}

\begin{proposition}[基底の対応]\label{prop-presentation-of-differential-of-mapping}
    $(x^1,\cdots,x^n),(y^1,\cdots,y^m)$を$p$と$\varphi(p)$の局所座標系とし，$\varphi^*y^i=\varphi^i$とおく．
    \[\xymatrix{
        M\ar[r]^-{\varphi}\ar[d]_-{(x^1,\cdots,x^n)}\ar@{-->}[dr]|-{(\varphi^1,\cdots,\varphi^n)}&M'\ar[d]^-{(y^1,\cdots,y^m)}\\
        \R^n&\R^m
    }\]
    このとき，
    \[(\varphi_*)_p\paren{\pp{}{x^i}}_p=\sum^m_{j=1}\pp{\varphi^j}{x^i}(p)\paren{\pp{}{y^j}}_{\varphi(p)}.\footnote{関数の微分を用いて，$M$の座標$(x^1,\cdots,x^n)$を抽象化するならば，係数を$(d\varphi^j)_p\paren{\paren{\pp{}{x^i}}_p}$と表せる．}
    \]
\end{proposition}
\begin{proof}
    任意に$g:M'\to\R$を取って議論しても甲斐がないから，
    作用素としての意味を直接考えてみる．
    \begin{enumerate}
        \item $(\varphi_*)_p\paren{\pp{}{x^i}}_p\in T_{\varphi(p)}(M')$とは，関数$f:M'\to\R$を$\varphi$によって引き戻してから$\paren{\pp{}{x^i}}_p:C_p^\infty(M)\to\R$によってスカラーにすることをいう．なお，作用素$\paren{\pp{}{x^i}}_p:C_p^\infty(M)\to\R$とは，座標近傍$(x^1,\cdots,x^n)$によって$\R^n$へ写してから$x^i$について偏微分係数を取る作用素である．
        すなわち，$(\varphi_*)_p\paren{\pp{}{x^i}}_p=\paren{\pp{}{x^i}}_p(-\circ\varphi)$．
        \item ここで，$\xymatrix{
            M\ar[r]^-{\varphi}&M'\ar[d]^-{(y^1,\cdots,y^m)}\\
            &\R^m
        }$についての連鎖律を考える．関数$g:M'\to\R$が与えられてから，引き戻し$g\circ\varphi$を$\paren{\pp{}{x^i}}_p$で微分するのではなく，最初から連鎖律を適用すると，
        \begin{align*}
            &\paren{\pp{}{x^i}}_p(-\circ\varphi)\\
            =\sum^m_{j=1}&\paren{\pp{}{y^j}}_{\varphi(p)}\pp{\varphi^j}{x^i}(p)
        \end{align*}
        ここで，作用素性は$\paren{\pp{}{y^j}}_{\varphi(p)}$に集約され，$\pp{\varphi^j}{x^i}(p)$はただの$\varphi^j:\R^n\to\R^m$の偏微分係数．
    \end{enumerate}
\end{proof}

\begin{proposition}[連鎖律]\mbox{}
    \begin{enumerate}
        \item 可微分写像$\varphi:M\to M',\psi:M'\to M''$について，$((\psi\circ\varphi)_*)_p=(\psi_*)_{\varphi(p)}\circ(\varphi_*)_p$．
        \item 特に，$M\simeq M'$ならば，$M$と$M'$は同次元である．
    \end{enumerate}
\end{proposition}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item 図式の可換性からわかる．
        \item $\varphi:M\iso M'$は，各点において接空間の同型$\varphi_*:TM\iso M'$を定める．接空間の次元と可微分多様体の次元は一致するから\ref{thm-dimention-of-tangent-space}．
    \end{enumerate}
\end{proof}

\begin{definition}[rank]\mbox{}
    \begin{enumerate}
        \item $(\varphi_*)_p:T_p(M)\to T_{\varphi(p)}(M')$の階数のことを，可微分写像$\varphi:M\to M'$の$p\in M$における\textbf{階数}という：$\rank_p(\varphi)=\dim(\Im(\varphi_*)_p)=\rank\paren{\pp{\varphi^i}{x^j}(p)}$．
        \item よって，$\rank_p(\varphi)\le\min(n,m)$がわかる．
        \item $\rank(\varphi):=\max_{p\in M}\rank_p(\varphi)$と定める．
    \end{enumerate}
\end{definition}
\begin{remarks}[写像の微分の行列表示]\label{remarks-representation-of-differential}
    $\varphi:M\to M'$を接束の上に持ち上げる理論$\varphi_*:TM\to TM'$が成立した．
    接束には座標関数$x:M\to\R^n$の持ち上げ$x_*=(dx^1,\cdots,dx^n):TM\to T\R^n\simeq\R^n$により座標を入れている．
    $y_*:M'\to\R^m$についても同様．
    よって，$\varphi_*$の$x_*,y_*$による行列表示とは，基底の対応\ref{prop-presentation-of-differential-of-mapping}をみると，
    $\paren{\pp{\varphi^j}{x^i}(p)}$とわかる．すると，$\varphi$の行列表示としては，その転置が妥当，ということか．\footnote{双対微分の議論をする前に，そもそも接空間の構成が双対的であったことに注意．}
\end{remarks}

\begin{lemma}[最大ランク集合は開集合である]
    $\Brace{p\in M\mid \rank_p(\varphi)=\rank(\varphi)}\osub M$．
\end{lemma}
\begin{proof}
    rankの半連続性\ref{lemma-semicontinuity-of-rank}より．
\end{proof}

\begin{definition}[dual differential]
    写像の微分の双対を\textbf{双対微分}と呼ぶ．
    すなわち，$(\varphi_*)_p:T_p(M)\to T_{\varphi(p)}(M')$が定める双対写像$(\varphi^*)_p:T_{\varphi(p)}^*(M')\to T_{p}^*(M)$をいう．
    可微分写像$f:M'\to\R$に対して，微分1-形式を引き戻す：$(\varphi^*)_p\paren{(df)_{\varphi(p)}}=(d(\varphi^*f))_p$．
\end{definition}
\begin{remark}
    Hodge双対と極めて近い概念．
\end{remark}

\begin{theorem}[可微分多様体に一般化された陰関数定理]\label{thm-implicit-function-thm}
    $\varphi:M\to M'$を，次元$n$から$m$への可微分写像とする．
    点$p\in M$において$\rank_p(\varphi)=n$とする．
    このとき，$\rank(\varphi)=n\le m$であり（最大ランク），$p,\varphi(p)$の局所座標系$(x^1,\cdots,x^n),(y^1,\cdots,y^m)$を適当に選べば，
    \[y^i\circ\varphi=x^i\quad(i=1,\cdots,n),\qquad y^j\circ\varphi=0\quad(j=n+1,\cdots,m)\]
    が成り立つようにできる．
    \[\xymatrix{
        M\ar[r]^-\varphi&M'\\
        U\ar@{^{(}->}[u]\ar[r]\ar@{.>}[d]_-{\exists x}&V\ar@{^{(}->}[u]\ar@{.>}[d]^-{\exists y}\\
        O\ar[r]_-{q_n}&W
    }\]
\end{theorem}
\begin{proof}
    最初の主張については，一般に$\rank(\varphi)\le\min(n,m)$であるから，$\rank_p(\varphi)=n$の時点で$n\le m$が成り立ち，$\rank(\varphi)=n$が従う．
\end{proof}
\begin{remark}
    仮定を$\rank_p(\varphi)=m$としても，$\iota:O\to W$として同じ主張が成り立つ．
\end{remark}

\subsection{Sardの定理}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    臨界点＝停留点とは，あくまで微分が消える点である．これは，行列表示\ref{remarks-representation-of-differential}を介して，$\rank_p\varphi<\rank\varphi$を意味する．
    すなわち，陰関数定理が適用できない点と同義である．
    臨界点の集合(critical locus)はたくさんあるかもしれないが，臨界値の集合はほとんどない．
\end{tcolorbox}

\begin{definition}[critical point, regular point]
    $\varphi:M\to M'$を，$n$次元から$m$次元への可微分写像とする．
    \begin{enumerate}
        \item $(\varphi_*)_p:T_p(M)\to T_q(M')$が全射でない時($\rank_p(\varphi)<m$)\footnote{すなわち，$(\varphi_*)_p$の表現行列の行ベクトル空間が$T_q(M')$を生成しないとき．これは微分$\varphi_*:TX\to TY$が消えることに当たる．}，$p\in M$を\textbf{臨界点}という．\footnote{$\rank_p(\varphi)<\rank(\varphi)=\min(n,m)$を臨界点と呼ぶ流儀もある．}そうでない場合，\textbf{正則点}という．この定義では，$p\in M$が正則点であることと，$F$が$p$における沈め込みであることが同値になる．
        \item $q\in M'$が\textbf{臨界値}であるとは，$\exists_{p\in f^{-1}(q)}\;p:\mathrm{critical}$であることといい，そうでない点の全てを\textbf{正則値}という．正則値とは$p\in M$が正則である場合と，$p\in M$となるfiberが存在しない場合とを含む：$\forall_{p\in F^{-1}(q)}\;p:\mathrm{regular}$．
    \end{enumerate}
\end{definition}

\begin{lemma}[可微分多様体上の集合が測度0という概念のwell-definedness]
    $\varphi:\R^n\to\R^n$を$C^1$級写像とし，$A\subset\R^n$を零集合とする．このとき，$\varphi(A)$も零集合である．
\end{lemma}

\begin{lemma}
    $\varphi:M\to M'$を，$n$次元から$m$次元への可微分写像とする．
    \begin{enumerate}
        \item $n<m$ならば，$\varphi(M)$は$M'$の測度$0$の部分集合となる．
        \item $n=m$のとき，$A$を$M$の測度$0$の部分集合とすれば，$\varphi(A)$も測度$0$である．
    \end{enumerate}
\end{lemma}
\begin{remark}
    これより，$n<m$のときは必ず$\rank_p(\varphi)\le n<m$だから，$M$の全てが臨界点となるが，$\varphi(M)$は測度$0$なので，
    一般の可微分写像$\varphi:M\to M'$についてもSardの定理は成り立つ．
\end{remark}

\begin{theorem}[Sard]
    $\varphi:M\to M'$を$n$次元多様体の間の可微分写像とする．
    $M$は可算基を持つならば，$\varphi$の臨界値の集合$K$は$M'$の測度$0$の集合である．
\end{theorem}

\subsection{接写像とその性質}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    微分論を構築したので，これを用いてDiffのmonoとepiを定める．
    台写像$\varphi:M\to M'$の全射と単射との消息からはほど遠く，微分の言葉で定める．
    
    全ての値が正則値である射がsubmersionで，これがDiffのepiである．（本当に左簡約可能かは未確認）．
    monoについては議論があり，submanifold inclusion $X\mono Y$は，Top同様，通常埋め込みとされる．本当に右簡約可能かは未確認だが，Topでは連続単射は必ずしも（連続な）引き戻しが存在しないが，埋め込みの場合は存在する．
    \footnote{\url{https://ncatlab.org/nlab/show/submanifold}}
\end{tcolorbox}

\begin{definition}[immersion, imbedding, submersion]
    $\varphi:M\to M'$を可微分写像，$n=\dim M,m=\dim M'$とする．
    \begin{enumerate}
        \item 任意の点$p\in M$において$\rank(\varphi_*)_p=n$であるとき，$\varphi$を\textbf{挿入}または\textbf{嵌め込み}という．
        \item 挿入であるに留まらず，$\varphi:M\to M'$自身が単射でもあるとき，これを\textbf{正則でない埋め込み}という．
        \item 挿入であり，$\varphi:M\to M'$自身が単射であるに留まらず埋め込みでもあるとき，これを\textbf{正則な埋め込み}という．
        \item 任意の点$p\in M$において$\rank(\varphi_*)_p=m$であるとき，$\varphi$を\textbf{沈め込み}という．
        \item $\varphi$が嵌め込みかつ沈め込みであるとき，局所微分同相であるという．
    \end{enumerate}
\end{definition}
\begin{remark}\mbox{}
    \begin{enumerate}
        \item $\rank(\varphi_*)_p=n$は$n\le m$も含意する\ref{thm-implicit-function-thm}．すなわち最大ランクであることを含意する．実際，最大ランクのあり方は挿入か沈め込みかのいずれかである．
        \item 可微分写像$\varphi:M\mono M'$が単射であるとき，これは特にTopの意味で埋め込みである．
        \item $\rank(\varphi_*)_p=m$は全射であることを意味するから，$p\in M$が正則点であることの定義と同値．
    \end{enumerate}
\end{remark}
\begin{remarks}\mbox{}\label{remarks-immersion-submersion}
    \begin{enumerate}
        \item immersionはshear mapに似た定義もできる．$f:X\to Y$が定める次の接写像について，pullbackの普遍性が定める標準写像$TX\to X\underset{Y}{\times}TY=:f^*TY$が単射であること．
        \[\xymatrix{
            TX\ar@{->>}[d]_-{\pr_1}\ar[r]^-{df}&TY\ar@{->>}[d]^-{\pr_1}\\
            X\ar[r]^-f&Y
        }\]
        \[\xymatrix@R-2pc{
            TX\ar[r]&X\underset{Y}{\times}TY=:f^*TY\\
            \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
            (p,v)\ar@{|->}[r]&(p,f(p),df(v))
        }\]
        \item submersionはこの双対で定義できる．submersionをさらに近傍座標の言葉で表現すると，各点$p\in X$に対して，座標近傍が存在してその上での$f$は射影$p_m$となることと同値：\footnote{nLabではnormal formだという見出しがついていて面白い．\url{https://ncatlab.org/nlab/show/submersion}}
        \[\xymatrix{
            X\ar[r]^-f&Y\\
            U_p\ar@{-->}[r]\ar[d]_-{\sim} \;\ar@{^{(}->}[u]&V_{f(p)} \;\ar@{^{(}->}[u]\ar[d]^-{\sim}\\
            \R^n\osup\wt{U}_p\ar@{.>}[r]^-{\wt{f}=p_m}&\wt{V}_{f(p)}\osub\R^m
        }\]
        \item immersion $f:X\to Y$は局所的には埋め込みである．すなわち，任意の点$x\in X$について，開近傍$U$が存在して，この上では埋め込み$f|_U:U\mono Y$を定める．
        \item 逆関数定理より，局所微分同相は開写像である．
    \end{enumerate}
\end{remarks}

\begin{lemma}[局所微分同相の特徴付け]
    多様体の射$F:N\to M$について，次の４条件は同値．
    \begin{enumerate}
        \item $F$は局所微分同相である（嵌め込みかつ沈め込みである）．
        \item 各$p\in M$について，接写像$df_p$は接空間の同型である．
        \item 接束の射$(f,df)$はpullback diagramである．\footnote{すなわち，\ref{remarks-immersion-submersion}のshear mapのようなやつがDiffの同型．\url{https://ncatlab.org/nlab/show/local+diffeomorphism}}
        \item 各$p\in M$について，$f(U)\osub N$，かつ，制限が可逆射を定める$f|_U:U\iso f(U)$開近傍$p\in U$が存在する．
    \end{enumerate}
\end{lemma}

\begin{example}\mbox{}
    \begin{enumerate}
        \item 開集合$U\subset M$について，包含写像$i:U\mono M$は，接写像$i_*$が全単射（恒等写像）なので，嵌め込みかつ沈め込みである．
        また位相空間の埋め込みでもあるから，埋め込みである．
        \item $f:(a,b)\to\R^2$を，横断的な自己交叉のある閉曲線とすると\footnote{横断的でない自己交叉がある場合はimmersionでさえないだろうね．}，これは嵌め込みであるが埋め込みではない．
        \textbf{嵌め込みは完全に接空間の消息である}から，自己交叉点で速度ベクトルが違うと，嵌め込みにはなる．
        しかし，$f$は連続写像としてはそもそも単射でさえない．例えば$f=(\sin2-,\sin-)$
        \item 部分集合$S\subset M$への可微分同相写像$f:N\to M$でも，$M$部分空間としての$S$と同相とは限らない．
        正則でない部分多様体はリー群の理論の中に登場するもので、部分リー群は自然な正則でない部分多様体である。\footnote{\url{https://ja.wikipedia.org/wiki/部分多様体}}
    \end{enumerate}
\end{example}

\section{部分多様体と多様体上の関数}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    Setの射としての包含写像$i:M\mono N$がTopで見て埋め込みでもあるとき，これを部分多様体という．すなわち，最低限の要件としては$M\subset N$には部分空間としての位相が入ることだが，それより強い位相を持った多様体であっても全く問題ない．\footnote{あくまでDiffの対象として見ている．位相が違えば別の多様体．}
    特に$M$の位相が$N$の部分空間としての位相（終位相）と一致しているとき，これを\textbf{正則}部分多様体という．

    多様体の間の写像を考えると１点の逆像が多様体になることが多いことがわかる．これはSardの定理の結果である．
    特に，Euclid空間上で方程式系により定義される部分集合は，多様体となることが多い．
    このような多様体から多様体への写像を使って，多様体の形を明らかにしていくことができる．最もよく知られているのが，Morse理論である．

    $C^\infty$級集合の等位集合は正則部分多様体である．逆関数定理からの直接の証明からは，部分多様体上の具体的な座標関数の算譜が抽出できる．
\end{tcolorbox}

\subsection{部分多様体}

\begin{definition}[submanifold, regular submanifold, closed submanifold]\mbox{}
    \begin{enumerate}
        \item 部分集合$M\subset M'$について，包含写像$i:M\mono M'$が正則でない埋め込み（単射な嵌め込み）であるとき，$M$を$M'$の\textbf{部分多様体}であるという．\footnote{これはLie群論に自然に出てくる対象．部分Lie群は自然な正則でない部分多様体の例となる．}
        \item 特に包含写像$i:M\mono M'$が正則な埋め込み（位相の意味でも埋め込み）となっているとき，$M$を\textbf{正則部分多様体}という．\footnote{これは，$i(M)$の位相が$M'$の相対位相と一致することを強要する．}
        \item $M\subset M'$が正則部分多様体かつ$M'$の閉集合であるとき，\textbf{閉部分多様体}であるという．
    \end{enumerate}
\end{definition}

\subsection{開部分多様体}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
    title=多様体という概念の微妙な均衡]
    いつも通り，連続単射$i:O\mono M$について構成がある．が，
    Diffの描像：等化子や余等化子は全く保たないから，多様体はもっと労わらなきゃいけない．
    Hausdorffも，局所Euclid性も，普遍構成とは相性が悪い．すると多様体の射のwell-defined性が全く成り立たなくなる．
\end{tcolorbox}

\begin{lemma}[open submanifold]
    $M$を$m$次元$C^r$級多様体とする．開部分空間$O\subset M$について，$M$の各チャートを$O$に制限することにより，$O$も$m$次元$C^r$級多様体となる．\footnote{微分構造を同一にする標準的な部分多様体か．}
\end{lemma}

\begin{lemma}[0次元多様体の特徴づけ]
    位相空間$M$について，次の２条件は同値．
    \begin{enumerate}
        \item $M$は$0$次元位相多様体である．
        \item $M$は離散空間である．
    \end{enumerate}
\end{lemma}
\begin{proof}\mbox{}
    \begin{description}
        \item[(1)$\Rightarrow$(2)] 各点$p\in M$について，$\R^0$の開集合と同相に取れるというが，$\R^0$の開集合は$\emptyset$と$\R^0$のみである．すなわち，$\{p\}$が開．
        \item[(2)$\Rightarrow$(1)] $(\{p\},i:\{p\}\to\R^0)$をチャートとすれば良い．
    \end{description}
\end{proof}
\begin{remark}[自明な$C^\infty$級多様体]
    $0$次元多様体は方向が取れないので，仮定が空ということで$C^\infty$級とする．
    また，空集合は任意次元の$C^\infty$級多様体とする．正則値の逆像$f^{-1}(q)$としても出現し，コボルティズム群の零元となる．
\end{remark}

\subsection{正則部分多様体}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    節\ref{subsection-regular-submanifold}の続きを，等位集合の言葉で更なる例を重ねる．
    
    部分多様体$N\mono M$は通常埋め込み（横長の行列が最大ランク，かつ，部分空間への同型）として定義されるが，
    単に前者のみ（この場合，位相は崩れているので嵌め込みという）のことも指し得る．写される過程での自己交叉も許す．
\end{tcolorbox}

\begin{definition}[regular submanifold]\label{def-regular-submanifold}
    $M\subset N$が$m$次元\textbf{（正則）部分多様体}であるとは，任意の$p\in M$について，ある\textcolor{red}{$N$の}座標近傍$(U_p,\varphi_p=(x^1,\cdots,x^m))$について，
    \[M\cap U=\varphi_p^{-1}(\R^m\times\{0\})=\{x\in U\mid x_{m+1}=\cdots=x_n=0\}\]
    となることをいう．\footnote{一般のaffine空間で良い．}$n-m\ge 0$を$M$の\textbf{余次元}という．
\end{definition}
\begin{notation}[adapted chart]
    このような$N$のチャート$(U_p,\varphi_p,V_p)$を\textbf{$M$に適合するチャート}といい，$\varphi$の最初の$m$成分の$U_p\cap M$への制限を$\varphi_M:=(x^1,\cdots,x^m):U\cap S\to\R^m$と表す．
\end{notation}

\begin{example}[topologist's sine curve]
    $\Gamma$を$f(x)=\sin(1/x):(0,1)\to[-1,1]$のグラフとし，$I:=\{0\}\times[-1,1]$とし，$M:=\Gamma\cup I$とする．
    $I$上の任意の点$p$において，適合するチャートが存在しない．
    $T=\o{\Gamma}$を\textbf{位相幾何学者の正弦曲線}という．
    \begin{itemize}
        \item 連結だが，局所連結でも弧状連結でもない．
    \end{itemize}
\end{example}

\begin{lemma}
    線型空間の標準的な埋め込みを$\iota:\R^m\to\R^m\times\R^{n-m}=\R^n$とする．
    \begin{enumerate}
        \item $\wh{V}_p:=\iota^{-1}(V_p),\wh{\varphi}_p:=\varphi_p|_{M\cap U_p}:M\cap U_p\to\wh{V}_p$．$(M,\{(M\cap U_p,\wh{\varphi}_p,\wh{V}_p)\}_{p\in M})$は$m$-次元$C^\infty$多様体である．正則部分多様体は，それ自身が多様体である．
        \item 包含写像$i:M\to N$は$C^\infty$級であり，次の普遍性を満たす：
        \begin{quote}
            任意の$C^\infty$級多様体$L$とそこからの写像$f:L\to M$について，$f:L\to M$が$C^\infty$級であることと$i\circ f:L\to N$が$C^\infty$級であることとが同値である．
        \end{quote}
    \end{enumerate}
\end{lemma}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item \begin{enumerate}[a]
            \item $N$がHausdorffであることより，$M$もHausdorffである．第２可算性も同様．
            \item チャートについては，各$p\in M$について，$\wh{\varphi}_p:M\cap U_p\iso\wh{V}_p$は引き続き同型である．
            \item $C^\infty$級で両立する．任意の$p,p'\in M$について，次の図は可換であるため，$\wh{\varphi}_{p'}\circ\wh{\varphi}_p^{-1}$も$C^\infty$級である：
            \[\xymatrix{
                &M\cap U_{p'}\cap U_p\ar[dl]_-{\wh{\varphi}_p}\ar[dr]^-{\wh{\varphi}_{p'}}\\
                \iota^{-1}(\varphi_p(U_p\cap U_{p'}))\ar[rr]\ar[d]_-\iota&&\iota^{-1}(\varphi_{p'}(U_p\cap U_{p'}))\ar[d]^-\iota\\
                \varphi_{p}(U_p\cap U_{p'})\ar[rr]_-{\varphi_{p'}\circ\varphi_p^{-1}}&&\varphi_{p'}(U_p\cap U_{p'})
            }\]
        \end{enumerate}
        \item 任意の$p\in M$について次の図式が可換であることより，$\iota$が$C^\infty$級だから，$i$も$C^\infty$級である：
        \[\xymatrix{
            (L)\ar@{.>}[r]^-{f}&M\cap U_p\;\ar@{^{(}->}[r]^-i\ar[d]_-{\wh{\varphi}_p}&U_p\ar[d]^-{\varphi_p}\\
            &\wh{V}_p\ar[r]_-{\iota}&V_p
        }\]
        \begin{description}
            \item[$\Rightarrow$] $i$が$C^\infty$級であるとき，合成も$C^\infty$級である．
            \item[$\Leftarrow$] $i\circ f$が$C^\infty$級であるとき，任意の$p\in M$について$\iota\circ\wh{\varphi}_p\circ f=\varphi_p\circ(i\circ f):L\to V_p$が$C^\infty$級関数で，$\wh{\varphi}_p\circ f$も$C^\infty$級だから，$f$が$C^\infty$級写像であることが従う．
        \end{description}
    \end{enumerate}
\end{proof}
\begin{remarks}
    あの拡張された陰関数定理\ref{thm-generalized-implicit-function-theorem}が強力な基礎を築いているのがわかる．そっか，こんな理論の作り方をするのか．感慨深い．
\end{remarks}

\subsection{正則部分多様体の例}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    球面に同相なLie群は$S^0,S^1,S^3$のみである．
\end{tcolorbox}

\begin{example}[finite dimentional linear space]
    $m$次元実線型空間は，同型$\varphi:V\to\R^m$が引き起こす始位相を$V$に入れると，Hausdorffで，$C^\infty$級多様体である．
\end{example}

\begin{definition}[Lie group]
    $C^\infty$級多様体上の群構造$(G,\mu,e,\iota)$であって，$\mu:G\times G\to G,\iota:G\to G$が$C^\infty$級写像であるものをLie群という．
\end{definition}

\begin{example}\mbox{}
    \begin{enumerate}
        \item $\R^n$は加法の下でLie群である．
        \item $\C^\times$は乗法の下でLie群である．
        \item $S^1\subset\C^\times$は乗法の下でLie群である．
        \item $\GL_n(\R)$は行列積の下でLie群である．
    \end{enumerate}
\end{example}

\begin{example}[球面と微分同相なLie群]\mbox{}
    \begin{enumerate}
        \item $\Z/2\Z\simeq S^0$はLie群である．
        \item $SO(2)=\Brace{\begin{pmatrix}x&-y\\y&x\end{pmatrix}\;\middle|\;x^2+y^2=1}\simeq S^1\subset\R^2$．
        \item $SU(2)=\Brace{\begin{pmatrix}z&-\o{w}\\w&\o{z}\end{pmatrix}\;\middle|\;\abs{z}^2+\abs{w}^2=1}\simeq S^3\subset\C^2$．
    \end{enumerate}
\end{example}

\section{正則等位集合定理}

\subsection{正則等位集合定理}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=zero locus / vanishing locus]
    等位集合といっても，$f:=g-c$とすれば良いから正則零点集合のみ考えれば良い．
    これが原初の霊性の大成である．
    多様体の間の写像と，微分が消えるかどうかの問題であったのだ．
    「方程式が３個あると変数は３個消せるが，「ダブっているとき」は消せない」という現象を幾何学的に解釈したものである．

    そして，全ての正則等位集合定理の証明の原型がこれである．
    アイデアは，座標近傍$(U,x^1,\cdots,x^m)$において偏微分$\pp{f}{x^i}(p)$が$0$でないならば，座標$x^i$を$f$で置き換えてしまうというものである．
    陰関数定理で死ぬほど出会った証明である．
\end{tcolorbox}

\begin{definition}[level set]
    写像$F:N\to M$に対して，$F^{-1}(c)$という形の集合のことを\textbf{等位集合}という．\footnote{２次元の場合はisoline，等高線と呼ばれ，３次元は等位面，高次元の場合は等位超平面などともいう．zero-growth isoclineのことをnull-clineという．}
    値$c$を$F^{-1}(c)$の位という．
    正則値の等位集合を\textbf{正則等位集合}という．特に$c=0$のとき，正則零点集合という．
\end{definition}

\begin{theorem}
    $g:N\to\R$を$C^\infty$級関数とする．
    このとき，空でない正則等位集合$S:=g^{-1}(c)$は$N$の正則部分多様体で，余次元は$1$である．
\end{theorem}
\begin{proof}\mbox{}
    \begin{description}
        \item[方針] $f:=g-c$とおくと，$S:=f^{-1}(0)$．$p$は正則点なので，$p$の任意のチャート$(U_p,x^1_p,\cdots,x^m_p)$について，$\exists_{i\in[m]}\;\pp{f}{x^i}(p)\ne 0$．便宜上$i=1$としても一般性を失わない．
        \item[構成] $C^\infty$級写像$(f,x^2,\cdots,x^n):U\to\R^n$のJacobi行列式は$0$でないから，逆関数定理により，$p$のチャート$(U_p,f,x^2,\cdots,x^n,V_p)$が取れる．関数$(f,x^2,\cdots,x^n)$は$U_p\cap S$上第一成分を$0$とすることが決まっているので，これは$S$に適合するチャートである：$U_p\cap S=(f,x^2,\cdots,x^m)^{-1}(0\times\R^{n-1})$．よって，$p$は任意であったので，次元は$n-1$．
    \end{description}
\end{proof}
\begin{remarks}
    「変数が３つと方程式が３本」という高校の頃の直感は，実数の空間$\R$が１次元だからか．
\end{remarks}

\begin{theorem}[implicit function theorem / preimage theorem / regular level set theorem]\label{thm-the-implicit-function-theorem}
    $F:N\to M$を$C^\infty$級写像とする．任意の$c\in M$について，$F^{-1}(c)$は$N$の正則部分多様体で，次元は$n-m$である．
\end{theorem}
\begin{proof}\mbox{}
    \begin{description}
        \item[方針] かけなきゃダメ．
    \end{description}
\end{proof}

\begin{lemma}[算譜抽出]
    $F:N\to\R^m$を$C^\infty$級写像とし，$S:=F^{-1}(0)$とする．
    $p\in S$のチャート$(U,x^1,\cdots,x^m)$が，ある$j_1,\cdots,j_m$に対して$\det(\pp{F^k}{j_l}(p))_{1\le k\le m}$が$0$でないならば，$p$のある近傍において，座標写像$x^{j_1},\cdots,x^{j_m}$の代わりに$F^1,\cdots,F^m$を取ることで$S$に適合する$N$のチャートが得られる．
\end{lemma}
\begin{remarks}
    「適合する」というのが，affine空間の概念にあたり，この「座標変換」が陰関数定理と説明された．
\end{remarks}
\begin{remark}
    $f(x,y)=y^2$の零点集合$Z(f)=\{(x,y)\in\R^2\mid y=0\}$は，$\pp{f}{x}=f,\pp{f}{y}=2y$より，任意の点が臨界点．
\end{remark}

\subsection{正則部分多様体の例}

\subsection{横断性定理}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    種々の性質を持つ多様体を，横断的な交わりの共通部分として構成する方法はThomやPontryaginにより用いられた．
\end{tcolorbox}

\begin{definition}[transversality]
    多様体の射$f:X\to Z,g:Y\to Z$が\textbf{横断的に交わる}とは，
    任意の$f(x)=g(y)=z$を満たす点$z\in Z$について，写像の微分の像同士の和が$T_xZ$を生成することをいう：
    $\Im(df)+\Im(dg)\simeq T_zZ$．\footnote{線型空間$T_zZ\simeq\R^n$上で定義された和であって，直和である必要はない．むしろこの時のために用意された場である．}
\end{definition}

\begin{theorem}[transversality theorem]
    $C^\infty$級写像$f:N\to M$が$M$における余次元$k$の正則部分多様体$S$に対して横断的ならば，$f^{-1}(S)$は$N$における余次元$k$の正則部分多様体である．
\end{theorem}

\begin{theorem}[Pontryagin's construction]
    $X$の正則部分多様体$Y,Z$が横断的に交わる時，$Y\cap Z$も$X$の$\dim Y+\dim Z-\dim X$次元正則部分多様体である．
\end{theorem}

\section{ベクトル場}

\subsection{ベクトル場の定義と演算}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    ベクトル場の考え方とは「各点の線型代数を写像としてまとめあげる」ことである．
    そして写像全体の集合のなす代数的構造を考える．すると結合多元環$C^\infty(M)$とそれが作用する$C^\infty(M)$-加群$\X(M)$が現れる．
\end{tcolorbox}

\begin{definition}[vector field]\mbox{}
    \begin{enumerate}
        \item 接束$\pr_1:TM\to M$の切断をベクトル場という．
        \item 局所座標系$(U,x^1,\cdots,x^n)$について，$U$上の関数$\xi^i$が存在して，$X_p:\sum_{i=1}^n\xi^i(p)\paren{\pp{}{x^i}}_p$と表せる．これを\textbf{成分}という．
        \item ベクトルの変換則\ref{prop-transformation-of-tangent-vector}はベクトル場の変換則に持ち越される．ゆえに，ベクトル場の$C^r$級という性質は局所座標系に依らない．
        \item $M$上の$C^\infty$級のベクトル場の集合を$\X(M)$と表す．
    \end{enumerate}
\end{definition}

\begin{definition}[ベクトル場の演算]\mbox{}
    \begin{enumerate}
        \item 環$C^\infty(M)$による左作用「各点スカラー倍」を受けて，環上の加群の構造を持つ：
        \[\xymatrix@R-2pc{
            C^\infty(M)\times\X(M)\ar[r]&\X(M)\\
            \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
            (f,X)\ar@{|->}[r]&fX
        }\]
        \item ベクトル場の多元環は環$C^\infty(M)$に「各点微分作用」で左から作用し，Leibniz則を満たす線型写像として表現される：
        \[\xymatrix@R-2pc{
            \X(M)\times C^\infty(M)\ar[r]&C^\infty(M)\\
            \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
            (X,f)\ar@{|->}[r]&Xf
        }\]
    \end{enumerate}
\end{definition}

\subsection{単位的結合多元環}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=代数学と幾何学]
    空間上の関数は環$R$をなす．$R$-加群とは，その空間の接束の切断の空間と考えられる．
    これを代数-幾何双対性という．\footnote{\url{https://ncatlab.org/nlab/show/module}}
    こうして一般の微分作用素は環$R$について定義される．
\end{tcolorbox}

\begin{definition}[associative (unital) algebra]
    可換環$R$に対して，$R$-加群$V$に付加的な構造を考える．
    \begin{enumerate}
        \item 線型写像$p:V\otimes V\to V$を備えた構造を\textbf{分配多元環}という：$\lambda(ab)=(\lambda a)b=a(\lambda b), (a+b)c=ac+bc, a(b+c)=ab+ac$．
        \item $p$が結合的でもある時，\textbf{結合多元環}という．
        \item 乗法単位元$i:R\to V$の構造も備える時，\textbf{単位的結合多元環}という．混同の危険がない場合，\textbf{結合代数}または\textbf{代数}と呼ぶ．
        ここまでで，$(R,+,0,p,i)$は環の構造を成していることに注意．\footnote{単位的かは不問で，結合代数のことを，線型環ともいう．これは環からの作用を受けているのを「線型」と表現しているのであろう．多元環はalgebraの訳語であるが，環でもあることに注目した良い訳である．}
    \end{enumerate}
\end{definition}

\begin{definition}[derivation]
    $R$-分配多元環$V$の間の線型写像$D:V\to V$が，$D(ab)=(Da)b+a(Db)$を満たす時，これを分配多元環$V$の\textbf{微分作用素}と言う．
    微分作用素の全体$\Der(V)\subsetneq\End_\R(V)$はモノイドをなさない，合成について閉じていないためである．
\end{definition}

\begin{example}\mbox{}
    \begin{enumerate}
        \item $C^\infty(M)$は$\R$上の単位的結合多元環である．
        \item $\X(M)$は$C^\infty(M)$-加群である．
        \item $X$の左作用が定める線型写像$D_X:C^\infty(M)\to C^\infty(M)$は多元環$C^\infty$の微分作用素である．\footnote{加群というものは本質的に作用という概念と共役的である．}
    \end{enumerate}
\end{example}

\subsection{微分作用素}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=derivations of smooth functions are vector fields ]
    滑らかな関数上の微分作用素がベクトル場である．ベクトル場がこんな抽象的な存在になった……．
\end{tcolorbox}

\begin{lemma}
    $M$上のベクトル場$X,Y$について，$D_X=D_Y$ならば$X=Y$である．すなわち，表現$D_-:\X(M)\to\Aut(C^\infty(M))$は単射．
\end{lemma}

\begin{theorem}\label{thm-vector-field-and-derivation}
    $D$を多元環$C^\infty(M)$の微分作用素とする．$D=D_X$を満たす$M$上のベクトル場$X\in\X(M)$はただ一つ存在する．
\end{theorem}

\subsection{括弧積}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=滑らかなベクトル場の全体はLie環をなす]
    $\X(M)\simeq\Der(C^\infty(M))\subsetneq\End_\R(C^\infty(M))$は合成については閉じていないので，より自然な積構造を考える必要がある．
    これをLie環のIso集合とみる．これはなんと交換子積を導入する．Leibniz則は，歪対称性の下ではJacobi恒等式に同値である点に注目するのである．
    これで正しい研究対象が定まった．
\end{tcolorbox}

\begin{definition}[commutator product]
    分配多元環$V$の微分作用素$D_1,D_2\in\Der(V)$について，\textbf{交換子積}を$[D_1,D_2]:=D_1\circ D_2-D_2\circ D_1$と定めると，これは$\Der(V)$で閉じている．
    対応するベクトル場の交換子積も，$[D_X,D_Y]=D_{[X,Y]}$で定める（定理\ref{thm-vector-field-and-derivation}）．
\end{definition}
\begin{proof}
    線型写像になることはわかるから，Leibniz則を確かめる．
    \begin{align*}
        [D_1,D_2](ab)&=D_1(D_2(ab))-D_2(D_1(ab))\\
        &=D_1((D_2a)b+a(D_2b))-D_2((D_1a)b+a(D_1b))\\
        &=(D_1D_2a)b+a(D_1D_2b)-(D_2D_1a)b-a(D_2D_1b)=([D_1,D_2]a)b+a([D_1,D_2]b).
    \end{align*}
\end{proof}

\begin{lemma}[括弧積の性質]\mbox{}
    \begin{enumerate}
        \item (歪対称性) $[D_1,D_2]=-[D_2,D_1]$．
        \item (Jaboci恒等式) $[D_1,[D_2,D_3]]+[D_2,[D_3,D_1]]+[D_3,[D_1,D_2]]=0$．
        \item $[fX,gY]=fg[X,Y]+f(Xg)Y-g(Yf)X$．
    \end{enumerate}
\end{lemma}
\begin{proof}
    Jacobi恒等式は，歪対称性と併せると，
    \begin{align*}
        [D_1,[D_2,D_3]]+[D_2,[D_3,D_1]]+[D_3,[D_1,D_2]]=0\\
        [D_1,[D_2,D_3]]-[D_2,[D_1,D_3]]-[[D_1,D_2],D_3]=0\\
        [D_1,[D_2,D_3]]=[[D_1,D_2],D_3]+[D_2,[D_1,D_3]]
    \end{align*}
    と変形できるから，このLeibniz則$[a,[b,c]]=[[a,b],c]+[b,[a,c]]$を示せばよい．
\end{proof}

\begin{definition}[Lie algebra]\mbox{}
    \begin{enumerate}
        \item $K$上の線型空間$\g$であって，Jacobi恒等式を満たす歪対称な双線型写像$[-,-]:\g\land\g\to\g$を備えたものを\textbf{Lie環}と呼ぶ．
        \item 線型写像$\phi:\g\to\h$が$\phi[X,Y]=[\phi(X),\phi(Y)]$を満たす時，Lie環の準同型であるという．
        \item 括弧積について閉じている部分空間を，\textbf{Lie部分環}と言う．
    \end{enumerate}
\end{definition}
\begin{example}\mbox{}
    \begin{enumerate}
        \item 多元環の積を用いて$[a,b]:=ab-ba$と定めると，この新しい乗法についてLie環になる．
        \item こうして$\End_\R(V)$に括弧積を定めるとLie環となる．$\Der(V)$はこのLie部分環である．
        \item 可換環$R$上の分配多元環$V$の微分作用素の全体$\Der(V)$は$R$-加群となるが，これに括弧積を考えるとLie環となる．
    \end{enumerate}
\end{example}

\begin{theorem}\mbox{}
    \begin{enumerate}
        \item $\X(M)$は交換子積についてLie環をなす．
        \item $\X(M)\simeq_\LieAlg\Der(C^\infty(M))$．
    \end{enumerate}
\end{theorem}

\subsection{微分同相写像の作用}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    次に連鎖律を考える．可微分写像$\varphi:M\to M'$は，多元環の準同型$\varphi^*:C^\infty(M')\to C^\infty(M)$を事前合成で定めるから，これを用いてベクトル場の押し出し$\varphi_*X=X'$を考える．これは各点ごとの押し出し$(\varphi_*)_pX_p=X'_{\varphi(p)}$で定める．
    するとこれは括弧積の構造を保つ．
    自己同型$\varphi:M\iso M$は，多元環の同型$\varphi^*:C^\infty(M)\iso C^\infty(M)$とLie環の同型$\varphi_*:\X(M)\iso\X(M)$とを定める．
    $M$がパラコンパクトならば，$C^\infty(M)$の自己同型はこの形に限ることが知られているが，Lie環$\X(M)$の自己同型については未解決．
\end{tcolorbox}

\begin{definition}\mbox{}
    \begin{enumerate}
        \item 可微分写像$\varphi:M\to M'$は，多元環の準同型$\varphi^*:C^\infty(M')\to C^\infty(M)$を事前合成で定め，次の図式を可換にするとき，$D$と$D'$には$\varphi$-関係があると言う：\[\xymatrix{
            C^\infty(M)\ar[d]^-{D}&C^\infty(M')\ar[l]_-{\varphi^*}\ar[d]^-{D'}\\
            C^\infty(M)&C^\infty(M')\ar[l]_-{\varphi^*}
        }\]
        $\varphi^*D'=D\varphi^*$とは，$M$上に引き戻して$D$で微分するのと，$D'$で微分してから$M$上に引き戻すのでは同じスカラー場を得ることをいう．
        \item $D_1\sim_\varphi D_1',D_2\sim_\varphi D_2'$のとき，$[D_1,D_2]\sim_\varphi [D_1',D_2']$が成り立つ．
        \begin{align*}
            [D_1,D_2]\circ\varphi^*&=D_1\circ D_2\circ\varphi^*-D_2\circ D_1\circ\varphi^*=\varphi^*\circ D_1'\circ D_2-\varphi^*\circ D_2'\circ D_1'=\varphi^*\circ[D_1,D_2]
        \end{align*}
        \item $X\sim_\varphi X'$と$D_X\sim_\varphi D_{X'}$とは同値である．$X\sim_\varphi X'\Lrarrow(\varphi_*)_pX_p=X'_{\varphi(p)}$より\footnote{$X_p$の押し出しで微分するのと，$X'_{\varphi(p)}$で微分するのが同値．}，$D$と$\varphi$-関係にある$D'$は一意的であることがわかる：$\varphi_*:\Der(V)\to\Der(V)$．$X'$を$X$の$\varphi$-射影と呼ぶ．
        \item すると，$\varphi_*$は積を保つ$\varphi_*(X_1X_2)=(\varphi_*X_1)(\varphi_*X_2)$ことより，括弧積も保つ：$\varphi_*[X_1,X_2]=[\varphi_*X_1,\varphi_*X_2]$．
    \end{enumerate}
\end{definition}

\subsection{1-パラメータ変換群}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    積分曲線(flow line)とそれに沿って流れる落ち葉の変換群．
\end{tcolorbox}

\begin{definition}[integral curve / flow line]
    $C^\infty$級曲線$\varphi:(a,b)\to M$がベクトル場$X\in\X(M)$の積分曲線であるとは，$\forall_{t\in(a,b)}\;\varphi'(t)=X_{\varphi(t)}$が成り立つことをいう．
    すなわち，局所座標系$(x^i)$を取り，$\varphi^i:=x^i\circ\varphi$と置きベクトル場$X$の成分を$\xi^i$とすると，$\varphi^i$は微分方程式$\dd{u^i}{t}=\xi^i(u^1,\cdots,u^n)$の解である．
\end{definition}
\begin{lemma}[局所的存在と一意性]\mbox{}
    \begin{enumerate}
        \item 積分曲線は局所的に存在し，初期値について$C^\infty$級である：$\forall_{p\in M}\;\exists_{O\osub M}\;\exists_{\epsilon>0}\;\exists_{\varphi:(-\epsilon,\epsilon)\times\O\to M}\;\varphi_p(0)=p,\varphi'_p(t)=X_{\varphi_p(t)}$．
        \item 積分曲線は存在すれば一意的である．
    \end{enumerate}
\end{lemma}

\begin{definition}[flow / 1 parameter group of transformation, flow domain, flow]\mbox{}
    \begin{enumerate}
        \item 写像$\varphi:\R\to\End_\Diff(M)$が次の２条件を満たすとき，\textbf{1-パラメータ変換群}または\textbf{大域フロー}であるという：
        \begin{enumerate}[(a)]
            \item $\varphi_s\circ\varphi_t=\varphi_{s+t}$．\footnote{したがって，$\varphi_0=\id_M$．}
            \item $\R\times M\to M$は$C^\infty$級．
        \end{enumerate}
        \item $O\osub \R\times M$であって，任意の$x\in M$について$(0,x)\in\R\times\{x\}\cap O$を満たすものを\textbf{フロー領域}という．
        \item 各変換$\varphi(p):\R\times\{x\}\cap O\to M$を\textbf{フロー}という．これも可微分で，積分曲線になる．
        \item 1-パラメータ変換群$\varphi$が定めるベクトル場を$X_pf:=\paren{\dd{f(\varphi_t(p))}{t}}_{t=0}$と定める．ベクトル場$X$を1-パラメータ変換群$\varphi$の\textbf{無限小変換}という．
        \item ベクトル場$X$を定める無限小変換$\varphi$が存在するとき，ベクトル場は\textbf{完備}であるという．積分曲線の一意性より，この完備ベクトル場と大域フローの関係は１対１で，$\varphi_t=\Exp tX$と表す．
    \end{enumerate}
\end{definition}
\begin{example}\mbox{}
    \begin{enumerate}
        \item $X=0$は，任意の点$p\in M$について，$c=p$が積分曲線となるから完備である．
        \item $\R$上のベクトル場$X=\pp{}{x}$は，任意の点$p\in M$について，$c(t)=p+t$と定めればよい．
    \end{enumerate}
\end{example}

\begin{example}[無限小線型変換]
    $\R^n$上のベクトル場を
    \[X=\sum_{i,j=1}^na^i_jx^j\pp{}{x^i}=\paren{\pp{}{x^1}\;\cdots\;\pp{}{x^n}}\begin{pmatrix}a^1_1&\cdots&a^1_n\\\vdots&\ddots&\vdots\\a^n_1&\cdots&a^n_n\end{pmatrix}\begin{pmatrix}x^1\\\vdots\\x^n\end{pmatrix}\]
    と定めると，これは完備ベクトル場で，$(\Exp tX)(p)=\exp tA\begin{pmatrix}x^1(p)\\\vdots\\x^n(p)\end{pmatrix}$を満たす．
\end{example}

\subsection{1-パラメータ局所群}

\section{圏と関手}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    代数トポロジーの大半は，例えばホモロジー，コホモロジー，ホモトピーといった関手の研究である．
    関手が真に便利なものであるためには，その関手が計算できる程度に十分単純である一方，元の圏の本質的な
    特徴を保っている程度に複雑であるべきである．滑らかな多様体の場合は，この微妙なバランスがde Rham cohomology関手によって得られる．
    本書の残りの部分では，接束や微分形式などさまざまな関手を導入し，de Rham cohomologyへと結実させる．
\end{tcolorbox}

\begin{definition}[交代テンソル関手]
    線型空間$V$に$V$上の$k$-covector＝交代テンソル$V^{\times k}\to\R$を対応させる対応$\alt_k:V\mapsto\alt_k(V)$は，反変関手$\alt_k:\Vect\to\Vect$を定める．$k=1$のとき，これは双対空間を対応させる関手$\vee$である．
\end{definition}

\section{滑らかな写像の階数}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    全ての嵌め込み（縦長行列）は局所的には包含写像で，全ての沈め込み（横長行列）は局所的には射影になる．
    嵌め込みかつ埋め込みは局所微分同型写像である．
\end{tcolorbox}

\subsection{階数一定定理}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    階数一定定理の退化が，逆関数定理と陰関数定理だと見ることができる．
    この本質は，階数が一定ならば（全射は特別な場合！），近傍で標準形に変換できる（微分構造からチャートが見つかる）ことである．
    これより，階数が一定の等位集合ならば，正則部分多様体となる判定法が従う．
\end{tcolorbox}

\begin{theorem}[constant rank theorem]\label{thm-constant-rank-theorem}
    $f:N\to M$が$p\in N$の近傍で$\rank f=k\ge 0$で一定とする．
    このとき，$p$のチャート$(U_p,\varphi_p)$と$f(p)$のチャート$(V_q,\psi_q)$で，$\psi\circ f\circ\varphi^{-1}=\iota_k$であるものが存在する：\footnote{$k=m$の場合が，$0$が消える場合である．}
    \[\forall_{(r^1,\cdots,r^k)\in\varphi(U)}\;(\psi\circ f\circ\varphi^{-1})(r^1,\cdots,r^n)=(r^1,\cdots,r^k,0,\cdots,0)\]
\end{theorem}
\begin{proof}
    Euclid空間での知識（節\ref{subsection-constant-rank-thm-in-Euclidean-space}の知識）より．
\end{proof}
\begin{remarks}
    これを$N\cap U_p=(\psi_q\circ f\circ\varphi_p^{-1})^{-1}(\R^k\times\{0^{m-k}\})$とも表せる．
    これは線型空間$\R^m$への埋め込みとしては標準形であり，これが「真っ直ぐにできる」ということである．
\end{remarks}

\begin{theorem}[constant rank level set theorem]\label{thm-constant-rank-level-set-theorem}
    $f:N\to M$を$C^\infty$級写像とする．
    $c\in M$の等位集合$f^{-1}(c)$が$N$の正則部分多様体で余次元が$k$であるためには，$f^{-1}(c)$のある近傍上で$f$が一定の階数$k$を持てば十分．
\end{theorem}
\begin{proof}
    任意の点$p\in f^{-1}(c)$について，階数一定定理\ref{thm-constant-rank-theorem}より，$(U_p,\varphi_p),(V_c,\psi_c)$が存在して，
    \[N\cap U_p=(\psi_c\circ f\circ\varphi_p^{-1})^{-1}(\R^k\times\{0^{m-k}\})\]
    が成り立つ．これについて，$f^{-1}(c)=(\psi_c\circ f\circ\varphi_p^{-1})^{-1}(0^m)$である．すなわち，正則部分多様体\ref{def-regular-submanifold}としては，
    座標$r^1,\cdots,r^k$が消えている集合として$f^{-1}(c)$は定まる．
    \[\varphi(f^{-1}(c))=\varphi(f^{-1}(\psi^{-1}(0)))=(\psi\circ f\circ\varphi^{-1})^{-1}(0)\]
    より，$f^{-1}(c)$は座標$x^i:=r^i\circ\varphi\;(i=1,\cdots,k)$が消えている点の集合である．すなわち，余次元$k$の正則部分多様体である．
\end{proof}
\begin{remarks}
    謎．
\end{remarks}

\subsection{嵌め込み・沈め込み定理}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    ある点で最大階数を持つということは，その近傍において一定の階数を持つことを意味し，ゆえに最大ランクであることを意味する嵌め込みや沈め込みは階数一定の写像である．
    したがって，階数一定定理は，嵌め込み定理と沈め込み定理を特別な場合として含み，嵌め込みや沈め込みの単純な標準形を与える．
    そして，正則等位集合定理\ref{thm-the-implicit-function-theorem}は沈め込み定理の帰結である．
\end{tcolorbox}

\begin{lemma}
    $C^\infty$級写像$f:N\to M$が$p\in N$における嵌め込みならば，その近傍で$\rank f=n$で一定である．埋め込みならばその近傍で$\rank f=m$で一定である．
\end{lemma}
\begin{proof}
    rankの半連続性\ref{lemma-semicontinuity-of-rank}の帰結である．
\end{proof}

\begin{corollary}[immersion, submersion theorem]\mbox{}\label{cor-submersion-and-immersion}
    \begin{enumerate}
        \item $f:N\to M$を$p\in N$における嵌め込みとする．チャート$(U_p,\varphi_p,V_p),(O_{f(p)},\psi_{f(p)},W_{f(p)})$が存在して，$\forall_{(r^1,\cdots,r^n)\in V_p}\;(\psi_{f(p)}\circ f\circ\varphi_p^{-1})(r^1,\cdots,r^m)=(r^1,\cdots,r^n,0,\cdots,0)$を満たす．
        \item $f:N\to M$を$p\in N$における沈め込みとする．チャート$(U_p,\varphi_p,V_p),(O_{f(p)},\psi_{f(p)},W_{f(p)})$が存在して，$\forall_{(r^1,\cdots,r^n)\in V_p}\;(\psi_{f(p)}\circ f\circ\varphi_p^{-1})(r^1,\cdots,r^n)=(r^1,\cdots,r^m)$を満たす．
    \end{enumerate}
\end{corollary}

\begin{corollary}
    沈め込み$f:N\to M$は開写像である．
\end{corollary}
\begin{proof}
    任意の開集合$W\subset N$について，$f(W)\subset M$が開と示す．
    任意の点$f(p)\in f(W)$を取ると，沈め込み定理より，この近傍で$f$は射影である．
    射影は開写像であるから，$p\in{}^\exists U\subset W\;f(U)\osub f(W)\subset M$．
\end{proof}
\begin{remarks}
    開写像定理はこの特別な場合だろう！！
\end{remarks}

\begin{corollary}[implicit function theorem / preimage theorem / regular level set theorem]（定理\ref{thm-the-implicit-function-theorem}）
    $F:N\to M$を$C^\infty$級写像とする．任意の$c\in M$について，$F^{-1}(c)$は$N$の正則部分多様体で，次元は$n-m$である．
\end{corollary}
\begin{proof}
    $f:N\to M$の等位集合$f^{-1}(c)$が正則点のみからなる$\Leftrightarrow\;f$は$f^{-1}(c)$上沈め込みである．
    したがって，沈め込み定理\ref{cor-submersion-and-immersion}より，$f^{-1}(c)=f^{-1}(\psi^{-1}(0))=(\psi\circ f)^{-1}(0)=Z(\psi\circ f)$．
    $x^i:=r^i\circ f^i$とすれば，チャート$(U,x^1,\cdots,x^n)$において，$f^{-1}(c)$は座標関数$x^1,\cdots,x^m$の消滅として定義できていることをいう．
    よって，$f^{-1}(c)$は正則部分多様体である．
\end{proof}
\begin{remarks}
    これが２つ目の証明である．階数一定レベル集合定理\ref{thm-constant-rank-level-set-theorem}が第３の証明を提出する．
\end{remarks}

\subsection{像}

\begin{theorem}
    $F:M\to N$が単射な嵌め込みとする．$M$がコンパクトならば$F(M)\subset N$は$N$の部分多様体である．
\end{theorem}
\begin{proof}
    コンパクトな空間からHausdorff空間への連続な単射は像への同相写像であるため，$F:M\to F(M)$は埋め込みである．
\end{proof}

\section{接束}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=Diff上のfiber束の理論：微積分学とは接束関手の研究である]
    ここではfiber束の理論のうち，TopやDiffに内部化されたものしか必要でない．
    多様体上の接空間の集まりは接束と呼ばれ，$M$によりパラメタづけされていて，局所的には直積になっているような\footnote{局所的にはランクが一定で，のっぺりと伸ばしたaffine空間にできるという階数一定定理＝陰関数定理の議論が，ベクトル束が局所的には積束$U\times\R^r$に束として同型であることに対応する．これに気づいた時には血が洗われた気分だ．}ベクトル束の構造を持つ．
    底空間を固定してその上のベクトル束と束写像の集まりは一般に圏をなす（over cateogoryの部分圏）ので，微分＝超局所線型化の研究とは，ここへの\textbf{接束関手}を構成することとなる．\footnote{その動きだけ言えば，$f:N\to M$の$N,M$に射を上から突き建て，その矢尻に射が生えるのである．これは共変的であるから，微分は$f_*$と表すのである！この時の関手性の中にChain Ruleがreincarnateしている．}
    少し議論が複雑に思えるかもしれないが，この枠組みが極めて自然で，多様体に内在するものである．実際，特性数などの不変量を持つ．

    このように，fiber束の考え方はあまりに強力で，Grothendieckの霊性を湛えている．思うに，Weylが精緻化して見せた曲線などの概念でさえ，fiber束の極めて退化した姿で，$A$上の圏$C_A$を調べるのが幾何学的な行為だといえよう．
\end{tcolorbox}

\subsection{束}

\begin{definition}[bundle, total space, base space, fiber bundle, trivial fiber bundle, typical fiber, vector bundle]\mbox{}
    \begin{enumerate}
        \item 射$p:E\to B$を，対象$B$上の束という．$E$を\textbf{全空間}，$B$を\textbf{底空間}という．
        \item 対象$B$上の\textbf{標準ファイバー$F$を備えるファイバー束}$p:E\to B$とは，任意の大域点$x:1\to B$との引き戻しが常に$F$と同型になることをいう．すなわち，「同質」な集合$p^{-1}(x)$の族である．この$F$をtypical fiberまたはfiber spaceと呼ぶ．
        \item 直積が定めるファイバー束$\pr_1:B\times F\to B$を自明束という．\footnote{図式がCartesianであるという時と同じか．}
        \item 圏TopやDiffでは，ファイバー束と呼ぶために\textbf{locally trivial}と呼ばれる公理を課す．すなわち，ある被覆$(j_\alpha:U_\alpha\to B)_\alpha$が存在して，$j_\alpha$に沿った$E$の引き戻し$E_\alpha$が自明束$U_\alpha\times F$に同型である．\footnote{$x\in X$に依らず$F_x\simeq F$というだけである．}
        \item 束$p:E\to B$の間の射を束写像という．
        \item 各fiberが線型空間$V_x$であるようなファイバー束のクラスを，\textbf{ベクトル束}という．
        \item 底空間を多様体$X$の接空間の非交和$TX$としたベクトル束$TX\to X$を接束という．これの切断がベクトル場や微分形式である．
        \item $X$上のベクトル束は束写像と圏をなし，これを$\Vect(X)$と表す．これは多様体に標準的に備わっているものであるから，接束の不変量は多様体の不変量を与える．Chern-Weil理論ではEuler数の一般化とみなせる特性数なる不変量を定める．
        \item 写像の微分により，線型化関手(tangent functor) $T:\Diff\to\Vect(\Diff)$が定まる．
        微分可能多様体とその間の写像を，接束とその間の束写像$(f,df)$に移す．
    \end{enumerate}
\end{definition}
\begin{remarks}
    空間$X$に対して，$x\in X$をパラメータとして少しずつ変化する，局所的には単なる直積とみなせる相空間のような「線型道具の空間」がvector bundleである．
\end{remarks}
\begin{history}[30s生まれの理論]
    ファイバー束の概念は、埋め込み定理のWhitneyに始まる。ホイットニーは多様体上のベクトル場から接ベクトル空間をファイバーに持つ接ベクトル束を構成し、その一般化としてファイバー束に到達した。その後、陳省身(Shiing-Shen Chern) による研究は、ファイバー束と接続を関連させ微分幾何学を大域的理論へと導いていくことになり、ゲージ理論などの基礎も成している。また、微分幾何学に留まらず、様々な幾何学の基本的な道具となり、その適用範囲は広い。さらにファイバー束はセールやヒューレッツらによってファイバー空間として一般化され、代数的位相幾何学を支える概念の一つにもなった。
\end{history}
\begin{example}\mbox{}
    \begin{enumerate}
        \item 自明束：Euclid空間の接束は単なる直積である．多様体の理論では，$M$上のベクトル束で積束$M\times\R^r$と同型なものを自明束と言う．
        \item 多様体$M$に対して，自明束$\pr_1:M\times\R^r\to M$は，階数が$r$だから，\textbf{階数が$r$の$M$上の積束}という．無限円筒$S^1\times\R$は階数が1の$S^1$上の積束である．
        \item メビウスの帯
        \item クラインの壺
    \end{enumerate}
\end{example}

\begin{definition}[bundle map]
    束$\pi:E\to M,\pi':E'\to M$の射とは，次の図式を可換にする写像のことである：
    \[\xymatrix{
        E\ar[rr]^-\varphi\ar[dr]_-{\pi}&&E'\ar[dl]^-{\pi'}\\
        &M
    }\]
    これは$\forall_{e\in E}\;\pi(e)=\varphi(\pi'(e))$ということだから，$\varphi(E_p)\subset E'_p$に同値である．
\end{definition}

\begin{definition}[vector bundle map]
    ベクトル束$\pi_E:E\to M,\pi_F:F\to M$に対して，その間の\textbf{束写像}とは，
    組$(f:M\to N,\tilde{f}:E\to F)$で次の２条件を満たすものである：
    \begin{enumerate}
        \item 次の図式が可換である．
        \[\xymatrix{
            E\ar[r]^-{\tilde{f}}\ar[d]_-{\pi_E}&F\ar[d]^-{\pi_F}\\
            M\ar[r]_-{f}&N
        }\]
        \item $\tilde{f}:E\to F$の各ファイバー上の制限$\tilde{f}|_{E_p}:E_p\to F$は線型写像である．
    \end{enumerate}
    したがって，ベクトル束の射$(f,\tilde{f}):E\to F$が\textbf{$M$上の束写像}であるとは，$\tilde{f}=1_M$が退化している状況を言う．
\end{definition}

\begin{remarks}[相空間が見えた！]
    これは多様体を同一にした変数変換か！この構造が相空間の霊性ではないか？
\end{remarks}

\subsection{ベクトル束}

\begin{definition}[trivialization]
    多様体の間の滑らかな全射$\pi:E\to M$が\textbf{局所自明で階数が$r$}とは，次の２条件が成り立つことをいう．
    \begin{enumerate}
        \item 各ファイバー$E_p$が$r$-次元線型空間である．
        \item 任意の点$p\in M$について，$p$の開近傍$U$とfiberを保つ微分同相写像$\phi:\pi^{-1}(U)\to U\times\R^r$（$M$上の射）の組で，次を満たす組$(U,\phi)$が存在する．$U$を$E$を\textbf{自明化する開集合}といい，$\phi$を$E$の$U$上の\textbf{自明化}と呼ぶ．
        \begin{quote}
            $\forall_{q\in U}\;\phi_{\pi^{-1}(q)}:\pi^{-1}(q)\iso\{q\}\times\R^r$は可逆．\footnote{この$\R^r$がtypical fiberである．}
        \end{quote}
    \end{enumerate}
    自明化の族$(U,\varphi)$で$M$の開被覆をなすものを$E$の\textbf{局所自明化}と呼ぶ．
\end{definition}
\begin{remark}[自明化とはベクトル束の局所的な同型である]
    条件(2)は，ベクトル束の同型$\varphi:\pi^{-1}(U)=:E|_U\iso U\times\R^r$であって次の図式を可換にするもの（これを\textbf{自明化}と呼ぶ）が存在するということである：
    \[\xymatrix{
        E\ar[r]^-\pi&M\\
        \pi^{-1}(U)\ar[d]_-{\varphi}\ar@{^{(}->}[u]^-i\ar[r]^-{\pi}&U \ar@{^{(}->}[u]_-i\\
        U\times\R^r\ar[ur]_-{\pr_1}
    }\]
    一般に，このように積束と自明な束を\textbf{自明束}という．
\end{remark}

\begin{definition}
    階数が$r$の$C^\infty$級ベクトル束とは，
    \begin{enumerate}
        \item 局所自明で階数$r$の$C^\infty$級の全射な多様体の射$\pi:E\to M$，
        \item 多様体$E,M$
    \end{enumerate}
    からなる3-組$(E,M,\pi)$のことである．混用する際には全空間$E$を$M$上のベクトル束という．
\end{definition}

\begin{example}[restriction]
    任意の正則部分多様体$S\subset N$に対して，3-組$(\pi^{-1}(S),S,\pi|_{\pi^{-1}(S)})$は$C^\infty$級ベクトル束である：
    \[\xymatrix{
        E\ar[r]^-\pi&M\\
        \pi^{-1}(S) \ar@{^{(}->}[u]\ar[r]_-\pi&S \ar@{^{(}->}[u]
    }\]
    $\pi^{-1}(S)$を$E|_S$とも書く．
\end{example}

\begin{definition}[natural bundle：接束の一般化]
    多様体$M$上のファイバー束$E\to M$が，多様体の射$M\to N$を自然に底空間上の射にliftするとき，これをnaturalという．
    ファイバー束として接束をとるとこれは成り立ち，関手$\Diff\to\Vect(\Diff)$を定める．この時の関手性をChain Ruleという．
\end{definition}

\subsection{接束の構成とその性質}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    $TM$は「接束の全空間」であるが，慣用的に非交和$TM$自体も接束と呼ぶ．
    多様体とその間の射から，接束とその間の射の構成は共変関手で，
    接束の射$(f:N\to M,\tilde{f}:T(N)\to T(M))$は，微分$f_*$を用いて$\tilde{f}(p,v)=(f(p),f_*(v))$と構成される．
    この時の関手性の中にChain Ruleがreincarnateしている．
\end{tcolorbox}

\begin{definition}[tangent bundleとそのチャートの構成]\mbox{}
    \begin{enumerate}
        \item 集合として$TM=\coprod_{p\in M}T_p(M)$と定める．元は$(p,v)\in TM$という形をしている．積が定める自然な写像＝束$\pi:=\pr_1:TM\to M$が存在する．\footnote{無縁和を使ったすごくぎこちない定義に見える．要は，$\cup_{p\in M}\{p\}\times T_p(M)$である．接ベクトルのデータ構造は$(p,v)$であるからこそ，交わらないのである．}これにより，接束は$C^\infty$級ベクトル束である．
        \item $M$の各チャート$(U,\varphi=(x^1,\cdots,x^n))$に対して，$\pi$による$\varphi$の引き戻し$\pi^*\varphi:TU\xrightarrow{\pr_1}U\xrightarrow{\varphi}\varphi(U)\subset\R^n$と，
        $\varphi$による$v\in TU$の座標係数関数を$c=(c^1,\cdots,c^n):TU\to\R^n$とを用いて，
        積写像$\wt{\varphi}:=(\o{\varphi},c):TU\to\varphi(U)\times\R^n$を，$TM$の座標近傍$(TU,\wt{\varphi})$とする．
        なお，座標係数関数とは各方向への微分係数に他ならないから，$\varphi:U\mono\R^n$の$p$での微分を$\varphi_*$とすると，$\wt{\varphi}=(\pi^*\varphi,\varphi_*)$に他ならない．
        \item この座標近傍$\wt{\varphi}:TU\to\varphi(U)\times\R^n$によるEuclid位相のfinal topologyを$TU$に定める．
        \item $C^\infty$級ベクトル束$\pi:E\to M$に対して，$M$のチャート$(U,\psi)$が存在して，$\varphi:E|_U\iso U\times\R^r$が自明化であるとする．この時，$(\psi\times\id_{\R^r})\circ\phi:E|_U\iso U\times\R^r\iso\psi(U)\times\R^r\subset\R^{n+r}$は$E$の近傍座標である．
        前半を$E$上のチャート$(E|_U,(\psi\times 1)\circ\varphi)$に関する\textbf{底座標}，後半を\textbf{ファイバー座標}という．\footnote{前半が底空間の間の写像$f$に対応し，後半が微分，すなわち接束上の写像$f_*$に対応するからであろう．}
    \end{enumerate}
\end{definition}
\begin{remarks}
    この言葉を使うと，$\R^m\in\Diff$は特別な対象で，自明化のお手本として使われる．

\end{remarks}

\begin{lemma}
    $\{(U_\alpha,\varphi_\alpha,V_\alpha)\}_{\alpha\in A}$が$M$の$C^\infty$級アトラスならば，これが定める$\{(TU_\alpha,\wt{\varphi}_\alpha)\}_{\alpha\in A}$も$C^\infty$級アトラスである．
\end{lemma}

\begin{proposition}[接束も多様体である]
    多様体$M$の接束$TM$は
    \begin{enumerate}
        \item 第２可算である．
        \item Hausdorffである．
        \item パラコンパクトである．
    \end{enumerate}
\end{proposition}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item 
        \item 
    \end{enumerate}
\end{proof}

\begin{definition}
    
\end{definition}

\subsection{滑らかな切断}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    接束$\pi:TM\to M$はDiffの射でもあるので，滑らかな切断があるかどうかが焦点となる．
    全射ならば存在しそう．
\end{tcolorbox}

\begin{definition}[global section]
    $\pi:E\to M$の$C^\infty$級切断全体の集合を$\Gamma(E)$と書く．
    これは$\Hom_\Diff(M,E)$の実線型部分空間である．
    切断の開集合$U$への制限からなる集合$\Gamma(U,E)$も同様に部分空間であり，$C^\infty(M)$-加群となる．
    これに対して，$\Gamma(E)$の元を\textbf{大域切断}と呼ぶ．
\end{definition}

\begin{proposition}
    $\Gamma(E)$は環$C^\infty(M)$上の加群である．すなわち，$s,t\in\Gamma(E)$，$f\in C^\infty(M)$に対して，
    \begin{enumerate}
        \item $s+t\in\Gamma(E)$．
        \item $fs\in\Gamma(E)$．
    \end{enumerate}
\end{proposition}

\subsection{滑らかな枠}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    ベクトル場の場合も微分形式の場合も，$TM$には標準的な基底が入っていた．これを抽象化していく．
    するとテンソル計算の一般理論が出来上がる気がする．
    「滑らか」を「連続」とすれば，全く等価な理論がDiffだけでなくTopでも成り立つ．
\end{tcolorbox}

\begin{definition}[frame]
    ベクトル束$\pi:E\to M$に対して，その部分集合$U\subset M$上の\textbf{枠}とは，
    切断の組$(s_i:U\to E)$であって，
    その各点$x\in U$に於ける像$\{s_i(p)\}$がファイバー$E_x=\pi^{-1}(x)$の基底を与えるもののことをいう．
    全空間を$FE:=\coprod_{i\in I}(\Im s_i)$として，これを再び束と見ると枠束$FE\to M$という．
\end{definition}
\begin{example}
    ベクトル場の場合も微分形式の場合も，$TM$には標準的な基底が入っていた．これを抽象化していく．
    \begin{enumerate}
        \item ベクトル場の集合$\Brace{\pp{}{x},\pp{}{y},\pp{}{z}}$は，接束$T\R^3\to\R^3$に対して，$\R^3$上の滑らかな枠である．
        \item 一般の多様体$M$に対して，$\o{e}_i:=(\id_M,e_i):M\to M\times\R^r$と定めると，$\o{e}_1,\cdots,\o{e}_r$は積束$M\times\R^r\to M$の$C^\infty$級枠である．
        \item （自明化の枠）$r$階の滑らかなベクトル束$\pi:E\to M$について，$\varphi:E|_U\iso U\times\R^r$を自明化とする．$t_i:M\to E$を，$t_i(p):=\varphi^{-1}(p,e_i)$と定めると，$\varphi^{-1}$は積束$U\times\R^r$の$C^\infty$枠$\o{e}_1,\cdots,\o{e}_r$を$E$の$U$上の$C^\infty$級枠$t_1,\cdots,t_r$に移す反変関手となっている．この$t_1,\cdots,t_r$を\textbf{自明化$\varphi$の$U$上の$C^\infty$級枠}という．
    \end{enumerate}
\end{example}

\begin{lemma}
    $\varphi:E|_U\iso U\times\R^r$を$C^\infty$級ベクトル束$\pi:E\to M$の$U$上の自明化とし，$t_1,\cdots,t_r$をこの自明化の$U$上の$C^\infty$級枠とする．
    次の２条件は同値である．
    \begin{enumerate}
        \item $E$の$U$上の切断$s=\sum b^it_i$が$C^\infty$級である．
        \item 枠$t_1,\cdots,t_r$の係数$b^i$が全て$C^\infty$級である．
    \end{enumerate}
\end{lemma}
\begin{remarks}
    これは良い補題だなああ
\end{remarks}

\begin{proposition}
    $\pi:E\to M$を$C^\infty$級ベクトル束，$U\osub M$とし，$s_1,\cdots,s_r$は$E$の$U$上の$C^\infty$級枠とする．
    \begin{enumerate}
        \item $E$の$U$上の切断$s=\sum c^it_i$が$C^\infty$級である．
        \item 全ての係数$c^i$が$U$上$C^\infty$級となる．
    \end{enumerate}
\end{proposition}

\subsection{主束}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    枠束を代数化した概念を用意する．
    これは，群作用によりファイバー束が定まる場合である．
    この時の群を構造群と呼ぶ．
    これは，一般枠束におけるベクトル空間の全基底に対する一般線型群の作用を一般化したものである．
\end{tcolorbox}

\begin{definition}[principal bundle, principal homogeneous space]
    \textbf{主$G$-束}とは，束$P\to X$であって，次を満たす$G$-作用$\rho:P\times G\to P$を受けるものを言う．
    この群$G$を\textbf{構造群}と呼び，その軌道はファイバーに一致し，$G$は自由かつ推移的に作用する．この$e\in G$を忘れ去った空間を\textbf{主等質空間}または$G$-torsorと呼ぶ．
    \begin{quote}
        $(p_1,\rho):P\times G\iso P\times_XP$が可逆．すなわち，各ファイバーが$G$に似ている．
        すなわち，$P\to X$が商写像$P\to P/G$に同型．
    \end{quote}
\end{definition}

\section{隆起関数と1の分割}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    $C^\infty$級の１の分割の存在は，$C^\infty$級多様体の理論における最も重要な技術的道具の１つであり，$C^\infty$級多様体の振る舞いを実解析的多様体や複素多様体のそれと大きく異なるものとするただ一つの特徴である．
    １の分割は，独自の方法で，多様体上の大域的な解析と局所的な解析を結ぶ橋渡しをしてくれる存在である．
\end{tcolorbox}

\subsection{関数の台}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    つまみみたいなものをいう．台のコンパクト性が問題になるのはなぜだろうか．
\end{tcolorbox}

\begin{definition}[support, bump function]\mbox{}
    \begin{enumerate}
        \item $C^\infty$級関数$f:M\to\R^d$に対し，その\textbf{台}とは，$\supp f:=\o{\{x\in M\mid f(x)\ne 0\}}$をいう．
        \item $M$上の連続な非負関数$\rho$が，$U$に台を持つ$q$における\textbf{隆起関数}であるとは，$q$のある近傍において$1$であり，台が$\supp\rho\subset U$を満たすことをいう．
    \end{enumerate}
\end{definition}

\begin{example}\mbox{}
    \begin{description}
        \item[階段関数の構成] 
    節\ref{subsection-sheaf}で導入した
    \[f(t)=\begin{cases}
        e^{-\frac{1}{t}},&t>0,\\
        0,&t\le 0.
    \end{cases}\]
    から滑らかな階段関数
    \[g(t)=\frac{f(t)}{f(t)+f(1-t)}=\begin{cases}
        0,&t\le 0,\\
        \frac{\exp(-1/t)}{\exp(-1/t)+\exp(-1/(1-t))},&0\le t\le 1,\\
        1,&t\ge 1.
    \end{cases}\]
    が構成できる．
        \item[隆起関数の構成]
        変数変換
        \[\xymatrix@R-2pc{
            [a^2,b^2]\ar[r]^-\sim&[0,1]\\
            \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
            x\ar@{|->}[r]&\frac{x-a^2}{b^2-a^2}
        }\]
        を用いて，$h(x):=g\paren{\frac{x-a^2}{b^2-a^2}}$と定めると，$h(x)=0\;(x\le a^2),h(x)=1\;(x\ge b^2)$を満たす階段関数である．
        そこで，$k(x):=h(x^2)$とすると左右対称となり，$\rho(x)=1-k(x)$で，$[-a,a]$で恒等的に１となり，$[-b,b]$に台を持つ階段関数となる．
    \end{description}
\end{example}

\begin{theorem}
    多様体$M$の任意の点$p$とその近傍$p\in U$について，$U$にコンパクトな台を持つ$p$における$C^\infty$級の隆起関数$\rho:M\to\R$が存在する．
\end{theorem}

\begin{proposition}[関数の大域への拡張]
    $f:U_p\to\R$を$p\in M$の座標近傍上の関数とする．$p$の近傍上で$f$に一致する関数$\o{f}:M\to\R$が存在する．
\end{proposition}
\begin{proof}
    $U$に台を持つ$C^\infty$級の隆起関数$\rho:M\to\R$で，$p$の開近傍$V$について$\rho|_V=1$を満たすものを１つとる．
    これについて
    \[\o{f}(x):=\begin{cases}
        \rho(x)f(x),&x\in U,\\
        0,&x\notin U.
    \end{cases}\]
    とすると，$\o{f}$は$U$上$C^\infty$級で，$x\notin U$ならば$x\in (M\setminus\supp\rho)$より，$\o{f}|_{O}=0$を満たす開集合$x\in O\subset (M\setminus\supp\rho)$が取れるから，$x\notin U$上でも$C^\infty$級である．
    また，$V$上で$\rho=1$より，$f$と一致している．
\end{proof}

\subsection{１の分割}

\begin{definition}[partition of unity]\mbox{}
    \begin{enumerate}
        \item $M$の有限開被覆$(U_i)_{i\in I}$に対して，これに従属する$C^\infty$級の１の分割とは，非負関数の族$(\rho_i:M\to\R)_{i\in I}$で，$\supp\rho_i\subset U_i$を満たし，$\sum\rho_i=1$を満たすものをいう．
        \item 添字集合$I$が無限である時，台の族$(\supp \rho_i)_{i\in I}$が局所有限ならば，同様に定義ができる．
    \end{enumerate}
\end{definition}

\begin{lemma}
    $\rho_1,\cdots,\rho_m$が多様体$M$上の実数値関数ならば，$\supp\paren{\sum\rho_i}\subset\cup\supp\rho_i$．
\end{lemma}

\begin{proposition}
    コンパクトな多様体$M$の開被覆を$(U_\alpha)_{\alpha\in A}$とする．これに従属する１の分割$(\rho_\alpha)_{\alpha\in A}$が存在する．
\end{proposition}

\begin{theorem}
    $(U_\alpha)_{\alpha\in A}$を多様体$M$の開被覆とする．
    \begin{enumerate}
        \item $C^\infty$級の１の分割$(\varphi_k)_{k\in\N}$が存在し，$\supp\varphi_k$はコンパクトな台を持ち，$\exists_{\alpha\in A}\;\supp\varphi_k\subset U_\alpha$．
        \item 台がコンパクトでなくても良いならば，$(U_\alpha)_{\alpha\in A}$に従属する$C^\infty$級の１の分割は存在する．
    \end{enumerate}
\end{theorem}

\section{ベクトル場}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    多様体の部分集合を比べるためにはどうすれば良いかという問題は，多様体からそれ自身への微分同相写像を考えることによって解決される．
    微分同相写像で写り合うものを同じと考えることができる．
    多様体の部分集合の移動を考えるためには，微分同相写像の連続な族を考えることになるが，これは，多様体上の常微分方程式論，すなわちベクトル場の理論によって，解決される．
    特にコンパクトな多様体では，ベクトル場とフローが１対１に対応している．
\end{tcolorbox}

\subsection{ベクトル場の滑らかさの特徴付け}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    ベクトル場は接束の切断なので，$C^\infty$級写像として滑らかであることが自然な定義だが，他のインターフェイスとして２つ用意する．
\end{tcolorbox}

\subsection{積分曲線}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    全てのベクトル場は局所的には流体の速度ベクトル場と見ることができる．
    積分曲線は，その速度ベクトル場が元のベクトル場の曲線上への制限と一致しているような曲線である．
    積分曲線の式を見つけることは，１階の連立常微分方程式を解くことと同値であり，
    したがって常微分方程式の理論が積分曲線の存在を保証する．
\end{tcolorbox}

\begin{definition}[integral curve]
    $X:M\to TM$を$C^\infty$級ベクトル場とする．
    \begin{enumerate}
        \item $X$の積分曲線$c:(a,b)\to M$とは，$\forall_{t\in(a,b)}\;c'(t)=X_{c(t)}$が成り立つ曲線をいう．
        \item $0\in (a,b),c(0)=p$を満たす時，点$p$を視点とする積分曲線であると良い，$c(t)$の代わりに$c_t(p)$とも表す．
        \item これ以上延長できない積分曲線を極大であるという．
    \end{enumerate}
\end{definition}

\begin{example}
    ベクトル場$X_{(x,y)}=\brac{-y,x}$の積分曲線たちは，$p$を中心とした$\theta\in\R$回転からなるため，
    $\R^2$の微分同相写像の一パラメータ部分群$c:\R\to\Aut_{C^\infty}(\R^3)$を与える．
\end{example}

\subsection{局所フロー}

\begin{proposition}[時刻に依存する方程式の解]
    $V\osub\R^n,f:V\to\R^n$を$C^\infty$級写像（ベクトル場）とする．
    各点$p_0\in V$に対して，近傍$p_0\in W\subset V$と実数$\epsilon>0$と$C^\infty$級写像$y:(-\epsilon,\epsilon)\times W\to V$が存在して，
    \[\forall_{(t,q)\in(-\epsilon,\epsilon)\times W}\;\pp{y}{t}(t,q)=f(y(t,q)),\quad y(0,q)=q.\]
\end{proposition}

\begin{definition}\mbox{}
    \begin{enumerate}
        \item $C^\infty$級写像$F:(-\epsilon,\epsilon)\times W\to U$であって次を満たすものを，\textbf{ベクトル場$X$により生成される局所フロー}という．\begin{enumerate}[(a)]
            \item $F_0=\id_W$．
            \item 両辺が定義されていれば$F_t(F_s(q))=F_{t+s}(q)$．
        \end{enumerate}
        \item 各$q$を始点とする積分曲線$F_t(q):W\to U$を局所フローの\textbf{フロー曲線}という．
        \item 局所フローが$\R\times M$上で定義される時，これを\textbf{大域フロー}という．
        \item 大域フローを持つベクトル場を\textbf{完備}という．
    \end{enumerate}

\end{definition}

\subsection{Lie括弧積}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    $\X(M)$は明らかに線型空間の構造を持つ．ここにさらにLie代数になるような代数構造を導入する．
    ベクトル場は滑らかな写像の下での押し出しを持たないので，Lie代数$\X(M)$は多様体の圏上の関手にはならないが，
    ２つの多様体の間の滑らかな写像の下でベクトル場を比較する\textbf{関係にあるベクトル場}と呼ばれるものが存在する．
\end{tcolorbox}

\begin{definition}[Lie algebra]
    
\end{definition}

\subsection{ベクトル場の押し出し}

\subsection{関係のあるベクトル場}

\section{多様体上のフロー}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    $M$をコンパクト多様体とする．$C^\infty$級関数$f$の２つの正則値$a,b$に対して，部分多様体$f^{-1}(a),f^{-1}(b)$の
    多様体$M$内での付値と形の比較を考える．
\end{tcolorbox}

\subsection{isotopy}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    相似変換で写り合う（同型），合同変換で写り合う，正則写像で写り合う．射によって種々の「形が同じ」という同値の概念がある．
    この中でも特にアイソトピーを考える文脈がフローにつながる．
    $F_{t_0}=\id_M$となる$F_t$により$F_{t_1}(A_0)=A_1$となることは，時刻に依存するベクトル場の定める常微分方程式の解により$A_0$を$A_1$に移すことと同じである．
\end{tcolorbox}

\begin{definition}[isotopy]
    微分同型写像$F_t:M\iso M$のcurrying $F:[0,1]\times M\to M$であって，$F_0=\id_M$を満たすものを\textbf{アイソトピー}という．
\end{definition}

\section{曲線の長さ}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    こうして得られた多様体上には，実は大きさの概念がほとんどない．ほとんど全体を覆い尽くす開集合と１点の近傍は多様体上では，区別されていない．
    このような区別を与えるためには曲線に長さを定義できれば良いことがわかっている．
    曲線に長さを与えるためには接ベクトルに長さを定義してその積分とすれば良く，Riemann計量という形で定義される．
    多様体の形を研究するためにはその多様体に最も適合した計量を考えれば良いことになる．
    このような計量に対する等距離変換の群が多様体の対称性などを表現することとなるが，等距離変換群は多様体の構造を持ち，Lie群となることが知られている．
\end{tcolorbox}

\chapter{微分形式とテンソル場}

\chapter{Lie群と等質空間}

\begin{quotation}
    圏Diff内の群対象がLie群である．
    Sophus Lie 1842-1899の，空間$X$に対する変換群$\Aut_\Diff(X)$の研究，
    特に無限小変換と連続群の研究に端を発するためこの名がついた．

    Lie群はそれ自身への左移動によって推移的に作用するからそれ自身等質空間である．
    それゆえ，単位元における接空間の知見を深めれば，どの点でも局所的には同じ構造をしていると考えられる．
    そして単位元における接空間$T_eG$では，Lie代数を定めるような自然な括弧積が定義できる．
\end{quotation}

\section{位相群}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    標準的な自己位相同型$L_g,R_g\in\Aut_\Top(G)$や$Ad(g)=L_g\circ R_{g^{-1}}$，または演算写像とその合成$\mult\circ(\id_G\times\inv);(x,y)\mapsto xy^{-1}$が連続であることを元に議論する．
    すると，$e\in G$の近傍全体のなす集合$\U$に注目すれば良い．
    任意の点$g\in G$について，その近傍全体のなす集合は$L_g(\U)=g\U$であるため．
    つまり，自己移動によって近傍系が写り合うという意味で「等質的」である．
    この群$G$にある意味で似ている位相空間が，等質空間である．
\end{tcolorbox}

\begin{lemma}
    $A,B\subset G$を部分集合とする．
    \begin{enumerate}
        \item $A$または$B$が開であるとき，$AB$は開である．
        \item $A$が開であるとき，$A^{-1}$及び$gAg^{-1}$も開である．
    \end{enumerate}
\end{lemma}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item $A$が開とすると，任意の$b\in B$について$R_b(A)$は開である．よって，$AB=\cup_{b\in B}R_b(A)$も開．
        \item $A^{-1}$は連続写像である$\inv:G\to G$の像．$gAg^{-1}$は$\Ad(g):G\to G$の像．
    \end{enumerate}
\end{proof}

\begin{lemma}[使える連続写像のレパートリー]\label{lemma-morphism-toolset-for-topological-group}
    $e\in G$の近傍全体の集合$\U$について，
    \begin{enumerate}
        \item $\U\ne\emptyset$．
        \item $\U$は開集合の基底である：$\forall_{U_1,U_2\in\U}\;\exists_{U_3\in\U}\;(e\in)U_3\subset U_1\cap U_2$．
        \item $\forall_{U\in\U}\;\exists_{V\in\U}\;V\cdot V^{-1}\subset U$．
        \item $\forall_{U\in\U}\;\forall_{a\in U}\;\exists_{V\in\U}\;aV\subset U$．
        \item $\forall_{U\in\U}\;\forall_{g\in G}\;\exists_{V\in\U}\;gVg^{-1}\subset U$．
    \end{enumerate}
\end{lemma}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item $G\in\U$．
        \item 基本近傍系だから．
        \item $\varphi:=\mult\circ(\id_G\times\inv):G\times G\to G;\varphi(x,y)=xy^{-1}$が連続であることと，$\varphi(e,e)=e$であることより，任意の近傍$U$に対して，近傍$V$が存在して$\varphi(V,V)=V\cdot V^{-1}\subset U$を満たす．
        \item $L_a:G\to G$は$L_a(e)=a$を満たす連続写像であるため．
        \item $L_g\cdot R_{g^{-1}}=\Ad(g)$について．
    \end{enumerate}
\end{proof}
\begin{remark}
    上の５つを公理として，$G$の部分集合の族$\U$を定める．$\U(g):=\Brace{gU\mid U\in\U}$とおくと，これらを$g$の基本近傍系とするような位相が$G$に定まる．
\end{remark}

\begin{proposition}[ハウスドルフ位相群の特徴付け]
    位相群$G$について，次の２条件は同値．
    \begin{enumerate}
        \item $G$はHausdorffである．
        \item $\bigcap_{U\in\U}U=\{e\}$．
    \end{enumerate}
\end{proposition}
\begin{remarks}
    他の点が分離可能ってそう言うことだもんね．位相群本当に面白いな．
\end{remarks}
\begin{proof}\mbox{}
    \begin{description}
        \item[(1)$\Rightarrow$(2)] 任意の$g\in G\setminus\{e\}$について，$g\notin U$を満たす$U\in\U$が存在するため．
        \item[(2)$\Rightarrow$(1)] 任意に相異なる$g,h\in G$を取る．相異なるため，$h^{-1}g\ne e$であるから，$h^{-1}g\in U$を満たす$U\in\U$が存在する．このとき，$\mult\circ\inv$の連続性より，$VV^{-1}\subset U$を満たす$V\in\U$が存在し，これについても$h^{-1}g\notin VV^{-1}$．すなわち，$g\notin hVV^{-1}$，$gV\cap hV=\emptyset$．
    \end{description}
\end{proof}

\begin{itembox}
    すごい．単位元$e\in G$をある種の標準点と見れるのか．
    他の点は必ず$e$に引き戻せる，というtoolsetが群だと思える．
\end{itembox}

\section{位相群の部分群と商空間}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    部分群については，剰余類分解があるため，閉集合であることの方が広い概念である．
\end{tcolorbox}

\begin{lemma}
    $G$を位相群，$H$を部分群とする．
    \begin{enumerate}
        \item $H$の閉包$\o{H}$は$G$の閉部分群である．
        \item $H$が$G$の正規部分群ならば，$\o{H}$も$G$の正規部分群である．
        \item $H$が$G$の開集合ならば，$H$はまた$G$の閉集合である．
    \end{enumerate}
\end{lemma}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item $g,h\in\o{H}$を任意に取る．$gh^{-1}\in\o{H}\Lrarrow\forall_{U\in\U}\;gh^{-1}U\cap H\ne\emptyset$を示せば良い．
        $\Ad(h)\circ\mult\circ(\id_G\times\inv)$の連続性（補題\ref{lemma-morphism-toolset-for-topological-group}）より，$hVV^{-1}h^{-1}\subset U$を満たす$V\in\U$が存在する．すなわち，$VV^{-1}h^{-1}\subset h^{-1}U$．
        $g,h\in\o{H}$より，$gV\cap H\ne\emptyset,hV\cap H\ne\emptyset$であるから，$gu,hv\in H$を満たす$u,v\in V$が存在する．これについて，$(gu)(hv)^{-1}=guv^{-1}h^{-1}\in H$であるから，$gVV^{-1}h^{-1}\subset gh^{-1}U$が空でないことがわかった．
        \item 
        $H$が$G$の正規部分群だから，任意の$g\in G$について，$gHg^{-1}=\Ad_g(H)=H$．ここで，$Ad_g:G\iso G$は位相同型であることより，$\o{\Ad_g(H)}=\Ad_g(\o{H})=g\o{H}g^{-1}=\o{H}$．
        \item $H$による左剰余類分解$G=H\cup\bigcup_{\alpha\in A}a_\alpha H$を考える．$a_\alpha H$は連続写像$L_{a_\alpha}$の像だから開．よって，$H$の補集合$H'=\bigcup_{\alpha\in A}a_{\alpha}H$は開である．
    \end{enumerate}
\end{proof}

\begin{lemma}\mbox{}
    \begin{enumerate}
        \item 位相群$G$の中心は閉部分群である．
    \end{enumerate}
\end{lemma}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item 
    \end{enumerate}
\end{proof}

\begin{proposition}\mbox{}
    \begin{enumerate}
        \item 左剰余類全体の集合$G/H$に，終位相を入れると，$\pi:G\epi G/H$は開写像となる．
        \item $H\rsub G$であるとき，$G/H$は位相群である．
        \item Hausdorff位相群$G$の商群$G/H$がHausdorffであるための必要十分条件は，正規部分群$H$が閉であることである．
    \end{enumerate}
\end{proposition}
\begin{remarks}
    これは商位相空間がHausdorffになる条件\ref{thm-characterization-of-quotient-Hausdorff}の例である．
\end{remarks}

\section{位相群の等質空間，局所コンパクト群}

\begin{definition}[topological transformaton group, effective / free, transitive, homogeneous space, isotropy subgroup]\mbox{}
    \begin{enumerate}
        \item 位相空間$X$への位相群の作用$\varphi:G\times X\to X$が定まっているとき，$G\to\Aut_\Top(X)$が定まっている．このとき位相群$G$のことを\textbf{位相変換群}という．
        \item 作用が\textbf{効果的}であるとは，$\forall_{x\in X}\;gx=x\Rightarrow g=e$が成り立つことをいう．すなわち，剪断写像$(\varphi,\pr_2):G\times X\to X\times X$が単射である．
        \item 作用が\textbf{推移的}であるとは，$\forall_{x,y\in X}\;\exists_{g\in G}\;gx=y$が成り立つことをいう．すなわち，剪断写像$(\varphi,\pr_2):G\times X\to X\times X$が全射である．これは軌道が１つであるということであり，この位相空間$X$を，\textbf{位相群$G$の等質空間}という．
        \item 安定化群$\Stab_G(x):=\Brace{g\in G\mid gx=x}$を，$G$の\textbf{等方部分群}という．
    \end{enumerate}
\end{definition}

\begin{lemma}\mbox{}
    \begin{enumerate}
        \item $x$における等方部分群$\Stab_G(x):=\Brace{g\in G\mid gx=x}$は$G$の部分群になる．
        \item $G$がHausdorffであるとき，等方部分群は閉である．
        \item $N:=\Brace{g\in G\mid \forall_{x\in X}\;gx=x}$は$G$の正規閉部分群である．
        \item $G$が$X$に推移的に作用するとき，$X$の任意の２点における等方部分群$H,H'$は互いに共役である：$\exists_{g\in G}\;gHg^{-1}=H'$．
    \end{enumerate}
\end{lemma}
\begin{proof}\mbox{}
    \begin{enumerate}
        \item $gx=x\Lrarrow x=g^{-1}x$より逆元について閉じており，$(gh)x=g(hx)=gx=x$より積についても閉じており，単位元を含むため．
        \item $\varphi(-,x):=\varphi_x:G\to X$を$g\mapsto gx$と定めると，これは作用$\varphi:G\times X\to X$の制限であるため，連続である．このとき，$\Stab_G(x)=\varphi_x^{-1}(x)$と，閉集合の逆像であるため．
    \end{enumerate}
\end{proof}

\begin{example}
    $G$を位相群，$H$をその正規部分群とすると，$G$は$G/H$の位相変換であり，$G/H$に推移的に作用する：
    \[\xymatrix@R-2pc{
        \varphi:G\times G/H\ar[r]&G/H\\
        \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
        (g,\pi(g'))\ar@{|->}[r]&\pi(gg')
    }\]
    この作用のcurryingを$T:G\to\Aut_\Top(G/H)$と表し，$T_ga=\varphi(g,a)$と表す．
\end{example}

\begin{theorem}[等質空間に関する軌道・安定化群定理]
    局所コンパクトハウスドルフ空間$X$を，可算基を持つ位相群$G$の等質空間とする（すなわち，推移的に連続作用している）．
    $H$を，$x\in X$における$G$の等方部分群とする．
    \begin{enumerate}
        \item 次の写像は同相写像である．
        \[\xymatrix@R-2pc{
            \alpha:G/H\ar[r]&X\\
            \rotatebox[origin=c]{90}{$\in$}&\rotatebox[origin=c]{90}{$\in$}\\
            gH\ar@{|->}[r]&gx
        }\]
        \item $T_g:=\pi(g\cdot -):G\epi G/H$について，$\alpha(T_g\xi)=g\alpha(\xi)$．
    \end{enumerate}
\end{theorem}
\begin{example}[直交群の等質空間としての単位球面]
    $O(n)\subset\GL_n(\R)$はコンパクト部分群である．列ベクトルの空間として，$U_1(0)\subset\R^n$を$n$次元開球とすると，$O(n)\subset\o(U_1(0))^n$より．
    ここで，$\norm{Ax}=\norm{x}$を満たすから，$O(n)$の作用は連続写像$S^{n-1}\epi S^{n-1}$を誘導する．また，$O(n)$は推移的に$S^{n-1}$に作用する．
    したがって，$S^{n-1}$は$O(n)$の等質空間である．
    点$e_1\in S^{n-1}$における等方部分群は
    \[H:=\Brace{\begin{pmatrix}1&0\\0&B\end{pmatrix}\;\middle|\;B\in O(n-1)}\]
    より，軌道と安定化群との関係から，$O(n)/H\simeq O(n)/O(n-1)\simeq S^{n-1}$である．

    全く同様の議論で，$SO(n)/SO(n-1)\simeq S^{n-1}$も成り立つ．
\end{example}
\begin{example}[affine空間]
    affine変換群$\Aff_n(\R)$は局所コンパクトで，$n$次元空間$A^n$の推移的な位相変換群である．
    原点$0$における等方部分群は$\GL_n(\R)$に等しいから，$\Aff_n(\R)/\GL_n(\R)\simeq A^n$が成り立つ．
\end{example}

\begin{proposition}
    $SO(n)$は$O(n)$を含む連結成分である．
\end{proposition}

\section{Lie群とLie環}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    Lie群はDiffの群対象だから，可算基をもち，また局所コンパクト\footnote{近傍座標を介してEuclid空間の開集合に同相であるが，Euclid空間が局所コンパクトであるため．}である．
\end{tcolorbox}

\begin{lemma}
    Lie群$G$の単位元$e$を含む連結成分$G_0$は再びLie群である．
\end{lemma}

\section{Lie群の例}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    Lie群とは，$C^\infty$級多様体の圏での群対象である．
\end{tcolorbox}

\begin{remark}
    任意の群は離散位相を入れることで，$0$次元Lie群になる．
\end{remark}

\begin{example}\mbox{}
    \begin{enumerate}
        \item $\K^n$は加法についてLie群をなす．
        \item $\GL_n(\K)$は行列積についてLie群をなす．積演算は成分の二次多項式だから$C^\infty$級で，逆もCramerの公式より$C^\infty$級とわかる．\footnote{多様体となることは，detの正則点の集合となることからわかる（例\ref{example-GL-as-submanifold-of-Euclidean-space}．SLはdetの正則等位集合であり，$\{1\}\subset\R$の逆像なので$\R^{n^2}$の開部分集合であるGLの閉部分集合．}
    \end{enumerate}
\end{example}

\begin{lemma}[群の包含写像が滑らかならば，部分Lie群である]
    Lie群$G$に対して，任意の部分群$H\mono G$は$C^\infty$級多様体である．が，$H\mono G$が埋め込みとは限らないので部分多様体とは限らない．
    これについて，次を満たすならば，$H$はLie（部分）群である：$\forall_{L\in\Diff}\;\forall_{f:L\to H}\;i\circ fがC^\infty 級\Lrarrow fがC^\infty 級$．
    特に，$H$が$C^\infty$部分多様体ならば，$H$はLie部分群である．
\end{lemma}
\begin{proof}
    条件は$i:H\mono G$が$C^\infty$級だということを特徴付けているから，$H$の各射は確かに$C^\infty$級である．
\end{proof}

\begin{example}[Lie部分群]\mbox{}
    \begin{enumerate}
        \item $\SL_n(\K),O(n),U(n),SU(n),O(n,\C),\Sp_{2g}(\K)$などは$\GL_n(\K)$の部分群かつ正則部分多様体である．このとき，$i:\SL\mono\GL$は群準同型であるだけでなく滑らかな埋め込みであるから，Lie部分群である．
        \item $\H:=\Brace{\begin{pmatrix}z&w\\-\o{w}&\o{z}\end{pmatrix}\;\middle|\;z,w\in\C}\simeq\R^4$は$M_2(\C)$の$\R$-部分代数で，非可換体である．
        $\H^\times=\H\setminus\{0\}$はLie群である．
        \item $\H^\times$の部分群かつ部分多様体であるから，$S^3\simeq SU(2)$はLie群である．
        \item 同様に円群$S^1=\{z\in\C^\times\mid\abs{z}=1\}=U(1)=SO(2)$もLie群である．
    \end{enumerate}
\end{example}

\begin{example}[Lie群の射]
    $\det:\GL_n(\K)\to\K^\times$はLie群の射である．
\end{example}

\section{閉部分群定理}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    Lie群の閉部分群は，再びLie群である．
    これが，与えられた群がLie群であることを示すための一番簡単な方法となる．
\end{tcolorbox}

\section{Lie群の作用}

\begin{definition}[isotopy group]
    Lie群$G$の作用$G\times X\to X$に関する安定化群$G_x=\Stab_G(x)=\{g\in G\mid gx=x\}$を，$G$の\textbf{等方部分群}
\end{definition}

\begin{example}\mbox{}
    \begin{enumerate}
        \item 左移動$G\times G\to G$は$C^\infty$級の自由作用．
        \item 共役作用$G\times G\to G$は$C^\infty$級の作用である．$G_x=G\Leftrightarrow x\in Z(G)$．
        \item 行列のベクトルへの作用$\GL_n(\K)\times\K^n\to\K^n$は$C^\infty$級の作用である．
        \item 射影変換$\GL_{n+1}(\K)\times\K P^n\to\K P^n$も$C^\infty$級の作用である．
        \item Möbius変換$\SL_2(\R)\times\H\to\H$も$C^\infty$級の作用である．これは射影変換$\GL_2(\C)\times\C P^1\to\C P^1$の部分作用であるため．
    \end{enumerate}
\end{example}


\chapter{Riemann多様体}

\section{Riemann計量}

\begin{tcolorbox}[colframe=ForestGreen, colback=ForestGreen!10!white,breakable,colbacktitle=ForestGreen!40!white,coltitle=black,fonttitle=\bfseries\sffamily,
title=]
    接束に内積構造$g:M\to (TM\times_M TM)^*$を定めると，これが各点に計量を定め，これに沿った押し出しにより曲線に沿った積分が定義でき，したがって曲線の長さが定まる．
    すると，Riemann多様体上に距離関数$d:M\to\R_{\ge 0}$が定まる．
\end{tcolorbox}

\begin{definition}[Riemannian metric]\mbox{}
    \begin{enumerate}
        \item $g_p:T_p(M)\times T_p(M)\to\R$を内積とする．
        \item $U$の局所座標系$(x^1,\cdots,x^n)$について，$g_{ij}(q):=g_q\paren{\paren{\pp{}{x^i}}_q,\paren{\pp{}{x^j}}_q}$と置くと，$g_{ij}:U\to\R$は可微分関数で，行列$(g_{ij}(q))_{1\le ij\le n}$は正定値な対称行列となる．
        \item これは2-tensorの変換則を満たす．
        \item 各点上の内積を対応させる写像$g:p\mapsto g_p$を$C^r$級のRiemann計量といい，$g_{ij}$を$g$の$(x^1,\cdots,x^n)$に関する成分と呼ぶ．
    \end{enumerate}
\end{definition}

\begin{definition}[lengths of curves]\mbox{}
    \begin{enumerate}
        \item 接ベクトル$v\in T_p(M)$の局所座標系$(x^1,\cdots,x^n)$に関する成分を$(\xi^1,\cdots,\xi^n)$とすると，$\norm{v}^2:=g_p(v,v)=\sum^n_{i,j=1}g_{ij}(p)\xi^i\xi^j$と定める．
        これを$ds^2=g_{ij}dx^idx^j$と表す．
        \item 可微分曲線$\varphi:(a,b)\to M$は，連続関数$\norm{v_t}:(a,b)\to\R$を定めるから，これを用いて曲線$\varphi$の長さを$L(\varphi;c,d):=\int^d_c\norm{v_t}dt$とおく．
        \item 距離を，$d(a,b):=\inf\{L(\varphi)\in\R\mid\varphi はa,b\in Mを通る可微分曲線\}$と定める．
    \end{enumerate}
\end{definition}
\begin{remark}
    $(dx^i)_p(v)$は$v\in T_p(M)$の基底$x^i$に関する成分であるから，
    $\norm{v}^2=\sum_{i,j}g_{ij}(p)(dx^i)_p(v)(dx^j)_p(v)$と表せる．これの略記だと思うと良い．
\end{remark}

\begin{example}[Euclid空間]
    $(x^1,\cdots,x^n)$を標準座標として，$(\R^n,(dx^1)^2+(dx^2)^2+\cdots+(dx^n)^2)$を$n$次元Euclid空間という．
\end{example}

\begin{example}[Hyperbolic plane]
    $\paren{H,\frac{dzd\o{z}}{(\Im z)^2}}$または$\paren{H,\frac{(dx)^2+(dy)^2}{y^2}}$を\textbf{双曲的非ユークリッド空間}という．
\end{example}

\section{Riemann多様体の運動}

\begin{definition}[isometry, motion, isometry group]\mbox{}
    \begin{enumerate}
        \item 可微分写像$\varphi:M\to M'$が$\forall_{p\in M}\;\forall_{u\in T_p(M)}\;\norm{\varphi_*u}=\norm{u}$を満たすとき，\textbf{等距離写像}であるという．\footnote{$\varphi^*g=g'$に同値．}
        \item 微分同型$\varphi\in\Aut_\Diff(M)$が等距離写像になっているとき，これを$M$の\textbf{運動}という．
        \item 群$\Iso(M,g)\subsetneq\Aut_\Diff(M)$を\textbf{運動群}と呼ぶ．
    \end{enumerate}
\end{definition}

\begin{example}[Euclid空間の運動]
    次の２条件は同値．
    \begin{enumerate}
        \item $\varphi\in\Iso(\R^n,(dx^1)^2+\cdots+(dx^n)^2)$はEuclid空間である．
        \item $\varphi:\R^n\to\R^n$はaffine変換であって，$\varphi^*x^i=\sum_ja^i_jx^j+b^j$と表示したとすると，行列$(a^i_j)$は直交行列になる．
    \end{enumerate}
\end{example}

\begin{example}[双曲空間の運動]
    双曲空間$H$において，運動群を$\Iso(H)$，正則自己同型を$\Aut(H)$とする．
    このとき，$\Aut(H)$は$\Iso(H)$の指数が2の不変部分群で，$\Iso(H)=\Aut(H)+\inv\Aut(H)$が成り立つ．ただし，$\inv:z\mapsto -\o{z}$は$H$の微分同型だが正則自己同型ではない．
\end{example}

\chapter{接続：ベクトル束の幾何}

\begin{quotation}
    \begin{quote}
        空間に計量を定めると，多くの場合は計量に応じて曲率が定まる．
        曲率は計量の２階微分として与えられるので，「曲率が与えられた条件を満たす」という性質は，
        「多様体上で計量がある微分方程式を満たす」という形で表される．
        したがって，曲率が与えられた条件を満たすような計量を求めること，あるいはそのような計量が存在するかどうかを調べることは多様体上の解析学の問題になる．
        さらに，計量が満たすべき微分方程式に解が存在するかどうかは，多様体の位相や複素解析的な性質と関係している．
        また，微分幾何学は自然界を記述する言葉を与えるので，symplectic幾何学や理論物理学との関係も深い．
    \end{quote}
    \begin{quote}
        Differential and smooth manifolds are the basis for much of differential geometry. They are the analogs in differential geometry of what schemes are in algebraic geometry.\footnote{\url{https://ncatlab.org/nlab/show/smooth+manifold}}
    \end{quote}
\end{quotation}

\begin{thebibliography}{9}
    \bibitem{Tu}
    Loring W. Tu \textit{An Introduction to Manifolds}, Second edition (Springer, 2010)
    \bibitem{坪井}
    坪井俊『多様体入門』(2005)
    \bibitem{今野}
    今野宏『微分幾何学』(2013)
\end{thebibliography}

\end{document}